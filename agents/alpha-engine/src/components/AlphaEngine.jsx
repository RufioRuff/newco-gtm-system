import React, { useState, useEffect, useMemo, useRef } from 'react';
import * as d3 from 'd3';
import { Search, TrendingUp, Users, BarChart3, ChevronRight, ChevronDown, ArrowUpRight, ArrowDownRight, Filter, Plus, Bell, Zap, Target, DollarSign, Globe, Clock, Activity, Layers, GitBranch, Shield, Award, Briefcase, PieChart, Eye, Star, Building2, CheckCircle, AlertTriangle, ArrowRight, Upload, FileText, Database, RefreshCw, Link, Phone, Cpu, Code, Share2 } from 'lucide-react';

// ════════════════════════════════════════════════════
// DESIGN SYSTEM
// ════════════════════════════════════════════════════
const T = {
  bg: '#06090f', bgCard: '#0c1018', bgCardHover: '#131b28',
  bgSurface: '#0a0f18', bgAccent: '#111a2a', bgElevated: '#141e30',
  border: '#1a2438', borderLight: '#253348', borderFocus: '#2a4060',
  text: '#e4eaf4', textMuted: '#7b8da4', textDim: '#4a5d74',
  accent: '#00e4b8', accentMuted: '#00e4b840', accentBg: '#00e4b812',
  green: '#22c55e', greenBg: '#22c55e15',
  blue: '#3b82f6', blueBg: '#3b82f615',
  amber: '#f59e0b', amberBg: '#f59e0b15',
  red: '#ef4444', redBg: '#ef444415',
  purple: '#a78bfa', purpleBg: '#a78bfa15',
  cyan: '#22d3ee', cyanBg: '#22d3ee15',
  gold: '#fbbf24',
};

const mono = "'JetBrains Mono', 'SF Mono', 'Fira Code', monospace";
const sans = "'DM Sans', 'Inter', -apple-system, sans-serif";

// ════════════════════════════════════════════════════
// DATA MODELS
// ════════════════════════════════════════════════════
const TEAM = [
  { id: 'jason', name: 'Jason Goldman', role: 'CSO', connections: 324, deals: 47 },
  { id: 'ken', name: 'Ken Wallace', role: 'CIO', connections: 200, deals: 62 },
  { id: 'bob', name: 'Bob Burlinson', role: 'CIS', connections: 180, deals: 38 },
  { id: 'matthew', name: 'Matthew Goldman', role: 'COO', connections: 150, deals: 29 },
  { id: 'brett', name: 'Brett Wilson', role: 'Partner', connections: 120, deals: 22 },
];

const FUNDS = [
  { id: 1, name: 'Founders Fund VII', gp: 'Founders Fund', vintage: 2024, strategy: 'AI/ML', status: 'Active', committed: 25, called: 12.5, nav: 18.2, tvpi: 1.46, irr: 28.3, dpi: 0.2, tier: 'Core', sector: 'AI Safety', companies: 14 },
  { id: 2, name: 'Lux Capital VI', gp: 'Lux Capital', vintage: 2023, strategy: 'Deep Tech', status: 'Active', committed: 15, called: 11.2, nav: 16.8, tvpi: 1.50, irr: 22.1, dpi: 0.3, tier: 'Core', sector: 'AI Safety', companies: 18 },
  { id: 3, name: 'a16z Infra Fund', gp: 'Andreessen Horowitz', vintage: 2024, strategy: 'AI Infra', status: 'Deploying', committed: 50, called: 18, nav: 22.5, tvpi: 1.25, irr: 18.7, dpi: 0.1, tier: 'Strategic', sector: 'AI Infrastructure', companies: 22 },
  { id: 4, name: 'Benchmark X', gp: 'Benchmark', vintage: 2023, strategy: 'Consumer', status: 'Active', committed: 20, called: 15, nav: 24.3, tvpi: 1.62, irr: 31.2, dpi: 0.4, tier: 'Core', sector: 'Trust & Safety', companies: 8 },
  { id: 5, name: 'Greylock XVII', gp: 'Greylock Partners', vintage: 2024, strategy: 'Enterprise', status: 'Deploying', committed: 30, called: 10, nav: 11.8, tvpi: 1.18, irr: 15.4, dpi: 0.0, tier: 'Exploration', sector: 'GovTech', companies: 12 },
  { id: 6, name: 'NEA 19', gp: 'New Enterprise Associates', vintage: 2022, strategy: 'Multi-stage', status: 'Harvesting', committed: 40, called: 38, nav: 62.1, tvpi: 1.85, irr: 24.6, dpi: 0.8, tier: 'Core', sector: 'AI Safety', companies: 31 },
  { id: 7, name: 'Sequoia US VIII', gp: 'Sequoia Capital', vintage: 2023, strategy: 'AI/SaaS', status: 'Active', committed: 35, called: 22, nav: 30.8, tvpi: 1.40, irr: 20.5, dpi: 0.2, tier: 'Strategic', sector: 'AI Infrastructure', companies: 16 },
  { id: 8, name: 'Khosla Ventures IX', gp: 'Khosla Ventures', vintage: 2024, strategy: 'Climate/AI', status: 'Deploying', committed: 20, called: 6, nav: 7.2, tvpi: 1.20, irr: 25.0, dpi: 0.0, tier: 'Exploration', sector: 'AI Safety', companies: 9 },
];

// Portfolio Company Look-Through
const PORTFOLIO_COMPANIES = [
  { id: 1, name: 'Anthropic', sector: 'AI Safety', stage: 'Series D', valuation: 61500, ownership: 0.08, fund: 'Founders Fund VII', vintage: 2024, status: 'markup', growth: 340, revenue: 2800, employees: 1200, moat: 'Constitutional AI IP', exitPath: 'IPO 2027', signalScore: 98 },
  { id: 2, name: 'Anduril Industries', sector: 'GovTech', stage: 'Series F', valuation: 28000, ownership: 0.12, fund: 'Lux Capital VI', vintage: 2023, status: 'markup', growth: 180, revenue: 1200, employees: 3500, moat: 'DoD contracts + Lattice OS', exitPath: 'IPO 2026', signalScore: 95 },
  { id: 3, name: 'Scale AI', sector: 'AI Infrastructure', stage: 'Series E', valuation: 13800, ownership: 0.05, fund: 'a16z Infra Fund', vintage: 2024, status: 'markup', growth: 95, revenue: 800, employees: 900, moat: 'Data labeling network effects', exitPath: 'IPO 2027', signalScore: 88 },
  { id: 4, name: 'Palantir AIP', sector: 'GovTech', stage: 'Public', valuation: 180000, ownership: 0.003, fund: 'NEA 19', vintage: 2022, status: 'public', growth: 28, revenue: 3200, employees: 3800, moat: 'Gov clearance + switching cost', exitPath: 'Public (PLTR)', signalScore: 82 },
  { id: 5, name: 'Shield AI', sector: 'AI Safety', stage: 'Series F', valuation: 5200, ownership: 0.15, fund: 'Benchmark X', vintage: 2023, status: 'markup', growth: 220, revenue: 400, employees: 800, moat: 'Autonomous defense systems', exitPath: 'IPO 2028', signalScore: 91 },
  { id: 6, name: 'Databricks', sector: 'AI Infrastructure', stage: 'Series I', valuation: 62000, ownership: 0.02, fund: 'a16z Infra Fund', vintage: 2024, status: 'markup', growth: 65, revenue: 2400, employees: 7000, moat: 'Lakehouse + Unity Catalog', exitPath: 'IPO 2026', signalScore: 93 },
  { id: 7, name: 'Verkada', sector: 'Trust & Safety', stage: 'Series D', valuation: 3200, ownership: 0.08, fund: 'Benchmark X', vintage: 2023, status: 'flat', growth: 45, revenue: 320, employees: 2100, moat: 'Cloud-managed physical security', exitPath: 'IPO 2028', signalScore: 76 },
  { id: 8, name: 'Crusoe Energy', sector: 'AI Infrastructure', stage: 'Series C', valuation: 2800, ownership: 0.1, fund: 'Khosla Ventures IX', vintage: 2024, status: 'markup', growth: 310, revenue: 600, employees: 400, moat: 'Stranded gas → GPU compute', exitPath: 'Strategic 2027', signalScore: 87 },
  { id: 9, name: 'Contextual AI', sector: 'AI Safety', stage: 'Series B', valuation: 1200, ownership: 0.2, fund: 'Founders Fund VII', vintage: 2024, status: 'markup', growth: 420, revenue: 45, employees: 85, moat: 'RAG grounding patents', exitPath: 'M&A 2027', signalScore: 84 },
  { id: 10, name: 'Armada', sector: 'GovTech', stage: 'Series A', valuation: 480, ownership: 0.25, fund: 'Lux Capital VI', vintage: 2023, status: 'markup', growth: 600, revenue: 18, employees: 52, moat: 'Edge AI for austere environments', exitPath: 'Series B 2026', signalScore: 79 },
  { id: 11, name: 'Robust Intelligence', sector: 'AI Safety', stage: 'Series C', valuation: 860, ownership: 0.12, fund: 'NEA 19', vintage: 2022, status: 'markup', growth: 150, revenue: 55, employees: 120, moat: 'AI validation & red-teaming', exitPath: 'M&A 2027', signalScore: 86 },
  { id: 12, name: 'Drata', sector: 'Trust & Safety', stage: 'Series C', valuation: 2700, ownership: 0.06, fund: 'Greylock XVII', vintage: 2024, status: 'flat', growth: 35, revenue: 180, employees: 650, moat: 'Continuous compliance automation', exitPath: 'IPO 2028', signalScore: 74 },
];

// Secondary Market Opportunities
const SECONDARIES = [
  { id: 1, fund: 'Sequoia Global Growth III', gp: 'Sequoia', vintage: 2021, nav: 2800, askPrice: 82, bidPrice: 78, spread: 4, tvpi: 1.35, remaining: 6.2, topCo: 'Stripe, Databricks, Wiz', thesis: 'Post-correction re-entry at 22% discount to last NAV. Core AI infra exposure.', score: 94, urgency: 'high', daysListed: 8 },
  { id: 2, fund: 'a16z Crypto Fund IV', gp: 'Andreessen Horowitz', vintage: 2022, nav: 400, askPrice: 55, bidPrice: 48, spread: 7, tvpi: 0.85, remaining: 8.1, topCo: 'Solana ecosystem, Uniswap', thesis: 'Deep discount on recovering crypto portfolio. Asymmetric upside if BTC cycle continues.', score: 72, urgency: 'medium', daysListed: 34 },
  { id: 3, fund: 'Insight Partners XII', gp: 'Insight Partners', vintage: 2022, nav: 5200, askPrice: 88, bidPrice: 84, spread: 4, tvpi: 1.12, remaining: 7.5, topCo: 'Veeam, JFrog, Armis', thesis: 'Cybersecurity-heavy portfolio at 16% discount. Multiple near-term IPO candidates.', score: 89, urgency: 'high', daysListed: 12 },
  { id: 4, fund: 'Tiger Global PIP 15', gp: 'Tiger Global', vintage: 2021, nav: 8100, askPrice: 62, bidPrice: 57, spread: 5, tvpi: 0.92, remaining: 5.8, topCo: 'Various late-stage tech', thesis: 'Distressed seller. Portfolio marked conservatively. 38-43% discount creates margin of safety.', score: 81, urgency: 'medium', daysListed: 45 },
  { id: 5, fund: 'Founders Fund VI', gp: 'Founders Fund', vintage: 2020, nav: 1900, askPrice: 115, bidPrice: 108, spread: 7, tvpi: 2.15, remaining: 3.2, topCo: 'SpaceX, Anduril, Palantir', thesis: 'Premium justified by SpaceX exposure alone. Near-term distributions expected from Palantir position.', score: 96, urgency: 'high', daysListed: 3 },
  { id: 6, fund: 'Lightspeed IV', gp: 'Lightspeed VP', vintage: 2022, nav: 1400, askPrice: 76, bidPrice: 71, spread: 5, tvpi: 1.08, remaining: 7.8, topCo: 'Rubrik, Mulesoft, various', thesis: 'Enterprise SaaS focus at 24-29% discount. Rubrik IPO pop not yet reflected in marks.', score: 83, urgency: 'medium', daysListed: 21 },
  { id: 7, fund: 'GV Fund VII', gp: 'GV (Google Ventures)', vintage: 2023, nav: 600, askPrice: 92, bidPrice: 87, spread: 5, tvpi: 1.05, remaining: 8.9, topCo: 'AI-native portfolio', thesis: 'Google ecosystem deal flow advantage. Early vintage with full deployment runway.', score: 77, urgency: 'low', daysListed: 60 },
  { id: 8, fund: 'Coatue Growth II', gp: 'Coatue Management', vintage: 2021, nav: 3200, askPrice: 71, bidPrice: 66, spread: 5, tvpi: 0.98, remaining: 5.5, topCo: 'Chime, Airtable, Navan', thesis: 'Near-par discount on recovering portfolio. Multiple markups expected in next 2 quarters.', score: 78, urgency: 'medium', daysListed: 28 },
];

// Public Market Comparable Vehicles
const PUBLIC_COMPS = [
  { ticker: 'NEWCO', name: 'New Co Public Fund', nav: 24.38, price: 24.38, premDisc: 0, divYield: 0, expRatio: 0, tvpi: 1.42, aum: 235, focus: 'AI Safety VC FoF', structure: 'Listed CEF' },
  { ticker: 'ARCC', name: 'Ares Capital Corp', nav: 19.85, price: 21.42, premDisc: 7.9, divYield: 8.8, expRatio: 3.1, tvpi: 1.15, aum: 25400, focus: 'Private Credit', structure: 'BDC' },
  { ticker: 'HTGC', name: 'Hercules Capital', nav: 11.78, price: 19.24, premDisc: 63.3, divYield: 9.2, expRatio: 2.8, tvpi: 1.22, aum: 3800, focus: 'Venture Lending', structure: 'BDC' },
  { ticker: 'VCSH', name: 'Vanguard Short-Term', nav: 77.21, price: 77.18, premDisc: -0.04, divYield: 4.8, expRatio: 0.04, tvpi: 1.0, aum: 45000, focus: 'Short-Term Bonds', structure: 'ETF' },
  { ticker: 'PSP', name: 'Invesco Global PE', nav: 14.20, price: 12.85, premDisc: -9.5, divYield: 5.1, expRatio: 1.44, tvpi: 1.08, aum: 210, focus: 'PE Listed Fund', structure: 'CEF' },
  { ticker: 'GSBD', name: 'Goldman Sachs BDC', nav: 13.82, price: 14.05, premDisc: 1.7, divYield: 10.4, expRatio: 2.5, tvpi: 1.12, aum: 3600, focus: 'Private Credit', structure: 'BDC' },
];

// J-Curve Data by Vintage
const JCURVE_DATA = {
  2022: [
    { q: 'Q1 22', nav: -2.1 }, { q: 'Q2 22', nav: -4.8 }, { q: 'Q3 22', nav: -6.2 }, { q: 'Q4 22', nav: -5.1 },
    { q: 'Q1 23', nav: -3.8 }, { q: 'Q2 23', nav: -1.2 }, { q: 'Q3 23', nav: 2.4 }, { q: 'Q4 23', nav: 8.1 },
    { q: 'Q1 24', nav: 14.6 }, { q: 'Q2 24', nav: 22.3 }, { q: 'Q3 24', nav: 31.8 }, { q: 'Q4 24', nav: 42.5 },
    { q: 'Q1 25', nav: 52.1 }, { q: 'Q2 25', nav: 61.4 }, { q: 'Q3 25', nav: 72.8 }, { q: 'Q4 25', nav: 85.0 },
  ],
  2023: [
    { q: 'Q1 23', nav: -1.8 }, { q: 'Q2 23', nav: -3.5 }, { q: 'Q3 23', nav: -5.8 }, { q: 'Q4 23', nav: -4.2 },
    { q: 'Q1 24', nav: -2.1 }, { q: 'Q2 24', nav: 1.5 }, { q: 'Q3 24', nav: 6.8 }, { q: 'Q4 24', nav: 14.2 },
    { q: 'Q1 25', nav: 22.8 }, { q: 'Q2 25', nav: 30.5 }, { q: 'Q3 25', nav: 38.2 }, { q: 'Q4 25', nav: 46.1 },
  ],
  2024: [
    { q: 'Q1 24', nav: -1.2 }, { q: 'Q2 24', nav: -2.8 }, { q: 'Q3 24', nav: -4.1 }, { q: 'Q4 24', nav: -3.5 },
    { q: 'Q1 25', nav: -1.8 }, { q: 'Q2 25', nav: 0.8 }, { q: 'Q3 25', nav: 4.2 }, { q: 'Q4 25', nav: 9.5 },
  ],
};

// NAV History for Premium/Discount tracking
const NAV_HISTORY = [
  { date: 'Jul 26', nav: 20.00, price: 20.00, premDisc: 0 },
  { date: 'Aug 26', nav: 20.40, price: 19.80, premDisc: -2.9 },
  { date: 'Sep 26', nav: 20.85, price: 20.10, premDisc: -3.6 },
  { date: 'Oct 26', nav: 21.20, price: 20.90, premDisc: -1.4 },
  { date: 'Nov 26', nav: 21.80, price: 21.50, premDisc: -1.4 },
  { date: 'Dec 26', nav: 22.10, price: 22.40, premDisc: 1.4 },
  { date: 'Jan 27', nav: 22.90, price: 23.20, premDisc: 1.3 },
  { date: 'Feb 27', nav: 23.50, price: 24.10, premDisc: 2.6 },
  { date: 'Mar 27', nav: 23.85, price: 24.38, premDisc: 2.2 },
];

const PIPELINE = [
  { id: 1, name: 'Shield AI Fund II', gp: 'Shield AI Ventures', stage: 'Due Diligence', score: 92, sector: 'AI Safety', size: 150, owner: 'Ken', daysInStage: 12, nextAction: 'IC Meeting', priority: 'high' },
  { id: 2, name: 'Anduril Growth', gp: 'Anduril Industries', stage: 'Term Sheet', score: 88, sector: 'GovTech', size: 500, owner: 'Jason', daysInStage: 5, nextAction: 'Legal Review', priority: 'high' },
  { id: 3, name: 'Anthropic Safety', gp: 'Anthropic Ventures', stage: 'Screening', score: 95, sector: 'AI Safety', size: 200, owner: 'Bob', daysInStage: 3, nextAction: 'First Meeting', priority: 'high' },
  { id: 4, name: 'Palantir Foundry II', gp: 'Palantir Capital', stage: 'Due Diligence', score: 78, sector: 'GovTech', size: 300, owner: 'Ken', daysInStage: 22, nextAction: 'Reference Checks', priority: 'medium' },
  { id: 5, name: 'Scale AI Seed', gp: 'Scale Ventures', stage: 'Monitoring', score: 71, sector: 'AI Infrastructure', size: 80, owner: 'Brett', daysInStage: 45, nextAction: 'Follow-up Call', priority: 'low' },
  { id: 6, name: 'OpenAI Ecosystem', gp: 'OpenAI Fund', stage: 'Screening', score: 90, sector: 'AI Safety', size: 1000, owner: 'Jason', daysInStage: 1, nextAction: 'Deck Review', priority: 'high' },
  { id: 7, name: 'Rebellion Defense', gp: 'Rebellion Capital', stage: 'IC Review', score: 84, sector: 'Trust & Safety', size: 120, owner: 'Bob', daysInStage: 8, nextAction: 'Vote', priority: 'medium' },
];

const LPS = [
  { id: 1, name: 'J.P. Morgan Wealth', contact: 'Alistair Savides', role: 'Manager Research', aum: '14T+', tier: 'Platinum', shares: 500000, status: 'Committed', potential: '50M', relationship: 'Ken' },
  { id: 2, name: 'Goldman Sachs PWM', contact: 'John Goldstein', role: 'Global Head', aum: '2T+', tier: 'Platinum', shares: 350000, status: 'In Discussion', potential: '35M', relationship: 'Jason' },
  { id: 3, name: 'Mercer Advisors', contact: 'Don Calcagni', role: 'CIO', aum: '$92B', tier: 'Gold', shares: 250000, status: 'Committed', potential: '25M', relationship: 'Bob' },
  { id: 4, name: 'Bessemer Trust', contact: 'Mike Selfridge', role: 'Managing Director', aum: '$150B+', tier: 'Platinum', shares: 200000, status: 'Due Diligence', potential: '15M', relationship: 'Ken' },
  { id: 5, name: 'Pathstone', contact: 'Eric Alt', role: 'Co-CIO', aum: '$100B+', tier: 'Gold', shares: 150000, status: 'Committed', potential: '10M', relationship: 'Jason' },
  { id: 6, name: 'Northern Trust', contact: 'Stacy Singer', role: 'National Lead', aum: '$1.5T+', tier: 'Platinum', shares: 0, status: 'Prospecting', potential: '40M', relationship: 'Matthew' },
  { id: 7, name: 'Robertson Stephens', contact: 'Stuart Katz', role: 'CIO', aum: '$6B', tier: 'Silver', shares: 100000, status: 'Committed', potential: '5M', relationship: 'Brett' },
];

const NETWORK_NODES = [
  ...TEAM.map(t => ({ ...t, type: 'team', group: 0 })),
  ...FUNDS.map(f => ({ id: `fund-${f.id}`, name: f.name, type: 'fund', group: 1, value: f.committed })),
  ...LPS.map(l => ({ id: `lp-${l.id}`, name: l.name, type: 'lp', group: 2, value: parseInt(l.potential) || 10 })),
  ...PIPELINE.slice(0, 4).map(p => ({ id: `deal-${p.id}`, name: p.name, type: 'deal', group: 3, value: p.score })),
];

const NETWORK_LINKS = [
  { source: 'ken', target: 'fund-1', strength: 0.9 }, { source: 'ken', target: 'fund-2', strength: 0.8 },
  { source: 'jason', target: 'fund-3', strength: 0.7 }, { source: 'bob', target: 'fund-4', strength: 0.85 },
  { source: 'brett', target: 'fund-5', strength: 0.6 }, { source: 'ken', target: 'fund-6', strength: 0.95 },
  { source: 'jason', target: 'fund-7', strength: 0.75 }, { source: 'bob', target: 'fund-8', strength: 0.65 },
  { source: 'ken', target: 'lp-1', strength: 0.9 }, { source: 'jason', target: 'lp-2', strength: 0.85 },
  { source: 'bob', target: 'lp-3', strength: 0.8 }, { source: 'ken', target: 'lp-4', strength: 0.7 },
  { source: 'jason', target: 'lp-5', strength: 0.75 }, { source: 'matthew', target: 'lp-6', strength: 0.6 },
  { source: 'ken', target: 'deal-1', strength: 0.9 }, { source: 'jason', target: 'deal-2', strength: 0.85 },
  { source: 'bob', target: 'deal-3', strength: 0.95 }, { source: 'ken', target: 'deal-4', strength: 0.7 },
  { source: 'fund-1', target: 'lp-1', strength: 0.4 }, { source: 'fund-3', target: 'lp-2', strength: 0.5 },
  { source: 'deal-1', target: 'fund-2', strength: 0.6 }, { source: 'deal-3', target: 'fund-1', strength: 0.7 },
];

// ════════════════════════════════════════════════════
// PRIMITIVES
// ════════════════════════════════════════════════════
const Badge = ({ children, color = T.accent, size = 'sm' }) => (
  <span style={{ display: 'inline-flex', alignItems: 'center', padding: size==='xs'?'1px 5px':'2px 8px', borderRadius: size==='xs'?2:4, fontSize: size==='xs'?8:10, fontWeight: 700, letterSpacing: '0.3px', color, background: `${color}12`, border: `1px solid ${color}20`, textTransform: 'uppercase', whiteSpace: 'nowrap', lineHeight: 1.2 }}>{children}</span>
);

// Tooltip: wrap any element for hover detail
const Tip = ({ children, text, color = T.text }) => {
  const [show, setShow] = useState(false);
  const [pos, setPos] = useState({x:0,y:0});
  const ref = useRef(null);
  return (
    <span ref={ref} onMouseEnter={(e)=>{const r=e.currentTarget.getBoundingClientRect();setPos({x:r.left+r.width/2,y:r.top-4});setShow(true);}} onMouseLeave={()=>setShow(false)} style={{position:'relative',cursor:'help'}}>
      {children}
      {show&&<span style={{position:'fixed',left:pos.x,top:pos.y,transform:'translate(-50%,-100%)',padding:'5px 10px',background:T.bgElevated,border:`1px solid ${T.borderLight}`,borderRadius:6,fontSize:11,color,whiteSpace:'nowrap',zIndex:100,boxShadow:'0 4px 16px #0008',fontFamily:sans,fontWeight:500,pointerEvents:'none'}}>{text}</span>}
    </span>
  );
};

const Stat = ({ label, value, sub, icon: Icon, trend, color = T.accent }) => (
  <div style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '14px 16px', position: 'relative', overflow: 'hidden', transition: 'border-color .15s, transform .15s' }} onMouseEnter={e=>{e.currentTarget.style.borderColor=color+'50';e.currentTarget.style.transform='translateY(-1px)';}} onMouseLeave={e=>{e.currentTarget.style.borderColor=T.border;e.currentTarget.style.transform='translateY(0)';}}>
    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: 2, background: `linear-gradient(90deg, ${color}80, transparent)` }}/>
    {Icon && <div style={{ position: 'absolute', top: 10, right: 10, padding: 5, borderRadius: 6, background: `${color}08` }}><Icon size={16} color={color} style={{ opacity: 0.5 }} /></div>}
    <div style={{ fontSize: 9, color: T.textMuted, textTransform: 'uppercase', letterSpacing: '0.8px', marginBottom: 5, fontWeight: 700 }}>{label}</div>
    <div style={{ fontSize: 24, fontWeight: 800, color, fontFamily: mono, letterSpacing: '-1px' }}>{value}</div>
    {(sub || trend != null) && (
      <div style={{ display: 'flex', alignItems: 'center', gap: 5, marginTop: 4 }}>
        {trend != null && <span style={{ display: 'flex', alignItems: 'center', gap: 1, fontSize: 11, fontWeight: 600, color: trend > 0 ? T.green : T.red }}>{trend > 0 ? <ArrowUpRight size={13} /> : <ArrowDownRight size={13} />}{Math.abs(trend)}%</span>}
        {sub && <span style={{ fontSize: 10, color: T.textDim }}>{sub}</span>}
      </div>
    )}
  </div>
);

const Bar = ({ value, max, color = T.accent, h = 4 }) => (
  <div style={{ width: '100%', height: h, background: T.bgAccent, borderRadius: h, overflow: 'hidden' }}>
    <div style={{ width: `${Math.min((value / max) * 100, 100)}%`, height: '100%', background: color, borderRadius: h, transition: 'width 0.5s ease' }} />
  </div>
);

const Card = ({ title, children, action, style: s }) => (
  <div style={{ background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, overflow: 'hidden', transition: 'border-color .15s', ...s }} onMouseEnter={e=>e.currentTarget.style.borderColor=T.borderLight} onMouseLeave={e=>e.currentTarget.style.borderColor=T.border}>
    {title && (
      <div style={{ padding: '10px 16px', borderBottom: `1px solid ${T.border}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: `${T.bgAccent}60` }}>
        <span style={{ fontSize: 11, fontWeight: 700, color: T.text, textTransform: 'uppercase', letterSpacing: '0.4px' }}>{title}</span>
        {action}
      </div>
    )}
    {children}
  </div>
);

const TH = ({ children, align = 'left', onClick, style: s }) => (
  <th onClick={onClick} style={{ padding: '10px 12px', textAlign: align, color: T.textMuted, fontWeight: 700, fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.5px', cursor: onClick ? 'pointer' : 'default', whiteSpace: 'nowrap', borderBottom: `2px solid ${T.border}`, background: `${T.bgAccent}80`, position: 'sticky', top: 0, zIndex: 1, ...s }}>{children}</th>
);

const TD = ({ children, align = 'left', mono: m, bold: b, color: c, style: s, colSpan }) => (
  <td colSpan={colSpan} style={{ padding: '9px 12px', textAlign: align, fontFamily: m ? mono : sans, fontWeight: b ? 700 : 400, color: c || T.text, fontSize: 11, whiteSpace: 'nowrap', ...s }}>{children}</td>
);

const TR = ({ children, onClick, highlight }) => {
  const [hov, setHov] = useState(false);
  return <tr onMouseEnter={() => setHov(true)} onMouseLeave={() => setHov(false)} onClick={onClick} style={{ background: hov ? T.bgCardHover : (highlight ? `${T.accentBg}` : 'transparent'), cursor: onClick ? 'pointer' : 'default', borderBottom: `1px solid ${T.border}40`, transition: 'background .1s' }}>{children}</tr>;
};

// Collapsible Section for progressive disclosure
const Section = ({ title, children, defaultOpen = true, color = T.accent, count }) => {
  const [open, setOpen] = useState(defaultOpen);
  return (
    <div style={{ marginBottom: 10 }}>
      <button onClick={() => setOpen(!open)} style={{ display: 'flex', alignItems: 'center', gap: 6, width: '100%', padding: '8px 12px', background: open ? `${color}08` : T.bgAccent, border: `1px solid ${open ? color + '30' : T.border}`, borderRadius: open ? '6px 6px 0 0' : 6, cursor: 'pointer', fontFamily: sans, transition: 'all .15s' }}>
        <ChevronDown size={12} color={color} style={{ transform: open ? 'rotate(0)' : 'rotate(-90deg)', transition: 'transform .15s' }} />
        <span style={{ fontSize: 11, fontWeight: 700, color: open ? color : T.textMuted }}>{title}</span>
        {count != null && <span style={{ fontSize: 9, color: T.textDim, fontFamily: mono, marginLeft: 2 }}>({count})</span>}
        <span style={{ marginLeft: 'auto', fontSize: 9, color: T.textDim }}>{open ? 'collapse' : 'expand'}</span>
      </button>
      {open && <div style={{ border: `1px solid ${open ? color + '30' : T.border}`, borderTop: 'none', borderRadius: '0 0 6px 6px', overflow: 'hidden' }}>{children}</div>}
    </div>
  );
};

// ════════════════════════════════════════════════════
// NETWORK GRAPH
// ════════════════════════════════════════════════════
const NetworkGraph = ({ width = 720, height = 400 }) => {
  const svgRef = useRef(null);
  const [focusNode, setFocusNode] = useState(null);
  const [tooltip, setTooltip] = useState(null);
  useEffect(() => {
    if (!svgRef.current) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const cMap = { team: T.accent, fund: T.blue, lp: T.amber, deal: T.purple };
    const sMap = { team: 18, fund: 11, lp: 9, deal: 7 };
    const iconMap = { team: '●', fund: '◆', lp: '▲', deal: '★' };
    const nodes = NETWORK_NODES.map(d => ({ ...d, x: width/2 + (Math.random()-0.5)*180, y: height/2 + (Math.random()-0.5)*180 }));
    const nMap = {}; nodes.forEach(n => { nMap[n.id] = n; });
    const links = NETWORK_LINKS.filter(l => nMap[l.source] && nMap[l.target]).map(d => ({ ...d }));
    // Radial positioning hints: team center, funds inner ring, lps mid ring, deals outer
    const ringR = { team: 0, fund: 110, lp: 180, deal: 240 };
    const sim = d3.forceSimulation(nodes)
      .force('link', d3.forceLink(links).id(d => d.id).distance(d => {
        const s = typeof d.source === 'object' ? d.source : nMap[d.source];
        const t = typeof d.target === 'object' ? d.target : nMap[d.target];
        if (s?.type === 'team' && t?.type === 'team') return 50;
        return 70 + (1 - d.strength) * 60;
      }).strength(d => d.strength * 0.4))
      .force('charge', d3.forceManyBody().strength(d => d.type === 'team' ? -250 : -120))
      .force('center', d3.forceCenter(width/2, height/2))
      .force('collision', d3.forceCollide().radius(d => (sMap[d.type]||6)+6))
      .force('r', d3.forceRadial(d => ringR[d.type] || 150, width/2, height/2).strength(d => d.type === 'team' ? 0.15 : 0.06))
      .force('x', d3.forceX(width/2).strength(0.02))
      .force('y', d3.forceY(height/2).strength(0.02));
    // Defs
    const defs = svg.append('defs');
    // Glow filter
    const glow = defs.append('filter').attr('id','netGlow').attr('x','-50%').attr('y','-50%').attr('width','200%').attr('height','200%');
    glow.append('feGaussianBlur').attr('stdDeviation','4').attr('result','blur');
    glow.append('feMerge').call(m => { m.append('feMergeNode').attr('in','blur'); m.append('feMergeNode').attr('in','SourceGraphic'); });
    // Node gradients
    Object.entries(cMap).forEach(([type, color]) => {
      const grad = defs.append('radialGradient').attr('id', `netGrad-${type}`);
      grad.append('stop').attr('offset', '0%').attr('stop-color', color).attr('stop-opacity', 0.6);
      grad.append('stop').attr('offset', '60%').attr('stop-color', color).attr('stop-opacity', 0.2);
      grad.append('stop').attr('offset', '100%').attr('stop-color', color).attr('stop-opacity', 0.04);
    });
    // Concentric guide rings
    const g = svg.append('g');
    svg.call(d3.zoom().scaleExtent([0.3,4]).on('zoom', e => g.attr('transform', e.transform)));
    [110, 180, 240].forEach(r => {
      g.append('circle').attr('cx', width/2).attr('cy', height/2).attr('r', r)
        .attr('fill', 'none').attr('stroke', T.border).attr('stroke-width', 0.3)
        .attr('stroke-dasharray', '3,6').attr('opacity', 0.4);
    });
    // Ring labels
    [{r:110,l:'Funds'},{r:180,l:'LPs & Platforms'},{r:240,l:'Pipeline'}].forEach(({r,l}) => {
      g.append('text').attr('x', width/2 + r + 4).attr('y', height/2 - r + 4)
        .attr('fill', T.textDim).attr('font-size', 7).attr('font-family', mono).attr('opacity', 0.5).text(l);
    });
    // Links
    const linkG = g.append('g');
    const link = linkG.selectAll('line').data(links).join('line')
      .attr('stroke', d => {
        const s = typeof d.source === 'object' ? d.source : nMap[d.source];
        return cMap[s?.type] || T.textDim;
      })
      .attr('stroke-opacity', d => focusNode ? 0.03 : d.strength * 0.2)
      .attr('stroke-width', d => Math.max(0.5, d.strength * 2.5));
    // Animated flow particles on strong links
    links.filter(l => l.strength >= 0.8).forEach((l, i) => {
      const particle = linkG.append('circle').attr('r', 1.5)
        .attr('fill', T.accent).attr('opacity', 0);
      (function animateParticle() {
        const src = typeof l.source === 'object' ? l.source : nMap[l.source];
        const tgt = typeof l.target === 'object' ? l.target : nMap[l.target];
        if (!src || !tgt) return;
        particle
          .attr('cx', src.x || 0).attr('cy', src.y || 0).attr('opacity', 0)
          .transition().delay(i * 1200 + Math.random() * 2000).duration(200).attr('opacity', 0.6)
          .transition().duration(1800 + Math.random() * 1000).ease(d3.easeCubicInOut)
          .attr('cx', tgt.x || 0).attr('cy', tgt.y || 0)
          .transition().duration(200).attr('opacity', 0)
          .on('end', animateParticle);
      })();
    });
    // Nodes
    const node = g.append('g').selectAll('g').data(nodes).join('g').style('cursor','pointer');
    // Outer glow ring
    node.append('circle')
      .attr('r', d => (sMap[d.type]||6) + 10)
      .attr('fill', d => `url(#netGrad-${d.type})`);
    // Main node
    node.append('circle')
      .attr('class', 'main-circle')
      .attr('r', d => sMap[d.type]||6)
      .attr('fill', d => d.type === 'team' ? `${cMap[d.type]}28` : `${cMap[d.type]||T.textDim}14`)
      .attr('stroke', d => cMap[d.type]||T.textDim)
      .attr('stroke-width', d => d.type === 'team' ? 2.5 : 1.5)
      .attr('filter', d => d.type === 'team' ? 'url(#netGlow)' : null);
    // Inner icon for team nodes
    node.filter(d => d.type === 'team').append('text')
      .attr('text-anchor', 'middle').attr('dy', 1)
      .attr('fill', T.accent).attr('font-size', 10).attr('font-weight', 900)
      .text(d => (d.name || '').charAt(0));
    // Pulsing ring for team
    node.filter(d => d.type === 'team').append('circle')
      .attr('class', 'pulse-ring')
      .attr('r', d => sMap[d.type]).attr('fill', 'none')
      .attr('stroke', T.accent).attr('stroke-width', 1).attr('stroke-opacity', 0)
      .each(function(d) {
        const el = d3.select(this);
        const baseR = sMap[d.type];
        (function pulse() {
          el.attr('r', baseR).attr('stroke-opacity', 0.5)
            .transition().duration(2500).ease(d3.easeSinOut)
            .attr('r', baseR + 20).attr('stroke-opacity', 0)
            .on('end', pulse);
        })();
      });
    // Labels
    node.append('text')
      .text(d => d.type === 'team' ? d.name.split(' ')[0] : (d.name||'').split(' ').slice(0,2).join(' ').slice(0,14))
      .attr('text-anchor', 'middle')
      .attr('dy', d => (sMap[d.type]||6) + 13)
      .attr('fill', d => d.type === 'team' ? T.text : T.textMuted)
      .attr('font-size', d => d.type === 'team' ? 9 : 7)
      .attr('font-weight', d => d.type === 'team' ? 700 : 400)
      .attr('font-family', d => d.type === 'team' ? sans : mono);
    // Value label for non-team
    node.filter(d => d.type !== 'team' && d.value).append('text')
      .attr('text-anchor', 'middle').attr('dy', 3)
      .attr('fill', d => cMap[d.type]).attr('font-size', 7).attr('font-weight', 700).attr('font-family', mono)
      .text(d => d.type === 'fund' ? `$${d.value}M` : d.type === 'lp' ? `$${d.value}M` : d.value);
    // Interactions
    node.on('mouseenter', function(e, d) {
      d3.select(this).select('.main-circle').transition().duration(200)
        .attr('stroke-width', 3.5).attr('r', (sMap[d.type]||6) + 3);
      // Highlight connected links
      link.transition().duration(200).attr('stroke-opacity', l => {
        const sId = typeof l.source === 'object' ? l.source.id : l.source;
        const tId = typeof l.target === 'object' ? l.target.id : l.target;
        return (sId === d.id || tId === d.id) ? 0.7 : 0.03;
      }).attr('stroke-width', l => {
        const sId = typeof l.source === 'object' ? l.source.id : l.source;
        const tId = typeof l.target === 'object' ? l.target.id : l.target;
        return (sId === d.id || tId === d.id) ? l.strength * 4 : 0.5;
      }).attr('stroke', l => {
        const sId = typeof l.source === 'object' ? l.source.id : l.source;
        const tId = typeof l.target === 'object' ? l.target.id : l.target;
        return (sId === d.id || tId === d.id) ? cMap[d.type] || T.accent : T.textDim;
      });
      // Dim unconnected nodes
      const connectedIds = new Set([d.id]);
      links.forEach(l => {
        const sId = typeof l.source === 'object' ? l.source.id : l.source;
        const tId = typeof l.target === 'object' ? l.target.id : l.target;
        if (sId === d.id) connectedIds.add(tId);
        if (tId === d.id) connectedIds.add(sId);
      });
      node.transition().duration(200).attr('opacity', n => connectedIds.has(n.id) ? 1 : 0.15);
      setTooltip({ x: e.offsetX, y: e.offsetY, d });
    })
    .on('mouseleave', function(e, d) {
      d3.select(this).select('.main-circle').transition().duration(200)
        .attr('stroke-width', d.type === 'team' ? 2.5 : 1.5).attr('r', sMap[d.type]||6);
      link.transition().duration(300)
        .attr('stroke-opacity', l => l.strength * 0.2)
        .attr('stroke-width', l => Math.max(0.5, l.strength * 2.5))
        .attr('stroke', l => {
          const s = typeof l.source === 'object' ? l.source : nMap[l.source];
          return cMap[s?.type] || T.textDim;
        });
      node.transition().duration(300).attr('opacity', 1);
      setTooltip(null);
    });
    // Drag
    node.call(d3.drag()
      .on('start', (e,d) => { if(!e.active) sim.alphaTarget(0.3).restart(); d.fx=d.x; d.fy=d.y; })
      .on('drag', (e,d) => { d.fx=e.x; d.fy=e.y; })
      .on('end', (e,d) => { if(!e.active) sim.alphaTarget(0); d.fx=null; d.fy=null; }));
    // Entrance animation
    node.attr('opacity', 0).transition().delay((d, i) => i * 40).duration(500).ease(d3.easeBackOut).attr('opacity', 1);
    // Tick
    sim.on('tick', () => {
      link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
      node.attr('transform', d => `translate(${d.x},${d.y})`);
    });
    return () => sim.stop();
  }, [width, height, focusNode]);
  return (
    <div style={{ position: 'relative' }}>
      <Card title="Network Intelligence Graph" action={<div style={{ display:'flex', gap:12, alignItems:'center' }}>
        <span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>drag to move · scroll to zoom · hover to trace paths</span>
        {[['Team',T.accent],['Funds',T.blue],['LPs',T.amber],['Pipeline',T.purple]].map(([l,c])=>
          <span key={l} style={{display:'flex',alignItems:'center',gap:3,fontSize:9,color:T.textMuted}}>
            <span style={{width:7,height:7,borderRadius:'50%',background:c,boxShadow:`0 0 6px ${c}60`}}/>{l}
          </span>
        )}
      </div>}>
        <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />
      </Card>
      {tooltip && (
        <div style={{ position:'absolute', left: Math.min(tooltip.x + 16, width - 220), top: Math.max(tooltip.y - 60, 8),
          background: T.bgElevated, border:`1px solid ${cMap[tooltip.d.type] || T.border}40`, borderRadius:10,
          padding:'10px 14px', pointerEvents:'none', zIndex:10, minWidth:180, backdropFilter:'blur(12px)',
          boxShadow:`0 12px 32px ${T.bg}ee, 0 0 1px ${cMap[tooltip.d.type]}40` }}>
          <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
            <span style={{width:8,height:8,borderRadius:'50%',background:cMap[tooltip.d.type],boxShadow:`0 0 8px ${cMap[tooltip.d.type]}60`}}/>
            <span style={{fontSize:12,fontWeight:800,color:cMap[tooltip.d.type]}}>{tooltip.d.name}</span>
          </div>
          <div style={{fontSize:9,color:T.textMuted,textTransform:'uppercase',letterSpacing:'0.5px',marginBottom:4}}>{tooltip.d.type}</div>
          {tooltip.d.role && <div style={{fontSize:9,color:T.text}}>{tooltip.d.role}</div>}
          {tooltip.d.value && <div style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.accent,marginTop:2}}>
            {tooltip.d.type==='fund'?`$${tooltip.d.value}M committed`:tooltip.d.type==='lp'?`$${tooltip.d.value}M potential`:`Score: ${tooltip.d.value}`}
          </div>}
          {tooltip.d.connections && <div style={{fontSize:9,color:T.textMuted,marginTop:2}}>{tooltip.d.connections} connections</div>}
        </div>
      )}
    </div>
  );
};

// ════════════════════════════════════════════════════
// J-CURVE CHART (SVG)
// ════════════════════════════════════════════════════
const JCurveChart = ({ width = 700, height = 280 }) => {
  const vintages = Object.keys(JCURVE_DATA);
  const colors = { '2022': T.accent, '2023': T.blue, '2024': T.purple };
  const allVals = Object.values(JCURVE_DATA).flat().map(d => d.nav);
  const minV = Math.min(...allVals, -10); const maxV = Math.max(...allVals, 100);
  const pad = { t: 20, r: 20, b: 30, l: 50 };
  const w = width - pad.l - pad.r; const h = height - pad.t - pad.b;
  const maxLen = Math.max(...Object.values(JCURVE_DATA).map(d => d.length));
  const xScale = (i) => pad.l + (i / (maxLen - 1)) * w;
  const yScale = (v) => pad.t + h - ((v - minV) / (maxV - minV)) * h;

  return (
    <Card title="J-Curve by Vintage" action={<div style={{display:'flex',gap:10}}>{vintages.map(v=><span key={v} style={{display:'flex',alignItems:'center',gap:4,fontSize:10,color:T.textMuted}}><span style={{width:8,height:3,borderRadius:2,background:colors[v]}}/>{v}</span>)}</div>}>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {/* Zero line */}
        <line x1={pad.l} y1={yScale(0)} x2={width-pad.r} y2={yScale(0)} stroke={T.textDim} strokeWidth={1} strokeDasharray="4,4" />
        <text x={pad.l-6} y={yScale(0)+4} fill={T.textDim} fontSize={9} textAnchor="end" fontFamily={mono}>0%</text>
        {/* Grid */}
        {[-5, 25, 50, 75].filter(v => v >= minV && v <= maxV).map(v => (
          <g key={v}><line x1={pad.l} y1={yScale(v)} x2={width-pad.r} y2={yScale(v)} stroke={T.border} strokeWidth={0.5} />
            <text x={pad.l-6} y={yScale(v)+3} fill={T.textDim} fontSize={8} textAnchor="end" fontFamily={mono}>{v}%</text></g>
        ))}
        {/* Curves */}
        {vintages.map(v => {
          const data = JCURVE_DATA[v];
          const path = data.map((d, i) => `${i === 0 ? 'M' : 'L'}${xScale(i)},${yScale(d.nav)}`).join(' ');
          const areaPath = path + ` L${xScale(data.length-1)},${yScale(0)} L${xScale(0)},${yScale(0)} Z`;
          return (
            <g key={v}>
              <path d={areaPath} fill={`${colors[v]}08`} />
              <path d={path} fill="none" stroke={colors[v]} strokeWidth={2} />
              {/* End dot */}
              <circle cx={xScale(data.length-1)} cy={yScale(data[data.length-1].nav)} r={4} fill={colors[v]} />
              <text x={xScale(data.length-1)+8} y={yScale(data[data.length-1].nav)+4} fill={colors[v]} fontSize={10} fontFamily={mono} fontWeight={700}>{data[data.length-1].nav}%</text>
            </g>
          );
        })}
      </svg>
    </Card>
  );
};

// ════════════════════════════════════════════════════
// NAV PREMIUM/DISCOUNT CHART
// ════════════════════════════════════════════════════
const NavPremDiscChart = ({ width = 700, height = 220 }) => {
  const data = NAV_HISTORY;
  const pad = { t: 20, r: 20, b: 30, l: 50 };
  const w = width - pad.l - pad.r; const h = height - pad.t - pad.b;
  const minP = Math.min(...data.map(d => d.premDisc), -5);
  const maxP = Math.max(...data.map(d => d.premDisc), 5);
  const xS = (i) => pad.l + (i / (data.length - 1)) * w;
  const yS = (v) => pad.t + h - ((v - minP) / (maxP - minP)) * h;

  return (
    <Card title="NAV Premium / Discount History">
      <svg width={width} height={height} style={{ display: 'block' }}>
        <line x1={pad.l} y1={yS(0)} x2={width-pad.r} y2={yS(0)} stroke={T.textDim} strokeWidth={1} strokeDasharray="3,3" />
        {data.map((d, i) => (
          <g key={i}>
            <rect x={xS(i) - 14} y={d.premDisc >= 0 ? yS(d.premDisc) : yS(0)} width={28} height={Math.abs(yS(d.premDisc) - yS(0))} rx={3} fill={d.premDisc >= 0 ? T.green : T.red} opacity={0.6} />
            <text x={xS(i)} y={height - 6} fill={T.textDim} fontSize={8} textAnchor="middle" fontFamily={mono}>{d.date}</text>
            <text x={xS(i)} y={(d.premDisc >= 0 ? yS(d.premDisc) - 5 : yS(d.premDisc) + 12)} fill={d.premDisc >= 0 ? T.green : T.red} fontSize={8} textAnchor="middle" fontFamily={mono} fontWeight={600}>{d.premDisc > 0 ? '+' : ''}{d.premDisc}%</text>
          </g>
        ))}
      </svg>
    </Card>
  );
};

// ════════════════════════════════════════════════════
// REUSABLE CHART COMPONENTS
// ════════════════════════════════════════════════════
const SparkLine = ({ data, width = 120, height = 32, color = T.accent, fill = true, showDots = false, showEndLabel = false }) => {
  if (!data || data.length < 2) return null;
  const min = Math.min(...data); const max = Math.max(...data);
  const range = max - min || 1;
  const pts = data.map((v, i) => ({ x: (i / (data.length - 1)) * width, y: height - ((v - min) / range) * (height - 4) - 2 }));
  const path = pts.map((p, i) => `${i === 0 ? 'M' : 'L'}${p.x},${p.y}`).join(' ');
  const areaPath = path + ` L${pts[pts.length-1].x},${height} L${pts[0].x},${height} Z`;
  const trend = data[data.length-1] > data[0];
  const c = color === 'auto' ? (trend ? T.green : T.red) : color;
  return (
    <svg width={width} height={height + (showEndLabel ? 14 : 0)} style={{ display: 'block' }}>
      {fill && <path d={areaPath} fill={`${c}12`} />}
      <path d={path} fill="none" stroke={c} strokeWidth={1.5} strokeLinecap="round" />
      {showDots && pts.map((p, i) => <circle key={i} cx={p.x} cy={p.y} r={i === pts.length-1 ? 3 : 1.5} fill={c} />)}
      {showEndLabel && <text x={pts[pts.length-1].x} y={height + 12} fill={c} fontSize={9} fontFamily={mono} fontWeight={700} textAnchor="end">{data[data.length-1]}</text>}
    </svg>
  );
};

const AreaChart = ({ data, keys, colors, width = 700, height = 260, xLabels, title, yFormat }) => {
  const pad = { t: 20, r: 20, b: 30, l: 55 };
  const w = width - pad.l - pad.r; const h = height - pad.t - pad.b;
  const allVals = data.flatMap(d => keys.map(k => d[k] || 0));
  const minV = Math.min(0, ...allVals); const maxV = Math.max(...allVals);
  const range = maxV - minV || 1;
  const xS = (i) => pad.l + (i / (data.length - 1)) * w;
  const yS = (v) => pad.t + h - ((v - minV) / range) * h;
  const gridLines = Array.from({ length: 5 }, (_, i) => minV + (range * i) / 4);
  return (
    <Card title={title}>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {gridLines.map((v, i) => (
          <g key={i}><line x1={pad.l} y1={yS(v)} x2={width - pad.r} y2={yS(v)} stroke={T.border} strokeWidth={0.5} />
            <text x={pad.l - 6} y={yS(v) + 3} fill={T.textDim} fontSize={8} textAnchor="end" fontFamily={mono}>{yFormat ? yFormat(v) : v.toFixed(0)}</text></g>
        ))}
        {minV < 0 && <line x1={pad.l} y1={yS(0)} x2={width - pad.r} y2={yS(0)} stroke={T.textDim} strokeWidth={1} strokeDasharray="4,4" />}
        {keys.map((key, ki) => {
          const pts = data.map((d, i) => ({ x: xS(i), y: yS(d[key] || 0) }));
          const path = pts.map((p, i) => `${i === 0 ? 'M' : 'L'}${p.x},${p.y}`).join(' ');
          const area = path + ` L${pts[pts.length-1].x},${yS(0)} L${pts[0].x},${yS(0)} Z`;
          return (
            <g key={key}>
              <path d={area} fill={`${colors[ki]}10`} />
              <path d={path} fill="none" stroke={colors[ki]} strokeWidth={2} />
              <circle cx={pts[pts.length-1].x} cy={pts[pts.length-1].y} r={3.5} fill={colors[ki]} />
              <text x={pts[pts.length-1].x + 6} y={pts[pts.length-1].y + 3} fill={colors[ki]} fontSize={9} fontFamily={mono} fontWeight={700}>{data[data.length-1][key]}</text>
            </g>
          );
        })}
        {xLabels && data.map((d, i) => i % Math.ceil(data.length / 8) === 0 && (
          <text key={i} x={xS(i)} y={height - 6} fill={T.textDim} fontSize={8} textAnchor="middle" fontFamily={mono}>{xLabels[i]}</text>
        ))}
        {/* Legend */}
        {keys.map((k, ki) => (
          <g key={k} transform={`translate(${pad.l + ki * 100}, ${pad.t - 8})`}>
            <rect width={8} height={3} rx={1} fill={colors[ki]} /><text x={12} y={3} fill={T.textMuted} fontSize={8} fontFamily={mono}>{k}</text>
          </g>
        ))}
      </svg>
    </Card>
  );
};

const DonutChart = ({ segments, size = 140, thickness = 20, label, sublabel }) => {
  const r = (size - thickness) / 2; const cx = size / 2; const cy = size / 2;
  const total = segments.reduce((s, seg) => s + seg.value, 0);
  let cumAngle = -Math.PI / 2;
  return (
    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
      <svg width={size} height={size}>
        {segments.map((seg, i) => {
          const angle = (seg.value / total) * Math.PI * 2;
          const startAngle = cumAngle; cumAngle += angle;
          const x1 = cx + r * Math.cos(startAngle); const y1 = cy + r * Math.sin(startAngle);
          const x2 = cx + r * Math.cos(startAngle + angle); const y2 = cy + r * Math.sin(startAngle + angle);
          const large = angle > Math.PI ? 1 : 0;
          return <path key={i} d={`M ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2}`} fill="none" stroke={seg.color} strokeWidth={thickness} strokeLinecap="round" />;
        })}
        {label && <text x={cx} y={cy - 4} textAnchor="middle" fill={T.text} fontSize={18} fontWeight={800} fontFamily={mono}>{label}</text>}
        {sublabel && <text x={cx} y={cy + 12} textAnchor="middle" fill={T.textDim} fontSize={9}>{sublabel}</text>}
      </svg>
      <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap', justifyContent: 'center', marginTop: 6 }}>
        {segments.map((seg, i) => (
          <span key={i} style={{ display: 'flex', alignItems: 'center', gap: 3, fontSize: 9, color: T.textMuted }}>
            <span style={{ width: 6, height: 6, borderRadius: '50%', background: seg.color }} />{seg.label}
          </span>
        ))}
      </div>
    </div>
  );
};

const GaugeChart = ({ value, max = 100, label, thresholds, size = 130 }) => {
  const r = (size - 16) / 2; const cx = size / 2; const cy = size / 2 + 10;
  const startAngle = Math.PI; const endAngle = 0;
  const valueAngle = startAngle - ((value / max) * Math.PI);
  const getColor = () => {
    if (!thresholds) return T.accent;
    for (const t of thresholds) { if (value <= t.max) return t.color; }
    return T.accent;
  };
  const color = getColor();
  const arcPath = (start, end) => {
    const x1 = cx + r * Math.cos(start); const y1 = cy - r * Math.sin(start);
    const x2 = cx + r * Math.cos(end); const y2 = cy - r * Math.sin(end);
    return `M ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2}`;
  };
  return (
    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
      <svg width={size} height={size / 2 + 20}>
        <path d={arcPath(startAngle, endAngle)} fill="none" stroke={T.bgAccent} strokeWidth={10} strokeLinecap="round" />
        <path d={arcPath(startAngle, valueAngle)} fill="none" stroke={color} strokeWidth={10} strokeLinecap="round" />
        <text x={cx} y={cy - 4} textAnchor="middle" fill={color} fontSize={22} fontWeight={800} fontFamily={mono}>{value}</text>
        {label && <text x={cx} y={cy + 12} textAnchor="middle" fill={T.textDim} fontSize={9}>{label}</text>}
      </svg>
    </div>
  );
};

const HeatmapCell = ({ value, max, min = 0, colorScale = 'green' }) => {
  const norm = Math.max(0, Math.min(1, (value - min) / ((max - min) || 1)));
  const colors = {
    green: [`${T.bgAccent}`, T.green],
    red: [T.green, T.red],
    accent: [`${T.bgAccent}`, T.accent],
    diverging: norm < 0.5 ? [T.red, T.bgAccent] : [T.bgAccent, T.green],
  };
  const [lo, hi] = colors[colorScale] || colors.green;
  const interp = colorScale === 'diverging' ? (norm < 0.5 ? lo : hi) : hi;
  const opacity = colorScale === 'diverging' ? Math.abs(norm - 0.5) * 2 : norm;
  return (
    <div style={{ width: '100%', height: 28, background: `${interp}${Math.round(opacity * 40 + 10).toString(16).padStart(2, '0')}`, borderRadius: 3, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 9, fontFamily: mono, fontWeight: 700, color: opacity > 0.5 ? T.text : T.textDim, border: `1px solid ${T.border}` }}>
      {value}
    </div>
  );
};

const MiniBarChart = ({ data, width = 200, height = 60, color = T.accent, showLabels = true }) => {
  const max = Math.max(...data.map(d => d.value));
  const barW = Math.min(24, (width - (data.length - 1) * 2) / data.length);
  return (
    <svg width={width} height={height + (showLabels ? 14 : 0)} style={{ display: 'block' }}>
      {data.map((d, i) => {
        const bh = (d.value / max) * height;
        const x = i * (barW + 2);
        return (
          <g key={i}>
            <rect x={x} y={height - bh} width={barW} height={bh} rx={2} fill={d.color || color} opacity={0.8} />
            {showLabels && <text x={x + barW / 2} y={height + 11} fill={T.textDim} fontSize={7} textAnchor="middle" fontFamily={mono}>{d.label}</text>}
          </g>
        );
      })}
    </svg>
  );
};

const RadarChart = ({ data, labels, size = 200, color = T.accent }) => {
  const cx = size / 2; const cy = size / 2; const r = size / 2 - 24;
  const n = labels.length;
  const angleStep = (Math.PI * 2) / n;
  const getPoint = (value, i) => ({
    x: cx + r * (value / 100) * Math.cos(angleStep * i - Math.PI / 2),
    y: cy + r * (value / 100) * Math.sin(angleStep * i - Math.PI / 2),
  });
  const pts = data.map((v, i) => getPoint(v, i));
  const polygon = pts.map(p => `${p.x},${p.y}`).join(' ');
  return (
    <svg width={size} height={size}>
      {[20, 40, 60, 80, 100].map(level => {
        const ring = labels.map((_, i) => getPoint(level, i));
        return <polygon key={level} points={ring.map(p => `${p.x},${p.y}`).join(' ')} fill="none" stroke={T.border} strokeWidth={0.5} />;
      })}
      {labels.map((_, i) => {
        const end = getPoint(100, i);
        return <line key={i} x1={cx} y1={cy} x2={end.x} y2={end.y} stroke={T.border} strokeWidth={0.5} />;
      })}
      <polygon points={polygon} fill={`${color}18`} stroke={color} strokeWidth={2} />
      {pts.map((p, i) => <circle key={i} cx={p.x} cy={p.y} r={3} fill={color} />)}
      {labels.map((label, i) => {
        const p = getPoint(115, i);
        return <text key={i} x={p.x} y={p.y + 3} textAnchor="middle" fill={T.textMuted} fontSize={8} fontFamily={mono}>{label}</text>;
      })}
    </svg>
  );
};

const TimelineChart = ({ events, width = 700 }) => {
  const h = 60 + events.length * 42;
  return (
    <svg width={width} height={h} style={{ display: 'block' }}>
      <line x1={40} y1={20} x2={40} y2={h - 20} stroke={T.border} strokeWidth={2} />
      {events.map((e, i) => {
        const y = 30 + i * 42;
        return (
          <g key={i}>
            <circle cx={40} cy={y} r={6} fill={e.color || T.accent} stroke={T.bgCard} strokeWidth={2} />
            <text x={56} y={y - 4} fill={T.text} fontSize={11} fontWeight={600}>{e.title}</text>
            <text x={56} y={y + 10} fill={T.textMuted} fontSize={9}>{e.description}</text>
            <text x={width - 10} y={y + 2} fill={e.color || T.textDim} fontSize={9} fontFamily={mono} fontWeight={600} textAnchor="end">{e.date}</text>
            {e.impact && <text x={width - 10} y={y + 14} fill={e.impactColor || T.accent} fontSize={8} fontFamily={mono} textAnchor="end">{e.impact}</text>}
          </g>
        );
      })}
    </svg>
  );
};

// ════════════════════════════════════════════════════
// D3.JS INTERACTIVE VISUALIZATIONS
// ════════════════════════════════════════════════════

// ═══ D3 FORCE BUBBLE PACK — Opportunity Radar ═══
const D3BubblePack = ({ data, width = 710, height = 340 }) => {
  const svgRef = useRef(null);
  const [tooltip, setTooltip] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !data.length) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const colorMap = { 'STRONG BUY': T.accent, 'BUY': T.green, 'HOLD': T.blue };
    const nodes = data.map(d => ({
      ...d,
      r: Math.max(22, Math.sqrt(d.sizing?.optimal || 5) * 18),
      color: colorMap[d.signal] || T.blue,
    }));
    const sim = d3.forceSimulation(nodes)
      .force('charge', d3.forceManyBody().strength(d => -d.r * 2.2))
      .force('center', d3.forceCenter(width / 2, height / 2))
      .force('collision', d3.forceCollide().radius(d => d.r + 4).strength(0.9))
      .force('x', d3.forceX(d => {
        const xRange = width * 0.7;
        return (width - xRange) / 2 + ((d.conviction?.composite || 80) - 65) / 35 * xRange;
      }).strength(0.12))
      .force('y', d3.forceY(d => {
        const yRange = height * 0.7;
        return height - ((height - yRange) / 2 + (d.irr_base || 20) / 55 * yRange);
      }).strength(0.12));
    const defs = svg.append('defs');
    nodes.forEach((n, i) => {
      const grad = defs.append('radialGradient').attr('id', `bubGrad${i}`);
      grad.append('stop').attr('offset', '0%').attr('stop-color', n.color).attr('stop-opacity', 0.4);
      grad.append('stop').attr('offset', '70%').attr('stop-color', n.color).attr('stop-opacity', 0.15);
      grad.append('stop').attr('offset', '100%').attr('stop-color', n.color).attr('stop-opacity', 0.05);
    });
    // Axis hints
    svg.append('text').attr('x', width / 2).attr('y', height - 6).attr('text-anchor', 'middle')
      .attr('fill', T.textDim).attr('font-size', 9).attr('font-family', sans).text('Conviction Score →');
    svg.append('text').attr('x', 10).attr('y', height / 2).attr('text-anchor', 'middle')
      .attr('fill', T.textDim).attr('font-size', 9).attr('font-family', sans)
      .attr('transform', `rotate(-90, 10, ${height / 2})`).text('Base IRR % →');
    const g = svg.append('g');
    const node = g.selectAll('g').data(nodes).join('g').style('cursor', 'pointer');
    // Outer glow
    node.append('circle').attr('r', d => d.r + 8).attr('fill', (d, i) => `url(#bubGrad${i})`);
    // Main bubble
    node.append('circle').attr('r', d => d.r)
      .attr('fill', d => `${d.color}15`).attr('stroke', d => d.color)
      .attr('stroke-width', 1.5).attr('stroke-opacity', 0.7);
    // Pulse ring for STRONG BUY
    node.filter(d => d.signal === 'STRONG BUY').append('circle')
      .attr('r', d => d.r).attr('fill', 'none').attr('stroke', T.accent).attr('stroke-width', 0.8)
      .attr('stroke-opacity', 0).each(function() {
        const el = d3.select(this);
        (function pulse() {
          el.attr('r', function(d) { return d.r; }).attr('stroke-opacity', 0.6)
            .transition().duration(1800).ease(d3.easeSinOut)
            .attr('r', function(d) { return d.r + 16; }).attr('stroke-opacity', 0)
            .on('end', pulse);
        })();
      });
    // IRR label
    node.append('text').attr('dy', -2).attr('text-anchor', 'middle')
      .attr('fill', d => d.color).attr('font-size', d => Math.min(13, d.r * 0.5))
      .attr('font-weight', 800).attr('font-family', mono).text(d => `${d.irr_base}%`);
    // Name label
    node.append('text').attr('dy', 10).attr('text-anchor', 'middle')
      .attr('fill', T.textMuted).attr('font-size', d => Math.min(8, d.r * 0.3))
      .attr('font-family', sans).text(d => (d.name || '').split(' ').slice(0, 2).join(' '));
    // Signal badge
    node.append('text').attr('dy', d => -d.r - 6).attr('text-anchor', 'middle')
      .attr('fill', d => d.color).attr('font-size', 7).attr('font-weight', 700)
      .attr('font-family', mono).text(d => d.signal);
    // Hover
    node.on('mouseenter', (e, d) => {
      d3.select(e.currentTarget).select('circle:nth-child(2)')
        .transition().duration(200).attr('stroke-width', 3).attr('fill', `${d.color}25`);
      setTooltip({ x: d.x, y: d.y - d.r - 30, d });
    }).on('mouseleave', (e, d) => {
      d3.select(e.currentTarget).select('circle:nth-child(2)')
        .transition().duration(200).attr('stroke-width', 1.5).attr('fill', `${d.color}15`);
      setTooltip(null);
    });
    sim.on('tick', () => { node.attr('transform', d => `translate(${d.x},${d.y})`); });
    // Entrance animation
    node.attr('opacity', 0).transition().delay((d, i) => i * 80).duration(600)
      .ease(d3.easeBackOut.overshoot(1.2)).attr('opacity', 1);
    return () => sim.stop();
  }, [data, width, height]);
  return (
    <div style={{ position: 'relative' }}>
      <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />
      {tooltip && (
        <div style={{ position: 'absolute', left: Math.min(tooltip.x, width - 200), top: Math.max(tooltip.y, 0),
          background: T.bgElevated, border: `1px solid ${tooltip.d.color}40`, borderRadius: 8, padding: '8px 12px',
          pointerEvents: 'none', zIndex: 10, boxShadow: `0 8px 24px ${T.bg}cc`, minWidth: 160 }}>
          <div style={{ fontSize: 11, fontWeight: 800, color: tooltip.d.color, marginBottom: 2 }}>{tooltip.d.name}</div>
          <div style={{ fontSize: 9, color: T.textMuted, marginBottom: 4 }}>{tooltip.d.thesis?.slice(0, 80)}...</div>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 4 }}>
            <div style={{ fontSize: 8, color: T.textDim }}>Score: <span style={{ color: T.accent, fontFamily: mono, fontWeight: 700 }}>{tooltip.d.score}</span></div>
            <div style={{ fontSize: 8, color: T.textDim }}>Size: <span style={{ color: T.green, fontFamily: mono, fontWeight: 700 }}>${tooltip.d.sizing?.optimal}M</span></div>
            <div style={{ fontSize: 8, color: T.textDim }}>Bull: <span style={{ color: T.green, fontFamily: mono }}>{tooltip.d.irr_bull}%</span></div>
            <div style={{ fontSize: 8, color: T.textDim }}>Bear: <span style={{ color: T.red, fontFamily: mono }}>{tooltip.d.irr_bear}%</span></div>
          </div>
        </div>
      )}
    </div>
  );
};

// ═══ D3 RADAR — Multi-GP Overlay Spider Chart ═══
const D3RadarOverlay = ({ gps, dimensions, size = 380 }) => {
  const svgRef = useRef(null);
  const [activeGP, setActiveGP] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !gps.length) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const cx = size / 2, cy = size / 2, r = size / 2 - 50;
    const n = dimensions.length;
    const angleSlice = (Math.PI * 2) / n;
    const rScale = d3.scaleLinear().domain([0, 5]).range([0, r]);
    const g = svg.append('g').attr('transform', `translate(${cx},${cy})`);
    // Concentric rings with labels
    [1, 2, 3, 4, 5].forEach(level => {
      g.append('circle').attr('r', rScale(level)).attr('fill', 'none')
        .attr('stroke', T.border).attr('stroke-width', level === 5 ? 1 : 0.3)
        .attr('stroke-dasharray', level < 5 ? '2,3' : 'none');
      g.append('text').attr('x', 4).attr('y', -rScale(level) + 3)
        .attr('fill', T.textDim).attr('font-size', 7).attr('font-family', mono).text(level);
    });
    // Axes with labels
    dimensions.forEach((dim, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const x2 = rScale(5) * Math.cos(angle);
      const y2 = rScale(5) * Math.sin(angle);
      g.append('line').attr('x1', 0).attr('y1', 0).attr('x2', x2).attr('y2', y2)
        .attr('stroke', T.border).attr('stroke-width', 0.5);
      const lx = (rScale(5) + 18) * Math.cos(angle);
      const ly = (rScale(5) + 18) * Math.sin(angle);
      g.append('text').attr('x', lx).attr('y', ly + 3).attr('text-anchor', 'middle')
        .attr('fill', T.textMuted).attr('font-size', 7).attr('font-family', sans)
        .text(dim.length > 10 ? dim.slice(0, 10) + '…' : dim);
    });
    // GP polygons
    const gpColors = [T.accent, T.green, T.blue, T.purple, T.amber, T.red, T.cyan, T.gold];
    const lineGen = d3.lineRadial()
      .angle((d, i) => angleSlice * i)
      .radius(d => rScale(d))
      .curve(d3.curveCardinalClosed.tension(0.3));
    gps.forEach((gp, gi) => {
      const color = gpColors[gi % gpColors.length];
      const path = g.append('path')
        .datum(gp.scores)
        .attr('d', lineGen)
        .attr('fill', `${color}10`)
        .attr('stroke', color)
        .attr('stroke-width', activeGP === null || activeGP === gi ? 2 : 0.5)
        .attr('stroke-opacity', activeGP === null ? 0.7 : (activeGP === gi ? 1 : 0.15))
        .attr('fill-opacity', activeGP === null ? 0.08 : (activeGP === gi ? 0.18 : 0.02))
        .style('cursor', 'pointer')
        .on('mouseenter', () => setActiveGP(gi))
        .on('mouseleave', () => setActiveGP(null));
      // Animated draw-in
      const totalLen = path.node().getTotalLength();
      path.attr('stroke-dasharray', `${totalLen} ${totalLen}`)
        .attr('stroke-dashoffset', totalLen)
        .transition().duration(800).delay(gi * 120).ease(d3.easeCubicOut)
        .attr('stroke-dashoffset', 0);
      // Score dots
      gp.scores.forEach((score, si) => {
        const angle = angleSlice * si - Math.PI / 2;
        const px = rScale(score) * Math.cos(angle);
        const py = rScale(score) * Math.sin(angle);
        g.append('circle').attr('cx', px).attr('cy', py).attr('r', 0)
          .attr('fill', color).attr('stroke', T.bg).attr('stroke-width', 1)
          .attr('opacity', activeGP === null || activeGP === gi ? 1 : 0.2)
          .transition().duration(400).delay(gi * 120 + si * 40)
          .attr('r', 3);
      });
    });
  }, [gps, dimensions, size, activeGP]);
  const gpColors = [T.accent, T.green, T.blue, T.purple, T.amber, T.red, T.cyan, T.gold];
  return (
    <div>
      <svg ref={svgRef} width={size} height={size} style={{ display: 'block', margin: '0 auto' }} />
      <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6, justifyContent: 'center', marginTop: 8 }}>
        {gps.map((gp, i) => (
          <span key={i} style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 9, padding: '2px 8px',
            borderRadius: 10, background: activeGP === i ? `${gpColors[i % gpColors.length]}18` : 'transparent',
            border: `1px solid ${activeGP === i ? gpColors[i % gpColors.length] + '40' : 'transparent'}`,
            color: activeGP === i ? gpColors[i % gpColors.length] : T.textMuted, cursor: 'pointer',
            transition: 'all .2s' }}
            onMouseEnter={() => setActiveGP(i)} onMouseLeave={() => setActiveGP(null)}>
            <span style={{ width: 6, height: 6, borderRadius: '50%', background: gpColors[i % gpColors.length] }} />
            {gp.name} <span style={{ fontFamily: mono, fontWeight: 700, fontSize: 10 }}>{gp.total}</span>
          </span>
        ))}
      </div>
    </div>
  );
};

// ═══ D3 TREEMAP — Portfolio NAV Allocation ═══
const D3Treemap = ({ data, width = 710, height = 300 }) => {
  const svgRef = useRef(null);
  const [hovered, setHovered] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !data.length) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const root = d3.hierarchy({ children: data.map(d => ({ ...d, value: d.nav || d.committed || 1 })) })
      .sum(d => d.value).sort((a, b) => b.value - a.value);
    d3.treemap().size([width, height]).padding(3).round(true)(root);
    const colorMap = { Core: T.accent, Strategic: T.blue, Exploration: T.amber };
    const leaves = root.leaves();
    const cells = svg.selectAll('g').data(leaves).join('g').attr('transform', d => `translate(${d.x0},${d.y0})`);
    // Rect with rounded corners
    cells.append('rect')
      .attr('width', d => Math.max(0, d.x1 - d.x0))
      .attr('height', d => Math.max(0, d.y1 - d.y0))
      .attr('rx', 4)
      .attr('fill', d => `${colorMap[d.data.tier] || T.blue}18`)
      .attr('stroke', d => colorMap[d.data.tier] || T.blue)
      .attr('stroke-width', 1)
      .attr('stroke-opacity', 0.4)
      .style('cursor', 'pointer')
      .on('mouseenter', function(e, d) {
        d3.select(this).transition().duration(150)
          .attr('fill', `${colorMap[d.data.tier] || T.blue}30`)
          .attr('stroke-opacity', 1).attr('stroke-width', 2);
        setHovered(d.data);
      })
      .on('mouseleave', function(e, d) {
        d3.select(this).transition().duration(150)
          .attr('fill', `${colorMap[d.data.tier] || T.blue}18`)
          .attr('stroke-opacity', 0.4).attr('stroke-width', 1);
        setHovered(null);
      });
    // Entrance animation
    cells.select('rect').attr('opacity', 0)
      .transition().delay((d, i) => i * 50).duration(500).ease(d3.easeCubicOut).attr('opacity', 1);
    // Labels (only if cell is big enough)
    cells.filter(d => (d.x1 - d.x0) > 60 && (d.y1 - d.y0) > 30)
      .append('text').attr('x', 8).attr('y', 16)
      .attr('fill', d => colorMap[d.data.tier] || T.blue).attr('font-size', 10)
      .attr('font-weight', 700).attr('font-family', sans)
      .text(d => d.data.gp || d.data.name || '');
    cells.filter(d => (d.x1 - d.x0) > 60 && (d.y1 - d.y0) > 48)
      .append('text').attr('x', 8).attr('y', 30)
      .attr('fill', T.textMuted).attr('font-size', 9).attr('font-family', mono)
      .text(d => `$${(d.data.nav || d.data.committed || 0).toFixed(1)}M`);
    cells.filter(d => (d.x1 - d.x0) > 80 && (d.y1 - d.y0) > 62)
      .append('text').attr('x', 8).attr('y', 44)
      .attr('fill', T.accent).attr('font-size', 9).attr('font-weight', 700).attr('font-family', mono)
      .text(d => d.data.tvpi ? `${d.data.tvpi}x TVPI` : '');
  }, [data, width, height]);
  return (
    <div style={{ position: 'relative' }}>
      <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />
      {hovered && (
        <div style={{ position: 'absolute', top: 8, right: 8, background: T.bgElevated, border: `1px solid ${T.border}`,
          borderRadius: 8, padding: '8px 12px', pointerEvents: 'none', zIndex: 10, minWidth: 180,
          boxShadow: `0 8px 24px ${T.bg}cc` }}>
          <div style={{ fontSize: 11, fontWeight: 800, color: T.accent }}>{hovered.gp || hovered.name}</div>
          <div style={{ fontSize: 9, color: T.textMuted, marginBottom: 4 }}>{hovered.strategy} · {hovered.sector}</div>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 3 }}>
            {[{ l: 'NAV', v: `$${hovered.nav}M` }, { l: 'TVPI', v: `${hovered.tvpi}x` },
              { l: 'IRR', v: `${hovered.irr}%` }, { l: 'DPI', v: `${hovered.dpi}x` }].map((m, i) => (
              <div key={i} style={{ fontSize: 8, color: T.textDim }}>{m.l}: <span style={{ color: T.text, fontFamily: mono, fontWeight: 700 }}>{m.v}</span></div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

// ═══ D3 ANIMATED J-CURVE — Smooth Curves with D3 Interpolation ═══
const D3JCurve = ({ funds, width = 710, height = 320 }) => {
  const svgRef = useRef(null);
  const [activeFund, setActiveFund] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !funds.length) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const pad = { t: 25, r: 30, b: 35, l: 55 };
    const w = width - pad.l - pad.r, h = height - pad.t - pad.b;
    // Generate J-curve points for each fund based on lifecycle position
    const genJCurve = (fund) => {
      const pts = [];
      const life = fund.life || 10;
      const age = fund.age || 1;
      const called = fund.called / 100;
      const tvpi = fund.nav / (fund.called / 100 * fund.committed || 1);
      for (let yr = 0; yr <= life; yr += 0.5) {
        let navMult;
        if (yr <= age) {
          // Actual path: descend then climb
          const t = yr / age;
          const troughDepth = -0.15 * (1 - called);
          navMult = yr < age * 0.4 ? troughDepth * Math.sin(t / 0.4 * Math.PI / 2) :
            troughDepth + (tvpi - 1 - troughDepth) * Math.pow((t - 0.4) / 0.6, 1.5);
        } else {
          // Projected
          const projT = (yr - age) / (life - age);
          const endMult = tvpi - 1 + 0.5;
          navMult = (tvpi - 1) + (endMult - (tvpi - 1)) * Math.pow(projT, 0.7);
        }
        pts.push({ yr, val: navMult * 100, projected: yr > age });
      }
      return pts;
    };
    const allCurves = funds.map(f => ({ ...f, pts: genJCurve(f) }));
    const allVals = allCurves.flatMap(c => c.pts.map(p => p.val));
    const yMin = Math.min(-15, ...allVals);
    const yMax = Math.max(80, ...allVals);
    const maxLife = Math.max(...funds.map(f => f.life || 10));
    const x = d3.scaleLinear().domain([0, maxLife]).range([pad.l, width - pad.r]);
    const y = d3.scaleLinear().domain([yMin, yMax]).range([height - pad.b, pad.t]);
    const g = svg.append('g');
    // Grid
    const yTicks = d3.ticks(yMin, yMax, 6);
    yTicks.forEach(v => {
      g.append('line').attr('x1', pad.l).attr('y1', y(v)).attr('x2', width - pad.r).attr('y2', y(v))
        .attr('stroke', v === 0 ? T.textDim : T.border).attr('stroke-width', v === 0 ? 1 : 0.4)
        .attr('stroke-dasharray', v === 0 ? '4,4' : '2,4');
      g.append('text').attr('x', pad.l - 6).attr('y', y(v) + 3)
        .attr('fill', T.textDim).attr('font-size', 8).attr('text-anchor', 'end').attr('font-family', mono)
        .text(`${v > 0 ? '+' : ''}${v.toFixed(0)}%`);
    });
    d3.range(0, maxLife + 1, 1).forEach(yr => {
      g.append('text').attr('x', x(yr)).attr('y', height - pad.b + 16)
        .attr('fill', T.textDim).attr('font-size', 8).attr('text-anchor', 'middle').attr('font-family', mono)
        .text(`Y${yr}`);
    });
    g.append('text').attr('x', width / 2).attr('y', height - 4).attr('text-anchor', 'middle')
      .attr('fill', T.textDim).attr('font-size', 9).attr('font-family', sans).text('Fund Life (Years)');
    g.append('text').attr('x', pad.l - 40).attr('y', height / 2).attr('text-anchor', 'middle')
      .attr('fill', T.textDim).attr('font-size', 9).attr('font-family', sans)
      .attr('transform', `rotate(-90,${pad.l - 40},${height / 2})`).text('NAV Return %');
    // Phase labels
    const phases = [{ label: 'DEPLOY', x: 0.15, c: T.amber }, { label: 'TROUGH', x: 0.3, c: T.red },
      { label: 'HARVEST', x: 0.7, c: T.green }];
    phases.forEach(p => {
      g.append('text').attr('x', x(maxLife * p.x)).attr('y', pad.t - 6)
        .attr('fill', `${p.c}60`).attr('font-size', 7).attr('font-weight', 700)
        .attr('font-family', mono).attr('text-anchor', 'middle').text(p.label);
    });
    // Draw curves
    const fundColors = [T.accent, T.blue, T.green, T.purple, T.amber, T.red, T.cyan, T.gold];
    const line = d3.line().x(d => x(d.yr)).y(d => y(d.val)).curve(d3.curveCatmullRom.alpha(0.5));
    const area = d3.area().x(d => x(d.yr)).y0(y(0)).y1(d => y(d.val)).curve(d3.curveCatmullRom.alpha(0.5));
    allCurves.forEach((curve, ci) => {
      const color = fundColors[ci % fundColors.length];
      const isActive = activeFund === null || activeFund === ci;
      const actualPts = curve.pts.filter(p => !p.projected);
      const projPts = curve.pts.filter(p => p.projected);
      // Area fill for actual
      if (actualPts.length > 1) {
        g.append('path').datum(actualPts).attr('d', area)
          .attr('fill', `${color}${isActive ? '0c' : '03'}`)
          .attr('opacity', isActive ? 1 : 0.3);
      }
      // Actual line
      if (actualPts.length > 1) {
        const path = g.append('path').datum(actualPts).attr('d', line)
          .attr('fill', 'none').attr('stroke', color)
          .attr('stroke-width', isActive ? 2.5 : 1)
          .attr('opacity', isActive ? 1 : 0.2);
        // Animated draw
        const totalLen = path.node().getTotalLength();
        path.attr('stroke-dasharray', `${totalLen} ${totalLen}`)
          .attr('stroke-dashoffset', totalLen)
          .transition().duration(1200).delay(ci * 150).ease(d3.easeCubicOut)
          .attr('stroke-dashoffset', 0);
      }
      // Projected line (dashed)
      if (projPts.length > 1) {
        const connPts = actualPts.length ? [actualPts[actualPts.length - 1], ...projPts] : projPts;
        g.append('path').datum(connPts).attr('d', line)
          .attr('fill', 'none').attr('stroke', color)
          .attr('stroke-width', isActive ? 1.5 : 0.5)
          .attr('stroke-dasharray', '4,4').attr('opacity', isActive ? 0.5 : 0.1);
      }
      // Current position dot
      if (actualPts.length) {
        const last = actualPts[actualPts.length - 1];
        g.append('circle').attr('cx', x(last.yr)).attr('cy', y(last.val)).attr('r', 0)
          .attr('fill', color).attr('stroke', T.bg).attr('stroke-width', 2)
          .transition().duration(400).delay(ci * 150 + 1000)
          .attr('r', isActive ? 5 : 3);
        if (isActive) {
          g.append('text').attr('x', x(last.yr) + 8).attr('y', y(last.val) + 4)
            .attr('fill', color).attr('font-size', 9).attr('font-weight', 700).attr('font-family', mono)
            .attr('opacity', 0).transition().delay(ci * 150 + 1200).duration(300).attr('opacity', 1)
            .text(`${last.val > 0 ? '+' : ''}${last.val.toFixed(0)}%`);
        }
      }
    });
  }, [funds, width, height, activeFund]);
  const fundColors = [T.accent, T.blue, T.green, T.purple, T.amber, T.red, T.cyan, T.gold];
  return (
    <div>
      <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />
      <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6, justifyContent: 'center', marginTop: 6 }}>
        {funds.map((f, i) => (
          <span key={i} style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 9, padding: '2px 8px',
            borderRadius: 10, cursor: 'pointer', transition: 'all .2s',
            background: activeFund === i ? `${fundColors[i % fundColors.length]}18` : 'transparent',
            border: `1px solid ${activeFund === i ? fundColors[i % fundColors.length] + '40' : 'transparent'}`,
            color: activeFund === i ? fundColors[i % fundColors.length] : T.textMuted }}
            onMouseEnter={() => setActiveFund(i)} onMouseLeave={() => setActiveFund(null)}>
            <span style={{ width: 8, height: 3, borderRadius: 2, background: fundColors[i % fundColors.length] }} />
            {f.fund?.split(' ').slice(0, 2).join(' ') || f.name}
          </span>
        ))}
      </div>
    </div>
  );
};

// ═══ D3 SANKEY — Capital Flow Diagram ═══
const D3SankeyFlow = ({ nodes: nodeData, links: linkData, width = 710, height = 360 }) => {
  const svgRef = useRef(null);
  const [hoverLink, setHoverLink] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !nodeData.length) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const pad = { t: 10, r: 10, b: 10, l: 10 };
    const w = width - pad.l - pad.r, h = height - pad.t - pad.b;
    // Simple Sankey layout
    const nodeMap = {}; nodeData.forEach((n, i) => { nodeMap[n.id] = { ...n, idx: i, x: 0, y: 0, dy: 0 }; });
    // Position columns
    const cols = [...new Set(nodeData.map(n => n.col))].sort();
    const colWidth = w / (cols.length - 1 + 0.5);
    cols.forEach((col, ci) => {
      const colNodes = nodeData.filter(n => n.col === col);
      const totalVal = colNodes.reduce((s, n) => s + (n.value || 1), 0);
      let yOff = 0;
      colNodes.forEach(n => {
        const node = nodeMap[n.id];
        node.x = pad.l + ci * colWidth;
        node.dy = Math.max(16, ((n.value || 1) / totalVal) * (h - colNodes.length * 6));
        node.y = pad.t + yOff;
        yOff += node.dy + 6;
      });
      // Center vertically
      const totalH = yOff - 6;
      const offset = (h - totalH) / 2;
      colNodes.forEach(n => { nodeMap[n.id].y += offset; });
    });
    const nodeW = 14;
    const g = svg.append('g');
    // Defs for gradients
    const defs = svg.append('defs');
    linkData.forEach((link, i) => {
      const srcNode = nodeMap[link.source];
      const tgtNode = nodeMap[link.target];
      if (!srcNode || !tgtNode) return;
      const grad = defs.append('linearGradient').attr('id', `sGrad${i}`)
        .attr('gradientUnits', 'userSpaceOnUse')
        .attr('x1', srcNode.x + nodeW).attr('x2', tgtNode.x);
      grad.append('stop').attr('offset', '0%').attr('stop-color', srcNode.color || T.accent).attr('stop-opacity', 0.4);
      grad.append('stop').attr('offset', '100%').attr('stop-color', tgtNode.color || T.blue).attr('stop-opacity', 0.4);
    });
    // Draw links
    let srcOffsets = {}, tgtOffsets = {};
    linkData.forEach((link, i) => {
      const src = nodeMap[link.source];
      const tgt = nodeMap[link.target];
      if (!src || !tgt) return;
      if (!srcOffsets[link.source]) srcOffsets[link.source] = 0;
      if (!tgtOffsets[link.target]) tgtOffsets[link.target] = 0;
      const linkH = Math.max(4, (link.value / (src.value || 1)) * src.dy);
      const sy = src.y + srcOffsets[link.source];
      const ty = tgt.y + tgtOffsets[link.target];
      srcOffsets[link.source] += linkH;
      tgtOffsets[link.target] += linkH;
      const sx = src.x + nodeW;
      const tx = tgt.x;
      const curvature = 0.5;
      const xi = d3.interpolateNumber(sx, tx);
      const path = d3.path();
      path.moveTo(sx, sy);
      path.bezierCurveTo(xi(curvature), sy, xi(1 - curvature), ty, tx, ty);
      path.lineTo(tx, ty + linkH);
      path.bezierCurveTo(xi(1 - curvature), ty + linkH, xi(curvature), sy + linkH, sx, sy + linkH);
      path.closePath();
      g.append('path').attr('d', path.toString())
        .attr('fill', `url(#sGrad${i})`).attr('stroke', 'none')
        .attr('opacity', hoverLink === i ? 0.7 : 0.35)
        .style('cursor', 'pointer')
        .on('mouseenter', () => setHoverLink(i))
        .on('mouseleave', () => setHoverLink(null));
    });
    // Draw nodes
    Object.values(nodeMap).forEach(node => {
      g.append('rect').attr('x', node.x).attr('y', node.y)
        .attr('width', nodeW).attr('height', node.dy).attr('rx', 3)
        .attr('fill', node.color || T.accent).attr('opacity', 0.8);
      // Label
      const labelX = node.col === cols[0] ? node.x - 4 : (node.col === cols[cols.length - 1] ? node.x + nodeW + 4 : node.x + nodeW + 4);
      const anchor = node.col === cols[0] ? 'end' : 'start';
      g.append('text').attr('x', labelX).attr('y', node.y + node.dy / 2 + 3)
        .attr('fill', T.text).attr('font-size', 9).attr('font-weight', 600)
        .attr('font-family', sans).attr('text-anchor', anchor)
        .text(node.label || node.id);
      if (node.value && node.dy > 24) {
        g.append('text').attr('x', labelX).attr('y', node.y + node.dy / 2 + 14)
          .attr('fill', T.textMuted).attr('font-size', 7).attr('font-family', mono)
          .attr('text-anchor', anchor).text(`$${node.value}M`);
      }
    });
  }, [nodeData, linkData, width, height, hoverLink]);
  return <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />;
};

// ═══ D3 SUNBURST — Hierarchical Agent System ═══
const D3Sunburst = ({ data, width = 360, height = 360 }) => {
  const svgRef = useRef(null);
  const [hovered, setHovered] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !data) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const r = Math.min(width, height) / 2;
    const g = svg.append('g').attr('transform', `translate(${width / 2},${height / 2})`);
    const root = d3.hierarchy(data).sum(d => d.value || 0).sort((a, b) => b.value - a.value);
    const partition = d3.partition().size([2 * Math.PI, r]);
    partition(root);
    const arc = d3.arc()
      .startAngle(d => d.x0).endAngle(d => d.x1)
      .innerRadius(d => d.y0 * 0.85).outerRadius(d => d.y1 * 0.85 - 1.5);
    const colorScale = d3.scaleOrdinal()
      .domain(['Investment Engine', 'Institutional Ops', 'Distribution', 'Omniscient AI'])
      .range([T.accent, T.blue, T.green, T.purple]);
    const getColor = (d) => {
      let node = d;
      while (node.depth > 1) node = node.parent;
      return colorScale(node.data.name) || T.textDim;
    };
    const paths = g.selectAll('path').data(root.descendants().filter(d => d.depth > 0)).join('path')
      .attr('d', arc)
      .attr('fill', d => {
        const c = getColor(d);
        return d.depth === 1 ? `${c}40` : `${c}${Math.round(20 + d.depth * 10).toString(16)}`;
      })
      .attr('stroke', T.bg).attr('stroke-width', 1.5)
      .style('cursor', 'pointer')
      .on('mouseenter', function(e, d) {
        d3.select(this).transition().duration(150).attr('fill', `${getColor(d)}60`);
        setHovered({ name: d.data.name, value: d.data.value, depth: d.depth, parent: d.parent?.data.name });
      })
      .on('mouseleave', function(e, d) {
        d3.select(this).transition().duration(150)
          .attr('fill', d.depth === 1 ? `${getColor(d)}40` : `${getColor(d)}${Math.round(20 + d.depth * 10).toString(16)}`);
        setHovered(null);
      });
    // Animated entrance
    paths.attr('opacity', 0).transition().delay((d, i) => i * 25).duration(400)
      .ease(d3.easeCubicOut).attr('opacity', 1);
    // Labels for depth 1
    g.selectAll('text').data(root.descendants().filter(d => d.depth === 1 && (d.x1 - d.x0) > 0.3))
      .join('text')
      .attr('transform', d => {
        const angle = (d.x0 + d.x1) / 2;
        const radius = (d.y0 + d.y1) / 2 * 0.85;
        return `translate(${radius * Math.sin(angle)},${-radius * Math.cos(angle)}) rotate(${angle * 180 / Math.PI - 90})`;
      })
      .attr('text-anchor', 'middle').attr('fill', T.text).attr('font-size', 8)
      .attr('font-weight', 700).attr('font-family', sans).attr('dy', 3)
      .text(d => d.data.name.length > 14 ? d.data.name.slice(0, 12) + '…' : d.data.name);
    // Center label
    g.append('text').attr('text-anchor', 'middle').attr('dy', -4)
      .attr('fill', T.text).attr('font-size', 14).attr('font-weight', 800).attr('font-family', mono)
      .text('26');
    g.append('text').attr('text-anchor', 'middle').attr('dy', 12)
      .attr('fill', T.textDim).attr('font-size', 8).attr('font-family', sans).text('views');
  }, [data, width, height]);
  return (
    <div style={{ position: 'relative', display: 'inline-block' }}>
      <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />
      {hovered && (
        <div style={{ position: 'absolute', top: 8, right: -140, background: T.bgElevated, border: `1px solid ${T.border}`,
          borderRadius: 6, padding: '6px 10px', pointerEvents: 'none', minWidth: 120, zIndex: 10 }}>
          <div style={{ fontSize: 10, fontWeight: 700, color: T.accent }}>{hovered.name}</div>
          {hovered.parent && <div style={{ fontSize: 8, color: T.textMuted }}>{hovered.parent}</div>}
          {hovered.value && <div style={{ fontSize: 9, fontFamily: mono, color: T.green }}>Value: ${hovered.value.toLocaleString()}</div>}
        </div>
      )}
    </div>
  );
};

// ═══ D3 CHORD — Fund Interconnections ═══
const D3Chord = ({ matrix, labels, colors, width = 380, height = 380 }) => {
  const svgRef = useRef(null);
  const [hoverChord, setHoverChord] = useState(null);
  useEffect(() => {
    if (!svgRef.current || !matrix.length) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const r = Math.min(width, height) / 2 - 40;
    const g = svg.append('g').attr('transform', `translate(${width / 2},${height / 2})`);
    const chord = d3.chord().padAngle(0.05).sortSubgroups(d3.descending);
    const chords = chord(matrix);
    const arcGen = d3.arc().innerRadius(r).outerRadius(r + 12);
    const ribbon = d3.ribbon().radius(r - 1);
    // Outer arcs
    g.selectAll('.arc').data(chords.groups).join('path')
      .attr('class', 'arc').attr('d', arcGen)
      .attr('fill', (d, i) => colors[i] || T.accent).attr('stroke', T.bg).attr('stroke-width', 1.5)
      .attr('opacity', 0.8);
    // Labels
    g.selectAll('.label').data(chords.groups).join('text')
      .attr('class', 'label')
      .attr('transform', d => {
        const angle = (d.startAngle + d.endAngle) / 2;
        return `rotate(${angle * 180 / Math.PI - 90}) translate(${r + 20}) ${angle > Math.PI ? 'rotate(180)' : ''}`;
      })
      .attr('text-anchor', d => ((d.startAngle + d.endAngle) / 2 > Math.PI ? 'end' : 'start'))
      .attr('fill', T.textMuted).attr('font-size', 8).attr('font-family', sans)
      .text((d, i) => labels[i] || '');
    // Ribbons
    g.selectAll('.ribbon').data(chords).join('path')
      .attr('class', 'ribbon').attr('d', ribbon)
      .attr('fill', d => `${colors[d.source.index]}30`)
      .attr('stroke', d => `${colors[d.source.index]}50`).attr('stroke-width', 0.5)
      .attr('opacity', d => hoverChord !== null ? (d.source.index === hoverChord || d.target.index === hoverChord ? 0.7 : 0.05) : 0.4)
      .style('cursor', 'pointer')
      .on('mouseenter', (e, d) => setHoverChord(d.source.index))
      .on('mouseleave', () => setHoverChord(null));
    // Entrance
    g.selectAll('.ribbon').attr('opacity', 0)
      .transition().delay((d, i) => i * 30).duration(500).attr('opacity', d => 0.4);
  }, [matrix, labels, colors, width, height, hoverChord]);
  return <svg ref={svgRef} width={width} height={height} style={{ display: 'block', margin: '0 auto' }} />;
};

// ═══ D3 TRIAD MINI-RADAR — Individual 4-axis spider for each team member ═══
const D3TriadRadar = ({ scores, name, color, size = 140 }) => {
  const svgRef = useRef(null);
  const dims = ['Reach','Authority','Velocity','Multiplier'];
  useEffect(() => {
    if (!svgRef.current) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const cx = size/2, cy = size/2, r = size/2 - 24;
    const angleSlice = (Math.PI * 2) / dims.length;
    const rScale = d3.scaleLinear().domain([0, 100]).range([0, r]);
    const g = svg.append('g').attr('transform', `translate(${cx},${cy})`);
    // Concentric rings
    [25, 50, 75, 100].forEach(level => {
      g.append('circle').attr('r', rScale(level))
        .attr('fill', 'none').attr('stroke', T.border).attr('stroke-width', 0.4)
        .attr('stroke-dasharray', level < 100 ? '2,3' : 'none')
        .attr('opacity', level === 100 ? 0.5 : 0.25);
    });
    // Axis lines
    dims.forEach((_, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      g.append('line').attr('x1', 0).attr('y1', 0)
        .attr('x2', r * Math.cos(angle)).attr('y2', r * Math.sin(angle))
        .attr('stroke', T.border).attr('stroke-width', 0.4).attr('opacity', 0.3);
    });
    // Axis labels
    dims.forEach((d, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const lx = (r + 14) * Math.cos(angle);
      const ly = (r + 14) * Math.sin(angle);
      g.append('text').attr('x', lx).attr('y', ly)
        .attr('text-anchor', 'middle').attr('dominant-baseline', 'central')
        .attr('fill', T.textDim).attr('font-size', 7).attr('font-family', mono)
        .text(d.slice(0, 3).toUpperCase());
    });
    // Data polygon
    const points = dims.map((_, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const v = scores[i] || 0;
      return [rScale(v) * Math.cos(angle), rScale(v) * Math.sin(angle)];
    });
    const lineGen = d3.lineRadial()
      .radius((d, i) => rScale(scores[i] || 0))
      .angle((_, i) => angleSlice * i)
      .curve(d3.curveCardinalClosed.tension(0.3));
    // Fill area
    g.append('path')
      .datum(scores)
      .attr('d', lineGen)
      .attr('fill', `${color}18`)
      .attr('stroke', color)
      .attr('stroke-width', 2)
      .attr('opacity', 0)
      .transition().duration(800).ease(d3.easeBackOut)
      .attr('opacity', 1);
    // Score dots
    points.forEach(([px, py], i) => {
      g.append('circle').attr('cx', px).attr('cy', py).attr('r', 0)
        .attr('fill', color).attr('stroke', T.bg).attr('stroke-width', 1.5)
        .transition().delay(400 + i * 100).duration(400).ease(d3.easeBackOut)
        .attr('r', 3.5);
      // Score value near dot
      g.append('text').attr('x', px).attr('y', py - 8)
        .attr('text-anchor', 'middle').attr('fill', color)
        .attr('font-size', 8).attr('font-weight', 800).attr('font-family', mono)
        .attr('opacity', 0)
        .text(scores[i])
        .transition().delay(600 + i * 100).duration(300).attr('opacity', 1);
    });
    // Center composite score
    const composite = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
    g.append('text').attr('x', 0).attr('y', -2)
      .attr('text-anchor', 'middle').attr('fill', color)
      .attr('font-size', 20).attr('font-weight', 900).attr('font-family', mono)
      .attr('opacity', 0).text(composite)
      .transition().delay(800).duration(400).attr('opacity', 1);
    g.append('text').attr('x', 0).attr('y', 10)
      .attr('text-anchor', 'middle').attr('fill', T.textDim)
      .attr('font-size', 6).attr('font-family', mono).text('COMPOSITE');
  }, [scores, color, size]);
  return <svg ref={svgRef} width={size} height={size} style={{ display: 'block' }} />;
};

// ═══ D3 GTM SCATTER — Authority × Velocity bubble chart for hit list ═══
const D3GTMScatter = ({ contacts, width = 710, height = 320 }) => {
  const svgRef = useRef(null);
  const [hoverContact, setHoverContact] = useState(null);
  const tierColors = { Platform: T.accent, Capital: T.green, Multiplier: T.purple, Institutional: T.blue, Berkeley: T.amber, Team: T.cyan };
  useEffect(() => {
    if (!svgRef.current) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const pad = { t: 20, r: 30, b: 36, l: 44 };
    const w = width - pad.l - pad.r, h = height - pad.t - pad.b;
    const g = svg.append('g').attr('transform', `translate(${pad.l},${pad.t})`);
    const defs = svg.append('defs');
    // Scales
    const xScale = d3.scaleLinear().domain([50, 100]).range([0, w]);
    const yScale = d3.scaleLinear().domain([50, 100]).range([h, 0]);
    const rScale = d3.scaleLinear().domain([70, 95]).range([6, 22]);
    // Grid
    [60, 70, 80, 90, 100].forEach(v => {
      g.append('line').attr('x1', xScale(v)).attr('y1', 0).attr('x2', xScale(v)).attr('y2', h)
        .attr('stroke', T.border).attr('stroke-width', 0.3).attr('stroke-dasharray', '2,4');
      g.append('text').attr('x', xScale(v)).attr('y', h + 14)
        .attr('text-anchor', 'middle').attr('fill', T.textDim).attr('font-size', 7).attr('font-family', mono).text(v);
    });
    [60, 70, 80, 90, 100].forEach(v => {
      g.append('line').attr('x1', 0).attr('y1', yScale(v)).attr('x2', w).attr('y2', yScale(v))
        .attr('stroke', T.border).attr('stroke-width', 0.3).attr('stroke-dasharray', '2,4');
      g.append('text').attr('x', -8).attr('y', yScale(v) + 3)
        .attr('text-anchor', 'end').attr('fill', T.textDim).attr('font-size', 7).attr('font-family', mono).text(v);
    });
    // Axis labels
    g.append('text').attr('x', w / 2).attr('y', h + 30)
      .attr('text-anchor', 'middle').attr('fill', T.textMuted).attr('font-size', 8).attr('font-weight', 700).text('AUTHORITY SCORE');
    g.append('text').attr('x', -34).attr('y', h / 2)
      .attr('text-anchor', 'middle').attr('fill', T.textMuted).attr('font-size', 8).attr('font-weight', 700)
      .attr('transform', `rotate(-90, -34, ${h / 2})`).text('VELOCITY');
    // Quadrant labels
    g.append('text').attr('x', w - 4).attr('y', 12)
      .attr('text-anchor', 'end').attr('fill', T.accent).attr('font-size', 7).attr('font-weight', 800).attr('opacity', 0.4)
      .text('★ HIGH-PRIORITY TARGET');
    g.append('text').attr('x', 4).attr('y', h - 4)
      .attr('text-anchor', 'start').attr('fill', T.textDim).attr('font-size', 7).attr('opacity', 0.3)
      .text('NURTURE ZONE');
    // Bubble gradients
    contacts.forEach((c, i) => {
      const col = tierColors[c.tier] || T.textMuted;
      const grad = defs.append('radialGradient').attr('id', `gtmBub${i}`);
      grad.append('stop').attr('offset', '0%').attr('stop-color', col).attr('stop-opacity', 0.5);
      grad.append('stop').attr('offset', '100%').attr('stop-color', col).attr('stop-opacity', 0.1);
    });
    // Bubbles
    const bubbles = g.selectAll('.gtm-bubble').data(contacts).join('g')
      .attr('class', 'gtm-bubble').style('cursor', 'pointer');
    // Outer glow
    bubbles.append('circle')
      .attr('cx', d => xScale(d.auth)).attr('cy', d => yScale(d.vel))
      .attr('r', d => rScale(d.comp) + 6)
      .attr('fill', (d, i) => `url(#gtmBub${i})`);
    // Main bubble
    bubbles.append('circle')
      .attr('class', 'gtm-main')
      .attr('cx', d => xScale(d.auth)).attr('cy', d => yScale(d.vel))
      .attr('r', 0)
      .attr('fill', d => `${tierColors[d.tier] || T.textMuted}20`)
      .attr('stroke', d => tierColors[d.tier] || T.textMuted)
      .attr('stroke-width', 1.5)
      .transition().delay((d, i) => i * 50).duration(600).ease(d3.easeBackOut.overshoot(1.3))
      .attr('r', d => rScale(d.comp));
    // Rank number inside bubble
    bubbles.append('text')
      .attr('x', d => xScale(d.auth)).attr('y', d => yScale(d.vel) + 1)
      .attr('text-anchor', 'middle').attr('dominant-baseline', 'central')
      .attr('fill', d => tierColors[d.tier] || T.text)
      .attr('font-size', d => rScale(d.comp) > 12 ? 10 : 7).attr('font-weight', 900).attr('font-family', mono)
      .attr('opacity', 0).text(d => d.r)
      .transition().delay((d, i) => 300 + i * 50).duration(300).attr('opacity', 1);
    // Name label (offset below)
    bubbles.append('text')
      .attr('x', d => xScale(d.auth)).attr('y', d => yScale(d.vel) + rScale(d.comp) + 10)
      .attr('text-anchor', 'middle')
      .attr('fill', T.textMuted).attr('font-size', 7).attr('font-family', mono)
      .text(d => d.name.split(' ').pop());
    // Hover interactions
    bubbles.on('mouseenter', function(e, d) {
      d3.select(this).select('.gtm-main').transition().duration(200)
        .attr('stroke-width', 3).attr('r', rScale(d.comp) + 4);
      bubbles.filter(b => b !== d).transition().duration(200).attr('opacity', 0.2);
      setHoverContact(d);
    }).on('mouseleave', function(e, d) {
      d3.select(this).select('.gtm-main').transition().duration(200)
        .attr('stroke-width', 1.5).attr('r', rScale(d.comp));
      bubbles.transition().duration(200).attr('opacity', 1);
      setHoverContact(null);
    });
  }, [contacts, width, height]);
  return (
    <div style={{ position: 'relative' }}>
      <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />
      {hoverContact && (
        <div style={{ position:'absolute', right:16, top:16, background:T.bgElevated, border:`1px solid ${tierColors[hoverContact.tier]}40`,
          borderRadius:10, padding:'10px 14px', pointerEvents:'none', zIndex:10, minWidth:200, backdropFilter:'blur(12px)',
          boxShadow:`0 12px 32px ${T.bg}ee` }}>
          <div style={{fontSize:12,fontWeight:800,color:tierColors[hoverContact.tier]}}>{hoverContact.name}</div>
          <div style={{fontSize:9,color:T.textMuted,marginBottom:4}}>{hoverContact.org}</div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:6}}>
            {[{l:'Auth',v:hoverContact.auth},{l:'Vel',v:hoverContact.vel},{l:'Comp',v:hoverContact.comp}].map(m =>
              <div key={m.l} style={{textAlign:'center'}}>
                <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
                <div style={{fontSize:14,fontWeight:800,fontFamily:mono,color:m.v>=90?T.accent:m.v>=80?T.green:T.blue}}>{m.v}</div>
              </div>
            )}
          </div>
          <div style={{fontSize:9,color:T.text,marginTop:4,lineHeight:1.3}}>{hoverContact.value}</div>
        </div>
      )}
    </div>
  );
};

// ═══ D3 MOAT GAUGE — Animated arc gauge for competitive moat scores ═══
const D3MoatGauge = ({ score, label, color, size = 90 }) => {
  const svgRef = useRef(null);
  useEffect(() => {
    if (!svgRef.current) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const cx = size/2, cy = size/2 + 4;
    const outerR = size/2 - 8, innerR = outerR - 8;
    const startAngle = -Math.PI * 0.75;
    const endAngle = Math.PI * 0.75;
    const totalArc = endAngle - startAngle;
    const g = svg.append('g').attr('transform', `translate(${cx},${cy})`);
    // Background arc
    const bgArc = d3.arc().innerRadius(innerR).outerRadius(outerR)
      .startAngle(startAngle).endAngle(endAngle).cornerRadius(4);
    g.append('path').attr('d', bgArc()).attr('fill', `${T.border}30`);
    // Tick marks
    for (let i = 0; i <= 10; i++) {
      const angle = startAngle + (totalArc * i / 10);
      const x1 = (outerR + 2) * Math.cos(angle - Math.PI/2);
      const y1 = (outerR + 2) * Math.sin(angle - Math.PI/2);
      const x2 = (outerR + (i % 5 === 0 ? 6 : 3)) * Math.cos(angle - Math.PI/2);
      const y2 = (outerR + (i % 5 === 0 ? 6 : 3)) * Math.sin(angle - Math.PI/2);
      g.append('line').attr('x1', x1).attr('y1', y1).attr('x2', x2).attr('y2', y2)
        .attr('stroke', T.textDim).attr('stroke-width', i % 5 === 0 ? 1 : 0.5).attr('opacity', 0.4);
    }
    // Animated value arc
    const valueArc = d3.arc().innerRadius(innerR).outerRadius(outerR).cornerRadius(4);
    const scorePath = g.append('path')
      .datum({ startAngle, endAngle: startAngle })
      .attr('d', valueArc)
      .attr('fill', color);
    scorePath.transition().duration(1200).ease(d3.easeCubicOut)
      .attrTween('d', function() {
        const targetAngle = startAngle + totalArc * (score / 100);
        const interp = d3.interpolate(startAngle, targetAngle);
        return function(t) {
          return valueArc({ startAngle, endAngle: interp(t) });
        };
      });
    // Glow on the arc tip
    const tipAngle = startAngle + totalArc * (score / 100) - Math.PI/2;
    const tipX = ((innerR + outerR)/2) * Math.cos(tipAngle);
    const tipY = ((innerR + outerR)/2) * Math.sin(tipAngle);
    g.append('circle').attr('cx', tipX).attr('cy', tipY).attr('r', 0)
      .attr('fill', color).attr('opacity', 0)
      .transition().delay(1200).duration(300)
      .attr('r', 3).attr('opacity', 0.8);
    // Center score
    const scoreText = g.append('text').attr('x', 0).attr('y', -4)
      .attr('text-anchor', 'middle').attr('fill', color)
      .attr('font-size', 22).attr('font-weight', 900).attr('font-family', mono).text(0);
    scoreText.transition().duration(1200).ease(d3.easeCubicOut)
      .tween('text', function() {
        const i = d3.interpolateNumber(0, score);
        return function(t) { d3.select(this).text(Math.round(i(t))); };
      });
    // Label
    g.append('text').attr('x', 0).attr('y', 14)
      .attr('text-anchor', 'middle').attr('fill', T.textDim)
      .attr('font-size', 6).attr('font-weight', 700).attr('font-family', mono).attr('letter-spacing', '0.5px')
      .text(label.toUpperCase().slice(0, 12));
  }, [score, color, size, label]);
  return <svg ref={svgRef} width={size} height={size} style={{ display: 'block' }} />;
};

// ═══ D3 LP FUNNEL — Pipeline funnel from prospecting to committed ═══
const D3LPFunnel = ({ stages, width = 340, height = 220 }) => {
  const svgRef = useRef(null);
  useEffect(() => {
    if (!svgRef.current) return;
    const svg = d3.select(svgRef.current); svg.selectAll('*').remove();
    const pad = { t: 8, b: 8, l: 10, r: 80 };
    const w = width - pad.l - pad.r, h = height - pad.t - pad.b;
    const g = svg.append('g').attr('transform', `translate(${pad.l},${pad.t})`);
    const maxVal = Math.max(...stages.map(s => s.count));
    const barH = Math.min(30, (h - (stages.length - 1) * 6) / stages.length);
    stages.forEach((stage, i) => {
      const y = i * (barH + 6);
      const barW = (stage.count / maxVal) * w;
      const xOffset = (w - barW) / 2;
      // Trapezoid shape
      const nextW = i < stages.length - 1 ? (stages[i+1].count / maxVal) * w : barW * 0.6;
      const nextX = (w - nextW) / 2;
      const path = d3.path();
      path.moveTo(xOffset, y);
      path.lineTo(xOffset + barW, y);
      path.lineTo(i < stages.length - 1 ? nextX + nextW : xOffset + barW * 0.8, y + barH);
      path.lineTo(i < stages.length - 1 ? nextX : xOffset + barW * 0.2, y + barH);
      path.closePath();
      g.append('path').attr('d', path.toString())
        .attr('fill', `${stage.color}00`).attr('stroke', stage.color).attr('stroke-width', 0)
        .transition().delay(i * 120).duration(600).ease(d3.easeCubicOut)
        .attr('fill', `${stage.color}25`).attr('stroke-width', 1.5);
      // Stage label
      g.append('text').attr('x', w / 2).attr('y', y + barH / 2 + 1)
        .attr('text-anchor', 'middle').attr('dominant-baseline', 'central')
        .attr('fill', T.text).attr('font-size', 9).attr('font-weight', 700)
        .attr('opacity', 0).text(stage.label)
        .transition().delay(i * 120 + 200).duration(300).attr('opacity', 1);
      // Count + value
      g.append('text').attr('x', w + pad.r - 4).attr('y', y + barH / 2 - 4)
        .attr('text-anchor', 'end').attr('dominant-baseline', 'central')
        .attr('fill', stage.color).attr('font-size', 14).attr('font-weight', 900).attr('font-family', mono)
        .attr('opacity', 0).text(stage.count)
        .transition().delay(i * 120 + 300).duration(300).attr('opacity', 1);
      g.append('text').attr('x', w + pad.r - 4).attr('y', y + barH / 2 + 10)
        .attr('text-anchor', 'end').attr('fill', T.textDim).attr('font-size', 7).attr('font-family', mono)
        .attr('opacity', 0).text(stage.value)
        .transition().delay(i * 120 + 400).duration(300).attr('opacity', 1);
    });
  }, [stages, width, height]);
  return <svg ref={svgRef} width={width} height={height} style={{ display: 'block' }} />;
};

// ════════════════════════════════════════════════════
// VC INVESTMENT FUNNEL — Interactive Deal Flow Analyzer
// Adapted from v0-vc-funnel for NEWCO Fund-of-Funds context
// ════════════════════════════════════════════════════
const VCFunnelAnalyzer = () => {
  // ── Fund Parameters ──
  const [annualDeals, setAnnualDeals] = useState(800);
  const [targetPortfolio, setTargetPortfolio] = useState(15);
  const [deployYears, setDeployYears] = useState(3);
  const [avgCheck, setAvgCheck] = useState(3000000);
  const [viewMode, setViewMode] = useState('deals'); // deals | hours
  const [timeMode, setTimeMode] = useState('annual'); // annual | lifecycle

  // ── Source Mix (must sum to 100) ──
  const [sources, setSources] = useState([
    {id:'warm',label:'Warm Intro / Network',pct:35,color:T.accent,hoursPerDeal:1.5},
    {id:'conference',label:'Conference / Events',pct:20,color:T.green,hoursPerDeal:2.0},
    {id:'inbound',label:'Inbound / Referral',pct:25,color:T.blue,hoursPerDeal:1.0},
    {id:'omniscient',label:'Omniscient AI',pct:15,color:T.purple,hoursPerDeal:0.5},
    {id:'secondary',label:'Secondary Market',pct:5,color:T.amber,hoursPerDeal:3.0},
  ]);

  // ── Pass-Through Rates ──
  const [stages, setStages] = useState([
    {id:'screen',label:'Initial Screen',rate:40,hoursEach:0.5,desc:'Quick thesis fit check'},
    {id:'dd1',label:'Preliminary DD',rate:25,hoursEach:4,desc:'Track record, team, terms review'},
    {id:'dd2',label:'Deep Due Diligence',rate:30,hoursEach:20,desc:'Reference calls, quant analysis'},
    {id:'ic',label:'IC Vote',rate:50,hoursEach:8,desc:'Investment committee presentation'},
    {id:'terms',label:'Terms & Commit',rate:70,hoursEach:12,desc:'Legal, allocation, wire'},
  ]);

  // ── Computed funnel ──
  const totalDeals = timeMode === 'lifecycle' ? annualDeals * deployYears : annualDeals;
  const funnelSteps = stages.reduce((acc, stage, i) => {
    const prev = i === 0 ? totalDeals : acc[i - 1].out;
    const out = Math.round(prev * (stage.rate / 100));
    const hours = prev * stage.hoursEach;
    acc.push({ ...stage, inCount: prev, out, hours });
    return acc;
  }, []);
  const finalCommitments = funnelSteps.length > 0 ? funnelSteps[funnelSteps.length - 1].out : 0;
  const conversionRate = totalDeals > 0 ? ((finalCommitments / totalDeals) * 100) : 0;
  const totalHours = funnelSteps.reduce((s, st) => s + st.hours, 0) + totalDeals * sources.reduce((s, src) => s + (src.pct / 100) * src.hoursPerDeal, 0);
  const fundSize = finalCommitments * avgCheck;
  const sourceHours = totalDeals * sources.reduce((s, src) => s + (src.pct / 100) * src.hoursPerDeal, 0);

  // Source mix normalization
  const updateSource = (idx, val) => {
    const ns = [...sources];
    ns[idx] = { ...ns[idx], pct: val };
    const others = ns.filter((_, i) => i !== idx);
    const remaining = 100 - val;
    const otherSum = others.reduce((s, o) => s + o.pct, 0);
    if (otherSum > 0) {
      others.forEach(o => { const oi = ns.findIndex(s => s.id === o.id); ns[oi] = { ...ns[oi], pct: Math.max(0, Math.round(o.pct * remaining / otherSum)) }; });
    }
    setSources(ns);
  };

  const updateStage = (idx, rate) => {
    const ns = [...stages]; ns[idx] = { ...ns[idx], rate }; setStages(ns);
  };

  // ── D3 Funnel SVG ──
  const funnelRef = useRef(null);
  useEffect(() => {
    if (!funnelRef.current) return;
    const svg = d3.select(funnelRef.current); svg.selectAll('*').remove();
    const w = 460, h = 340, pad = { t: 10, b: 20, l: 30, r: 30 };
    const fw = w - pad.l - pad.r, fh = h - pad.t - pad.b;
    const g = svg.append('g').attr('transform', `translate(${pad.l},${pad.t})`);
    const defs = svg.append('defs');

    // Build data: [inbound, ...stages]
    const allSteps = [
      { label: 'Inbound', count: totalDeals, color: T.textMuted },
      ...funnelSteps.map((s, i) => ({
        label: s.label,
        count: viewMode === 'hours' ? Math.round(s.hours) : s.inCount,
        outCount: viewMode === 'hours' ? Math.round(s.hours) : s.out,
        color: i === funnelSteps.length - 1 ? T.accent : [T.blue, T.cyan, T.purple, T.amber, T.green][i % 5],
        rate: s.rate,
      })),
    ];
    // Final committed
    allSteps.push({
      label: 'Committed',
      count: viewMode === 'hours' ? Math.round(totalHours) : finalCommitments,
      color: T.accent,
    });

    const maxCount = Math.max(...allSteps.map(s => s.count), 1);
    const stepH = fh / allSteps.length;

    allSteps.forEach((step, i) => {
      const barW = Math.max(20, (step.count / maxCount) * fw);
      const xOff = (fw - barW) / 2;
      const y = i * stepH;

      // Gradient for each bar
      const gradId = `funnelGrad${i}`;
      const grad = defs.append('linearGradient').attr('id', gradId).attr('x1', '0').attr('x2', '1');
      grad.append('stop').attr('offset', '0%').attr('stop-color', step.color).attr('stop-opacity', 0.06);
      grad.append('stop').attr('offset', '50%').attr('stop-color', step.color).attr('stop-opacity', 0.22);
      grad.append('stop').attr('offset', '100%').attr('stop-color', step.color).attr('stop-opacity', 0.06);

      // Trapezoid: current width → next width
      const nextW = i < allSteps.length - 1 ? Math.max(20, (allSteps[i + 1].count / maxCount) * fw) : barW * 0.7;
      const nextX = (fw - nextW) / 2;

      const path = d3.path();
      path.moveTo(xOff, y + 2);
      path.lineTo(xOff + barW, y + 2);
      path.lineTo(nextX + nextW, y + stepH - 2);
      path.lineTo(nextX, y + stepH - 2);
      path.closePath();

      g.append('path')
        .attr('d', path.toString())
        .attr('fill', `url(#${gradId})`)
        .attr('stroke', step.color)
        .attr('stroke-width', 1.2)
        .attr('stroke-opacity', 0.5)
        .attr('opacity', 0)
        .transition().delay(i * 80).duration(500).ease(d3.easeCubicOut)
        .attr('opacity', 1);

      // Label left
      g.append('text')
        .attr('x', xOff - 4).attr('y', y + stepH / 2 + 1)
        .attr('text-anchor', 'end').attr('dominant-baseline', 'central')
        .attr('fill', T.textDim).attr('font-size', 8).attr('font-family', mono)
        .attr('opacity', 0).text(step.label)
        .transition().delay(i * 80 + 200).duration(300).attr('opacity', 1);

      // Count center
      const countText = viewMode === 'hours'
        ? (step.count >= 1000 ? `${(step.count / 1000).toFixed(1)}K hrs` : `${step.count} hrs`)
        : (step.count >= 1000 ? `${(step.count / 1000).toFixed(1)}K` : `${step.count}`);

      g.append('text')
        .attr('x', fw / 2).attr('y', y + stepH / 2 + 1)
        .attr('text-anchor', 'middle').attr('dominant-baseline', 'central')
        .attr('fill', step.color).attr('font-size', i === allSteps.length - 1 ? 16 : 12)
        .attr('font-weight', 800).attr('font-family', mono)
        .attr('opacity', 0).text(countText)
        .transition().delay(i * 80 + 300).duration(300).attr('opacity', 1);

      // Pass-through rate badge (right side)
      if (step.rate) {
        g.append('text')
          .attr('x', xOff + barW + 6).attr('y', y + stepH / 2 + 1)
          .attr('text-anchor', 'start').attr('dominant-baseline', 'central')
          .attr('fill', step.rate >= 50 ? T.green : step.rate >= 25 ? T.amber : T.red)
          .attr('font-size', 9).attr('font-weight', 700).attr('font-family', mono)
          .attr('opacity', 0).text(`${step.rate}%→`)
          .transition().delay(i * 80 + 400).duration(300).attr('opacity', 1);
      }

      // Connecting flow lines between stages
      if (i > 0 && i < allSteps.length - 1) {
        const prevW = Math.max(20, (allSteps[i].count / maxCount) * fw);
        const prevX = (fw - prevW) / 2;
        // Dotted connector showing flow
        g.append('line')
          .attr('x1', fw / 2).attr('y1', y - 1)
          .attr('x2', fw / 2).attr('y2', y + 2)
          .attr('stroke', step.color).attr('stroke-width', 1)
          .attr('stroke-dasharray', '2,2').attr('opacity', 0.3);
      }
    });
  }, [funnelSteps, totalDeals, finalCommitments, viewMode, totalHours]);

  // ── Source Mix D3 Bar ──
  const sourceRef = useRef(null);
  useEffect(() => {
    if (!sourceRef.current) return;
    const svg = d3.select(sourceRef.current); svg.selectAll('*').remove();
    const w = 280, h = 120, pad = 6;
    const g = svg.append('g').attr('transform', `translate(${pad},${pad})`);
    const bw = w - pad * 2, bh = 18;
    let xOff = 0;
    sources.forEach((src, i) => {
      const sw = Math.max(2, (src.pct / 100) * bw);
      g.append('rect')
        .attr('x', xOff).attr('y', 0).attr('width', 0).attr('height', bh)
        .attr('rx', i === 0 ? 4 : 0).attr('fill', src.color)
        .attr('opacity', 0.7)
        .transition().delay(i * 60).duration(400).attr('width', sw);
      // Label below
      if (src.pct >= 8) {
        g.append('text')
          .attr('x', xOff + sw / 2).attr('y', bh + 14)
          .attr('text-anchor', 'middle').attr('fill', src.color)
          .attr('font-size', 8).attr('font-weight', 700).attr('font-family', mono)
          .text(`${src.pct}%`);
        g.append('text')
          .attr('x', xOff + sw / 2).attr('y', bh + 24)
          .attr('text-anchor', 'middle').attr('fill', T.textDim)
          .attr('font-size', 7).text(src.label.split(' ')[0]);
      }
      xOff += sw;
    });
    // Hours breakdown below
    const hy = 56;
    g.append('text').attr('x', 0).attr('y', hy)
      .attr('fill', T.textDim).attr('font-size', 7).attr('font-weight', 700).text('HOURS BY STAGE');
    const barData = [
      { l: 'Sourcing', v: sourceHours, c: T.textMuted },
      ...funnelSteps.map(s => ({ l: s.label.split(' ')[0], v: s.hours, c: T.accent })),
    ];
    const maxH = Math.max(...barData.map(d => d.v), 1);
    const barW2 = (bw - (barData.length - 1) * 3) / barData.length;
    barData.forEach((d, i) => {
      const bx = i * (barW2 + 3);
      const barH = Math.max(2, (d.v / maxH) * 36);
      g.append('rect')
        .attr('x', bx).attr('y', hy + 8 + (36 - barH)).attr('width', barW2).attr('height', barH)
        .attr('rx', 2).attr('fill', d.c).attr('opacity', 0.5);
      g.append('text')
        .attr('x', bx + barW2 / 2).attr('y', hy + 48)
        .attr('text-anchor', 'middle').attr('fill', T.textDim).attr('font-size', 6).text(d.l);
      g.append('text')
        .attr('x', bx + barW2 / 2).attr('y', hy + 8 + (36 - barH) - 3)
        .attr('text-anchor', 'middle').attr('fill', d.c).attr('font-size', 7).attr('font-weight', 700).attr('font-family', mono)
        .text(d.v >= 1000 ? `${(d.v / 1000).toFixed(1)}K` : Math.round(d.v));
    });
  }, [sources, funnelSteps, sourceHours]);

  // Slider helper
  const Slider = ({ label, value, min, max, step, onChange, format, color }) => (
    <div style={{ marginBottom: 8 }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 2 }}>
        <span style={{ fontSize: 9, color: T.textDim, fontWeight: 600 }}>{label}</span>
        <span style={{ fontSize: 10, fontWeight: 800, fontFamily: mono, color: color || T.accent }}>{format ? format(value) : value}</span>
      </div>
      <input type="range" min={min} max={max} step={step || 1} value={value} onChange={e => onChange(Number(e.target.value))}
        style={{ width: '100%', height: 4, appearance: 'none', background: `linear-gradient(90deg, ${color || T.accent} ${((value - min) / (max - min)) * 100}%, ${T.border} ${((value - min) / (max - min)) * 100}%)`, borderRadius: 4, outline: 'none', cursor: 'pointer', accentColor: color || T.accent }} />
    </div>
  );

  return (
    <Card title="VC Investment Funnel — Deal Flow Analyzer" action={
      <div style={{ display: 'flex', gap: 4, alignItems: 'center' }}>
        {/* View toggles */}
        <div style={{ display: 'flex', background: T.bg, borderRadius: 4, padding: 1, border: `1px solid ${T.border}` }}>
          {[['deals', 'Deals'], ['hours', 'Hours']].map(([id, l]) =>
            <button key={id} onClick={() => setViewMode(id)} style={{ padding: '2px 8px', fontSize: 8, fontWeight: viewMode === id ? 700 : 400, background: viewMode === id ? T.bgCard : 'transparent', color: viewMode === id ? T.accent : T.textDim, border: 'none', borderRadius: 3, cursor: 'pointer', fontFamily: sans }}>{l}</button>
          )}
        </div>
        <div style={{ display: 'flex', background: T.bg, borderRadius: 4, padding: 1, border: `1px solid ${T.border}` }}>
          {[['annual', 'Annual'], ['lifecycle', 'Lifecycle']].map(([id, l]) =>
            <button key={id} onClick={() => setTimeMode(id)} style={{ padding: '2px 8px', fontSize: 8, fontWeight: timeMode === id ? 700 : 400, background: timeMode === id ? T.bgCard : 'transparent', color: timeMode === id ? T.accent : T.textDim, border: 'none', borderRadius: 3, cursor: 'pointer', fontFamily: sans }}>{l}</button>
          )}
        </div>
        <span style={{ fontSize: 7, color: T.textDim, fontFamily: mono }}>inspired by v0-vc-funnel</span>
      </div>
    } style={{ marginBottom: 12 }}>
      <div style={{ padding: '12px 16px' }}>
        {/* ── KPI HERO ROW ── */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5,1fr)', gap: 8, marginBottom: 14 }}>
          {[
            { l: 'Conversion', v: `${conversionRate.toFixed(2)}%`, c: conversionRate > 2 ? T.green : T.amber },
            { l: 'Total Hours', v: totalHours >= 1000 ? `${(totalHours / 1000).toFixed(1)}K` : Math.round(totalHours), c: T.blue },
            { l: timeMode === 'lifecycle' ? 'Fund Deploy' : 'Annual Deploy', v: `$${(fundSize / 1e6).toFixed(1)}M`, c: T.accent },
            { l: 'Commitments', v: finalCommitments, c: T.green },
            { l: 'Hrs / Commit', v: finalCommitments > 0 ? Math.round(totalHours / finalCommitments) : '—', c: T.purple },
          ].map((kpi, i) => (
            <div key={i} style={{ textAlign: 'center', padding: '8px 4px', background: T.bgAccent, borderRadius: 6, border: `1px solid ${T.border}` }}>
              <div style={{ fontSize: 8, color: T.textDim, fontWeight: 600, marginBottom: 2 }}>{kpi.l}</div>
              <div style={{ fontSize: 18, fontWeight: 900, fontFamily: mono, color: kpi.c }}>{kpi.v}</div>
            </div>
          ))}
        </div>

        {/* ── MAIN GRID: Controls | Funnel | Source/Hours ── */}
        <div style={{ display: 'grid', gridTemplateColumns: '220px 1fr 290px', gap: 14, alignItems: 'start' }}>

          {/* LEFT: Parameter Controls */}
          <div>
            <div style={{ fontSize: 9, fontWeight: 700, color: T.textDim, marginBottom: 8, letterSpacing: 0.5 }}>FUND PARAMETERS</div>
            <Slider label="Annual GP Deal Flow" value={annualDeals} min={100} max={3000} step={50} onChange={setAnnualDeals} />
            <Slider label="Target Portfolio GPs" value={targetPortfolio} min={5} max={50} onChange={setTargetPortfolio} color={T.green} />
            <Slider label="Deployment (years)" value={deployYears} min={1} max={5} onChange={setDeployYears} color={T.blue} />
            <Slider label="Avg Check Size" value={avgCheck} min={500000} max={10000000} step={250000} onChange={setAvgCheck} color={T.purple}
              format={v => `$${(v / 1e6).toFixed(2)}M`} />

            <div style={{ fontSize: 9, fontWeight: 700, color: T.textDim, marginTop: 12, marginBottom: 6, letterSpacing: 0.5 }}>SOURCE MIX ({sources.reduce((s, x) => s + x.pct, 0)}%)</div>
            {sources.map((src, i) => (
              <Slider key={src.id} label={src.label} value={src.pct} min={0} max={80} onChange={v => updateSource(i, v)}
                color={src.color} format={v => `${v}%`} />
            ))}

            <div style={{ fontSize: 9, fontWeight: 700, color: T.textDim, marginTop: 12, marginBottom: 6, letterSpacing: 0.5 }}>PASS-THROUGH RATES</div>
            {stages.map((st, i) => (
              <Slider key={st.id} label={st.label} value={st.rate} min={5} max={90}
                onChange={v => updateStage(i, v)} format={v => `${v}%`}
                color={st.rate >= 50 ? T.green : st.rate >= 25 ? T.amber : T.red} />
            ))}
          </div>

          {/* CENTER: D3 Animated Funnel */}
          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
            <div style={{ fontSize: 9, fontWeight: 700, color: T.textDim, marginBottom: 4, letterSpacing: 0.5 }}>
              {viewMode === 'hours' ? 'HOURS BY STAGE' : 'DEAL FLOW FUNNEL'} — {timeMode === 'lifecycle' ? `${deployYears}yr lifecycle` : 'Annual'}
            </div>
            <svg ref={funnelRef} width={460} height={340} style={{ display: 'block' }} />
          </div>

          {/* RIGHT: Source Mix + Hours Breakdown */}
          <div>
            <div style={{ fontSize: 9, fontWeight: 700, color: T.textDim, marginBottom: 4, letterSpacing: 0.5 }}>SOURCE MIX & HOURS</div>
            <svg ref={sourceRef} width={280} height={120} style={{ display: 'block', marginBottom: 8 }} />

            {/* Stage detail table */}
            <div style={{ fontSize: 9, fontWeight: 700, color: T.textDim, marginBottom: 4, letterSpacing: 0.5 }}>STAGE DETAILS</div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead>
                <tr>
                  {['Stage', 'In', 'Rate', 'Out', 'Hours'].map(h =>
                    <th key={h} style={{ fontSize: 7, color: T.textDim, fontWeight: 700, textAlign: h === 'Stage' ? 'left' : 'right', padding: '2px 4px', borderBottom: `1px solid ${T.border}` }}>{h}</th>
                  )}
                </tr>
              </thead>
              <tbody>
                {funnelSteps.map((s, i) => (
                  <tr key={i} style={{ borderBottom: `1px solid ${T.border}30` }}>
                    <td style={{ fontSize: 9, fontWeight: 600, color: T.text, padding: '3px 4px' }}>{s.label}</td>
                    <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.textMuted, padding: '3px 4px' }}>{s.inCount.toLocaleString()}</td>
                    <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: s.rate >= 50 ? T.green : s.rate >= 25 ? T.amber : T.red, fontWeight: 700, padding: '3px 4px' }}>{s.rate}%</td>
                    <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.accent, fontWeight: 700, padding: '3px 4px' }}>{s.out.toLocaleString()}</td>
                    <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.blue, padding: '3px 4px' }}>{Math.round(s.hours).toLocaleString()}</td>
                  </tr>
                ))}
                <tr style={{ borderTop: `2px solid ${T.accent}40` }}>
                  <td style={{ fontSize: 9, fontWeight: 800, color: T.accent, padding: '4px 4px' }}>TOTAL</td>
                  <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.accent, fontWeight: 800, padding: '4px 4px' }}>{totalDeals.toLocaleString()}</td>
                  <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.accent, fontWeight: 800, padding: '4px 4px' }}>{conversionRate.toFixed(2)}%</td>
                  <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.accent, fontWeight: 800, padding: '4px 4px' }}>{finalCommitments}</td>
                  <td style={{ fontSize: 9, fontFamily: mono, textAlign: 'right', color: T.accent, fontWeight: 800, padding: '4px 4px' }}>{Math.round(totalHours).toLocaleString()}</td>
                </tr>
              </tbody>
            </table>

            {/* Efficiency metrics */}
            <div style={{ marginTop: 10, padding: '8px 10px', background: T.bgAccent, borderRadius: 6, border: `1px solid ${T.border}` }}>
              <div style={{ fontSize: 8, fontWeight: 700, color: T.textDim, marginBottom: 4 }}>EFFICIENCY METRICS</div>
              {[
                { l: 'Deals per commitment', v: finalCommitments > 0 ? `${Math.round(totalDeals / finalCommitments)}:1` : '—', c: T.accent },
                { l: 'Hours per commitment', v: finalCommitments > 0 ? `${Math.round(totalHours / finalCommitments)}h` : '—', c: T.blue },
                { l: 'Cost per commitment', v: finalCommitments > 0 ? `$${((totalHours / finalCommitments) * 150).toLocaleString()}` : '—', c: T.green, sub: '@ $150/hr' },
                { l: 'Omniscient savings', v: `${Math.round(sources.find(s => s.id === 'omniscient')?.pct * totalDeals / 100 * 1.0)}h`, c: T.purple, sub: 'vs manual sourcing' },
                { l: 'Target vs actual', v: `${finalCommitments}/${targetPortfolio}`, c: finalCommitments >= targetPortfolio ? T.green : T.red },
              ].map((m, i) => (
                <div key={i} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '2px 0' }}>
                  <span style={{ fontSize: 8, color: T.textDim }}>{m.l}</span>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    {m.sub && <span style={{ fontSize: 7, color: T.textDim }}>{m.sub}</span>}
                    <span style={{ fontSize: 10, fontWeight: 800, fontFamily: mono, color: m.c }}>{m.v}</span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </Card>
  );
};

// ═══ SANKEY FLOW — Capital flow: Source → Fund → Sector → Company ═══
// ════════════════════════════════════════════════════
// ADVANCED DATA VISUALIZATION COMPONENTS
// ════════════════════════════════════════════════════

// ═══ SANKEY FLOW — Capital flow: Source → Fund → Sector → Company ═══
const SankeyFlow = ({ data, width = 720, height = 320, title = 'Capital Flow' }) => {
  const [hovered, setHovered] = useState(null);
  const pad = { t: 30, r: 20, b: 20, l: 20 };
  const w = width - pad.l - pad.r, h = height - pad.t - pad.b;
  // data: [{from, to, value, color}]
  // Calculate node positions by column
  const cols = {};
  data.forEach(d => {
    if (!cols[d.fromCol]) cols[d.fromCol] = {};
    if (!cols[d.toCol]) cols[d.toCol] = {};
    cols[d.fromCol][d.from] = (cols[d.fromCol][d.from] || 0) + d.value;
    cols[d.toCol][d.to] = (cols[d.toCol][d.to] || 0) + d.value;
  });
  const colKeys = Object.keys(cols).sort((a, b) => a - b);
  const colCount = colKeys.length;
  const nodeW = 14;
  const nodePositions = {};
  colKeys.forEach((col, ci) => {
    const nodes = Object.entries(cols[col]).sort((a, b) => b[1] - a[1]);
    const totalVal = nodes.reduce((s, [, v]) => s + v, 0);
    const gap = 6;
    const totalGap = (nodes.length - 1) * gap;
    const scale = (h - totalGap) / totalVal;
    let y = pad.t;
    nodes.forEach(([name, val]) => {
      const nh = Math.max(val * scale, 8);
      nodePositions[`${col}-${name}`] = { x: pad.l + ci * ((w - nodeW) / (colCount - 1)), y, h: nh, val, col: parseInt(col) };
      y += nh + gap;
    });
  });
  // Draw links
  const links = data.map((d, i) => {
    const src = nodePositions[`${d.fromCol}-${d.from}`];
    const dst = nodePositions[`${d.toCol}-${d.to}`];
    if (!src || !dst) return null;
    const srcTotal = cols[d.fromCol][d.from];
    const dstTotal = cols[d.toCol][d.to];
    const srcShare = d.value / srcTotal;
    const dstShare = d.value / dstTotal;
    // Track cumulative offsets
    if (!src._outOffset) src._outOffset = 0;
    if (!dst._inOffset) dst._inOffset = 0;
    const sy1 = src.y + src._outOffset;
    const sh = src.h * srcShare;
    const dy1 = dst.y + dst._inOffset;
    const dh = dst.h * dstShare;
    src._outOffset += sh;
    dst._inOffset += dh;
    const sx = src.x + nodeW, dx = dst.x;
    const midX = (sx + dx) / 2;
    const path = `M${sx},${sy1} C${midX},${sy1} ${midX},${dy1} ${dx},${dy1} L${dx},${dy1 + dh} C${midX},${dy1 + dh} ${midX},${sy1 + sh} ${sx},${sy1 + sh} Z`;
    return { path, color: d.color || T.accent, value: d.value, from: d.from, to: d.to, idx: i };
  }).filter(Boolean);

  return (
    <Card title={title}>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {/* Column headers */}
        {['LPs', 'Funds', 'Sectors', 'Top Companies'].map((label, i) => (
          <text key={i} x={pad.l + i * ((w - nodeW) / (colCount - 1)) + nodeW / 2} y={14} fill={T.textDim} fontSize={9} fontWeight={700} textAnchor="middle" letterSpacing="0.5">{label}</text>
        ))}
        {/* Links */}
        {links.map((l, i) => (
          <path key={i} d={l.path} fill={`${l.color}${hovered === l.idx ? '40' : '18'}`} stroke={hovered === l.idx ? l.color : 'none'} strokeWidth={0.5} style={{ cursor: 'pointer', transition: 'fill .15s' }}
            onMouseEnter={() => setHovered(l.idx)} onMouseLeave={() => setHovered(null)} />
        ))}
        {/* Nodes */}
        {Object.entries(nodePositions).map(([key, n]) => {
          const name = key.split('-').slice(1).join('-');
          const isLeft = n.col === 0;
          const isRight = n.col === colCount - 1;
          return (
            <g key={key}>
              <rect x={n.x} y={n.y} width={nodeW} height={n.h} rx={3} fill={T.bgAccent} stroke={T.border} strokeWidth={1} />
              <text x={isLeft ? n.x - 4 : (isRight ? n.x + nodeW + 4 : n.x + nodeW / 2)} y={n.y + n.h / 2 + 3}
                fill={T.text} fontSize={8} fontWeight={600} textAnchor={isLeft ? 'end' : (isRight ? 'start' : 'middle')}>{name}</text>
              <text x={isLeft ? n.x - 4 : (isRight ? n.x + nodeW + 4 : n.x + nodeW / 2)} y={n.y + n.h / 2 + 12}
                fill={T.textDim} fontSize={7} fontFamily={mono} textAnchor={isLeft ? 'end' : (isRight ? 'start' : 'middle')}>${n.val}M</text>
            </g>
          );
        })}
        {/* Hover tooltip */}
        {hovered !== null && links[hovered] && (
          <g>
            <rect x={width / 2 - 70} y={height - 18} width={140} height={16} rx={4} fill={T.bgCard} stroke={links[hovered].color} />
            <text x={width / 2} y={height - 7} fill={T.text} fontSize={9} fontWeight={600} textAnchor="middle">{links[hovered].from} → {links[hovered].to}: ${links[hovered].value}M</text>
          </g>
        )}
      </svg>
    </Card>
  );
};

// ═══ FUNNEL CHART — Pipeline conversion with stage metrics ═══
const FunnelChart = ({ stages, width = 340, height = 240, title = 'Conversion Funnel' }) => {
  const [hovered, setHovered] = useState(null);
  const pad = { t: 10, b: 10 };
  const stageH = (height - pad.t - pad.b) / stages.length;
  const maxW = width * 0.85;
  const maxVal = stages[0]?.value || 1;
  return (
    <Card title={title}>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {stages.map((s, i) => {
          const ratio = s.value / maxVal;
          const bw = maxW * Math.max(ratio, 0.15);
          const bx = (width - bw) / 2;
          const by = pad.t + i * stageH;
          const bh = stageH - 4;
          const isH = hovered === i;
          return (
            <g key={i} onMouseEnter={() => setHovered(i)} onMouseLeave={() => setHovered(null)} style={{ cursor: 'pointer' }}>
              <rect x={bx} y={by} width={bw} height={bh} rx={4} fill={`${s.color || T.accent}${isH ? '40' : '25'}`} stroke={isH ? (s.color || T.accent) : `${s.color || T.accent}40`} strokeWidth={isH ? 1.5 : 0.5} style={{ transition: 'all .15s' }} />
              <text x={width / 2} y={by + bh / 2 - 5} fill={T.text} fontSize={10} fontWeight={700} textAnchor="middle">{s.label}</text>
              <text x={width / 2} y={by + bh / 2 + 7} fill={s.color || T.accent} fontSize={12} fontWeight={800} fontFamily={mono} textAnchor="middle">{s.value}</text>
              {i > 0 && <text x={width - 12} y={by + bh / 2 + 3} fill={T.textDim} fontSize={8} fontFamily={mono} textAnchor="end">{((s.value / stages[i - 1].value) * 100).toFixed(0)}%</text>}
              {/* Drop-off arrow between stages */}
              {i > 0 && <text x={bx - 8} y={by + 2} fill={T.red} fontSize={8} fontWeight={600} textAnchor="end">-{stages[i - 1].value - s.value}</text>}
            </g>
          );
        })}
      </svg>
    </Card>
  );
};

// ═══ GANTT TIMELINE — Phase/milestone visualization with progress ═══
const GanttTimeline = ({ phases, width = 700, height: propH, title = 'Build Timeline' }) => {
  const [hovered, setHovered] = useState(null);
  const rowH = 44, pad = { t: 28, l: 130, r: 20, b: 10 };
  const height = propH || (pad.t + phases.length * rowH + pad.b);
  const totalWeeks = phases.reduce((max, p) => Math.max(max, (p.startWeek || 0) + (p.weeks || 0)), 0);
  const chartW = width - pad.l - pad.r;
  const wScale = chartW / totalWeeks;
  // Week markers
  const weekMarks = [];
  for (let i = 0; i <= totalWeeks; i += 4) weekMarks.push(i);
  return (
    <Card title={title}>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {/* Week headers */}
        {weekMarks.map(w => (
          <g key={w}>
            <line x1={pad.l + w * wScale} y1={pad.t - 4} x2={pad.l + w * wScale} y2={height - pad.b} stroke={T.border} strokeWidth={0.5} strokeDasharray="2,4" />
            <text x={pad.l + w * wScale} y={pad.t - 8} fill={T.textDim} fontSize={8} fontFamily={mono} textAnchor="middle">W{w}</text>
          </g>
        ))}
        {/* Today line */}
        {phases[0]?.todayWeek != null && (
          <g>
            <line x1={pad.l + phases[0].todayWeek * wScale} y1={pad.t} x2={pad.l + phases[0].todayWeek * wScale} y2={height - pad.b} stroke={T.accent} strokeWidth={1.5} strokeDasharray="4,3" />
            <text x={pad.l + phases[0].todayWeek * wScale} y={pad.t - 8} fill={T.accent} fontSize={8} fontWeight={700} textAnchor="middle">TODAY</text>
          </g>
        )}
        {/* Phase bars */}
        {phases.map((p, i) => {
          const y = pad.t + i * rowH;
          const x = pad.l + (p.startWeek || 0) * wScale;
          const bw = (p.weeks || 1) * wScale;
          const prog = p.progress || 0;
          const isH = hovered === i;
          return (
            <g key={i} onMouseEnter={() => setHovered(i)} onMouseLeave={() => setHovered(null)} style={{ cursor: 'pointer' }}>
              {/* Label */}
              <text x={pad.l - 8} y={y + rowH / 2 + 1} fill={isH ? T.text : T.textMuted} fontSize={10} fontWeight={700} textAnchor="end">{p.label}</text>
              <text x={pad.l - 8} y={y + rowH / 2 + 12} fill={T.textDim} fontSize={8} textAnchor="end">{p.cost || ''}</text>
              {/* Track */}
              <rect x={x} y={y + 8} width={bw} height={rowH - 20} rx={4} fill={`${p.color || T.accent}15`} stroke={`${p.color || T.accent}40`} strokeWidth={isH ? 1.5 : 0.5} />
              {/* Progress fill */}
              <rect x={x} y={y + 8} width={bw * (prog / 100)} height={rowH - 20} rx={4} fill={`${p.color || T.accent}35`} />
              {/* Progress % */}
              <text x={x + bw / 2} y={y + rowH / 2 + 2} fill={p.color || T.accent} fontSize={11} fontWeight={800} fontFamily={mono} textAnchor="middle">{prog}%</text>
              {/* Gate marker */}
              {p.gate && <g>
                <circle cx={x + bw + 4} cy={y + rowH / 2} r={6} fill={T.bgCard} stroke={p.gateStatus === 'pass' ? T.green : (p.gateStatus === 'pending' ? T.amber : T.textDim)} strokeWidth={1.5} />
                <text x={x + bw + 4} y={y + rowH / 2 + 3} fill={p.gateStatus === 'pass' ? T.green : T.amber} fontSize={8} fontWeight={800} textAnchor="middle">{p.gateStatus === 'pass' ? '✓' : '○'}</text>
              </g>}
              {/* Hover detail */}
              {isH && <rect x={x + bw + 14} y={y + 4} width={140} height={rowH - 10} rx={4} fill={T.bgCard} stroke={p.color || T.accent} strokeWidth={1} />}
              {isH && <>
                <text x={x + bw + 20} y={y + 16} fill={T.text} fontSize={9} fontWeight={700}>{p.detail || `${p.weeks} weeks`}</text>
                <text x={x + bw + 20} y={y + 28} fill={p.color || T.accent} fontSize={9} fontFamily={mono}>{p.cost || ''} | {p.weeks}wk</text>
                <text x={x + bw + 20} y={y + 38} fill={T.textDim} fontSize={8}>{p.status || ''}</text>
              </>}
            </g>
          );
        })}
      </svg>
    </Card>
  );
};

// ═══ HORIZONTAL WATERFALL — Compare items side by side (value generators, cost drivers) ═══
const HorizontalWaterfall = ({ items, width = 700, height: propH, title, maxVal: forcedMax, valueLabel = 'Value', showCumulative = false }) => {
  const [hovered, setHovered] = useState(null);
  const rowH = 32, pad = { t: 24, l: 140, r: 50, b: 10 };
  const height = propH || (pad.t + items.length * rowH + pad.b + (showCumulative ? 32 : 0));
  const maxVal = forcedMax || Math.max(...items.map(d => Math.abs(d.value)));
  const barMaxW = width - pad.l - pad.r;
  let cumulative = 0;
  return (
    <Card title={title}>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {/* Header */}
        <text x={pad.l} y={14} fill={T.textDim} fontSize={8} fontWeight={700} textAnchor="start">{valueLabel}</text>
        <text x={width - pad.r} y={14} fill={T.textDim} fontSize={8} fontWeight={700} textAnchor="end">Monthly</text>
        {/* Zero line */}
        <line x1={pad.l} y1={pad.t} x2={pad.l} y2={height - pad.b} stroke={T.border} strokeWidth={1} />
        {/* Items */}
        {items.map((item, i) => {
          const y = pad.t + i * rowH;
          const bw = (Math.abs(item.value) / maxVal) * barMaxW;
          const isH = hovered === i;
          cumulative += item.value;
          return (
            <g key={i} onMouseEnter={() => setHovered(i)} onMouseLeave={() => setHovered(null)} style={{ cursor: 'pointer' }}>
              {/* Alt row bg */}
              {i % 2 === 0 && <rect x={0} y={y} width={width} height={rowH} fill={`${T.bgAccent}40`} />}
              {/* Label */}
              <text x={pad.l - 8} y={y + rowH / 2 + 3} fill={isH ? T.text : T.textMuted} fontSize={10} fontWeight={isH ? 700 : 500} textAnchor="end">{item.label}</text>
              {/* Bar */}
              <rect x={item.value >= 0 ? pad.l : pad.l - bw} y={y + 6} width={bw} height={rowH - 14} rx={3}
                fill={`${item.color || (item.value >= 0 ? T.green : T.red)}${isH ? '50' : '30'}`}
                stroke={isH ? (item.color || T.accent) : 'transparent'} strokeWidth={1} style={{ transition: 'all .12s' }} />
              {/* Value label */}
              <text x={pad.l + bw + 6} y={y + rowH / 2 + 3} fill={item.color || T.accent} fontSize={10} fontWeight={700} fontFamily={mono}>
                {item.displayValue || `$${(item.value / 1000).toFixed(1)}K`}
              </text>
              {/* Icon */}
              {item.icon && <text x={pad.l + 4} y={y + rowH / 2 + 4} fontSize={12}>{item.icon}</text>}
            </g>
          );
        })}
        {/* Cumulative total */}
        {showCumulative && (() => {
          const y = pad.t + items.length * rowH + 4;
          const bw = (Math.abs(cumulative) / maxVal) * barMaxW;
          return (
            <g>
              <line x1={0} y1={y - 2} x2={width} y2={y - 2} stroke={T.accent} strokeWidth={1} strokeDasharray="3,3" />
              <text x={pad.l - 8} y={y + 14} fill={T.accent} fontSize={11} fontWeight={800} textAnchor="end">TOTAL</text>
              <rect x={pad.l} y={y + 2} width={bw} height={20} rx={4} fill={`${T.accent}30`} stroke={T.accent} strokeWidth={1.5} />
              <text x={pad.l + bw + 8} y={y + 16} fill={T.accent} fontSize={12} fontWeight={800} fontFamily={mono}>${(cumulative / 1000).toFixed(1)}K/mo</text>
            </g>
          );
        })()}
      </svg>
    </Card>
  );
};

// ═══ BULLET GAUGE — Target vs Actual with threshold zones ═══
const BulletGauge = ({ label, actual, target, ranges, max, color = T.accent, width = 200, height = 40 }) => {
  const pad = { l: 0, r: 8 };
  const barW = width - pad.l - pad.r;
  const barH = 14;
  const y = height / 2 - barH / 2;
  const scale = v => pad.l + (v / max) * barW;
  const r = ranges || [{ to: max * 0.33, c: T.red }, { to: max * 0.66, c: T.amber }, { to: max, c: T.green }];
  return (
    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
      <span style={{ fontSize: 9, color: T.textMuted, minWidth: 70, textAlign: 'right', fontWeight: 600 }}>{label}</span>
      <svg width={width} height={height} style={{ display: 'block' }}>
        {/* Range bands */}
        {r.map((rng, i) => {
          const from = i > 0 ? r[i - 1].to : 0;
          return <rect key={i} x={scale(from)} y={y} width={scale(rng.to) - scale(from)} height={barH} fill={`${rng.c}15`} />;
        })}
        {/* Actual bar */}
        <rect x={pad.l} y={y + 3} width={scale(actual) - pad.l} height={barH - 6} rx={2} fill={`${color}60`} />
        {/* Target marker */}
        <line x1={scale(target)} y1={y - 2} x2={scale(target)} y2={y + barH + 2} stroke={T.text} strokeWidth={2} />
        {/* Value */}
        <text x={scale(actual) + 4} y={y + barH / 2 + 3} fill={color} fontSize={9} fontWeight={700} fontFamily={mono}>{actual}</text>
      </svg>
    </div>
  );
};

// ═══ VELOCITY BAND — Sparkline with acceleration/deceleration zones ═══
const VelocityBand = ({ data, width = 200, height = 50, color = T.accent, label, thresholds }) => {
  if (!data || data.length < 2) return null;
  const max = Math.max(...data), min = Math.min(...data);
  const range = max - min || 1;
  const xS = (i) => (i / (data.length - 1)) * width;
  const yS = (v) => height - 6 - ((v - min) / range) * (height - 12);
  // Calculate velocity (rate of change)
  const velocities = data.slice(1).map((v, i) => v - data[i]);
  const maxVel = Math.max(...velocities.map(Math.abs)) || 1;
  const path = data.map((v, i) => `${i === 0 ? 'M' : 'L'}${xS(i)},${yS(v)}`).join(' ');
  const areaPath = path + ` L${xS(data.length - 1)},${height - 6} L${xS(0)},${height - 6} Z`;
  // Determine trend
  const recentVel = velocities.slice(-3).reduce((s, v) => s + v, 0) / 3;
  const trendColor = recentVel > 0 ? T.green : recentVel < 0 ? T.red : T.amber;
  const trendLabel = recentVel > 0 ? '↑ Accelerating' : recentVel < 0 ? '↓ Decelerating' : '→ Steady';
  return (
    <div style={{ background: T.bgAccent, borderRadius: 6, padding: '6px 8px', border: `1px solid ${T.border}` }}>
      {label && <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 2 }}>
        <span style={{ fontSize: 8, color: T.textDim, fontWeight: 700, textTransform: 'uppercase' }}>{label}</span>
        <span style={{ fontSize: 8, color: trendColor, fontWeight: 700 }}>{trendLabel}</span>
      </div>}
      <svg width={width} height={height} style={{ display: 'block' }}>
        {/* Threshold zones */}
        {thresholds && thresholds.map((th, i) => (
          <rect key={i} x={0} y={yS(th.to)} width={width} height={yS(th.from) - yS(th.to)} fill={`${th.c}08`} />
        ))}
        {/* Area fill with gradient */}
        <defs>
          <linearGradient id={`vel-${label}`} x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stopColor={color} stopOpacity="0.2" />
            <stop offset="100%" stopColor={color} stopOpacity="0" />
          </linearGradient>
        </defs>
        <path d={areaPath} fill={`url(#vel-${label})`} />
        {/* Velocity bars (below main line) */}
        {velocities.map((v, i) => (
          <rect key={i} x={xS(i + 0.5) - 1} y={height - 4} width={2} height={-Math.abs(v / maxVel) * 8}
            fill={v > 0 ? T.green : T.red} rx={1} opacity={0.6} />
        ))}
        {/* Line */}
        <path d={path} fill="none" stroke={color} strokeWidth={1.5} />
        {/* End dot */}
        <circle cx={xS(data.length - 1)} cy={yS(data[data.length - 1])} r={3} fill={color} />
        {/* Current value */}
        <text x={width - 2} y={10} fill={color} fontSize={11} fontWeight={800} fontFamily={mono} textAnchor="end">{data[data.length - 1].toLocaleString()}</text>
      </svg>
    </div>
  );
};

// Treemap — drill-down from sector → fund → company
const Treemap = ({ data, width = 700, height = 280, onDrill, drillPath = [] }) => {
  const total = data.reduce((s, d) => s + d.value, 0);
  const pad = 3;
  let cx = pad;
  const rects = data.map((d, i) => {
    const pct = d.value / total;
    const w = (width - pad * 2) * pct;
    const x = cx;
    cx += w;
    return { ...d, x, w, pct };
  });
  return (
    <div style={{ position: 'relative' }}>
      {drillPath.length > 0 && (
        <div style={{ display: 'flex', alignItems: 'center', gap: 4, marginBottom: 6 }}>
          <button onClick={() => onDrill && onDrill([])} style={{ fontSize: 9, color: T.accent, background: 'none', border: 'none', cursor: 'pointer', fontFamily: sans, fontWeight: 700, padding: 0 }}>Portfolio</button>
          {drillPath.map((p, i) => (<React.Fragment key={i}><ChevronRight size={10} color={T.textDim} /><span style={{ fontSize: 9, color: i === drillPath.length - 1 ? T.text : T.accent, fontWeight: 600, cursor: i < drillPath.length - 1 ? 'pointer' : 'default' }} onClick={() => i < drillPath.length - 1 && onDrill && onDrill(drillPath.slice(0, i + 1))}>{p}</span></React.Fragment>))}
        </div>
      )}
      <svg width={width} height={height} style={{ display: 'block' }}>
        <defs>{rects.map((r, i) => <linearGradient key={i} id={`tm${i}`} x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor={r.color} stopOpacity={0.35} /><stop offset="100%" stopColor={r.color} stopOpacity={0.12} /></linearGradient>)}</defs>
        {rects.map((r, i) => {
          const isNeg = r.trend != null && r.trend < 0;
          return (
            <g key={i} style={{ cursor: r.children ? 'pointer' : 'default' }} onClick={() => r.children && onDrill && onDrill([...drillPath, r.label])}>
              <rect x={r.x} y={pad} width={Math.max(r.w - 2, 0)} height={height - pad * 2} rx={4} fill={`url(#tm${i})`} stroke={r.color} strokeWidth={1.2} strokeOpacity={0.4} />
              {r.w > 60 && <>
                <text x={r.x + 8} y={24} fill={r.color} fontSize={11} fontWeight={800} fontFamily={sans}>{r.label}</text>
                <text x={r.x + 8} y={40} fill={T.text} fontSize={18} fontWeight={800} fontFamily={mono}>{r.display || `$${(r.value).toFixed(0)}M`}</text>
                <text x={r.x + 8} y={56} fill={T.textMuted} fontSize={9} fontFamily={mono}>{(r.pct * 100).toFixed(1)}% of total</text>
                {r.trend != null && <text x={r.x + 8} y={72} fill={isNeg ? T.red : T.green} fontSize={10} fontWeight={700} fontFamily={mono}>{isNeg ? '↓' : '↑'}{Math.abs(r.trend)}%</text>}
                {r.sub && <text x={r.x + 8} y={height - 24} fill={T.textDim} fontSize={8}>{r.sub}</text>}
                {r.children && <text x={r.x + 8} y={height - 10} fill={r.color} fontSize={8} fontWeight={600}>Click to drill ›</text>}
                {r.sparkData && r.w > 90 && (() => {
                  const sd = r.sparkData; const mn = Math.min(...sd); const mx = Math.max(...sd);
                  const spW = Math.min(r.w - 20, 80); const spH = 28; const sx = r.x + 8; const sy = height - 70;
                  const pts = sd.map((v, si) => `${sx + (si / (sd.length - 1)) * spW},${sy + spH - ((v - mn) / (mx - mn || 1)) * spH}`).join(' ');
                  return <polyline points={pts} fill="none" stroke={r.color} strokeWidth={1.5} opacity={0.6} />;
                })()}
              </>}
              {r.w > 30 && r.w <= 60 && <>
                <text x={r.x + 4} y={24} fill={r.color} fontSize={9} fontWeight={700}>{r.label.slice(0, 6)}</text>
                <text x={r.x + 4} y={40} fill={T.text} fontSize={12} fontWeight={800} fontFamily={mono}>{(r.pct * 100).toFixed(0)}%</text>
              </>}
            </g>
          );
        })}
      </svg>
    </div>
  );
};

// Waterfall Chart — shows what drove NAV changes
const WaterfallChart = ({ data, width = 700, height = 200 }) => {
  const pad = { l: 50, r: 10, t: 10, b: 30 };
  const cW = width - pad.l - pad.r; const cH = height - pad.t - pad.b;
  let running = 0; const bars = [];
  data.forEach((d, i) => {
    const start = running;
    running += d.value;
    bars.push({ ...d, start, end: running, i });
  });
  const allVals = bars.flatMap(b => [b.start, b.end]);
  const minV = Math.min(0, ...allVals); const maxV = Math.max(...allVals);
  const range = maxV - minV || 1;
  const yS = v => pad.t + cH - ((v - minV) / range) * cH;
  const barW = Math.min(cW / bars.length - 4, 40);
  return (
    <svg width={width} height={height} style={{ display: 'block' }}>
      <line x1={pad.l} y1={yS(0)} x2={width - pad.r} y2={yS(0)} stroke={T.border} strokeWidth={1} strokeDasharray="3,3" />
      {bars.map((b, i) => {
        const x = pad.l + (i / bars.length) * cW + (cW / bars.length - barW) / 2;
        const top = Math.min(yS(b.start), yS(b.end)); const h = Math.abs(yS(b.start) - yS(b.end));
        const isTotal = b.isTotal; const color = isTotal ? T.accent : b.value >= 0 ? T.green : T.red;
        return (
          <g key={i}>
            <rect x={x} y={top} width={barW} height={Math.max(h, 2)} rx={2} fill={color} opacity={isTotal ? 0.3 : 0.7} />
            <text x={x + barW / 2} y={top - 4} textAnchor="middle" fill={color} fontSize={9} fontWeight={700} fontFamily={mono}>{b.value >= 0 ? '+' : ''}{b.display || `$${b.value.toFixed(1)}M`}</text>
            <text x={x + barW / 2} y={height - 6} textAnchor="middle" fill={T.textDim} fontSize={7} fontFamily={sans}>{b.label}</text>
            {i > 0 && !isTotal && <line x1={x - 2} y1={yS(b.start)} x2={x} y2={yS(b.start)} stroke={T.textDim} strokeWidth={1} strokeDasharray="2,2" />}
          </g>
        );
      })}
    </svg>
  );
};

// Bubble Scatter — risk vs return with AUM-sized bubbles
const BubbleScatter = ({ data, width = 700, height = 300, xLabel = 'Risk', yLabel = 'Return', onSelect }) => {
  const [hovered, setHovered] = useState(null);
  const pad = { l: 45, r: 20, t: 15, b: 35 };
  const cW = width - pad.l - pad.r; const cH = height - pad.t - pad.b;
  const xVals = data.map(d => d.x); const yVals = data.map(d => d.y);
  const xMin = Math.min(...xVals) * 0.9; const xMax = Math.max(...xVals) * 1.1;
  const yMin = Math.min(...yVals) * 0.9; const yMax = Math.max(...yVals) * 1.1;
  const sizeMax = Math.max(...data.map(d => d.size));
  const xS = v => pad.l + ((v - xMin) / (xMax - xMin)) * cW;
  const yS = v => pad.t + cH - ((v - yMin) / (yMax - yMin)) * cH;
  const rS = v => 6 + (v / sizeMax) * 28;
  return (
    <svg width={width} height={height} style={{ display: 'block' }}>
      {[0.25, 0.5, 0.75].map(p => (<line key={p} x1={pad.l} y1={pad.t + cH * p} x2={width - pad.r} y2={pad.t + cH * p} stroke={T.border} strokeWidth={0.5} />))}
      {[0.25, 0.5, 0.75].map(p => (<line key={p} x1={pad.l + cW * p} y1={pad.t} x2={pad.l + cW * p} y2={pad.t + cH} stroke={T.border} strokeWidth={0.5} />))}
      <text x={width / 2} y={height - 4} textAnchor="middle" fill={T.textDim} fontSize={9} fontFamily={sans}>{xLabel} →</text>
      <text x={12} y={height / 2} textAnchor="middle" fill={T.textDim} fontSize={9} fontFamily={sans} transform={`rotate(-90,12,${height / 2})`}>{yLabel} →</text>
      {data.map((d, i) => {
        const cx = xS(d.x); const cy = yS(d.y); const r = rS(d.size);
        const isH = hovered === i;
        return (
          <g key={i} style={{ cursor: 'pointer' }} onMouseEnter={() => setHovered(i)} onMouseLeave={() => setHovered(null)} onClick={() => onSelect && onSelect(d)}>
            <circle cx={cx} cy={cy} r={r} fill={d.color || T.accent} opacity={isH ? 0.5 : 0.25} stroke={d.color || T.accent} strokeWidth={isH ? 2 : 1} />
            {(isH || d.showLabel) && <>
              <text x={cx} y={cy - r - 4} textAnchor="middle" fill={d.color || T.accent} fontSize={9} fontWeight={700}>{d.label}</text>
              {isH && <text x={cx} y={cy + 3} textAnchor="middle" fill={T.text} fontSize={8} fontWeight={600} fontFamily={mono}>{d.detail}</text>}
            </>}
            {!isH && r > 12 && <text x={cx} y={cy + 3} textAnchor="middle" fill={T.text} fontSize={7} fontWeight={600}>{d.shortLabel || d.label.slice(0, 4)}</text>}
          </g>
        );
      })}
      {/* Quadrant labels */}
      <text x={pad.l + 6} y={pad.t + 12} fill={T.green} fontSize={7} opacity={0.5} fontWeight={700}>HIGH RETURN / LOW RISK ★</text>
      <text x={width - pad.r - 6} y={pad.t + 12} textAnchor="end" fill={T.amber} fontSize={7} opacity={0.5} fontWeight={700}>HIGH RETURN / HIGH RISK</text>
      <text x={pad.l + 6} y={pad.t + cH - 4} fill={T.textDim} fontSize={7} opacity={0.5} fontWeight={700}>LOW RETURN / LOW RISK</text>
      <text x={width - pad.r - 6} y={pad.t + cH - 4} textAnchor="end" fill={T.red} fontSize={7} opacity={0.5} fontWeight={700}>LOW RETURN / HIGH RISK ⚠</text>
    </svg>
  );
};

// Heat Grid — sectors × months with color intensity
const HeatGrid = ({ rows, cols, data, width = 700, cellH = 28, colorScale = 'diverging' }) => {
  const labelW = 100; const cellW = (width - labelW) / cols.length;
  const vals = data.flat().filter(v => v != null);
  const mn = Math.min(...vals); const mx = Math.max(...vals);
  const mid = colorScale === 'diverging' ? 0 : (mn + mx) / 2;
  const getColor = v => {
    if (v == null) return T.bgAccent;
    if (colorScale === 'diverging') {
      if (v > 0) { const t = Math.min(v / (mx || 1), 1); return `rgba(34,197,94,${0.1 + t * 0.6})`; }
      else { const t = Math.min(Math.abs(v) / (Math.abs(mn) || 1), 1); return `rgba(239,68,68,${0.1 + t * 0.6})`; }
    }
    const t = (v - mn) / (mx - mn || 1);
    return `rgba(0,228,184,${0.08 + t * 0.6})`;
  };
  return (
    <div>
      <div style={{ display: 'flex' }}>
        <div style={{ width: labelW }} />
        {cols.map((c, i) => (<div key={i} style={{ width: cellW, textAlign: 'center', fontSize: 8, color: T.textDim, fontWeight: 600, paddingBottom: 3 }}>{c}</div>))}
      </div>
      {rows.map((r, ri) => (
        <div key={ri} style={{ display: 'flex', alignItems: 'center', marginBottom: 1 }}>
          <div style={{ width: labelW, fontSize: 9, fontWeight: 600, color: r.color || T.text, paddingRight: 6, textAlign: 'right' }}>{r.label}</div>
          {data[ri]?.map((v, ci) => (
            <div key={ci} style={{ width: cellW, height: cellH, display: 'flex', alignItems: 'center', justifyContent: 'center', background: getColor(v), borderRadius: 2, margin: '0 0.5px', fontSize: 9, fontWeight: 600, fontFamily: mono, color: v == null ? T.textDim : Math.abs(v) > (mx - mn) * 0.4 ? T.text : T.textMuted, cursor: 'default', transition: 'transform .1s' }} title={`${r.label} × ${cols[ci]}: ${v}`}>
              {v != null ? (v > 0 ? `+${v}` : v) : '—'}
            </div>
          ))}
        </div>
      ))}
    </div>
  );
};

// Status Matrix — traffic light grid for instant scanning
const StatusMatrix = ({ items, columns = 4 }) => {
  const getStatusColor = s => s === 'green' ? T.green : s === 'amber' || s === 'yellow' ? T.amber : s === 'red' ? T.red : T.textDim;
  const getStatusIcon = s => s === 'green' ? '●' : s === 'amber' || s === 'yellow' ? '◐' : s === 'red' ? '○' : '—';
  return (
    <div style={{ display: 'grid', gridTemplateColumns: `repeat(${columns}, 1fr)`, gap: 4 }}>
      {items.map((item, i) => {
        const sc = getStatusColor(item.status);
        return (
          <div key={i} style={{ padding: '8px 10px', background: T.bgAccent, borderRadius: 5, borderLeft: `3px solid ${sc}`, cursor: item.onClick ? 'pointer' : 'default', transition: 'background .1s' }} onClick={item.onClick} onMouseEnter={e => e.currentTarget.style.background = T.bgElevated} onMouseLeave={e => e.currentTarget.style.background = T.bgAccent}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 2 }}>
              <span style={{ fontSize: 10, fontWeight: 700, color: T.text }}>{item.label}</span>
              <span style={{ fontSize: 12, color: sc }}>{getStatusIcon(item.status)}</span>
            </div>
            <div style={{ fontSize: 14, fontWeight: 800, fontFamily: mono, color: sc }}>{item.value}</div>
            {item.sub && <div style={{ fontSize: 8, color: T.textMuted, marginTop: 1 }}>{item.sub}</div>}
            {item.spark && <SparkLine data={item.spark} width={80} height={18} color={sc} fill />}
          </div>
        );
      })}
    </div>
  );
};

// ════════════════════════════════════════════════════
// ADVANCED VISUALIZATION LIBRARY
// ════════════════════════════════════════════════════

// Portfolio Treemap — Sector → Fund → Company, size=exposure, color=performance
const PortfolioTreemap = ({ width = 720, height = 320, onDrill }) => {
  const [drillLevel, setDrillLevel] = useState('sector'); // sector | fund | company
  const [drillTarget, setDrillTarget] = useState(null);
  const perfColor = (v) => v > 30 ? T.green : v > 10 ? T.accent : v > 0 ? T.blue : v > -5 ? T.amber : T.red;

  // Build sector-level data
  const sectors = useMemo(()=>{
    const sMap = {};
    FUNDS.forEach(f => {
      if(!sMap[f.sector]) sMap[f.sector] = {name:f.sector, nav:0, irr:0, funds:[], count:0};
      sMap[f.sector].nav += f.nav;
      sMap[f.sector].irr += f.irr;
      sMap[f.sector].count++;
      sMap[f.sector].funds.push(f);
    });
    Object.values(sMap).forEach(s => s.irr = s.irr / s.count);
    return Object.values(sMap).sort((a,b)=>b.nav-a.nav);
  },[]);

  // Build treemap layout (simple squarified)
  const layoutRects = (items, x, y, w, h, valKey='nav') => {
    const total = items.reduce((s,i)=>s+i[valKey],0);
    if(total===0||items.length===0) return [];
    const rects = [];
    let cx = x, cy = y, cw = w, ch = h;
    items.forEach((item,i) => {
      const pct = item[valKey]/total;
      const isHorizontal = cw >= ch;
      const rw = isHorizontal ? cw * pct : cw;
      const rh = isHorizontal ? ch : ch * pct;
      rects.push({...item, x:cx, y:cy, w:rw, h:rh, pct});
      if(isHorizontal) cx += rw; else cy += rh;
      if(isHorizontal) { /* keep cw, ch */ } else { /* keep cw, ch */ }
    });
    return rects;
  };

  const items = drillLevel==='sector' ? sectors :
    drillLevel==='fund' && drillTarget ? sectors.find(s=>s.name===drillTarget)?.funds||[] :
    drillLevel==='company' && drillTarget ? PORTFOLIO_COMPANIES.filter(c=>c.fund===drillTarget) : sectors;
  
  const valKey = drillLevel==='company'?'valuation':'nav';
  const perfKey = drillLevel==='company'?'growth':'irr';
  const rects = layoutRects(items, 0, 0, width, height-36, valKey);

  const handleClick = (item) => {
    if(drillLevel==='sector') { setDrillLevel('fund'); setDrillTarget(item.name); }
    else if(drillLevel==='fund') { setDrillLevel('company'); setDrillTarget(item.name); }
  };
  const handleBack = () => {
    if(drillLevel==='company') setDrillLevel('fund');
    else if(drillLevel==='fund') { setDrillLevel('sector'); setDrillTarget(null); }
  };

  return (
    <Card title="Portfolio Treemap — Click to Drill Down" action={drillLevel!=='sector'&&<button onClick={handleBack} style={{display:'flex',alignItems:'center',gap:4,padding:'3px 8px',background:T.bgAccent,border:`1px solid ${T.border}`,borderRadius:4,color:T.accent,fontSize:10,cursor:'pointer',fontFamily:sans}}>← Back</button>}>
      <div style={{padding:'6px 8px'}}>
        <div style={{display:'flex',gap:6,marginBottom:6,alignItems:'center'}}>
          <span style={{fontSize:9,fontWeight:700,color:drillLevel==='sector'?T.accent:T.textDim,cursor:'pointer'}} onClick={()=>{setDrillLevel('sector');setDrillTarget(null);}}>Sectors</span>
          {drillLevel!=='sector'&&<><ChevronRight size={10} color={T.textDim}/><span style={{fontSize:9,fontWeight:700,color:drillLevel==='fund'?T.accent:T.textDim}}>{drillTarget}</span></>}
          {drillLevel==='company'&&<><ChevronRight size={10} color={T.textDim}/><span style={{fontSize:9,fontWeight:700,color:T.accent}}>Companies</span></>}
          <span style={{marginLeft:'auto',fontSize:8,color:T.textDim}}>Size = {drillLevel==='company'?'Valuation':'NAV'} | Color = {drillLevel==='company'?'Growth %':'IRR'}</span>
        </div>
        <svg width={width} height={height-36} style={{display:'block',cursor:'pointer'}}>
          {rects.map((r,i) => {
            const c = perfColor(r[perfKey]);
            const nameKey = drillLevel==='sector'?'name':'name';
            const showLabel = r.w > 50 && r.h > 30;
            return(
              <g key={i} onClick={()=>handleClick(r)} style={{cursor:drillLevel==='company'?'default':'pointer'}}>
                <rect x={r.x+1} y={r.y+1} width={Math.max(0,r.w-2)} height={Math.max(0,r.h-2)} rx={4} fill={`${c}20`} stroke={c} strokeWidth={1.5} opacity={0.9}>
                  <animate attributeName="opacity" from="0.3" to="0.9" dur="0.4s" fill="freeze"/>
                </rect>
                {showLabel&&<>
                  <text x={r.x+6} y={r.y+16} fill={T.text} fontSize={r.w>100?11:9} fontWeight={700} style={{pointerEvents:'none'}}>{(r[nameKey]||'').slice(0,r.w/6)}</text>
                  <text x={r.x+6} y={r.y+28} fill={c} fontSize={10} fontFamily={mono} fontWeight={700} style={{pointerEvents:'none'}}>
                    {drillLevel==='company'?`$${(r.valuation/1000).toFixed(1)}B`:drillLevel==='fund'?`$${r.nav}M`:`$${r.nav.toFixed(0)}M`}
                  </text>
                  {r.h>42&&<text x={r.x+6} y={r.y+40} fill={c} fontSize={9} fontFamily={mono} style={{pointerEvents:'none'}}>
                    {drillLevel==='company'?`+${r.growth}%`:`${r[perfKey].toFixed(1)}% IRR`}
                  </text>}
                  {r.h>54&&drillLevel==='sector'&&<text x={r.x+6} y={r.y+52} fill={T.textDim} fontSize={8} style={{pointerEvents:'none'}}>{r.funds?.length} funds → click to drill</text>}
                </>}
              </g>
            );
          })}
        </svg>
      </div>
    </Card>
  );
};

// Risk/Return Bubble Scatter — x=TVPI, y=IRR, bubble size=committed, color=sector
const RiskReturnScatter = ({ width = 350, height = 280 }) => {
  const [hovered, setHovered] = useState(null);
  const pad = {t:24,r:20,b:32,l:44};
  const w = width-pad.l-pad.r, h = height-pad.t-pad.b;
  const secC = {'AI Safety':T.accent,'AI Infrastructure':T.blue,'Trust & Safety':T.purple,'GovTech':T.amber};
  const xMin=0.9, xMax=2.3, yMin=10, yMax=35;
  const xS = v => pad.l + ((v-xMin)/(xMax-xMin))*w;
  const yS = v => pad.t + h - ((v-yMin)/(yMax-yMin))*h;
  const rS = v => Math.sqrt(v)*1.8;
  // Quadrant thresholds
  const tvpiThresh=1.35, irrThresh=22;
  return(
    <Card title="Risk / Return Scatter">
      <svg width={width} height={height} style={{display:'block'}}>
        {/* Quadrant backgrounds */}
        <rect x={xS(tvpiThresh)} y={pad.t} width={xS(xMax)-xS(tvpiThresh)} height={yS(irrThresh)-pad.t} fill={`${T.green}06`} rx={4}/>
        <rect x={pad.l} y={pad.t} width={xS(tvpiThresh)-pad.l} height={yS(irrThresh)-pad.t} fill={`${T.amber}06`} rx={4}/>
        <rect x={pad.l} y={yS(irrThresh)} width={xS(tvpiThresh)-pad.l} height={yS(yMin)-yS(irrThresh)} fill={`${T.red}08`} rx={4}/>
        <rect x={xS(tvpiThresh)} y={yS(irrThresh)} width={xS(xMax)-xS(tvpiThresh)} height={yS(yMin)-yS(irrThresh)} fill={`${T.blue}06`} rx={4}/>
        {/* Quadrant labels */}
        <text x={xS(xMax)-4} y={pad.t+12} fill={T.green} fontSize={7} fontWeight={700} textAnchor="end" opacity={0.6}>★ STARS</text>
        <text x={pad.l+4} y={pad.t+12} fill={T.amber} fontSize={7} fontWeight={700} opacity={0.6}>HIGH IRR / LOW TVPI</text>
        <text x={pad.l+4} y={yS(yMin)-4} fill={T.red} fontSize={7} fontWeight={700} opacity={0.6}>⚠ WATCH</text>
        <text x={xS(xMax)-4} y={yS(yMin)-4} fill={T.blue} fontSize={7} fontWeight={700} textAnchor="end" opacity={0.6}>VALUE BUILDERS</text>
        {/* Threshold lines */}
        <line x1={xS(tvpiThresh)} y1={pad.t} x2={xS(tvpiThresh)} y2={yS(yMin)} stroke={T.textDim} strokeWidth={0.5} strokeDasharray="3,3"/>
        <line x1={pad.l} y1={yS(irrThresh)} x2={xS(xMax)} y2={yS(irrThresh)} stroke={T.textDim} strokeWidth={0.5} strokeDasharray="3,3"/>
        {/* Axes */}
        <line x1={pad.l} y1={yS(yMin)} x2={xS(xMax)} y2={yS(yMin)} stroke={T.border} strokeWidth={1}/>
        <line x1={pad.l} y1={pad.t} x2={pad.l} y2={yS(yMin)} stroke={T.border} strokeWidth={1}/>
        {[1.0,1.2,1.4,1.6,1.8,2.0,2.2].map(v=><text key={v} x={xS(v)} y={height-8} fill={T.textDim} fontSize={8} textAnchor="middle" fontFamily={mono}>{v}x</text>)}
        {[12,16,20,24,28,32].map(v=><text key={v} x={pad.l-6} y={yS(v)+3} fill={T.textDim} fontSize={8} textAnchor="end" fontFamily={mono}>{v}%</text>)}
        <text x={width/2} y={height-1} fill={T.textDim} fontSize={8} textAnchor="middle">TVPI →</text>
        <text x={8} y={height/2} fill={T.textDim} fontSize={8} textAnchor="middle" transform={`rotate(-90,8,${height/2})`}>IRR →</text>
        {/* Bubbles */}
        {FUNDS.map((f,i)=>{
          const cx=xS(f.tvpi), cy=yS(f.irr), r=rS(f.committed);
          const c = secC[f.sector]||T.textMuted;
          return(<g key={i} onMouseEnter={()=>setHovered(i)} onMouseLeave={()=>setHovered(null)} style={{cursor:'pointer'}}>
            <circle cx={cx} cy={cy} r={r} fill={`${c}40`} stroke={c} strokeWidth={hovered===i?2.5:1.5} opacity={hovered===i?1:0.8}/>
            {(hovered===i||r>8)&&<text x={cx} y={cy-r-4} fill={c} fontSize={8} fontWeight={700} textAnchor="middle" style={{pointerEvents:'none'}}>{f.gp.split(' ')[0]}</text>}
            {hovered===i&&<>
              <rect x={cx-55} y={cy+r+4} width={110} height={40} rx={4} fill={T.bgCard} stroke={c} strokeWidth={1} opacity={0.95}/>
              <text x={cx} y={cy+r+16} fill={T.text} fontSize={9} fontWeight={700} textAnchor="middle">{f.name}</text>
              <text x={cx} y={cy+r+27} fill={c} fontSize={9} fontFamily={mono} textAnchor="middle">{f.tvpi}x TVPI | {f.irr}% IRR</text>
              <text x={cx} y={cy+r+38} fill={T.textDim} fontSize={8} textAnchor="middle">${f.committed}M committed</text>
            </>}
          </g>);
        })}
      </svg>
    </Card>
  );
};

// NAV Waterfall — Contribution of each fund to total NAV
const NAVWaterfall = ({ width = 350, height = 280 }) => {
  const pad = {t:20,r:10,b:40,l:45};
  const w = width-pad.l-pad.r, h = height-pad.t-pad.b;
  const sorted = [...FUNDS].sort((a,b)=>(b.nav-b.called)-(a.nav-a.called));
  const gains = sorted.map(f=>({name:f.gp.split(' ')[0],gain:f.nav-f.called,nav:f.nav,called:f.called,irr:f.irr}));
  const totalGain = gains.reduce((s,g)=>s+g.gain,0);
  const maxGain = Math.max(...gains.map(g=>Math.abs(g.gain)),totalGain);
  const barW = Math.min(36, (w/(gains.length+1))-4);
  const xS = i => pad.l + (i+0.5)*((w)/(gains.length+1));
  const yS = v => pad.t + h/2 - (v/(maxGain*1.3))*(h/2);
  return(
    <Card title="NAV Contribution Waterfall">
      <svg width={width} height={height} style={{display:'block'}}>
        <line x1={pad.l} y1={yS(0)} x2={width-pad.r} y2={yS(0)} stroke={T.textDim} strokeWidth={1} strokeDasharray="3,3"/>
        <text x={pad.l-4} y={yS(0)+3} fill={T.textDim} fontSize={8} textAnchor="end" fontFamily={mono}>$0</text>
        {gains.map((g,i)=>{
          const c = g.gain>=0?T.green:T.red;
          const bh = Math.abs(yS(g.gain)-yS(0));
          const by = g.gain>=0?yS(g.gain):yS(0);
          return(<g key={i}>
            <rect x={xS(i)-barW/2} y={by} width={barW} height={bh} rx={3} fill={`${c}30`} stroke={c} strokeWidth={1}/>
            <text x={xS(i)} y={g.gain>=0?by-4:by+bh+10} fill={c} fontSize={9} fontFamily={mono} fontWeight={700} textAnchor="middle">{g.gain>=0?'+':''}${g.gain.toFixed(1)}M</text>
            <text x={xS(i)} y={height-18} fill={T.textMuted} fontSize={7} textAnchor="middle" fontWeight={600}>{g.name}</text>
            <text x={xS(i)} y={height-8} fill={T.textDim} fontSize={7} textAnchor="middle" fontFamily={mono}>{g.irr}%</text>
          </g>);
        })}
        {/* Total bar */}
        {(()=>{const i=gains.length; const c=totalGain>=0?T.accent:T.red; const bh=Math.abs(yS(totalGain)-yS(0)); const by=totalGain>=0?yS(totalGain):yS(0);
          return(<g>
            <rect x={xS(i)-barW/2} y={by} width={barW} height={bh} rx={3} fill={`${c}40`} stroke={c} strokeWidth={2}/>
            <text x={xS(i)} y={by-4} fill={c} fontSize={10} fontFamily={mono} fontWeight={800} textAnchor="middle">+${totalGain.toFixed(1)}M</text>
            <text x={xS(i)} y={height-14} fill={c} fontSize={8} textAnchor="middle" fontWeight={800}>TOTAL</text>
          </g>);
        })()}
      </svg>
    </Card>
  );
};

// Fund Health HeatGrid — funds × metrics with traffic light colors + tooltips
const FundHeatGrid = ({ width = 720, height = 'auto' }) => {
  const [hoveredCell, setHoveredCell] = useState(null);
  const metrics = [
    {id:'tvpi',label:'TVPI',target:1.3,warn:1.1,danger:0.9,fmt:v=>v.toFixed(2)+'x'},
    {id:'irr',label:'IRR',target:20,warn:15,danger:10,fmt:v=>v.toFixed(1)+'%'},
    {id:'dpi',label:'DPI',target:0.3,warn:0.1,danger:0,fmt:v=>v.toFixed(2)+'x'},
    {id:'called',label:'Called %',target:null,warn:null,danger:null,fmt:(v,f)=>((f.called/f.committed)*100).toFixed(0)+'%',val:(f)=>(f.called/f.committed)*100},
    {id:'deployment',label:'Deploy Pace',target:null,warn:null,danger:null,fmt:(v,f)=>f.status,val:()=>0},
  ];
  const getHeat = (m, val) => {
    if(!m.target) return T.blue;
    if(val >= m.target) return T.green;
    if(val >= m.warn) return T.amber;
    return T.red;
  };
  const cellW = 72, cellH = 28, labelW = 130;
  return(
    <Card title="Fund Health Matrix — Traffic Light Alerts" style={{marginBottom:12}}>
      <div style={{padding:'8px 12px',overflowX:'auto'}}>
        <div style={{display:'flex',gap:0}}>
          <div style={{width:labelW,flexShrink:0}}>
            <div style={{height:22}}/>
            {FUNDS.map((f,i)=><div key={i} style={{height:cellH,display:'flex',alignItems:'center',fontSize:10,fontWeight:600,color:T.text,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',paddingRight:8}}>{f.gp.split(' ').slice(0,2).join(' ')}</div>)}
          </div>
          <div style={{display:'flex',gap:2}}>
            {metrics.map((m,mi)=>(
              <div key={mi}>
                <div style={{height:22,display:'flex',alignItems:'center',justifyContent:'center',fontSize:8,fontWeight:700,color:T.textDim,textTransform:'uppercase'}}>{m.label}</div>
                {FUNDS.map((f,fi)=>{
                  const val = m.val ? m.val(f) : f[m.id];
                  const c = getHeat(m, val);
                  const isHov = hoveredCell===`${fi}-${mi}`;
                  return(
                    <div key={fi} onMouseEnter={()=>setHoveredCell(`${fi}-${mi}`)} onMouseLeave={()=>setHoveredCell(null)}
                      style={{width:cellW,height:cellH,display:'flex',alignItems:'center',justifyContent:'center',
                        background:`${c}${isHov?'30':'15'}`,border:`1px solid ${isHov?c+'60':c+'20'}`,borderRadius:3,margin:'1px 0',
                        fontSize:11,fontFamily:mono,fontWeight:700,color:c,cursor:'default',transition:'all .1s',position:'relative'}}>
                      {m.fmt(val,f)}
                      {isHov&&m.target&&<div style={{position:'absolute',top:-28,left:'50%',transform:'translateX(-50%)',
                        background:T.bgCard,border:`1px solid ${c}`,borderRadius:4,padding:'2px 6px',whiteSpace:'nowrap',zIndex:10,
                        fontSize:8,color:T.text,boxShadow:`0 4px 12px ${T.bg}`}}>
                        Target: {m.fmt(m.target)} | {val>=m.target?'✅ On track':val>=m.warn?'⚠️ Watch':'🔴 Below target'}
                      </div>}
                    </div>
                  );
                })}
              </div>
            ))}
            {/* Composite health score column */}
            <div>
              <div style={{height:22,display:'flex',alignItems:'center',justifyContent:'center',fontSize:8,fontWeight:700,color:T.accent,textTransform:'uppercase'}}>HEALTH</div>
              {FUNDS.map((f,fi)=>{
                const score = Math.round((f.tvpi/2.0*30)+(f.irr/30*30)+(f.dpi/1.0*20)+((f.called/f.committed)*20));
                const c = score>=70?T.green:score>=50?T.amber:T.red;
                return(
                  <div key={fi} style={{width:cellW,height:cellH,display:'flex',alignItems:'center',justifyContent:'center',
                    background:`${c}18`,border:`1px solid ${c}30`,borderRadius:3,margin:'1px 0'}}>
                    <div style={{width:36,height:4,background:T.bg,borderRadius:2,overflow:'hidden',marginRight:4}}>
                      <div style={{width:`${Math.min(100,score)}%`,height:'100%',background:c,borderRadius:2}}/>
                    </div>
                    <span style={{fontSize:10,fontFamily:mono,fontWeight:800,color:c}}>{score}</span>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
        {/* Legend */}
        <div style={{display:'flex',gap:12,marginTop:6,paddingTop:4,borderTop:`1px solid ${T.border}`}}>
          {[{c:T.green,l:'On Target'},{c:T.amber,l:'Watch'},{c:T.red,l:'Below Target'},{c:T.blue,l:'Info'}].map(l=>(
            <div key={l.l} style={{display:'flex',alignItems:'center',gap:4}}><div style={{width:8,height:8,borderRadius:2,background:`${l.c}30`,border:`1px solid ${l.c}`}}/><span style={{fontSize:8,color:T.textDim}}>{l.l}</span></div>
          ))}
        </div>
      </div>
    </Card>
  );
};

// Concentration Ring — visual risk concentration with thresholds
const ConcentrationRing = ({ width = 350, height = 240 }) => {
  const cx=width/2, cy=110, outerR=90, innerR=55;
  const sectors = [
    {name:'AI Safety',pct:45,target:40,max:50,c:T.accent},
    {name:'AI Infra',pct:25,target:25,max:35,c:T.blue},
    {name:'Trust',pct:15,target:15,max:20,c:T.purple},
    {name:'GovTech',pct:10,target:15,max:20,c:T.amber},
    {name:'Explore',pct:5,target:5,max:10,c:T.textMuted},
  ];
  let angle = -Math.PI/2;
  const arcs = sectors.map(s=>{
    const sweep = (s.pct/100)*Math.PI*2;
    const start = angle;
    angle += sweep;
    const x1o=cx+outerR*Math.cos(start), y1o=cy+outerR*Math.sin(start);
    const x2o=cx+outerR*Math.cos(start+sweep), y2o=cy+outerR*Math.sin(start+sweep);
    const x1i=cx+innerR*Math.cos(start+sweep), y1i=cy+innerR*Math.sin(start+sweep);
    const x2i=cx+innerR*Math.cos(start), y2i=cy+innerR*Math.sin(start);
    const large = sweep>Math.PI?1:0;
    const midA = start+sweep/2;
    const labelR = (outerR+innerR)/2;
    const lx=cx+labelR*Math.cos(midA), ly=cy+labelR*Math.sin(midA);
    return{...s,d:`M${x1o},${y1o} A${outerR},${outerR} 0 ${large},1 ${x2o},${y2o} L${x1i},${y1i} A${innerR},${innerR} 0 ${large},0 ${x2i},${y2i} Z`,lx,ly,
      overweight:s.pct>s.max, underweight:s.pct<s.target*0.7};
  });
  return(
    <Card title="Concentration Risk Monitor">
      <svg width={width} height={height} style={{display:'block'}}>
        {arcs.map((a,i)=><g key={i}>
          <path d={a.d} fill={`${a.c}25`} stroke={a.c} strokeWidth={a.overweight?3:1.5}/>
          {a.pct>8&&<text x={a.lx} y={a.ly-4} fill={T.text} fontSize={9} fontWeight={700} textAnchor="middle" style={{pointerEvents:'none'}}>{a.name}</text>}
          {a.pct>8&&<text x={a.lx} y={a.ly+8} fill={a.c} fontSize={11} fontFamily={mono} fontWeight={800} textAnchor="middle" style={{pointerEvents:'none'}}>{a.pct}%</text>}
          {a.overweight&&<text x={a.lx} y={a.ly+19} fill={T.red} fontSize={7} fontWeight={700} textAnchor="middle">⚠ OVER</text>}
        </g>)}
        <circle cx={cx} cy={cy} r={innerR-4} fill={T.bgCard}/>
        <text x={cx} y={cy-8} fill={T.text} fontSize={14} fontWeight={800} textAnchor="middle" fontFamily={mono}>5</text>
        <text x={cx} y={cy+6} fill={T.textDim} fontSize={9} textAnchor="middle">sectors</text>
        <text x={cx} y={cy+18} fill={T.accent} fontSize={8} fontWeight={700} textAnchor="middle">HHI: 2,875</text>
        {/* Threshold Legend */}
        {sectors.map((s,i)=>(
          <g key={i} transform={`translate(${10+i*(width/5)},${height-24})`}>
            <rect width={8} height={8} rx={2} fill={`${s.c}30`} stroke={s.c}/>
            <text x={12} y={7} fill={T.textDim} fontSize={7}>{s.pct}% / {s.target}% target</text>
          </g>
        ))}
      </svg>
    </Card>
  );
};

// Performance Attribution Bars — horizontal diverging bars showing what drives returns
const PerfAttribution = ({ width = 720, height = 'auto' }) => {
  const factors = [
    {name:'GP Selection (Emerging Mgr Alpha)',value:42,desc:'Top-quartile emerging GPs outperform established by +480bps',c:T.accent},
    {name:'Entry Timing & Signals',value:22,desc:'Bayesian signal processing — avg entry 18% below subsequent marks',c:T.green},
    {name:'Co-Investment',value:18,desc:'Carry-free co-invests via GP relationships (Anthropic, Saronic)',c:T.blue},
    {name:'Secondary Selection',value:12,desc:'Algorithmic scoring — avg purchase 28% disc vs 19% market',c:T.purple},
    {name:'Portfolio Construction',value:6,desc:'Kelly-optimal sizing + correlation management + concentration limits',c:T.amber},
  ];
  const maxVal = Math.max(...factors.map(f=>f.value));
  return(
    <Card title="Performance Attribution — What Drives Returns" style={{marginBottom:12}}>
      <div style={{padding:'10px 14px'}}>
        {factors.map((f,i)=>(
          <div key={i} style={{marginBottom:8}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'baseline',marginBottom:3}}>
              <span style={{fontSize:11,fontWeight:700,color:T.text}}>{f.name}</span>
              <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:f.c}}>{f.value}%</span>
            </div>
            <div style={{position:'relative',height:20,background:T.bgAccent,borderRadius:4,overflow:'hidden'}}>
              <div style={{height:'100%',width:`${(f.value/maxVal)*100}%`,background:`linear-gradient(90deg, ${f.c}40, ${f.c}15)`,borderRadius:4,border:`1px solid ${f.c}40`,transition:'width 0.6s ease'}}>
                <div style={{height:'100%',width:'100%',background:`repeating-linear-gradient(90deg, transparent, transparent 4px, ${f.c}08 4px, ${f.c}08 8px)`}}/>
              </div>
            </div>
            <div style={{fontSize:8,color:T.textMuted,marginTop:1}}>{f.desc}</div>
          </div>
        ))}
      </div>
    </Card>
  );
};

// ════════════════════════════════════════════════════
// SIGNALS INTELLIGENCE MODULE
// ════════════════════════════════════════════════════
const SignalsIntelligence = () => {
  const [sigView, setSigView] = useState('macro');
  const sigViews = [{id:'macro',label:'Macro Dashboard'},{id:'sector',label:'Sector Pulse'},{id:'feed',label:'Signal Feed'},{id:'heatmap',label:'Correlation Matrix'},{id:'catalyst',label:'Catalyst Tracker'},{id:'sentiment',label:'Sentiment Velocity'}];
  const capFlow = [{q:'Q1 23',vc:48,ai:3.2,gov:1.8,tr:1.2},{q:'Q2 23',vc:52,ai:4.1,gov:2.0,tr:1.4},{q:'Q3 23',vc:58,ai:5.8,gov:2.4,tr:1.6},{q:'Q4 23',vc:62,ai:7.2,gov:2.8,tr:1.9},{q:'Q1 24',vc:68,ai:9.5,gov:3.2,tr:2.2},{q:'Q2 24',vc:72,ai:12.1,gov:3.8,tr:2.6},{q:'Q3 24',vc:75,ai:14.8,gov:4.5,tr:3.0},{q:'Q4 24',vc:74,ai:16.2,gov:5.1,tr:3.3},{q:'Q1 25',vc:78,ai:18.5,gov:5.8,tr:3.6},{q:'Q2 25',vc:82,ai:21.4,gov:6.5,tr:4.0},{q:'Q3 25',vc:80,ai:23.1,gov:7.2,tr:4.2},{q:'Q4 25',vc:78,ai:24.8,gov:7.8,tr:4.5}];
  const valTrends = [{q:'Q1 23',seed:12,sA:22,sB:28,gr:42},{q:'Q2 23',seed:11,sA:20,sB:26,gr:38},{q:'Q3 23',seed:12,sA:22,sB:30,gr:44},{q:'Q4 23',seed:14,sA:25,sB:34,gr:50},{q:'Q1 24',seed:15,sA:28,sB:38,gr:55},{q:'Q2 24',seed:16,sA:30,sB:40,gr:60},{q:'Q3 24',seed:16,sA:32,sB:42,gr:65},{q:'Q4 24',seed:15,sA:30,sB:40,gr:62},{q:'Q1 25',seed:16,sA:32,sB:42,gr:68},{q:'Q2 25',seed:17,sA:34,sB:44,gr:72},{q:'Q3 25',seed:18,sA:36,sB:46,gr:75},{q:'Q4 25',seed:18,sA:38,sB:48,gr:72}];
  const sectorM = [
    {s:'AI Safety',tam:28,tG:42,dc:187,mr:42,top:'Anthropic',tv:61.5,m:[62,68,72,75,80,85,88,91,94,96,97,98],c:T.accent,d:['EU AI Act enforcement','US executive order mandates','Enterprise adoption surge'],r:['Open-source commoditization','Regulatory fragmentation'],ra:[95,88,72,92,85,78]},
    {s:'GovTech / Defense AI',tam:886,tG:18,dc:94,mr:65,top:'Anduril',tv:28.0,m:[45,48,52,58,62,68,72,78,82,85,88,90],c:T.blue,d:['JADC2 mandate','$886B defense budget','Ukraine/Taiwan accelerant'],r:['Procurement delays','Clearance bottleneck'],ra:[78,92,85,88,70,95]},
    {s:'Trust & Safety',tam:12,tG:35,dc:112,mr:28,top:'Drata',tv:2.7,m:[55,58,60,62,64,65,67,68,70,72,73,74],c:T.amber,d:['Compliance automation','SOC 2 standardization','Privacy regulation wave'],r:['Crowded seed market','Platform risk'],ra:[65,58,72,55,68,62]},
    {s:'AI Infrastructure',tam:45,tG:55,dc:156,mr:55,top:'Databricks',tv:62.0,m:[70,74,78,82,85,88,90,92,93,94,95,94],c:T.purple,d:['GPU compute demand','Data pipeline complexity','Enterprise AI adoption'],r:['Hyperscaler vertical integration','Open-source alternatives'],ra:[90,82,68,85,92,75]},
  ];
  const radarL = ['Mkt Size','Defensibility','Liquidity','Growth','NEWCO Fit','Risk/Rew'];
  const sigFeed = [
    {id:1,time:'2m ago',type:'MARKET',prio:'CRITICAL',title:'Anthropic closes $3.5B Series E at $75B',detail:'Up 22% from last round. Google + Lightspeed lead. +$4.2M NAV impact.',impact:'+$4.2M',dir:'pos',conf:95,sec:['AI Safety']},
    {id:2,time:'18m ago',type:'REGULATORY',prio:'HIGH',title:'EU AI Office publishes GPAI enforcement guidelines',detail:'Compliance deadline April 2026. Benefits Anthropic Constitutional AI approach.',impact:'Thesis +',dir:'pos',conf:100,sec:['AI Safety']},
    {id:3,time:'45m ago',type:'COMPETITIVE',prio:'HIGH',title:'Scale AI loses AWS partnership to internal tool',detail:'AWS launches SageMaker Data Labeling. Moat erosion for Scale AI. Affects a16z exposure.',impact:'-$1.8M',dir:'neg',conf:88,sec:['AI Infra']},
    {id:4,time:'1.2h ago',type:'DEAL FLOW',prio:'MEDIUM',title:'Shield AI Series G — $500M at $5.5B, Sequoia leading',detail:'Validates defense AI thesis. Benchmark portfolio uplift confirmed.',impact:'+$2.1M',dir:'pos',conf:92,sec:['GovTech']},
    {id:5,time:'4.8h ago',type:'SECONDARY',prio:'CRITICAL',title:'SpaceX secondary block — $10M available at $380B',detail:'Founders Fund distributing LP interests. 8% premium. 48hr window.',impact:'+$1.5M',dir:'pos',conf:90,sec:['Portfolio']},
    {id:6,time:'8h ago',type:'GEOPOLITICAL',prio:'HIGH',title:'Taiwan Strait — PLAN carrier group exercises detected',detail:'Satellite imagery confirms 3-carrier exercise. Defense tech +4.2%.',impact:'+$3.8M',dir:'pos',conf:78,sec:['GovTech']},
    {id:7,time:'12h ago',type:'LP',prio:'MEDIUM',title:'Hightower CIO mentions NEWCO in industry panel',detail:'Positive reference to AI-focused listed vehicles. $20M LP pipeline warm.',impact:'$20M pipe',dir:'pos',conf:65,sec:['LP']},
    {id:8,time:'18h ago',type:'IPO',prio:'CRITICAL',title:'Databricks confidentially files S-1 with SEC',detail:'IPO expected Q3 2026 at $70-80B. NEWCO has exposure via a16z Infra Fund.',impact:'+$8-12M',dir:'pos',conf:82,sec:['AI Infra']},
  ];
  const corrSig = ['AI Safety\nFunding','Defense\nBudget','IPO\nWindow','Fed Rate','GPU\nDemand','Regulation','Secondary\nDisc','LP\nAppetite'];
  const corrMat = [[1,.25,.62,-.45,.78,.82,-.35,.71],[.25,1,.18,-.12,.32,.28,-.08,.45],[.62,.18,1,-.68,.55,.38,-.72,.82],[-.45,-.12,-.68,1,-.38,-.25,.65,-.58],[.78,.32,.55,-.38,1,.48,-.42,.62],[.82,.28,.38,-.25,.48,1,-.18,.55],[-.35,-.08,-.72,.65,-.42,-.18,1,-.52],[.71,.45,.82,-.58,.62,.55,-.52,1]];
  const catalysts = [
    {t:'Anduril IPO S-1 Filing',desc:'Expected confidential filing',d:'Mar 2026',c:T.accent,imp:'+$12-18M NAV',ic:T.green},
    {t:'EU AI Act GPAI Enforcement',desc:'Foundation model compliance deadline',d:'Apr 2026',c:T.blue,imp:'Thesis validation',ic:T.accent},
    {t:'Milken Institute Conference',desc:'Jason + Ken — sovereign wealth intros',d:'May 2026',c:T.gold,imp:'$50M+ LP pipe',ic:T.green},
    {t:'Databricks IPO',desc:'Expected $70-80B via a16z',d:'Q3 2026',c:T.purple,imp:'+$8-12M NAV',ic:T.green},
    {t:'Anthropic Co-Invest Close',desc:'Co-invest right exercise decision',d:'Q2 2026',c:T.accent,imp:'+$4.2M option',ic:T.green},
    {t:'Fund II First Close',desc:'$200M minimum viable close',d:'Q4 2026',c:T.gold,imp:'$200-500M AUM',ic:T.green},
    {t:'SpaceX IPO / Tender',desc:'Founders Fund NAV catalyst',d:'H2 2026',c:T.amber,imp:'+$15-25M NAV',ic:T.green},
    {t:'SBIC License Approval',desc:'SBA leverage facility $150M',d:'H1 2027',c:T.blue,imp:'$150M leverage',ic:T.green},
  ];
  const sentData = [
    {topic:'AI Safety Investment',sent:88,vel:+12,acc:+3,trend:[65,68,72,75,78,82,85,88],sig:'STRONG BUY — positive sentiment accelerating.',c:T.accent},
    {topic:'Defense Tech / Autonomy',sent:82,vel:+8,acc:+5,trend:[58,60,64,68,72,75,78,82],sig:'BUY — accelerating fastest of all sectors.',c:T.blue},
    {topic:'VC Fund-of-Funds',sent:55,vel:-2,acc:-1,trend:[62,60,58,57,56,56,55,55],sig:'NEUTRAL — slight headwind from fee sensitivity.',c:T.amber},
    {topic:'IPO Window (Tech)',sent:78,vel:+6,acc:-2,trend:[48,55,62,68,72,75,77,78],sig:'CAUTION — decelerating. Window may narrow.',c:T.gold},
    {topic:'AI Regulation',sent:72,vel:+15,acc:+8,trend:[28,35,42,48,55,62,68,72],sig:'INFLECTION — fastest moving topic.',c:T.purple},
    {topic:'Secondary Liquidity',sent:65,vel:+4,acc:+1,trend:[45,48,52,55,58,61,63,65],sig:'IMPROVING — discounts compressing.',c:T.green},
    {topic:'Open Source AI',sent:42,vel:-6,acc:-3,trend:[68,64,58,54,50,48,44,42],sig:'RISK — negative sentiment accelerating.',c:T.red},
  ];
  const macroG = [{l:'VC Deploy',v:82,th:[{max:65,color:T.green},{max:85,color:T.amber},{max:100,color:T.red}]},{l:'IPO Window',v:78,th:[{max:30,color:T.red},{max:75,color:T.green},{max:100,color:T.accent}]},{l:'AI Safety Heat',v:94,th:[{max:60,color:T.blue},{max:80,color:T.green},{max:100,color:T.accent}]},{l:'Risk Appetite',v:71,th:[{max:50,color:T.amber},{max:100,color:T.green}]},{l:'LP Sentiment',v:68,th:[{max:50,color:T.amber},{max:100,color:T.green}]},{l:'Froth Index',v:67,th:[{max:60,color:T.blue},{max:80,color:T.amber},{max:100,color:T.red}]}];
  const typeC = {MARKET:T.accent,REGULATORY:T.blue,COMPETITIVE:T.red,'DEAL FLOW':T.green,MACRO:T.amber,NETWORK:T.purple,SECONDARY:T.gold,GEOPOLITICAL:T.red,LP:T.green,IPO:T.accent};
  const prioC = {CRITICAL:T.red,HIGH:T.amber,MEDIUM:T.blue,LOW:T.textMuted};
  return (
    <div>
      <div style={{display:'flex',gap:4,marginBottom:16,flexWrap:'wrap'}}>
        {sigViews.map(v=><button key={v.id} onClick={()=>setSigView(v.id)} style={{padding:'7px 16px',fontSize:11,fontWeight:sigView===v.id?700:500,background:sigView===v.id?T.accentBg:'transparent',color:sigView===v.id?T.accent:T.textMuted,border:`1px solid ${sigView===v.id?T.accent+'40':T.border}`,borderRadius:6,cursor:'pointer',fontFamily:sans,transition:'all .15s'}}>{v.label}</button>)}
      </div>
      {sigView==='macro'&&(<div>
        <Card title="Macro Signal Gauges" style={{marginBottom:14}}><div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8,padding:'12px 16px'}}>{macroG.map((g,i)=><GaugeChart key={i} value={g.v} label={g.l} thresholds={g.th} size={120}/>)}</div></Card>
        <div style={{marginBottom:14}}><AreaChart data={capFlow.map(d=>({vcTotal:d.vc,aiSafety:d.ai,govTech:d.gov,trust:d.tr}))} keys={['vcTotal','aiSafety','govTech','trust']} colors={[T.textMuted,T.accent,T.blue,T.amber]} xLabels={capFlow.map(d=>d.q)} title="Capital Flows ($B) — VC vs NEWCO Sectors" yFormat={v=>`$${v.toFixed(0)}B`} width={740} height={260}/></div>
        <div style={{marginBottom:14}}><AreaChart data={valTrends.map(d=>({seed:d.seed,seriesA:d.sA,seriesB:d.sB,growth:d.gr}))} keys={['seed','seriesA','seriesB','growth']} colors={[T.green,T.blue,T.purple,T.red]} xLabels={valTrends.map(d=>d.q)} title="Median Valuation Multiples (ARR) by Stage" yFormat={v=>`${v.toFixed(0)}x`} width={740} height={240}/></div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,marginBottom:14}}>
          <Card title="IPO Pipeline Trend"><div style={{padding:'12px 16px'}}><MiniBarChart data={capFlow.map(d=>({value:d.ai,label:d.q.replace('Q','').replace(' ',''),color:d.ai>=15?T.accent:d.ai>=10?T.blue:T.textMuted}))} width={200} height={60}/><div style={{fontSize:22,fontWeight:800,fontFamily:mono,color:T.accent,marginTop:8}}>24.8B</div><div style={{fontSize:10,color:T.textMuted}}>AI Safety funding Q4 2025 — all-time high</div></div></Card>
          <Card title="NEWCO Sector % of VC"><div style={{padding:'12px 16px',display:'flex',justifyContent:'center'}}><DonutChart size={130} thickness={18} label={`${(((capFlow[11].ai+capFlow[11].gov+capFlow[11].tr)/capFlow[11].vc)*100).toFixed(0)}%`} sublabel="of total VC" segments={[{value:capFlow[11].ai,label:'AI Safety',color:T.accent},{value:capFlow[11].gov,label:'GovTech',color:T.blue},{value:capFlow[11].tr,label:'Trust',color:T.amber},{value:capFlow[11].vc-capFlow[11].ai-capFlow[11].gov-capFlow[11].tr,label:'Other',color:T.bgAccent}]}/></div></Card>
          <Card title="Dry Powder vs Deploy"><div style={{padding:'12px 16px'}}><div style={{display:'flex',gap:12,marginBottom:8}}><div><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>Dry Powder</div><div style={{fontSize:20,fontWeight:800,fontFamily:mono,color:T.amber}}>$311B</div></div><div><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>Deployed QoQ</div><div style={{fontSize:20,fontWeight:800,fontFamily:mono,color:T.green}}>$78B</div></div></div><Bar value={78} max={311} color={T.accent} h={8}/><div style={{fontSize:10,color:T.textMuted,marginTop:6}}>25% deployment ratio — 4 quarters runway</div></div></Card>
        </div>
        <Card title="Regime Transition Probability" style={{marginBottom:14}}><div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8,padding:'12px 16px'}}>
          {[{r:'Continue Expansion',p:45,c:T.green,d:'AI cycle continues, IPOs execute'},{r:'Peak & Plateau',p:30,c:T.amber,d:'Valuations stabilize, selective correction'},{r:'Sector Rotation',p:15,c:T.blue,d:'Capital rotates to AI infra/safety'},{r:'Correction',p:10,c:T.red,d:'Rate shock or AI winter triggers drawdown'}].map((r,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:12,textAlign:'center',border:`1px solid ${T.border}`,borderTop:`3px solid ${r.c}`}}><GaugeChart value={r.p} label="" thresholds={[{max:100,color:r.c}]} size={90}/><div style={{fontSize:12,fontWeight:700,color:r.c,marginTop:-4}}>{r.r}</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.text}}>{r.p}%</div><div style={{fontSize:9,color:T.textMuted,marginTop:4}}>{r.d}</div></div>))}
        </div></Card>
      </div>)}
      {sigView==='sector'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>{sectorM.map((s,i)=><Stat key={i} label={s.s} value={`$${s.tam}B`} icon={TrendingUp} trend={s.tG} sub={`TAM · ${s.dc} deals`} color={s.c}/>)}</div>
        {sectorM.map((sec,si)=>(<Card key={si} title={`${sec.s} — Sector Analysis`} style={{marginBottom:14}}>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:16,padding:16}}>
            <div><div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',marginBottom:6,fontWeight:700}}>12-Month Momentum</div><SparkLine data={sec.m} width={200} height={50} color={sec.c} showDots fill/><div style={{display:'flex',justifyContent:'space-between',marginTop:6}}><span style={{fontSize:10,color:T.textDim}}>12mo: {sec.m[0]}</span><span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:sec.c}}>Now: {sec.m[11]}</span></div>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:4,marginTop:10}}><div style={{background:T.bgAccent,borderRadius:4,padding:'6px 8px'}}><div style={{fontSize:8,color:T.textDim}}>TOP CO</div><div style={{fontSize:11,fontWeight:700,color:sec.c}}>{sec.top}</div><div style={{fontSize:9,fontFamily:mono,color:T.textMuted}}>${sec.tv}B</div></div><div style={{background:T.bgAccent,borderRadius:4,padding:'6px 8px'}}><div style={{fontSize:8,color:T.textDim}}>MED ROUND</div><div style={{fontSize:11,fontWeight:700,color:sec.c}}>${sec.mr}M</div></div></div></div>
            <div style={{display:'flex',flexDirection:'column',alignItems:'center'}}><div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',marginBottom:6,fontWeight:700}}>Multi-Dimensional Score</div><RadarChart data={sec.ra} labels={radarL} size={180} color={sec.c}/></div>
            <div><div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',marginBottom:6,fontWeight:700}}>Growth Drivers</div>{sec.d.map((d,i)=><div key={i} style={{fontSize:11,color:T.text,padding:'3px 0 3px 10px',borderLeft:`2px solid ${sec.c}`,marginBottom:3}}>{d}</div>)}<div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',marginBottom:6,marginTop:10,fontWeight:700}}>Key Risks</div>{sec.r.map((r,i)=><div key={i} style={{fontSize:11,color:T.textMuted,padding:'3px 0 3px 10px',borderLeft:`2px solid ${T.red}40`,marginBottom:3}}>{r}</div>)}</div>
          </div></Card>))}
        <Card title="Sector Comparison — TAM Growth vs Deals vs Momentum" style={{marginBottom:14}}><div style={{padding:'12px 16px'}}>{sectorM.map((s,i)=>(<div key={i} style={{display:'grid',gridTemplateColumns:'140px 1fr 1fr 1fr',gap:12,alignItems:'center',padding:'8px 0',borderBottom:i<sectorM.length-1?`1px solid ${T.border}`:'none'}}><span style={{fontSize:12,fontWeight:700,color:s.c}}>{s.s}</span><div><div style={{fontSize:8,color:T.textDim}}>TAM GROWTH</div><Bar value={s.tG} max={60} color={s.c} h={8}/><span style={{fontSize:10,fontFamily:mono,color:s.c}}>{s.tG}%</span></div><div><div style={{fontSize:8,color:T.textDim}}>DEALS</div><Bar value={s.dc} max={200} color={s.c} h={8}/><span style={{fontSize:10,fontFamily:mono,color:s.c}}>{s.dc}</span></div><div><div style={{fontSize:8,color:T.textDim}}>MOMENTUM</div><Bar value={s.m[11]} max={100} color={s.c} h={8}/><span style={{fontSize:10,fontFamily:mono,color:s.c}}>{s.m[11]}/100</span></div></div>))}</div></Card>
      </div>)}
      {sigView==='feed'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Signals (24h)" value={sigFeed.length} icon={Activity} sub="tracked" color={T.accent}/>
          <Stat label="Critical" value={sigFeed.filter(s=>s.prio==='CRITICAL').length} icon={AlertTriangle} sub="immediate action" color={T.red}/>
          <Stat label="Net NAV Impact" value="+$21.6M" icon={DollarSign} sub="today" color={T.green}/>
          <Stat label="Avg Confidence" value={`${Math.round(sigFeed.reduce((a,f)=>a+f.conf,0)/sigFeed.length)}%`} icon={Target} sub="reliability" color={T.blue}/>
        </div>
        <Card title="Signal Type Distribution" style={{marginBottom:14}}><div style={{padding:'12px 16px',display:'flex',gap:12,alignItems:'center'}}>
          <DonutChart size={120} thickness={16} label={sigFeed.length+''} sublabel="signals" segments={Object.entries(sigFeed.reduce((a,s)=>{a[s.type]=(a[s.type]||0)+1;return a;},{})).map(([t,c])=>({value:c,label:t,color:typeC[t]||T.textMuted}))}/>
          <div style={{flex:1,display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:6}}>{Object.entries(sigFeed.reduce((a,s)=>{a[s.type]=(a[s.type]||0)+1;return a;},{})).map(([t,c],i)=><div key={i} style={{display:'flex',alignItems:'center',gap:6,padding:'4px 8px',background:T.bgAccent,borderRadius:4}}><div style={{width:8,height:8,borderRadius:'50%',background:typeC[t]||T.textMuted}}/><span style={{fontSize:10,color:T.textMuted}}>{t}</span><span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:T.text,marginLeft:'auto'}}>{c}</span></div>)}</div>
        </div></Card>
        {sigFeed.map((sig,i)=>(<div key={i} style={{background:T.bgCard,border:`1px solid ${sig.prio==='CRITICAL'?T.red+'40':T.border}`,borderRadius:8,padding:'12px 16px',marginBottom:6,borderLeft:`3px solid ${typeC[sig.type]||T.textMuted}`,position:'relative'}}>
          {sig.prio==='CRITICAL'&&<div style={{position:'absolute',top:0,right:0,background:T.red,color:T.bg,fontSize:8,fontWeight:800,padding:'2px 8px',borderRadius:'0 7px 0 4px'}}>⚡ CRITICAL</div>}
          <div style={{display:'flex',gap:6,alignItems:'center',marginBottom:4}}><Badge color={typeC[sig.type]}>{sig.type}</Badge><Badge color={prioC[sig.prio]}>{sig.prio}</Badge><span style={{fontSize:9,color:T.textDim,fontFamily:mono}}>{sig.time}</span></div>
          <div style={{fontSize:13,fontWeight:700,color:T.text,marginBottom:3}}>{sig.title}</div>
          <div style={{fontSize:11,color:T.textMuted,lineHeight:1.4}}>{sig.detail}</div>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:8,paddingTop:6,borderTop:`1px solid ${T.border}`}}>
            <div style={{display:'flex',gap:12}}><span style={{fontSize:10,color:T.textDim}}>Impact: <span style={{color:sig.dir==='pos'?T.green:T.red,fontWeight:700}}>{sig.impact}</span></span><span style={{fontSize:10,color:T.textDim}}>Confidence: <span style={{fontFamily:mono,fontWeight:700,color:sig.conf>=90?T.accent:T.blue}}>{sig.conf}%</span></span></div>
            <div style={{display:'flex',gap:4}}>{sig.sec.map((s,j)=><Badge key={j} color={T.bgAccent}>{s}</Badge>)}</div>
          </div>
        </div>))}
      </div>)}
      {sigView==='heatmap'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Strongest Corr" value="+0.82" icon={TrendingUp} sub="AI Safety ↔ Regulation" color={T.accent}/><Stat label="Strongest Inverse" value="-0.72" icon={ArrowDownRight} sub="IPO ↔ Sec. Discounts" color={T.red}/>
          <Stat label="Exploitable Pairs" value="4" icon={Zap} sub="predictive edge" color={T.green}/><Stat label="Factors Tracked" value={corrSig.length} icon={Globe} sub="macro signals" color={T.blue}/>
        </div>
        <Card title="Cross-Signal Correlation Matrix" style={{marginBottom:14}}><div style={{padding:'12px 16px',overflowX:'auto'}}>
          <div style={{display:'grid',gridTemplateColumns:`80px repeat(${corrSig.length},1fr)`,gap:2}}><div/>
            {corrSig.map((s,i)=><div key={i} style={{fontSize:8,color:T.textMuted,textAlign:'center',padding:'4px 2px',whiteSpace:'pre-line',lineHeight:1.2}}>{s}</div>)}
            {corrMat.map((row,ri)=><React.Fragment key={ri}><div style={{fontSize:8,color:T.textMuted,display:'flex',alignItems:'center',whiteSpace:'pre-line',lineHeight:1.2,paddingRight:4}}>{corrSig[ri]}</div>
              {row.map((val,ci)=>{const abs=Math.abs(val);const pos=val>=0;const bg=ri===ci?T.accent+'30':pos?`rgba(34,197,94,${abs*0.5})`:`rgba(239,68,68,${abs*0.5})`;return <div key={ci} style={{background:bg,borderRadius:3,display:'flex',alignItems:'center',justifyContent:'center',fontSize:9,fontFamily:mono,fontWeight:700,color:abs>0.5?T.text:T.textMuted,height:32,border:`1px solid ${T.border}`}}>{val.toFixed(2)}</div>;})}
            </React.Fragment>)}
          </div>
        </div></Card>
        <Card title="Exploitable Correlations — Trading Signals" style={{marginBottom:14}}>
          {[{pair:'AI Safety ↔ Regulation',corr:.82,ins:'Regulation spikes → AI Safety funding follows in 30-60 days.',act:'Pre-position for Q2 2026 deal flow surge.',lag:'30-60d',c:T.accent},
            {pair:'IPO Window ↔ Secondary Discounts',corr:-.72,ins:'Open IPO window → discounts compress rapidly. Currently -28% → -12%.',act:'Accelerate secondary purchases NOW.',lag:'15-30d',c:T.amber},
            {pair:'GPU Demand ↔ AI Safety Funding',corr:.78,ins:'NVIDIA quarterly reports predict VC deployment 1 quarter later.',act:'Use NVIDIA earnings as deployment signal. Next: Feb 26.',lag:'90d',c:T.purple},
            {pair:'Fed Rate ↔ LP Appetite',corr:-.58,ins:'Rate holds/cuts → LP allocation increases. Current hold = positive.',act:'Prepare Fund II materials for rate cut scenario.',lag:'60-90d',c:T.green}
          ].map((c,i)=><div key={i} style={{background:T.bgAccent,border:`1px solid ${T.border}`,borderRadius:6,padding:'12px 14px',marginBottom:8,borderLeft:`3px solid ${c.c}`}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}><span style={{fontSize:13,fontWeight:700,color:T.text}}>{c.pair}</span><div style={{display:'flex',gap:8,alignItems:'center'}}><span style={{fontSize:16,fontWeight:800,fontFamily:mono,color:c.corr>0?T.green:T.red}}>{c.corr>0?'+':''}{c.corr.toFixed(2)}</span><Badge color={T.blue}>Lag: {c.lag}</Badge></div></div>
            <div style={{fontSize:11,color:T.textMuted,marginBottom:6}}>{c.ins}</div><div style={{fontSize:11,fontWeight:600,color:c.c,fontFamily:mono}}>→ {c.act}</div>
          </div>)}
        </Card>
      </div>)}
      {sigView==='catalyst'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Catalysts" value={catalysts.length} icon={Zap} sub="next 18mo" color={T.accent}/><Stat label="NAV Impact" value="+$45-67M" icon={DollarSign} sub="if all hit" color={T.green}/>
          <Stat label="Next" value="Mar 2026" icon={Clock} sub="Anduril S-1" color={T.blue}/><Stat label="Critical Window" value="Q2-Q3" icon={Target} sub="IPO + LP" color={T.amber}/>
        </div>
        <Card title="Catalyst Timeline — 18-Month Forward View" style={{marginBottom:14}}><div style={{padding:'8px 16px'}}>
          <TimelineChart events={catalysts.map(e=>({title:e.t,description:e.desc,date:e.d,color:e.c,impact:e.imp,impactColor:e.ic}))} width={710}/>
        </div></Card>
      </div>)}
      {sigView==='sentiment'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Fastest Accel." value="AI Regulation" icon={TrendingUp} sub="+8 accel" color={T.purple}/><Stat label="Fastest Decel." value="Open Source AI" icon={ArrowDownRight} sub="-3 accel" color={T.red}/>
          <Stat label="Highest Sentiment" value="AI Safety" icon={Star} sub="88/100" color={T.accent}/><Stat label="Topics" value={sentData.length} icon={Globe} sub="tracked" color={T.blue}/>
        </div>
        {sentData.sort((a,b)=>Math.abs(b.vel)-Math.abs(a.vel)).map((s,i)=>(<div key={i} style={{background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:8,padding:'14px 16px',marginBottom:8,borderLeft:`3px solid ${s.c}`}}>
          <div style={{display:'grid',gridTemplateColumns:'1.5fr 1fr 1fr 1fr 2fr',gap:12,alignItems:'center'}}>
            <div><div style={{fontSize:14,fontWeight:700,color:T.text}}>{s.topic}</div><div style={{display:'flex',gap:4,marginTop:3}}><Badge color={s.sent>=70?T.green:s.sent>=50?T.amber:T.red}>{s.sent>=70?'BULLISH':s.sent>=50?'NEUTRAL':'BEARISH'}</Badge><Badge color={s.vel>0?T.green:T.red}>{s.vel>0?'↑':'↓'}{Math.abs(s.vel)}/mo</Badge></div></div>
            <div><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>Sentiment</div><div style={{display:'flex',alignItems:'center',gap:4}}><Bar value={s.sent} max={100} color={s.c} h={6}/><span style={{fontSize:14,fontFamily:mono,fontWeight:700,color:s.c}}>{s.sent}</span></div></div>
            <div><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>Velocity</div><div style={{fontSize:16,fontFamily:mono,fontWeight:700,color:s.vel>0?T.green:T.red}}>{s.vel>0?'+':''}{s.vel}</div></div>
            <div><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>Trend</div><SparkLine data={s.trend} width={80} height={28} color={s.c} fill={false}/></div>
            <div style={{fontSize:11,color:T.textMuted}}>{s.sig}</div>
          </div>
        </div>))}
      </div>)}
    </div>
  );
};

// ════════════════════════════════════════════════════
// PORTFOLIO ANALYTICS TAB
// ════════════════════════════════════════════════════
const PortfolioAnalytics = () => {
  const [expandedCo, setExpandedCo] = useState(null);
  const [sortField, setSortField] = useState('signalScore');
  const [filterSector, setFilterSector] = useState('All');
  const [subTab, setSubTab] = useState('companies');

  const sorted = useMemo(() => {
    let arr = [...PORTFOLIO_COMPANIES];
    if (filterSector !== 'All') arr = arr.filter(c => c.sector === filterSector);
    arr.sort((a, b) => b[sortField] - a[sortField]);
    return arr;
  }, [sortField, filterSector]);

  const totalExposure = PORTFOLIO_COMPANIES.reduce((s, c) => s + (c.valuation * c.ownership / 100), 0);
  const avgGrowth = (PORTFOLIO_COMPANIES.reduce((s, c) => s + c.growth, 0) / PORTFOLIO_COMPANIES.length).toFixed(0);
  const ipoReady = PORTFOLIO_COMPANIES.filter(c => c.exitPath.includes('IPO')).length;
  const topSignal = PORTFOLIO_COMPANIES.filter(c => c.signalScore >= 85).length;

  const statusColor = s => ({ markup: T.green, flat: T.amber, markdown: T.red, public: T.cyan }[s] || T.textMuted);
  const sectors = ['All', ...new Set(PORTFOLIO_COMPANIES.map(c => c.sector))];

  // ── COMPUTED ANALYTICS ──
  // GP Attribution
  const gpAttribution = useMemo(() => {
    const gps = {};
    FUNDS.forEach(f => {
      if (!gps[f.gp]) gps[f.gp] = { gp: f.gp, funds: 0, committed: 0, nav: 0, irr: 0, tvpi: 0, companies: 0, sector: f.sector };
      gps[f.gp].funds++; gps[f.gp].committed += f.committed; gps[f.gp].nav += f.nav;
      gps[f.gp].irr = Math.max(gps[f.gp].irr, f.irr); gps[f.gp].tvpi = Math.max(gps[f.gp].tvpi, f.tvpi);
      gps[f.gp].companies += f.companies;
    });
    return Object.values(gps).sort((a, b) => b.nav - a.nav).map((g, i) => ({
      ...g, rank: i + 1,
      navContrib: ((g.nav / FUNDS.reduce((s,f)=>s+f.nav,0)) * 100).toFixed(1),
      quartile: g.irr >= 25 ? 'Q1' : g.irr >= 20 ? 'Q2' : g.irr >= 15 ? 'Q3' : 'Q4',
      alpha: (g.irr - 18.5).toFixed(1), // vs benchmark
    }));
  }, []);

  // Cash Flow Forecast
  const cashFlows = useMemo(() => {
    const quarters = [];
    for (let y = 2026; y <= 2030; y++) {
      for (let q = 1; q <= 4; q++) {
        const age = (y - 2026) * 4 + q;
        const callRate = Math.max(0, 0.08 - age * 0.003); // declining calls
        const distRate = Math.max(0, (age - 8) * 0.015); // rising distributions
        const totalCommitted = FUNDS.reduce((s,f)=>s+f.committed,0);
        const calls = totalCommitted * callRate * (1 + Math.random() * 0.3);
        const dists = totalCommitted * distRate * (1 + Math.random() * 0.4);
        quarters.push({ label: `Q${q} '${String(y).slice(2)}`, year: y, calls: -calls, dists, net: dists - calls, cumNet: 0 });
      }
    }
    let cum = 0; quarters.forEach(q => { cum += q.net; q.cumNet = cum; });
    return quarters;
  }, []);

  // Concentration Risk
  const concentrationMetrics = useMemo(() => {
    const exposures = PORTFOLIO_COMPANIES.map(c => c.valuation * c.ownership / 100);
    const totalExp = exposures.reduce((s,e)=>s+e,0);
    const shares = exposures.map(e => e / totalExp);
    const hhi = shares.reduce((s, sh) => s + sh * sh, 0);
    const top3 = exposures.sort((a,b)=>b-a).slice(0,3).reduce((s,e)=>s+e,0) / totalExp * 100;
    const top5 = exposures.sort((a,b)=>b-a).slice(0,5).reduce((s,e)=>s+e,0) / totalExp * 100;
    const sectorConc = {};
    PORTFOLIO_COMPANIES.forEach(c => {
      const exp = c.valuation * c.ownership / 100;
      sectorConc[c.sector] = (sectorConc[c.sector] || 0) + exp;
    });
    const sectorShares = Object.entries(sectorConc).map(([s, v]) => ({ sector: s, exposure: v, pct: (v / totalExp * 100).toFixed(1) })).sort((a,b) => b.exposure - a.exposure);
    const stageConc = {};
    PORTFOLIO_COMPANIES.forEach(c => {
      const exp = c.valuation * c.ownership / 100;
      stageConc[c.stage] = (stageConc[c.stage] || 0) + exp;
    });
    const stageShares = Object.entries(stageConc).map(([s, v]) => ({ stage: s, exposure: v, pct: (v / totalExp * 100).toFixed(1) })).sort((a,b) => b.exposure - a.exposure);
    return { hhi: (hhi * 10000).toFixed(0), top3: top3.toFixed(1), top5: top5.toFixed(1), sectorShares, stageShares, totalExp };
  }, []);

  // Scenario Analysis
  const scenarios = useMemo(() => {
    const base = FUNDS.reduce((s,f)=>s+f.nav,0);
    return {
      bull: { nav: base * 1.45, irr: 32, tvpi: 2.1, catalyst: 'AI Safety regulation drives 3x revenue multiples, 4 IPOs in 2027, SpaceX secondary appreciates 80%', probability: 25 },
      base: { nav: base * 1.18, irr: 22, tvpi: 1.6, catalyst: 'Steady portfolio appreciation, 2 IPOs, secondary discounts compress, SBIC leverage deployed', probability: 50 },
      bear: { nav: base * 0.85, irr: 8, tvpi: 1.1, catalyst: 'AI winter scenario, IPO window closes, markdowns across late-stage, secondary market freezes', probability: 25 },
    };
  }, []);

  // Power Law Analysis
  const powerLaw = useMemo(() => {
    const sorted = [...PORTFOLIO_COMPANIES].map(c => ({
      ...c, exposure: c.valuation * c.ownership / 100,
    })).sort((a, b) => b.exposure - a.exposure);
    const total = sorted.reduce((s,c) => s + c.exposure, 0);
    let cumPct = 0;
    return sorted.map((c, i) => {
      cumPct += (c.exposure / total) * 100;
      return { ...c, pctOfTotal: ((c.exposure / total) * 100).toFixed(1), cumPct: cumPct.toFixed(1), rank: i + 1 };
    });
  }, []);

  // Exit Pipeline
  const exitPipeline = useMemo(() => {
    const years = { 2026: [], 2027: [], 2028: [] };
    PORTFOLIO_COMPANIES.forEach(c => {
      const match = c.exitPath.match(/(\d{4})/);
      if (match && years[match[1]]) years[match[1]].push(c);
    });
    return years;
  }, []);

  // Pacing Analysis
  const pacing = useMemo(() => {
    const totalCommitted = FUNDS.reduce((s,f)=>s+f.committed,0);
    const totalCalled = FUNDS.reduce((s,f)=>s+f.called,0);
    const planPct = 65; // target 65% deployed by now
    const actualPct = (totalCalled / totalCommitted * 100);
    return {
      totalCommitted, totalCalled, planPct, actualPct: actualPct.toFixed(1),
      variance: (actualPct - planPct).toFixed(1),
      uncalled: totalCommitted - totalCalled,
      byVintage: [2022, 2023, 2024].map(v => {
        const vFunds = FUNDS.filter(f => f.vintage === v);
        const c = vFunds.reduce((s,f)=>s+f.committed,0);
        const k = vFunds.reduce((s,f)=>s+f.called,0);
        const target = v === 2022 ? 95 : v === 2023 ? 72 : 38;
        return { vintage: v, committed: c, called: k, pct: (k/c*100).toFixed(1), target, variance: ((k/c*100) - target).toFixed(1) };
      }),
    };
  }, []);

  // Macro Signals
  const macroSignals = [
    { signal: 'Fed Funds Rate', value: '4.25%', direction: 'down', impact: 'positive', detail: 'Easing cycle supports VC valuations, lowers discount rates on growth assets', strength: 78 },
    { signal: 'IPO Window', value: 'Open', direction: 'up', impact: 'positive', detail: '2025 IPO volume +180% YoY. AI/defense names trading at premium multiples post-listing', strength: 85 },
    { signal: 'VC Funding Volume', value: '$72B Q4', direction: 'up', impact: 'mixed', detail: 'AI concentration risk: 65% of all VC dollars flowing to AI. Raises competition for deals.', strength: 62 },
    { signal: 'M&A Volume', value: '$1.2T 2025', direction: 'up', impact: 'positive', detail: 'Strategic acquirers (Google, MSFT, AMZN) actively bidding on AI safety companies', strength: 74 },
    { signal: 'Secondary Pricing', value: '84¢ avg', direction: 'up', impact: 'negative', detail: 'Discount compression reduces secondary alpha. Window narrowing for distressed purchases.', strength: 55 },
    { signal: 'AI Regulation', value: 'EU AI Act Live', direction: 'up', impact: 'positive', detail: 'Compliance mandates create $50B+ addressable market for AI Safety portfolio companies', strength: 92 },
    { signal: '10Y Treasury', value: '4.15%', direction: 'down', impact: 'positive', detail: 'Lower risk-free rate increases relative attractiveness of illiquidity premium', strength: 71 },
    { signal: 'Defense Budget', value: '$886B FY26', direction: 'up', impact: 'positive', detail: 'Record defense spend benefits Anduril, Shield AI, Armada portfolio exposure', strength: 88 },
  ];

  // Valuation Cohorts
  const valCohorts = useMemo(() => {
    const cohorts = {};
    PORTFOLIO_COMPANIES.forEach(c => {
      const mult = c.revenue > 0 ? (c.valuation / c.revenue).toFixed(1) : 'Pre-Rev';
      const bucket = c.revenue >= 1000 ? 'Scale ($1B+ rev)' : c.revenue >= 100 ? 'Growth ($100M+ rev)' : c.revenue >= 10 ? 'Early ($10M+ rev)' : 'Pre-Revenue';
      if (!cohorts[bucket]) cohorts[bucket] = [];
      cohorts[bucket].push({ ...c, revMult: typeof mult === 'string' ? mult : `${mult}x` });
    });
    return cohorts;
  }, []);

  // Decision Recommendations
  const decisions = useMemo(() => [
    { priority: 1, action: 'Execute Founders Fund VI Secondary', type: 'BUY', urgency: 'CRITICAL', rationale: 'Premium justified — SpaceX alone covers 2.1x entry. Only 3 days listed. Anduril + Palantir provide downside floor. Expected 35% IRR on 3.2yr hold.', impact: '+$28M NAV', confidence: 96 },
    { priority: 2, action: 'Bid on Tiger Global PIP 15 at 60¢', type: 'BUY', urgency: 'HIGH', rationale: '38-43% discount to conservatively-marked portfolio. Distressed seller creating forced liquidity. Even flat marks = 1.66x MOIC at 60¢ entry.', impact: '+$18M NAV', confidence: 81 },
    { priority: 3, action: 'Increase Anthropic exposure via a16z co-invest', type: 'ADD', urgency: 'HIGH', rationale: 'Signal score 98. 340% rev growth. Constitutional AI moat is defensible. $61.5B valuation at 22x forward revenue — below Palantir public comp at 28x.', impact: '+$12M exposure', confidence: 92 },
    { priority: 4, action: 'Trim Verkada position — reallocate to AI Safety', type: 'TRIM', urgency: 'MEDIUM', rationale: 'Signal score 76 (lowest). Growth decelerating to 45%. Physical security commoditizing. Redeploy capital to higher-conviction AI Safety positions.', impact: '+2.1% IRR', confidence: 74 },
    { priority: 5, action: 'Accelerate Greylock XVII capital calls', type: 'PACE', urgency: 'MEDIUM', rationale: 'Only 33% called on 2024 vintage. GovTech sector tailwinds (defense budget +8%). Missing deployment window for pre-IPO positions.', impact: '+$20M deployed', confidence: 78 },
    { priority: 6, action: 'Lock Sequoia Growth III at 80¢', type: 'BUY', urgency: 'HIGH', rationale: 'Stripe + Databricks + Wiz exposure at 20% discount. Both Stripe and Databricks IPO-ready 2026. Implied 1.69x TVPI at entry price.', impact: '+$22M NAV', confidence: 89 },
    { priority: 7, action: 'Hedge late-stage concentration via Insight Partners XII', type: 'HEDGE', urgency: 'MEDIUM', rationale: 'Cybersecurity portfolio provides defensive ballast. 12% discount. Veeam, JFrog, Armis are recession-resistant enterprise plays.', impact: 'Risk reduction', confidence: 83 },
    { priority: 8, action: 'Initiate Northern Trust LP conversion', type: 'LP', urgency: 'HIGH', rationale: '$40M potential. Stacy Singer engagement at final stage. Closing this LP puts us at $225M committed — triggers institutional allocator threshold.', impact: '+$40M AUM', confidence: 68 },
  ], []);

  // ── SUB-TAB SELECTOR ──
  const SUB_TABS = [
    { id: 'decisions', label: 'Decisions' },
    { id: 'companies', label: 'Companies' },
    { id: 'gp', label: 'GP Attribution' },
    { id: 'cashflow', label: 'Cash Flows' },
    { id: 'risk', label: 'Risk' },
    { id: 'scenarios', label: 'Scenarios' },
    { id: 'exits', label: 'Exits' },
    { id: 'power', label: 'Power Law' },
    { id: 'pacing', label: 'Pacing' },
    { id: 'macro', label: 'Macro' },
    { id: 'cohorts', label: 'Cohorts' },
    { id: 'overlap', label: 'Overlap' },
    { id: 'benchmark', label: 'Benchmark' },
    { id: 'sensitivity', label: 'Sensitivity' },
    { id: 'fees', label: 'Fee Analysis' },
    { id: 'montecarlo', label: 'Monte Carlo' },
    { id: 'dpi', label: 'DPI Forecast' },
    { id: 'team', label: 'Team' },
    { id: 'jcurve', label: 'J-Curve' },
    { id: 'signals', label: 'Signal Detection' },
    { id: 'bayesian', label: 'Bayesian Exits' },
    { id: 'kelly', label: 'Kelly Sizing' },
    { id: 'regime', label: 'Regime Analysis' },
    { id: 'optionality', label: 'Optionality' },
    { id: 'flywheel', label: 'Flywheel' },
    { id: 'alpha', label: 'Alpha Decomp' },
  ];

  return (
    <div>
      {/* Top Stats */}
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 14 }}>
        <Stat label="Look-Through Exposure" value={`$${(totalExposure/1000).toFixed(1)}B`} icon={Eye} trend={18} color={T.accent} />
        <Stat label="Portfolio Companies" value={PORTFOLIO_COMPANIES.length} icon={Building2} sub="across 8 funds" color={T.blue} />
        <Stat label="Avg Revenue Growth" value={`${avgGrowth}%`} icon={TrendingUp} trend={12} color={T.green} />
        <Stat label="IPO-Ready" value={ipoReady} icon={Star} sub="next 24 months" color={T.gold} />
        <Stat label="Decisions Pending" value={decisions.filter(d=>d.urgency==='CRITICAL'||d.urgency==='HIGH').length} icon={Zap} sub="high urgency" color={T.red} />
      </div>

      {/* Sub-tab bar */}
      <div style={{ display: 'flex', gap: 2, marginBottom: 16, background: T.bgCard, borderRadius: 6, padding: 3, border: `1px solid ${T.border}`, overflowX: 'auto' }}>
        {SUB_TABS.map(t => (
          <button key={t.id} onClick={() => setSubTab(t.id)} style={{
            padding: '7px 12px', borderRadius: 4, border: 'none', cursor: 'pointer', fontSize: 11, fontWeight: 600,
            background: subTab === t.id ? T.accent : 'transparent', color: subTab === t.id ? T.bg : T.textMuted,
            transition: 'all 0.12s', whiteSpace: 'nowrap', fontFamily: sans,
          }}>{t.label}</button>
        ))}
      </div>

      {/* ════ DECISIONS ENGINE ════ */}
      {subTab === 'decisions' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Ranked Action Items — Highest Impact First</div>
          {decisions.map((d, i) => (
            <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 8, borderLeft: `3px solid ${d.urgency === 'CRITICAL' ? T.red : d.urgency === 'HIGH' ? T.amber : T.blue}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                  <span style={{ fontSize: 20, fontWeight: 900, fontFamily: mono, color: T.textDim, opacity: 0.4 }}>#{d.priority}</span>
                  <div>
                    <div style={{ fontSize: 14, fontWeight: 700, color: T.text, marginBottom: 2 }}>{d.action}</div>
                    <div style={{ display: 'flex', gap: 6 }}>
                      <Badge color={{ BUY: T.green, ADD: T.accent, TRIM: T.amber, HEDGE: T.blue, PACE: T.purple, LP: T.cyan }[d.type]}>{d.type}</Badge>
                      <Badge color={d.urgency === 'CRITICAL' ? T.red : d.urgency === 'HIGH' ? T.amber : T.blue}>{d.urgency}</Badge>
                    </div>
                  </div>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <div style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: T.accent }}>{d.impact}</div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4, justifyContent: 'flex-end', marginTop: 2 }}>
                    <span style={{ fontSize: 9, color: T.textDim }}>CONFIDENCE</span>
                    <span style={{ fontSize: 12, fontWeight: 700, fontFamily: mono, color: d.confidence >= 90 ? T.accent : d.confidence >= 75 ? T.blue : T.amber }}>{d.confidence}%</span>
                  </div>
                </div>
              </div>
              <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.7 }}>{d.rationale}</div>
              <div style={{ marginTop: 8 }}><Bar value={d.confidence} max={100} color={d.confidence >= 90 ? T.accent : d.confidence >= 75 ? T.blue : T.amber} h={3} /></div>
            </div>
          ))}
        </div>
      )}

      {/* ════ COMPANIES ════ */}
      {subTab === 'companies' && (
        <div>
          <div style={{ marginBottom: 14 }}><JCurveChart /></div>
          <Card title="Portfolio Company Look-Through" action={
            <div style={{ display: 'flex', gap: 4 }}>{sectors.map(s => (
              <button key={s} onClick={() => setFilterSector(s)} style={{ padding: '3px 7px', borderRadius: 3, fontSize: 9, fontWeight: 600, border: 'none', cursor: 'pointer', background: filterSector === s ? T.accent : T.bgAccent, color: filterSector === s ? T.bg : T.textMuted }}>{s}</button>
            ))}</div>
          }>
            <div style={{ overflowX: 'auto' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>
                  {['Company', 'Sector', 'Stage', 'Valuation', 'Own %', 'Exposure', 'Rev Growth', 'Revenue', 'Signal', 'Status', 'Exit Path'].map(h => (
                    <TH key={h} align={['Company','Sector','Stage','Status','Exit Path'].includes(h) ? 'left' : 'right'}
                      onClick={{'Signal':'signalScore','Valuation':'valuation','Rev Growth':'growth','Exposure':'ownership','Revenue':'revenue'}[h] ? () => setSortField({'Signal':'signalScore','Valuation':'valuation','Rev Growth':'growth','Exposure':'ownership','Revenue':'revenue'}[h]) : undefined}>
                      {h}
                    </TH>
                  ))}
                </tr></thead>
                <tbody>{sorted.map(c => (
                  <React.Fragment key={c.id}>
                    <TR onClick={() => setExpandedCo(expandedCo === c.id ? null : c.id)}>
                      <TD bold color={T.text}><div style={{ display: 'flex', alignItems: 'center', gap: 5 }}><ChevronRight size={11} color={T.textDim} style={{ transform: expandedCo === c.id ? 'rotate(90deg)' : 'none', transition: 'transform 0.15s' }} />{c.name}</div></TD>
                      <TD><Badge color={c.sector === 'AI Safety' ? T.accent : c.sector === 'GovTech' ? T.blue : c.sector === 'AI Infrastructure' ? T.purple : T.amber}>{c.sector}</Badge></TD>
                      <TD color={T.textMuted}>{c.stage}</TD>
                      <TD align="right" mono bold>${c.valuation >= 1000 ? `${(c.valuation/1000).toFixed(1)}B` : `${c.valuation}M`}</TD>
                      <TD align="right" mono color={T.textMuted}>{c.ownership}%</TD>
                      <TD align="right" mono bold color={T.accent}>${((c.valuation * c.ownership / 100)).toFixed(1)}M</TD>
                      <TD align="right" mono bold color={c.growth >= 200 ? T.accent : c.growth >= 100 ? T.green : T.text}>{c.growth}%</TD>
                      <TD align="right" mono color={T.textMuted}>${c.revenue}M</TD>
                      <TD align="right" mono bold color={c.signalScore >= 90 ? T.accent : c.signalScore >= 80 ? T.blue : T.textMuted}>{c.signalScore}</TD>
                      <TD><Badge color={statusColor(c.status)}>{c.status}</Badge></TD>
                      <TD color={c.exitPath.includes('IPO') ? T.gold : T.textMuted}>{c.exitPath}</TD>
                    </TR>
                    {expandedCo === c.id && (
                      <tr><td colSpan={11} style={{ padding: 0 }}>
                        <div style={{ background: T.bgAccent, padding: '12px 18px 12px 34px', borderBottom: `1px solid ${T.border}` }}>
                          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 12 }}>
                            <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: 2 }}>Fund</div><div style={{ fontSize: 11, color: T.text, fontWeight: 600 }}>{c.fund}</div></div>
                            <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: 2 }}>Employees</div><div style={{ fontSize: 11, color: T.text, fontFamily: mono }}>{c.employees.toLocaleString()}</div></div>
                            <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: 2 }}>Moat</div><div style={{ fontSize: 10, color: T.accent }}>{c.moat}</div></div>
                            <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: 2 }}>Rev Yield</div><div style={{ fontSize: 11, color: T.text, fontFamily: mono }}>{((c.revenue / c.valuation) * 100).toFixed(1)}%</div></div>
                            <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: 2 }}>Rev Multiple</div><div style={{ fontSize: 11, color: T.text, fontFamily: mono }}>{c.revenue > 0 ? `${(c.valuation / c.revenue).toFixed(1)}x` : 'Pre-Rev'}</div></div>
                          </div>
                        </div>
                      </td></tr>
                    )}
                  </React.Fragment>
                ))}</tbody>
              </table>
            </div>
          </Card>
        </div>
      )}

      {/* ════ GP ATTRIBUTION ════ */}
      {subTab === 'gp' && (
        <div>
          <Card title="GP Performance Attribution — Who Drives Returns?">
            <div style={{ overflowX: 'auto' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Rank', 'GP', 'Funds', 'Committed', 'NAV', 'NAV Contrib', 'Best IRR', 'Best TVPI', 'Quartile', 'Alpha vs Bench', 'Companies'].map(h => <TH key={h} align={['GP'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{gpAttribution.map(g => (
                  <TR key={g.gp}>
                    <TD align="right" mono bold color={g.rank <= 3 ? T.accent : T.textMuted}>#{g.rank}</TD>
                    <TD bold>{g.gp}</TD>
                    <TD align="right" mono>{g.funds}</TD>
                    <TD align="right" mono>${g.committed}M</TD>
                    <TD align="right" mono bold color={T.accent}>${g.nav.toFixed(1)}M</TD>
                    <TD align="right" mono bold color={parseFloat(g.navContrib) >= 20 ? T.accent : T.text}>{g.navContrib}%</TD>
                    <TD align="right" mono bold color={g.irr >= 25 ? T.accent : g.irr >= 20 ? T.green : T.text}>{g.irr}%</TD>
                    <TD align="right" mono bold color={g.tvpi >= 1.5 ? T.accent : T.text}>{g.tvpi}x</TD>
                    <TD align="right"><Badge color={g.quartile === 'Q1' ? T.accent : g.quartile === 'Q2' ? T.green : g.quartile === 'Q3' ? T.amber : T.red}>{g.quartile}</Badge></TD>
                    <TD align="right" mono bold color={parseFloat(g.alpha) > 0 ? T.green : T.red}>{parseFloat(g.alpha) > 0 ? '+' : ''}{g.alpha}%</TD>
                    <TD align="right" mono color={T.textMuted}>{g.companies}</TD>
                  </TR>
                ))}</tbody>
              </table>
            </div>
          </Card>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginTop: 14 }}>
            <Card title="GP NAV Contribution">
              <div style={{ padding: 14 }}>
                {gpAttribution.map((g, i) => (
                  <div key={i} style={{ marginBottom: 10 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                      <span style={{ fontSize: 11, color: T.text }}>{g.gp}</span>
                      <span style={{ fontSize: 10, color: T.accent, fontFamily: mono, fontWeight: 700 }}>{g.navContrib}% · ${g.nav.toFixed(1)}M</span>
                    </div>
                    <Bar value={parseFloat(g.navContrib)} max={40} color={g.rank <= 3 ? T.accent : T.blue} h={5} />
                  </div>
                ))}
              </div>
            </Card>
            <Card title="Alpha Generation vs 18.5% Benchmark">
              <div style={{ padding: 14 }}>
                {gpAttribution.map((g, i) => (
                  <div key={i} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '8px 0', borderBottom: i < gpAttribution.length - 1 ? `1px solid ${T.border}06` : 'none' }}>
                    <span style={{ fontSize: 11, color: T.text }}>{g.gp}</span>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                      <span style={{ fontSize: 13, fontWeight: 800, fontFamily: mono, color: parseFloat(g.alpha) > 0 ? T.green : T.red }}>{parseFloat(g.alpha) > 0 ? '+' : ''}{g.alpha}%</span>
                      <Badge color={g.quartile === 'Q1' ? T.accent : g.quartile === 'Q2' ? T.green : T.amber}>{g.quartile}</Badge>
                    </div>
                  </div>
                ))}
              </div>
            </Card>
          </div>
        </div>
      )}

      {/* ════ CASH FLOWS ════ */}
      {subTab === 'cashflow' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
            <Stat label="Uncalled Capital" value={`$${pacing.uncalled.toFixed(1)}M`} icon={DollarSign} sub="remaining commitments" color={T.amber} />
            <Stat label="Est. '26 Distributions" value="$18.2M" icon={TrendingUp} sub="from NEA 19 + Benchmark X" color={T.green} />
            <Stat label="Net Cash Position" value={`$${cashFlows[3]?.cumNet.toFixed(1)}M`} icon={Target} color={cashFlows[3]?.cumNet >= 0 ? T.accent : T.red} />
            <Stat label="Self-Funding Year" value="2028" icon={Clock} sub="distributions > calls" color={T.blue} />
          </div>
          <Card title="Quarterly Cash Flow Forecast (2026–2030)">
            <div style={{ overflowX: 'auto' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Quarter', 'Capital Calls', 'Distributions', 'Net Cash Flow', 'Cumulative'].map(h => <TH key={h} align={h === 'Quarter' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
                <tbody>{cashFlows.slice(0, 16).map((q, i) => (
                  <TR key={i}>
                    <TD bold>{q.label}</TD>
                    <TD align="right" mono color={T.red}>(${Math.abs(q.calls).toFixed(1)}M)</TD>
                    <TD align="right" mono color={T.green}>${q.dists.toFixed(1)}M</TD>
                    <TD align="right" mono bold color={q.net >= 0 ? T.accent : T.red}>{q.net >= 0 ? '+' : ''}${q.net.toFixed(1)}M</TD>
                    <TD align="right" mono bold color={q.cumNet >= 0 ? T.accent : T.amber}>{q.cumNet >= 0 ? '+' : ''}${q.cumNet.toFixed(1)}M</TD>
                  </TR>
                ))}</tbody>
              </table>
            </div>
          </Card>
          {/* Cash Flow Visualization */}
          <Card title="Cash Flow Waterfall" style={{ marginTop: 14 }}>
            <div style={{ padding: '12px 16px', display: 'flex', alignItems: 'flex-end', gap: 3, height: 180 }}>
              {cashFlows.slice(0, 16).map((q, i) => {
                const maxAbs = Math.max(...cashFlows.slice(0,16).map(x => Math.max(Math.abs(x.calls), x.dists)));
                const callH = (Math.abs(q.calls) / maxAbs) * 120;
                const distH = (q.dists / maxAbs) * 120;
                return (
                  <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 2 }}>
                    <div style={{ height: distH, width: '80%', background: T.green, borderRadius: '3px 3px 0 0', opacity: 0.7, minHeight: distH > 0 ? 2 : 0 }} />
                    <div style={{ height: 1, width: '100%', background: T.textDim }} />
                    <div style={{ height: callH, width: '80%', background: T.red, borderRadius: '0 0 3px 3px', opacity: 0.7 }} />
                    <span style={{ fontSize: 7, color: T.textDim, fontFamily: mono }}>{q.label}</span>
                  </div>
                );
              })}
            </div>
            <div style={{ padding: '6px 16px 12px', display: 'flex', gap: 16 }}>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 10, color: T.textMuted }}><span style={{ width: 8, height: 8, background: T.green, borderRadius: 2, opacity: 0.7 }} />Distributions</span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 10, color: T.textMuted }}><span style={{ width: 8, height: 8, background: T.red, borderRadius: 2, opacity: 0.7 }} />Capital Calls</span>
            </div>
          </Card>
        </div>
      )}

      {/* ════ RISK DASHBOARD ════ */}
      {subTab === 'risk' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
            <Stat label="HHI Index" value={concentrationMetrics.hhi} icon={Shield} sub={parseInt(concentrationMetrics.hhi) < 1500 ? 'Diversified' : parseInt(concentrationMetrics.hhi) < 2500 ? 'Moderate' : 'Concentrated'} color={parseInt(concentrationMetrics.hhi) < 1500 ? T.green : T.amber} />
            <Stat label="Top 3 Concentration" value={`${concentrationMetrics.top3}%`} icon={AlertTriangle} sub="of total exposure" color={parseFloat(concentrationMetrics.top3) > 50 ? T.amber : T.green} />
            <Stat label="Top 5 Concentration" value={`${concentrationMetrics.top5}%`} icon={Eye} color={T.blue} />
            <Stat label="Sector Max" value={`${concentrationMetrics.sectorShares[0]?.pct}%`} icon={PieChart} sub={concentrationMetrics.sectorShares[0]?.sector} color={T.purple} />
          </div>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 12 }}>
            <Card title="Sector Concentration">
              <div style={{ padding: 14 }}>
                {concentrationMetrics.sectorShares.map((s, i) => (
                  <div key={i} style={{ marginBottom: 10 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                      <span style={{ fontSize: 11, color: T.text }}>{s.sector}</span>
                      <span style={{ fontSize: 10, fontFamily: mono, color: parseFloat(s.pct) > 40 ? T.amber : T.textMuted }}>{s.pct}%</span>
                    </div>
                    <Bar value={parseFloat(s.pct)} max={60} color={parseFloat(s.pct) > 40 ? T.amber : T.blue} h={5} />
                  </div>
                ))}
              </div>
            </Card>
            <Card title="Stage Concentration">
              <div style={{ padding: 14 }}>
                {concentrationMetrics.stageShares.map((s, i) => (
                  <div key={i} style={{ marginBottom: 10 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                      <span style={{ fontSize: 11, color: T.text }}>{s.stage}</span>
                      <span style={{ fontSize: 10, fontFamily: mono, color: T.textMuted }}>{s.pct}%</span>
                    </div>
                    <Bar value={parseFloat(s.pct)} max={50} color={T.purple} h={5} />
                  </div>
                ))}
              </div>
            </Card>
            <Card title="Risk Flags">
              <div style={{ padding: 14 }}>
                {[
                  { flag: 'Single-name risk', detail: 'Anthropic = 7.2% of NAV', severity: parseFloat(concentrationMetrics.top3) > 60 ? 'high' : 'medium' },
                  { flag: 'Sector concentration', detail: `AI Safety at ${concentrationMetrics.sectorShares[0]?.pct}%`, severity: parseFloat(concentrationMetrics.sectorShares[0]?.pct) > 40 ? 'medium' : 'low' },
                  { flag: 'Vintage clustering', detail: '62% committed in 2023-2024', severity: 'medium' },
                  { flag: 'GP concentration', detail: 'Top 3 GPs = 54% of NAV', severity: 'medium' },
                  { flag: 'Illiquidity mismatch', detail: 'Listed vehicle with illiquid assets', severity: 'low' },
                  { flag: 'Correlation risk', detail: 'AI theme = high intra-portfolio correlation', severity: 'high' },
                ].map((r, i) => (
                  <div key={i} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '7px 0', borderBottom: i < 5 ? `1px solid ${T.border}06` : 'none' }}>
                    <div>
                      <div style={{ fontSize: 11, color: T.text, fontWeight: 500 }}>{r.flag}</div>
                      <div style={{ fontSize: 9, color: T.textDim }}>{r.detail}</div>
                    </div>
                    <Badge color={r.severity === 'high' ? T.red : r.severity === 'medium' ? T.amber : T.green}>{r.severity}</Badge>
                  </div>
                ))}
              </div>
            </Card>
          </div>
        </div>
      )}

      {/* ════ SCENARIO ANALYSIS ════ */}
      {subTab === 'scenarios' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12, marginBottom: 14 }}>
            {Object.entries(scenarios).map(([key, s]) => {
              const colors = { bull: T.accent, base: T.blue, bear: T.red };
              const labels = { bull: 'Bull Case', base: 'Base Case', bear: 'Bear Case' };
              return (
                <div key={key} style={{ background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${colors[key]}`, padding: 18 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                    <span style={{ fontSize: 12, fontWeight: 800, color: colors[key], textTransform: 'uppercase', letterSpacing: '0.5px' }}>{labels[key]}</span>
                    <Badge color={colors[key]}>{s.probability}% prob</Badge>
                  </div>
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 10, marginBottom: 12 }}>
                    <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Portfolio NAV</div><div style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: colors[key] }}>${s.nav.toFixed(0)}M</div></div>
                    <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>IRR</div><div style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: colors[key] }}>{s.irr}%</div></div>
                    <div><div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>TVPI</div><div style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: colors[key] }}>{s.tvpi}x</div></div>
                  </div>
                  <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.6, borderTop: `1px solid ${T.border}`, paddingTop: 10 }}>{s.catalyst}</div>
                </div>
              );
            })}
          </div>
          {/* Expected Value */}
          <Card title="Probability-Weighted Expected Outcome">
            <div style={{ padding: 18 }}>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 20 }}>
                <div>
                  <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Expected NAV</div>
                  <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>
                    ${((scenarios.bull.nav * 0.25 + scenarios.base.nav * 0.5 + scenarios.bear.nav * 0.25)).toFixed(0)}M
                  </div>
                </div>
                <div>
                  <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Expected IRR</div>
                  <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>
                    {(scenarios.bull.irr * 0.25 + scenarios.base.irr * 0.5 + scenarios.bear.irr * 0.25).toFixed(1)}%
                  </div>
                </div>
                <div>
                  <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Expected TVPI</div>
                  <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>
                    {(scenarios.bull.tvpi * 0.25 + scenarios.base.tvpi * 0.5 + scenarios.bear.tvpi * 0.25).toFixed(2)}x
                  </div>
                </div>
              </div>
            </div>
          </Card>
        </div>
      )}

      {/* ════ EXIT PIPELINE ════ */}
      {subTab === 'exits' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
            <Stat label="IPO Candidates" value={PORTFOLIO_COMPANIES.filter(c=>c.exitPath.includes('IPO')).length} icon={Star} sub="next 36 months" color={T.gold} />
            <Stat label="M&A Targets" value={PORTFOLIO_COMPANIES.filter(c=>c.exitPath.includes('M&A')).length} icon={Target} sub="strategic interest" color={T.blue} />
            <Stat label="Est. Exit Proceeds" value="$142M" icon={DollarSign} sub="at current marks" color={T.accent} />
            <Stat label="Avg Time to Exit" value="2.4yr" icon={Clock} sub="from current vintage" color={T.purple} />
          </div>
          {Object.entries(exitPipeline).map(([year, companies]) => (
            <Card key={year} title={`${year} Exit Pipeline`} style={{ marginBottom: 12 }}>
              {companies.length === 0 ? (
                <div style={{ padding: 14, fontSize: 11, color: T.textDim }}>No exits currently projected for {year}</div>
              ) : (
                <div style={{ overflowX: 'auto' }}>
                  <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                    <thead><tr>{['Company', 'Sector', 'Exit Type', 'Valuation', 'Our Exposure', 'Est. Proceeds', 'Signal', 'Growth'].map(h => <TH key={h} align={['Company','Sector','Exit Type'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
                    <tbody>{companies.map(c => (
                      <TR key={c.id}>
                        <TD bold>{c.name}</TD>
                        <TD><Badge color={c.sector === 'AI Safety' ? T.accent : c.sector === 'GovTech' ? T.blue : T.purple}>{c.sector}</Badge></TD>
                        <TD><Badge color={c.exitPath.includes('IPO') ? T.gold : T.cyan}>{c.exitPath.split(' ')[0]}</Badge></TD>
                        <TD align="right" mono bold>${c.valuation >= 1000 ? `${(c.valuation/1000).toFixed(1)}B` : `${c.valuation}M`}</TD>
                        <TD align="right" mono color={T.textMuted}>{c.ownership}%</TD>
                        <TD align="right" mono bold color={T.accent}>${(c.valuation * c.ownership / 100).toFixed(1)}M</TD>
                        <TD align="right" mono bold color={c.signalScore >= 90 ? T.accent : T.blue}>{c.signalScore}</TD>
                        <TD align="right" mono color={T.green}>{c.growth}%</TD>
                      </TR>
                    ))}</tbody>
                  </table>
                </div>
              )}
            </Card>
          ))}
        </div>
      )}

      {/* ════ POWER LAW ════ */}
      {subTab === 'power' && (
        <div>
          <Card title="Power Law Distribution — Which Positions Drive Returns?">
            <div style={{ padding: 16 }}>
              <div style={{ fontSize: 10, color: T.textDim, marginBottom: 12, lineHeight: 1.6 }}>
                Venture follows a power law: a small number of positions drive the vast majority of returns. The top 3 companies represent {powerLaw[2]?.cumPct}% of total portfolio exposure.
              </div>
              {/* Visual bars */}
              {powerLaw.map((c, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 6 }}>
                  <span style={{ width: 20, fontSize: 10, fontFamily: mono, color: T.textDim, textAlign: 'right' }}>#{c.rank}</span>
                  <span style={{ width: 110, fontSize: 11, color: T.text, fontWeight: i < 3 ? 700 : 400, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{c.name}</span>
                  <div style={{ flex: 1, position: 'relative' }}>
                    <Bar value={parseFloat(c.pctOfTotal)} max={parseFloat(powerLaw[0].pctOfTotal)} color={i === 0 ? T.accent : i < 3 ? T.blue : i < 5 ? T.purple : T.textDim} h={16} />
                    <span style={{ position: 'absolute', left: 8, top: 2, fontSize: 9, fontFamily: mono, fontWeight: 700, color: i < 5 ? T.bg : T.textMuted }}>{c.pctOfTotal}%</span>
                  </div>
                  <span style={{ width: 55, fontSize: 10, fontFamily: mono, color: T.accent, textAlign: 'right' }}>${c.exposure.toFixed(1)}M</span>
                  <span style={{ width: 50, fontSize: 9, fontFamily: mono, color: T.textDim, textAlign: 'right' }}>cum {c.cumPct}%</span>
                </div>
              ))}
            </div>
          </Card>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginTop: 14 }}>
            <Card title="Pareto Analysis">
              <div style={{ padding: 14 }}>
                {[
                  { label: 'Top 1 company', pct: powerLaw[0]?.pctOfTotal, name: powerLaw[0]?.name },
                  { label: 'Top 3 companies', pct: powerLaw[2]?.cumPct, name: `${powerLaw[0]?.name}, ${powerLaw[1]?.name}, ${powerLaw[2]?.name}` },
                  { label: 'Top 5 companies', pct: powerLaw[4]?.cumPct, name: '5 of 12 positions' },
                  { label: 'Bottom 50%', pct: (100 - parseFloat(powerLaw[5]?.cumPct || 0)).toFixed(1), name: '6 positions combined' },
                ].map((p, i) => (
                  <div key={i} style={{ padding: '8px 0', borderBottom: i < 3 ? `1px solid ${T.border}06` : 'none' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 2 }}>
                      <span style={{ fontSize: 11, color: T.text }}>{p.label}</span>
                      <span style={{ fontSize: 13, fontWeight: 800, fontFamily: mono, color: T.accent }}>{p.pct}%</span>
                    </div>
                    <div style={{ fontSize: 9, color: T.textDim }}>{p.name}</div>
                  </div>
                ))}
              </div>
            </Card>
            <Card title="Return Concentration Insight">
              <div style={{ padding: 14 }}>
                <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.8 }}>
                  <strong style={{ color: T.accent }}>Key Finding:</strong> Portfolio exhibits classic VC power law distribution. Anthropic + Databricks alone represent {(parseFloat(powerLaw[0]?.pctOfTotal || 0) + parseFloat(powerLaw[1]?.pctOfTotal || 0)).toFixed(1)}% of exposure.
                </div>
                <div style={{ marginTop: 12, padding: 12, background: T.bgAccent, borderRadius: 6, border: `1px solid ${T.accent}20` }}>
                  <div style={{ fontSize: 10, color: T.accent, fontWeight: 700, marginBottom: 6 }}>RECOMMENDATION</div>
                  <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6 }}>
                    Consider increasing allocation to mid-tier positions (Shield AI, Crusoe Energy, Contextual AI) where signal scores are strong but exposure is underweight relative to conviction. Each could be a 10x position from current valuation.
                  </div>
                </div>
              </div>
            </Card>
          </div>
        </div>
      )}

      {/* ════ PACING ════ */}
      {subTab === 'pacing' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
            <Stat label="Total Committed" value={`$${pacing.totalCommitted}M`} icon={DollarSign} color={T.blue} />
            <Stat label="Capital Called" value={`$${pacing.totalCalled.toFixed(1)}M`} icon={Target} sub={`${pacing.actualPct}% deployed`} color={T.accent} />
            <Stat label="Target Pace" value={`${pacing.planPct}%`} icon={Clock} sub="planned deployment" color={T.amber} />
            <Stat label="Pace Variance" value={`${pacing.variance}%`} icon={AlertTriangle} sub={parseFloat(pacing.variance) < 0 ? 'behind plan' : 'ahead of plan'} color={parseFloat(pacing.variance) < 0 ? T.red : T.green} />
          </div>
          <Card title="Deployment Pacing by Vintage">
            <div style={{ overflowX: 'auto' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Vintage', 'Committed', 'Called', 'Deployed %', 'Target %', 'Variance', 'Uncalled', 'Status'].map(h => <TH key={h} align={h === 'Vintage' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
                <tbody>{pacing.byVintage.map(v => (
                  <TR key={v.vintage}>
                    <TD bold>{v.vintage}</TD>
                    <TD align="right" mono>${v.committed}M</TD>
                    <TD align="right" mono>${v.called.toFixed(1)}M</TD>
                    <TD align="right" mono bold color={T.accent}>{v.pct}%</TD>
                    <TD align="right" mono color={T.textMuted}>{v.target}%</TD>
                    <TD align="right" mono bold color={parseFloat(v.variance) >= 0 ? T.green : T.red}>{parseFloat(v.variance) >= 0 ? '+' : ''}{v.variance}%</TD>
                    <TD align="right" mono color={T.amber}>${(v.committed - v.called).toFixed(1)}M</TD>
                    <TD align="right"><Badge color={parseFloat(v.variance) >= -5 ? T.green : parseFloat(v.variance) >= -15 ? T.amber : T.red}>{parseFloat(v.variance) >= -5 ? 'On Track' : parseFloat(v.variance) >= -15 ? 'Watch' : 'Behind'}</Badge></TD>
                  </TR>
                ))}</tbody>
              </table>
            </div>
          </Card>
          {/* Visual Pacing */}
          <Card title="Visual Deployment Progress" style={{ marginTop: 14 }}>
            <div style={{ padding: 14 }}>
              {pacing.byVintage.map((v, i) => (
                <div key={i} style={{ marginBottom: 16 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>
                    <span style={{ fontSize: 12, fontWeight: 700, color: T.text }}>{v.vintage} Vintage</span>
                    <span style={{ fontSize: 11, fontFamily: mono, color: T.accent }}>{v.pct}% / {v.target}% target</span>
                  </div>
                  <div style={{ position: 'relative', height: 20, background: T.bgAccent, borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ position: 'absolute', height: '100%', width: `${v.pct}%`, background: parseFloat(v.variance) >= -5 ? T.accent : T.amber, borderRadius: 4, transition: 'width 0.5s' }} />
                    <div style={{ position: 'absolute', height: '100%', width: 2, left: `${v.target}%`, background: T.text, opacity: 0.5 }} />
                    <span style={{ position: 'absolute', right: 8, top: 3, fontSize: 10, fontFamily: mono, fontWeight: 700, color: T.bg }}>${v.called.toFixed(0)}M / ${v.committed}M</span>
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </div>
      )}

      {/* ════ MACRO SIGNALS ════ */}
      {subTab === 'macro' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>External Signal Intelligence — Impact on Portfolio & Strategy</div>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>
            {macroSignals.map((s, i) => (
              <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '14px 16px', borderLeft: `3px solid ${s.impact === 'positive' ? T.green : s.impact === 'negative' ? T.red : T.amber}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                    <span style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{s.signal}</span>
                    <Badge color={s.impact === 'positive' ? T.green : s.impact === 'negative' ? T.red : T.amber}>{s.impact}</Badge>
                  </div>
                  <span style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: s.direction === 'up' ? T.green : T.red }}>
                    {s.value} {s.direction === 'up' ? '↑' : '↓'}
                  </span>
                </div>
                <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.6, marginBottom: 8 }}>{s.detail}</div>
                <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                  <span style={{ fontSize: 9, color: T.textDim }}>RELEVANCE</span>
                  <Bar value={s.strength} max={100} color={s.strength >= 80 ? T.accent : s.strength >= 60 ? T.blue : T.textMuted} h={4} />
                  <span style={{ fontSize: 10, fontFamily: mono, fontWeight: 700, color: s.strength >= 80 ? T.accent : T.textMuted }}>{s.strength}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ════ VALUATION COHORTS ════ */}
      {subTab === 'cohorts' && (
        <div>
          {Object.entries(valCohorts).map(([bucket, companies]) => (
            <Card key={bucket} title={bucket} style={{ marginBottom: 12 }}>
              <div style={{ overflowX: 'auto' }}>
                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                  <thead><tr>{['Company', 'Revenue', 'Valuation', 'Rev Multiple', 'Growth', 'Employees', 'Rev/Employee', 'Signal'].map(h => <TH key={h} align={h === 'Company' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
                  <tbody>{companies.sort((a,b)=>b.revenue-a.revenue).map(c => (
                    <TR key={c.id}>
                      <TD bold>{c.name}</TD>
                      <TD align="right" mono bold>${c.revenue}M</TD>
                      <TD align="right" mono>${c.valuation >= 1000 ? `${(c.valuation/1000).toFixed(1)}B` : `${c.valuation}M`}</TD>
                      <TD align="right" mono bold color={T.accent}>{c.revMult}</TD>
                      <TD align="right" mono color={c.growth >= 200 ? T.accent : c.growth >= 100 ? T.green : T.text}>{c.growth}%</TD>
                      <TD align="right" mono color={T.textMuted}>{c.employees.toLocaleString()}</TD>
                      <TD align="right" mono color={T.blue}>${c.revenue > 0 ? ((c.revenue * 1000000 / c.employees) / 1000).toFixed(0) + 'K' : '—'}</TD>
                      <TD align="right" mono bold color={c.signalScore >= 90 ? T.accent : c.signalScore >= 80 ? T.blue : T.textMuted}>{c.signalScore}</TD>
                    </TR>
                  ))}</tbody>
                </table>
              </div>
            </Card>
          ))}
          <Card title="Cohort Insights" style={{ marginTop: 4 }}>
            <div style={{ padding: 14, display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 14 }}>
              <div style={{ padding: 12, background: T.bgAccent, borderRadius: 6 }}>
                <div style={{ fontSize: 10, color: T.accent, fontWeight: 700, marginBottom: 4 }}>SCALE COHORT</div>
                <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.6 }}>Avg {(PORTFOLIO_COMPANIES.filter(c=>c.revenue>=1000).reduce((s,c)=>s+(c.valuation/c.revenue),0)/PORTFOLIO_COMPANIES.filter(c=>c.revenue>=1000).length).toFixed(1)}x revenue multiple. Palantir anchors at public market multiples. Anthropic + Databricks trading at growth premium.</div>
              </div>
              <div style={{ padding: 12, background: T.bgAccent, borderRadius: 6 }}>
                <div style={{ fontSize: 10, color: T.blue, fontWeight: 700, marginBottom: 4 }}>GROWTH COHORT</div>
                <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.6 }}>Highest avg growth rate at {(PORTFOLIO_COMPANIES.filter(c=>c.revenue>=100&&c.revenue<1000).reduce((s,c)=>s+c.growth,0)/Math.max(PORTFOLIO_COMPANIES.filter(c=>c.revenue>=100&&c.revenue<1000).length,1)).toFixed(0)}%. These are the next IPO candidates. Revenue multiples compressing as companies approach public market standards.</div>
              </div>
              <div style={{ padding: 12, background: T.bgAccent, borderRadius: 6 }}>
                <div style={{ fontSize: 10, color: T.purple, fontWeight: 700, marginBottom: 4 }}>EARLY COHORT</div>
                <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.6 }}>Highest risk/reward. Contextual AI and Armada both showing 400%+ growth. Watch for product-market-fit inflection. Position sizing should stay below 5% of NAV per name.</div>
              </div>
            </div>
          </Card>
        </div>
      )}

      {/* ════ CROSS-FUND OVERLAP ════ */}
      {subTab === 'overlap' && (() => {
        const secs = [...new Set(PORTFOLIO_COMPANIES.map(c => c.sector))];
        const sectorPairs = [];
        for (let i = 0; i < secs.length; i++) {
          for (let j = i; j < secs.length; j++) {
            const cosI = PORTFOLIO_COMPANIES.filter(c => c.sector === secs[i]);
            const cosJ = PORTFOLIO_COMPANIES.filter(c => c.sector === secs[j]);
            const avgGI = cosI.reduce((s,c)=>s+c.growth,0)/cosI.length;
            const avgGJ = cosJ.reduce((s,c)=>s+c.growth,0)/cosJ.length;
            const corr = i === j ? 1.0 : Math.min(0.95, Math.max(-0.3, 1 - Math.abs(avgGI - avgGJ) / 400 + (secs[i].includes('AI') && secs[j].includes('AI') ? 0.35 : 0)));
            sectorPairs.push({ s1: secs[i], s2: secs[j], corr: parseFloat(corr.toFixed(2)) });
          }
        }
        const knownOverlaps = [
          { company: 'Databricks', funds: ['a16z Infra Fund', 'Sequoia US VIII'], totalExp: '$13.4M', risk: 'Double exposure at $62B valuation. Consider if both GPs mark identically.' },
          { company: 'Anduril', funds: ['Lux Capital VI', 'Founders Fund VI (secondary)'], totalExp: '$33.6M + secondary', risk: 'Largest single-name across primary + secondary. Monitor for IPO timing correlation.' },
          { company: 'Palantir', funds: ['NEA 19', 'Founders Fund VI (secondary)'], totalExp: '$5.4M + secondary', risk: 'Public stock — mark-to-market diverges from private fund marks.' },
          { company: 'AI Safety Theme', funds: ['Founders Fund VII', 'NEA 19', 'Lux Capital VI', 'Khosla IX'], totalExp: '48% of NAV', risk: 'Thematic concentration: regulatory change or AI winter impacts all positions simultaneously.' },
        ];
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="Cross-Fund Overlaps" value={knownOverlaps.length} icon={AlertTriangle} sub="detected exposures" color={T.amber} />
              <Stat label="Avg Sector Correlation" value={(sectorPairs.filter(p=>p.s1!==p.s2).reduce((s,p)=>s+p.corr,0)/Math.max(sectorPairs.filter(p=>p.s1!==p.s2).length,1)).toFixed(2)} icon={Activity} color={T.purple} />
              <Stat label="Unique Companies" value={PORTFOLIO_COMPANIES.length} icon={Building2} sub={`across ${FUNDS.length} funds`} color={T.blue} />
              <Stat label="Max Single-Name" value="7.2%" icon={Eye} sub="Anthropic" color={T.red} />
            </div>
            <Card title="Cross-Fund Overlap Alerts" style={{ marginBottom: 14 }}>
              <div style={{ padding: 0 }}>{knownOverlaps.map((o, i) => (
                <div key={i} style={{ padding: '14px 16px', borderBottom: i < knownOverlaps.length - 1 ? `1px solid ${T.border}` : 'none', display: 'flex', gap: 14 }}>
                  <div style={{ width: 6, height: 6, borderRadius: '50%', background: T.amber, marginTop: 6, flexShrink: 0 }} />
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                      <span style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{o.company}</span>
                      <span style={{ fontSize: 12, fontFamily: mono, fontWeight: 700, color: T.accent }}>{o.totalExp}</span>
                    </div>
                    <div style={{ display: 'flex', gap: 4, marginBottom: 5, flexWrap: 'wrap' }}>{o.funds.map(f => <Badge key={f} color={T.blue}>{f}</Badge>)}</div>
                    <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.6 }}>{o.risk}</div>
                  </div>
                </div>
              ))}</div>
            </Card>
            <Card title="Sector Correlation Matrix">
              <div style={{ padding: 16 }}>
                <div style={{ display: 'grid', gridTemplateColumns: `100px repeat(${secs.length}, 1fr)`, gap: 2 }}>
                  <div />{secs.map(s => <div key={s} style={{ fontSize: 8, color: T.textMuted, textAlign: 'center', fontWeight: 700, padding: 4, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{s}</div>)}
                  {secs.map(s1 => (<React.Fragment key={s1}>
                    <div style={{ fontSize: 9, color: T.textMuted, fontWeight: 600, display: 'flex', alignItems: 'center' }}>{s1}</div>
                    {secs.map(s2 => {
                      const pair = sectorPairs.find(p => (p.s1 === s1 && p.s2 === s2) || (p.s1 === s2 && p.s2 === s1));
                      const corr = pair ? pair.corr : 0;
                      const bg = corr >= 0.8 ? T.red : corr >= 0.5 ? T.amber : corr >= 0.2 ? T.blue : T.accent;
                      return <div key={`${s1}-${s2}`} style={{ background: `${bg}${Math.floor(Math.abs(corr) * 40 + 10).toString(16)}`, border: `1px solid ${bg}30`, borderRadius: 3, padding: 6, textAlign: 'center', fontSize: 11, fontFamily: mono, fontWeight: 700, color: corr >= 0.7 ? T.text : T.textMuted }}>{corr.toFixed(2)}</div>;
                    })}
                  </React.Fragment>))}
                </div>
              </div>
            </Card>
            <Card title="Fund-Level Sector Exposure" style={{ marginTop: 14 }}>
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr><TH>Fund</TH>{secs.map(s => <TH key={s} align="right">{s}</TH>)}<TH align="right">Cos</TH></tr></thead>
                <tbody>{FUNDS.map(f => { const cos = PORTFOLIO_COMPANIES.filter(c => c.fund === f.name); return (
                  <TR key={f.id}><TD bold>{f.name.split(' ').slice(0,2).join(' ')}</TD>
                    {secs.map(s => { const exp = cos.filter(c=>c.sector===s).reduce((sum,c) => sum+(c.valuation*c.ownership/100),0); return <TD key={s} align="right" mono color={exp > 0 ? T.accent : T.textDim}>{exp > 0 ? `$${exp.toFixed(1)}M` : '—'}</TD>; })}
                    <TD align="right" mono color={T.textMuted}>{cos.length}</TD></TR>
                ); })}</tbody>
              </table></div>
            </Card>
          </div>
        );
      })()}

      {/* ════ BENCHMARK ════ */}
      {subTab === 'benchmark' && (() => {
        const benchmarks = [
          { name: 'NEWCO Portfolio', vintage: 'Blended', tvpi: 1.46, irr: 23.1, dpi: 0.28, rvpi: 1.18, pme: 1.32, quartile: 'Q1', color: T.accent },
          { name: 'Cambridge US VC', vintage: '2022-24', tvpi: 1.22, irr: 14.8, dpi: 0.15, rvpi: 1.07, pme: 1.08, quartile: 'Median', color: T.textMuted },
          { name: 'CA Upper Quartile', vintage: '2022-24', tvpi: 1.58, irr: 28.5, dpi: 0.32, rvpi: 1.26, pme: 1.45, quartile: 'Q1', color: T.blue },
          { name: 'CA Top Decile', vintage: '2022-24', tvpi: 2.15, irr: 42.0, dpi: 0.52, rvpi: 1.63, pme: 1.88, quartile: 'Top 10%', color: T.gold },
          { name: 'Pitchbook US VC', vintage: '2022-24', tvpi: 1.18, irr: 12.2, dpi: 0.12, rvpi: 1.06, pme: 1.02, quartile: 'Median', color: T.textDim },
          { name: 'S&P 500 (PME)', vintage: 'Same period', tvpi: 1.14, irr: 11.2, dpi: 1.14, rvpi: 0, pme: 1.0, quartile: 'Public', color: T.purple },
          { name: 'Preqin VC FoF', vintage: '2022-24', tvpi: 1.12, irr: 9.8, dpi: 0.08, rvpi: 1.04, pme: 0.95, quartile: 'Median', color: T.textDim },
        ];
        const vintageBreakdown = [
          { vintage: 2022, newco: { tvpi: 1.85, irr: 24.6 }, ca: { tvpi: 1.35, irr: 16.2 }, percentile: 82 },
          { vintage: 2023, newco: { tvpi: 1.50, irr: 24.6 }, ca: { tvpi: 1.18, irr: 13.5 }, percentile: 78 },
          { vintage: 2024, newco: { tvpi: 1.27, irr: 21.8 }, ca: { tvpi: 1.08, irr: 10.1 }, percentile: 85 },
        ];
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="Blended TVPI" value="1.46x" icon={BarChart3} sub="vs 1.22x CA median" color={T.accent} />
              <Stat label="Blended IRR" value="23.1%" icon={TrendingUp} sub="vs 14.8% CA median" color={T.green} />
              <Stat label="PME Ratio" value="1.32x" icon={Target} sub="vs S&P 500" color={T.blue} />
              <Stat label="Quartile Rank" value="Q1" icon={Award} sub="upper quartile" color={T.gold} />
              <Stat label="Percentile" value="81st" icon={Star} sub="blended vintage" color={T.purple} />
            </div>
            <Card title="Benchmark Comparison Table" style={{ marginBottom: 14 }}>
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Benchmark', 'Vintage', 'TVPI', 'IRR', 'DPI', 'RVPI', 'PME', 'Quartile'].map(h => <TH key={h} align={h==='Benchmark'||h==='Vintage'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{benchmarks.map((b, i) => (
                  <TR key={i}><TD bold color={b.color}>{b.name}</TD><TD color={T.textMuted}>{b.vintage}</TD>
                    <TD align="right" mono bold color={b.tvpi>=1.4?T.accent:T.text}>{b.tvpi}x</TD>
                    <TD align="right" mono bold color={b.irr>=20?T.accent:b.irr>=14?T.text:T.textMuted}>{b.irr}%</TD>
                    <TD align="right" mono color={T.textMuted}>{b.dpi}x</TD><TD align="right" mono color={T.textMuted}>{b.rvpi}x</TD>
                    <TD align="right" mono bold color={b.pme>=1.2?T.accent:b.pme>=1.0?T.text:T.red}>{b.pme}x</TD>
                    <TD align="right"><Badge color={b.quartile==='Q1'?T.accent:b.quartile==='Top 10%'?T.gold:T.textMuted}>{b.quartile}</Badge></TD></TR>
                ))}</tbody>
              </table></div>
            </Card>
            <Card title="Percentile Rank by Vintage (vs Cambridge Associates)">
              <div style={{ padding: 16 }}>{vintageBreakdown.map((v, i) => (
                <div key={i} style={{ marginBottom: 16 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>
                    <span style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{v.vintage}</span>
                    <span style={{ fontSize: 11, fontFamily: mono }}><span style={{ color: T.textDim }}>NEWCO</span> <span style={{ color: T.accent, fontWeight: 700 }}>{v.newco.tvpi}x / {v.newco.irr}%</span> <span style={{ color: T.textDim, marginLeft: 8 }}>CA</span> <span style={{ color: T.textMuted }}>{v.ca.tvpi}x / {v.ca.irr}%</span></span>
                  </div>
                  <div style={{ position: 'relative', height: 28, background: T.bgAccent, borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ position: 'absolute', height: '100%', width: `${v.percentile}%`, background: `linear-gradient(90deg, ${T.accent}40, ${T.accent})`, borderRadius: 4 }} />
                    {[25,50,75].map(q => <div key={q} style={{ position: 'absolute', left: `${q}%`, height: '100%', width: 1, background: T.textDim, opacity: 0.3 }} />)}
                    <span style={{ position: 'absolute', right: 10, top: 6, fontSize: 12, fontFamily: mono, fontWeight: 800, color: T.bg }}>{v.percentile}th pctl</span>
                  </div>
                </div>
              ))}</div>
            </Card>
            <Card title="Public Market Equivalent — NEWCO vs Alternatives" style={{ marginTop: 14 }}>
              <div style={{ padding: 16, display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 14 }}>
                {[{ label: 'vs S&P 500', value: '+32%', detail: 'PME 1.32x', color: T.accent, bg: T.accentBg },
                  { label: 'vs NASDAQ', value: '+18%', detail: 'Tech outperformance', color: T.blue, bg: T.blueBg },
                  { label: 'vs VC FoF Median', value: '+46%', detail: 'TVPI 1.46x vs 1.12x', color: T.purple, bg: T.purpleBg }].map(p => (
                  <div key={p.label} style={{ padding: 14, background: p.bg, borderRadius: 6, border: `1px solid ${p.color}25`, textAlign: 'center' }}>
                    <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>{p.label}</div>
                    <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: p.color }}>{p.value}</div>
                    <div style={{ fontSize: 10, color: T.textMuted }}>{p.detail}</div>
                  </div>
                ))}
              </div>
            </Card>
          </div>
        );
      })()}

      {/* ════ SENSITIVITY ════ */}
      {subTab === 'sensitivity' && (() => {
        const baseNAV = FUNDS.reduce((s,f) => s + f.nav, 0);
        const exitMultiples = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0, 3.0];
        const ipoDiscounts = [0, 10, 20, 30, 40];
        const topCos = [...PORTFOLIO_COMPANIES].sort((a,b) => (b.valuation*b.ownership) - (a.valuation*a.ownership)).slice(0, 5);
        const paceSensitivity = [
          { pace: 'Aggressive (90% by Q2 26)', irr: 26.8, tvpi: 1.62, risk: 'High concentration, limited dry powder' },
          { pace: 'Current (65% deployed)', irr: 23.1, tvpi: 1.46, risk: 'Balanced — on plan' },
          { pace: 'Conservative (45% deployed)', irr: 19.2, tvpi: 1.28, risk: 'Cash drag, missing vintage window' },
          { pace: 'Defensive (30% deployed)', irr: 14.5, tvpi: 1.12, risk: 'Significant cash drag, LP dissatisfaction' },
        ];
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="Base NAV" value={`$${baseNAV.toFixed(1)}M`} icon={Target} color={T.blue} />
              <Stat label="Bull 2x Exit" value={`$${(baseNAV * 1.8).toFixed(0)}M`} icon={TrendingUp} color={T.accent} />
              <Stat label="Bear 0.7x Exit" value={`$${(baseNAV * 0.7).toFixed(0)}M`} icon={AlertTriangle} color={T.red} />
              <Stat label="Breakeven" value="0.68x" icon={Shield} sub="on remaining" color={T.amber} />
            </div>
            <Card title="NAV Sensitivity to Exit Multiple (Top 5)" style={{ marginBottom: 14 }}>
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr><TH>Company</TH><TH align="right">Current</TH>{exitMultiples.map(m => <TH key={m} align="right">{m}x</TH>)}</tr></thead>
                <tbody>{topCos.map(c => { const cur = c.valuation * c.ownership / 100; return (
                  <TR key={c.id}><TD bold>{c.name}</TD><TD align="right" mono bold color={T.accent}>${cur.toFixed(1)}M</TD>
                    {exitMultiples.map(m => <TD key={m} align="right" mono bold color={m>1?T.green:m<1?T.red:T.text}>${(cur*m).toFixed(1)}M</TD>)}
                  </TR>); })}
                <tr style={{ borderTop: `2px solid ${T.border}` }}>
                  <TD bold color={T.accent}>TOTAL</TD><TD align="right" mono bold color={T.accent}>${topCos.reduce((s,c) => s + c.valuation*c.ownership/100, 0).toFixed(1)}M</TD>
                  {exitMultiples.map(m => <TD key={m} align="right" mono bold color={m>1?T.accent:T.red}>${topCos.reduce((s,c) => s + c.valuation*c.ownership/100*m, 0).toFixed(0)}M</TD>)}
                </tr></tbody>
              </table></div>
            </Card>
            <Card title="IPO Discount Sensitivity" style={{ marginBottom: 14 }}>
              <div style={{ padding: 16, display: 'grid', gridTemplateColumns: `repeat(${ipoDiscounts.length}, 1fr)`, gap: 8 }}>
                {ipoDiscounts.map(disc => {
                  const ipoExp = PORTFOLIO_COMPANIES.filter(c => c.exitPath.includes('IPO')).reduce((s,c) => s + c.valuation * c.ownership / 100, 0);
                  const loss = ipoExp * (disc / 100);
                  return (
                    <div key={disc} style={{ padding: 12, borderRadius: 6, background: disc === 0 ? T.accentBg : disc <= 20 ? T.bgAccent : T.redBg, border: `1px solid ${disc === 0 ? T.accent : disc <= 20 ? T.border : T.red}30`, textAlign: 'center' }}>
                      <div style={{ fontSize: 9, color: T.textDim, marginBottom: 4 }}>{disc}% DISCOUNT</div>
                      <div style={{ fontSize: 20, fontWeight: 900, fontFamily: mono, color: disc === 0 ? T.accent : disc <= 20 ? T.text : T.red }}>${(baseNAV-loss).toFixed(0)}M</div>
                      <div style={{ fontSize: 10, fontFamily: mono, color: disc === 0 ? T.accent : T.red }}>{disc === 0 ? 'Base' : `-$${loss.toFixed(0)}M`}</div>
                    </div>
                  );
                })}
              </div>
            </Card>
            <Card title="IRR Sensitivity to Deployment Pace">
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Strategy', 'IRR', 'TVPI', 'Risk'].map(h => <TH key={h} align={h==='Strategy'||h==='Risk'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{paceSensitivity.map((p, i) => (
                  <TR key={i}><TD bold color={i===1?T.accent:T.text}>{p.pace}{i===1?' ●':''}</TD>
                    <TD align="right" mono bold color={p.irr>=23?T.accent:p.irr>=18?T.blue:T.amber}>{p.irr}%</TD>
                    <TD align="right" mono bold color={p.tvpi>=1.4?T.accent:T.text}>{p.tvpi}x</TD>
                    <TD color={T.textMuted}>{p.risk}</TD></TR>
                ))}</tbody>
              </table></div>
            </Card>
          </div>
        );
      })()}

      {/* ════ FEE ANALYSIS ════ */}
      {subTab === 'fees' && (() => {
        const aum = 235;
        const years = [1, 3, 5, 7, 10];
        const grossReturn = 0.23;
        const structures = [
          { name: 'NEWCO (Zero Mgmt Fee)', mgmt: 0, perf: 10, hurdle: 8, color: T.accent },
          { name: 'Typical VC FoF', mgmt: 1.0, perf: 10, hurdle: 8, color: T.textMuted },
          { name: 'Typical Direct VC', mgmt: 2.0, perf: 20, hurdle: 0, color: T.amber },
          { name: 'Listed BDC (avg)', mgmt: 1.75, perf: 20, hurdle: 7, color: T.red },
          { name: 'PE Fund (avg)', mgmt: 2.0, perf: 20, hurdle: 8, color: T.purple },
        ];
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="NEWCO Mgmt Fee" value="0.00%" icon={Award} sub="zero management fee" color={T.accent} />
              <Stat label="Annual Fee Savings" value={`$${(aum * 0.015).toFixed(1)}M`} icon={DollarSign} sub="vs 1.5% industry avg" color={T.green} />
              <Stat label="10-Year Savings" value={`$${(aum * 0.015 * 10 * 1.3).toFixed(0)}M`} icon={TrendingUp} sub="compounded" color={T.accent} />
              <Stat label="Net-of-Fee Alpha" value="+340bps" icon={Zap} sub="vs traditional FoF" color={T.gold} />
            </div>
            <Card title="Cumulative Fee Drag ($235M AUM, 23% Gross IRR)" style={{ marginBottom: 14 }}>
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr><TH>Structure</TH><TH align="right">Mgmt</TH><TH align="right">Carry</TH><TH align="right">Hurdle</TH>{years.map(y => <TH key={y} align="right">Yr {y}</TH>)}<TH align="right">Net IRR</TH></tr></thead>
                <tbody>{structures.map((s, i) => {
                  const netIRR = grossReturn - (s.mgmt/100) - (Math.max(0, grossReturn - s.hurdle/100) * s.perf/100);
                  return (
                    <TR key={i}><TD bold color={s.color}>{s.name}</TD>
                      <TD align="right" mono bold color={s.mgmt===0?T.accent:T.text}>{s.mgmt}%</TD>
                      <TD align="right" mono color={T.textMuted}>{s.perf}%</TD><TD align="right" mono color={T.textMuted}>{s.hurdle}%</TD>
                      {years.map(y => { const drag = aum*(s.mgmt/100)*y + Math.max(0, aum*Math.pow(1+grossReturn,y)-aum - aum*(s.hurdle/100)*y)*(s.perf/100); return <TD key={y} align="right" mono color={drag<1?T.accent:T.red}>${drag.toFixed(1)}M</TD>; })}
                      <TD align="right" mono bold color={netIRR>=0.2?T.accent:netIRR>=0.15?T.text:T.amber}>{(netIRR*100).toFixed(1)}%</TD></TR>
                  );
                })}</tbody>
              </table></div>
            </Card>
            <Card title="$1M Invested: Net Value After 10 Years">
              <div style={{ padding: 16 }}>
                {structures.map((s, i) => {
                  const netIRR = grossReturn - (s.mgmt/100) - (Math.max(0, grossReturn - s.hurdle/100) * s.perf/100);
                  const finalVal = Math.pow(1 + netIRR, 10);
                  const maxVal = structures.reduce((max, st) => { const ir = grossReturn-(st.mgmt/100)-(Math.max(0,grossReturn-st.hurdle/100)*st.perf/100); return Math.max(max, Math.pow(1+ir,10)); }, 0);
                  return (
                    <div key={i} style={{ marginBottom: 10 }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                        <span style={{ fontSize: 11, color: s.color, fontWeight: i===0?700:400 }}>{s.name}</span>
                        <span style={{ fontSize: 13, fontWeight: 800, fontFamily: mono, color: s.color }}>${finalVal.toFixed(2)}M</span>
                      </div>
                      <Bar value={finalVal} max={maxVal} color={s.color} h={i===0?14:8} />
                    </div>
                  );
                })}
                <div style={{ marginTop: 14, padding: 12, background: T.accentBg, borderRadius: 6, border: `1px solid ${T.accent}25` }}>
                  <div style={{ fontSize: 10, color: T.accent, fontWeight: 700, marginBottom: 4 }}>ZERO-FEE ADVANTAGE</div>
                  <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6 }}>Over 10 years, NEWCO saves ${(aum*0.015*10*1.3).toFixed(0)}M in cumulative fee drag vs a typical VC FoF — equivalent to {((aum*0.015*10*1.3)/aum*100).toFixed(0)}% higher net return.</div>
                </div>
              </div>
            </Card>
          </div>
        );
      })()}

      {/* ════ MONTE CARLO ════ */}
      {subTab === 'montecarlo' && (() => {
        const simResults = (() => {
          const paths = [];
          const bNAV = FUNDS.reduce((s,f) => s + f.nav, 0);
          for (let i = 0; i < 200; i++) {
            const u1 = Math.random(); const u2 = Math.random();
            const z = Math.sqrt(-2 * Math.log(Math.max(u1, 0.001))) * Math.cos(2 * Math.PI * u2);
            const annRet = 0.22 + z * 0.15;
            const fiveYr = Math.pow(1 + annRet, 5);
            paths.push({ nav: bNAV * fiveYr, irr: annRet * 100, tvpi: fiveYr });
          }
          paths.sort((a, b) => a.nav - b.nav);
          const p = (pct) => paths[Math.floor(pct / 100 * (paths.length-1))];
          return { paths, p5: p(5), p10: p(10), p25: p(25), p50: p(50), p75: p(75), p90: p(90), p95: p(95),
            mean: { nav: paths.reduce((s,p)=>s+p.nav,0)/paths.length, tvpi: paths.reduce((s,p)=>s+p.tvpi,0)/paths.length },
            probAbove2x: (paths.filter(p=>p.tvpi>=2).length/paths.length*100).toFixed(0),
            probAbove3x: (paths.filter(p=>p.tvpi>=3).length/paths.length*100).toFixed(0),
            probLoss: (paths.filter(p=>p.tvpi<1).length/paths.length*100).toFixed(0) };
        })();
        const buckets = [
          { label: '<0.5x', min: 0, max: 0.5 }, { label: '0.5-1x', min: 0.5, max: 1 },
          { label: '1-1.5x', min: 1, max: 1.5 }, { label: '1.5-2x', min: 1.5, max: 2 },
          { label: '2-2.5x', min: 2, max: 2.5 }, { label: '2.5-3x', min: 2.5, max: 3 },
          { label: '3-4x', min: 3, max: 4 }, { label: '4x+', min: 4, max: 100 },
        ].map(r => ({ ...r, count: simResults.paths.filter(p=>p.tvpi>=r.min&&p.tvpi<r.max).length, pct: (simResults.paths.filter(p=>p.tvpi>=r.min&&p.tvpi<r.max).length/simResults.paths.length*100).toFixed(1) }));
        const maxB = Math.max(...buckets.map(b=>b.count));
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="Median" value={`${simResults.p50.tvpi.toFixed(2)}x`} icon={Target} sub={`$${simResults.p50.nav.toFixed(0)}M`} color={T.blue} />
              <Stat label="Mean" value={`${simResults.mean.tvpi.toFixed(2)}x`} icon={BarChart3} sub={`$${simResults.mean.nav.toFixed(0)}M`} color={T.accent} />
              <Stat label="P(>2x)" value={`${simResults.probAbove2x}%`} icon={TrendingUp} color={T.green} />
              <Stat label="P(>3x)" value={`${simResults.probAbove3x}%`} icon={Star} color={T.gold} />
              <Stat label="P(Loss)" value={`${simResults.probLoss}%`} icon={Shield} sub="TVPI<1x" color={parseInt(simResults.probLoss)>10?T.red:T.green} />
            </div>
            <Card title="TVPI Distribution — 200 Simulated 5-Year Paths" style={{ marginBottom: 14 }}>
              <div style={{ padding: '16px 18px' }}>
                <div style={{ display: 'flex', alignItems: 'flex-end', gap: 4, height: 160, marginBottom: 6 }}>
                  {buckets.map((b, i) => (
                    <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 3 }}>
                      <span style={{ fontSize: 9, fontFamily: mono, color: T.textMuted, fontWeight: 600 }}>{b.pct}%</span>
                      <div style={{ width: '85%', height: `${(b.count/maxB)*130}px`, background: b.min>=2?T.accent:b.min>=1?T.blue:T.red, borderRadius: '3px 3px 0 0', opacity: 0.75, minHeight: b.count>0?4:0 }} />
                    </div>
                  ))}
                </div>
                <div style={{ display: 'flex', gap: 4 }}>{buckets.map((b,i) => <div key={i} style={{ flex: 1, textAlign: 'center', fontSize: 8, color: T.textDim, fontFamily: mono }}>{b.label}</div>)}</div>
              </div>
            </Card>
            <Card title="Outcome Percentiles">
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Percentile', 'TVPI', 'NAV', 'Interpretation'].map(h => <TH key={h} align={h==='Interpretation'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{[
                  { label: '95th (Bull)', ...simResults.p95, interp: 'AI supercycle — multiple IPOs at premium' },
                  { label: '75th (Q1)', ...simResults.p75, interp: 'Thesis validated — 3+ successful exits' },
                  { label: '50th (Median)', ...simResults.p50, interp: 'Base case — steady appreciation' },
                  { label: '25th (Q3)', ...simResults.p25, interp: 'Delayed exits, some markdowns' },
                  { label: '5th (Bear)', ...simResults.p5, interp: 'AI winter + market crash' },
                ].map((p, i) => (
                  <TR key={i}><TD align="right" bold color={i<=1?T.accent:i===2?T.blue:T.red}>{p.label}</TD>
                    <TD align="right" mono bold color={p.tvpi>=2?T.accent:p.tvpi>=1?T.text:T.red}>{p.tvpi.toFixed(2)}x</TD>
                    <TD align="right" mono bold>${p.nav.toFixed(0)}M</TD>
                    <TD color={T.textMuted}>{p.interp}</TD></TR>
                ))}</tbody>
              </table></div>
            </Card>
          </div>
        );
      })()}

      {/* ════ DPI FORECAST ════ */}
      {subTab === 'dpi' && (() => {
        const totalCommitted = FUNDS.reduce((s,f)=>s+f.committed,0);
        const dpiTimeline = [
          { period: 'Q1 2026', event: 'NEA 19 — Palantir secondary sale', proceeds: 8.2, cumDPI: 0.034, source: 'Public stock liquidation' },
          { period: 'Q2 2026', event: 'Benchmark X — Verkada partial', proceeds: 4.1, cumDPI: 0.051, source: 'Secondary to growth fund' },
          { period: 'Q3 2026', event: 'NEA 19 — Robust Intel M&A', proceeds: 6.8, cumDPI: 0.080, source: 'Acquisition (CrowdStrike est.)' },
          { period: 'Q4 2026', event: 'Anduril IPO (partial)', proceeds: 12.5, cumDPI: 0.132, source: 'IPO lock-up release' },
          { period: 'Q1 2027', event: 'Databricks IPO', proceeds: 18.0, cumDPI: 0.207, source: 'IPO + secondary' },
          { period: 'Q2 2027', event: 'Anthropic IPO (partial)', proceeds: 22.0, cumDPI: 0.299, source: 'Largest single distribution' },
          { period: 'Q3 2027', event: 'Contextual AI M&A', proceeds: 8.5, cumDPI: 0.334, source: 'Strategic (Google/MSFT est.)' },
          { period: 'Q4 2027', event: 'Scale AI IPO + secondaries', proceeds: 15.0, cumDPI: 0.397, source: 'IPO + LP secondaries' },
          { period: 'H1 2028', event: 'Shield AI IPO + tail', proceeds: 28.0, cumDPI: 0.514, source: 'IPO + remaining' },
          { period: 'H2 2028', event: 'Final distributions', proceeds: 35.0, cumDPI: 0.660, source: 'Wind-down distributions' },
        ];
        const totalProceeds = dpiTimeline.reduce((s,d) => s + d.proceeds, 0);
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="Current DPI" value="0.28x" icon={DollarSign} sub={`$${(totalCommitted*0.28).toFixed(1)}M returned`} color={T.blue} />
              <Stat label="Total Distributions" value={`$${totalProceeds.toFixed(0)}M`} icon={TrendingUp} sub="through 2028" color={T.accent} />
              <Stat label="Target DPI" value="0.66x" icon={Target} sub="by end 2028" color={T.green} />
              <Stat label="First Major Exit" value="Q4 2026" icon={Star} sub="Anduril IPO" color={T.gold} />
              <Stat label="Peak Year" value="2027" icon={Zap} sub="$63.5M projected" color={T.purple} />
            </div>
            <Card title="Distribution Realization Timeline" style={{ marginBottom: 14 }}>
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Period', 'Event', 'Proceeds', 'Cum DPI', 'Source'].map(h => <TH key={h} align={['Period','Event','Source'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{dpiTimeline.map((d, i) => (
                  <TR key={i}><TD mono bold>{d.period}</TD><TD bold>{d.event}</TD>
                    <TD align="right" mono bold color={T.accent}>${d.proceeds}M</TD>
                    <TD align="right" mono bold color={d.cumDPI>=0.3?T.accent:d.cumDPI>=0.1?T.blue:T.textMuted}>{d.cumDPI.toFixed(3)}x</TD>
                    <TD color={T.textMuted}>{d.source}</TD></TR>
                ))}</tbody>
              </table></div>
            </Card>
            <Card title="Cumulative DPI Trajectory">
              <div style={{ padding: '16px 18px', display: 'flex', alignItems: 'flex-end', gap: 6, height: 200 }}>
                {dpiTimeline.map((d, i) => (
                  <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 3 }}>
                    <span style={{ fontSize: 8, fontFamily: mono, color: T.accent, fontWeight: 700 }}>{d.cumDPI.toFixed(2)}x</span>
                    <div style={{ width: '80%', height: `${(d.cumDPI/0.7)*150}px`, background: `linear-gradient(180deg, ${T.accent}, ${T.blue})`, borderRadius: '3px 3px 0 0', opacity: 0.7 }} />
                    <span style={{ fontSize: 7, color: T.textDim, fontFamily: mono, textAlign: 'center', lineHeight: 1.2 }}>{d.period}</span>
                  </div>
                ))}
              </div>
            </Card>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12, marginTop: 14 }}>
              {[{ year: 2026, color: T.blue }, { year: 2027, color: T.accent }, { year: 2028, color: T.purple }].map(y => {
                const total = dpiTimeline.filter(d=>d.period.includes(String(y.year))).reduce((s,d)=>s+d.proceeds,0);
                const events = dpiTimeline.filter(d=>d.period.includes(String(y.year))).length;
                return <div key={y.year} style={{ background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${y.color}`, padding: 16, textAlign: 'center' }}>
                  <div style={{ fontSize: 24, fontWeight: 900, color: y.color }}>{y.year}</div>
                  <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.text }}>${total.toFixed(1)}M</div>
                  <div style={{ fontSize: 10, color: T.textMuted, marginTop: 4 }}>{events} events</div>
                </div>;
              })}
            </div>
          </div>
        );
      })()}

      {/* ════ TEAM ATTRIBUTION ════ */}
      {subTab === 'team' && (() => {
        const teamMetrics = TEAM.map(t => {
          const firstName = t.name.split(' ')[0];
          const ownedPipeline = PIPELINE.filter(p => p.owner === firstName);
          const avgScore = ownedPipeline.length > 0 ? (ownedPipeline.reduce((s,p)=>s+p.score,0)/ownedPipeline.length).toFixed(0) : 0;
          const ownedLPs = LPS.filter(l => l.relationship === firstName);
          const lpCapital = ownedLPs.reduce((s,l) => s + parseInt(l.potential), 0);
          const ownerMap = { Ken: [1,2,6], Jason: [3,7], Bob: [4,8], Brett: [5], Matthew: [] };
          const managedFunds = FUNDS.filter(f => (ownerMap[firstName]||[]).includes(f.id));
          const fundNAV = managedFunds.reduce((s,f)=>s+f.nav,0);
          const fundIRR = managedFunds.length > 0 ? (managedFunds.reduce((s,f)=>s+f.irr,0)/managedFunds.length).toFixed(1) : '—';
          const convRates = { Jason: 34, Ken: 42, Bob: 28, Matthew: 22, Brett: 18 };
          const velocity = { Jason: 8.2, Ken: 6.5, Bob: 9.1, Matthew: 12.3, Brett: 14.8 };
          return { ...t, ownedPipeline: ownedPipeline.length, avgScore, ownedLPs: ownedLPs.length, lpCapital, fundNAV, fundIRR, managedFunds: managedFunds.length, conversionRate: convRates[firstName]||0, dealVelocity: velocity[firstName]||0 };
        });
        return (
          <div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 14 }}>
              <Stat label="Total Pipeline" value={PIPELINE.length} icon={GitBranch} sub={`$${PIPELINE.reduce((s,p)=>s+p.size,0).toLocaleString()}M`} color={T.blue} />
              <Stat label="Avg Deal Score" value={(PIPELINE.reduce((s,p)=>s+p.score,0)/PIPELINE.length).toFixed(0)} icon={Target} color={T.accent} />
              <Stat label="Best Conversion" value={`${Math.max(...teamMetrics.map(t=>t.conversionRate))}%`} icon={TrendingUp} sub={teamMetrics.find(t=>t.conversionRate===Math.max(...teamMetrics.map(x=>x.conversionRate)))?.name.split(' ')[0]} color={T.green} />
              <Stat label="LP Capital Sourced" value={`$${teamMetrics.reduce((s,t)=>s+t.lpCapital,0)}M`} icon={Users} color={T.gold} />
              <Stat label="Network Total" value={TEAM.reduce((s,t)=>s+t.connections,0)} icon={Globe} color={T.purple} />
            </div>
            <Card title="Team Performance Scorecard" style={{ marginBottom: 14 }}>
              <div style={{ overflowX: 'auto' }}><table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead><tr>{['Partner', 'Role', 'Pipeline', 'Avg Score', 'Conv %', 'Velocity', 'LPs', 'LP $', 'Fund NAV', 'IRR', 'Network', 'Deals'].map(h => <TH key={h} align={h==='Partner'||h==='Role'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{teamMetrics.sort((a,b)=>b.fundNAV-a.fundNAV).map(t => (
                  <TR key={t.id}><TD bold>{t.name}</TD><TD><Badge color={T.accent}>{t.role}</Badge></TD>
                    <TD align="right" mono>{t.ownedPipeline}</TD>
                    <TD align="right" mono bold color={t.avgScore>=90?T.accent:t.avgScore>=80?T.blue:T.textMuted}>{t.avgScore}</TD>
                    <TD align="right" mono bold color={t.conversionRate>=35?T.accent:t.conversionRate>=25?T.green:T.textMuted}>{t.conversionRate}%</TD>
                    <TD align="right" mono color={t.dealVelocity<=8?T.accent:T.textMuted}>{t.dealVelocity}d</TD>
                    <TD align="right" mono>{t.ownedLPs}</TD>
                    <TD align="right" mono bold color={T.gold}>${t.lpCapital}M</TD>
                    <TD align="right" mono bold color={t.fundNAV>0?T.accent:T.textDim}>{t.fundNAV>0?`$${t.fundNAV.toFixed(1)}M`:'—'}</TD>
                    <TD align="right" mono bold color={parseFloat(t.fundIRR)>=25?T.accent:T.text}>{t.fundIRR}%</TD>
                    <TD align="right" mono color={T.purple}>{t.connections}</TD>
                    <TD align="right" mono color={T.textMuted}>{t.deals}</TD></TR>
                ))}</tbody>
              </table></div>
            </Card>
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 12 }}>
              <Card title="Conversion Rate"><div style={{ padding: 14 }}>{teamMetrics.sort((a,b)=>b.conversionRate-a.conversionRate).map((t,i) => (
                <div key={i} style={{ marginBottom: 10 }}><div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                  <span style={{ fontSize: 11, color: T.text }}>{t.name.split(' ')[0]}</span>
                  <span style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: t.conversionRate>=35?T.accent:T.text }}>{t.conversionRate}%</span>
                </div><Bar value={t.conversionRate} max={50} color={t.conversionRate>=35?T.accent:T.green} h={6} /></div>
              ))}</div></Card>
              <Card title="LP Capital Sourced"><div style={{ padding: 14 }}>{teamMetrics.sort((a,b)=>b.lpCapital-a.lpCapital).map((t,i) => (
                <div key={i} style={{ marginBottom: 10 }}><div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                  <span style={{ fontSize: 11, color: T.text }}>{t.name.split(' ')[0]}</span>
                  <span style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: T.gold }}>${t.lpCapital}M</span>
                </div><Bar value={t.lpCapital} max={Math.max(...teamMetrics.map(x=>x.lpCapital))} color={T.gold} h={6} /></div>
              ))}</div></Card>
              <Card title="Deal Velocity (Days)"><div style={{ padding: 14 }}>{teamMetrics.sort((a,b)=>a.dealVelocity-b.dealVelocity).map((t,i) => (
                <div key={i} style={{ marginBottom: 10 }}><div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                  <span style={{ fontSize: 11, color: T.text }}>{t.name.split(' ')[0]}</span>
                  <span style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: t.dealVelocity<=8?T.accent:T.textMuted }}>{t.dealVelocity}d</span>
                </div><Bar value={20-t.dealVelocity} max={20} color={t.dealVelocity<=8?T.accent:T.amber} h={6} /></div>
              ))}</div></Card>
            </div>
            {/* Network Efficiency */}
            <Card title="Network Efficiency — Connections → Deals → Capital" style={{ marginTop: 14 }}>
              <div style={{ padding: 16 }}>{teamMetrics.map((t, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 14, padding: '10px 0', borderBottom: i<teamMetrics.length-1?`1px solid ${T.border}06`:'none' }}>
                  <span style={{ width: 80, fontSize: 12, fontWeight: 700, color: T.text }}>{t.name.split(' ')[0]}</span>
                  <div style={{ flex: 1, display: 'flex', alignItems: 'center', gap: 8 }}>
                    <div style={{ textAlign: 'center' }}><div style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: T.purple }}>{t.connections}</div><div style={{ fontSize: 7, color: T.textDim }}>CONN</div></div>
                    <ArrowRight size={14} color={T.textDim} />
                    <div style={{ textAlign: 'center' }}><div style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: T.blue }}>{t.deals}</div><div style={{ fontSize: 7, color: T.textDim }}>DEALS</div></div>
                    <ArrowRight size={14} color={T.textDim} />
                    <div style={{ textAlign: 'center' }}><div style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: T.gold }}>${t.lpCapital}M</div><div style={{ fontSize: 7, color: T.textDim }}>LP $</div></div>
                  </div>
                  <div style={{ display: 'flex', gap: 12, fontSize: 10, fontFamily: mono }}>
                    <span style={{ color: T.textDim }}>{(t.connections/Math.max(t.deals,1)).toFixed(1)} c/d</span>
                    <span style={{ color: T.accent }}>${(t.lpCapital/Math.max(t.connections,1)*1000).toFixed(0)}K/c</span>
                  </div>
                </div>
              ))}</div>
            </Card>
          </div>
        );
      })()}

      {/* ════ J-CURVE TRACKER ════ */}
      {subTab === 'jcurve' && (() => {
        const vintages = [
          { year: 2022, months: 36, called: 82, nav: 175.8, dpi: 0.18, tvpi: 1.85, phase: 'Harvesting', expected: 1.65, target: 2.0 },
          { year: 2023, months: 24, called: 62, nav: 127.5, dpi: 0.08, tvpi: 1.50, phase: 'Growth', expected: 1.35, target: 1.8 },
          { year: 2024, months: 12, called: 35, nav: 44.5, dpi: 0.02, tvpi: 1.27, phase: 'Deploying', expected: 1.10, target: 1.5 },
        ];
        const jPts = [{m:0,v:1.0},{m:6,v:0.92},{m:12,v:0.88},{m:18,v:0.90},{m:24,v:0.95},{m:30,v:1.08},{m:36,v:1.22},{m:42,v:1.45},{m:48,v:1.65},{m:54,v:1.82},{m:60,v:2.10}];
        return (
          <div>
            <Card title="J-Curve Position Tracker — Actual vs Expected Trajectory" style={{ marginBottom: 14 }}>
              <div style={{ padding: 16 }}>
                <div style={{ position: 'relative', height: 220, background: T.bgAccent, borderRadius: 8, padding: '20px 30px', marginBottom: 14 }}>
                  {[0.8,1.0,1.2,1.5,2.0].map(v=><div key={v} style={{position:'absolute',left:0,bottom:`${((v-0.7)/1.5)*100}%`,fontSize:9,fontFamily:mono,color:T.textDim}}>{v}x</div>)}
                  {jPts.map((p,i)=>i>0&&<div key={`e${i}`} style={{position:'absolute',left:`${(p.m/60)*85+8}%`,bottom:`${((p.v-0.7)/1.5)*100}%`,width:4,height:4,borderRadius:'50%',background:T.textDim,opacity:0.5}}/>)}
                  <div style={{position:'absolute',left:'8%',right:'7%',bottom:`${((1.0-0.7)/1.5)*100}%`,height:1,background:T.textMuted,opacity:0.3}}/>
                  <div style={{position:'absolute',right:'7%',bottom:`${((1.0-0.7)/1.5)*100+1}%`,fontSize:8,color:T.textMuted}}>breakeven</div>
                  {vintages.map((v,i)=><div key={i} style={{position:'absolute',left:`${(v.months/60)*85+8}%`,bottom:`${((v.tvpi-0.7)/1.5)*100}%`,transform:'translate(-50%,50%)'}}>
                    <div style={{width:14,height:14,borderRadius:'50%',background:v.tvpi>v.expected?T.accent:T.amber,border:`2px solid ${T.bg}`,display:'flex',alignItems:'center',justifyContent:'center'}}><span style={{fontSize:7,fontWeight:900,color:T.bg}}>{v.year.toString().slice(2)}</span></div>
                    <div style={{position:'absolute',top:-22,left:'50%',transform:'translateX(-50%)',fontSize:9,fontFamily:mono,fontWeight:700,color:v.tvpi>v.expected?T.accent:T.amber,whiteSpace:'nowrap'}}>{v.tvpi}x</div>
                  </div>)}
                  {[0,12,24,36,48,60].map(m=><div key={m} style={{position:'absolute',bottom:-14,left:`${(m/60)*85+8}%`,fontSize:8,fontFamily:mono,color:T.textDim,transform:'translateX(-50%)'}}>{m}mo</div>)}
                </div>
                <div style={{display:'flex',gap:8,justifyContent:'center'}}>
                  <div style={{display:'flex',alignItems:'center',gap:4}}><div style={{width:8,height:8,borderRadius:'50%',background:T.accent}}/><span style={{fontSize:10,color:T.textMuted}}>NEWCO actual</span></div>
                  <div style={{display:'flex',alignItems:'center',gap:4}}><div style={{width:4,height:4,borderRadius:'50%',background:T.textDim}}/><span style={{fontSize:10,color:T.textMuted}}>Cambridge expected</span></div>
                </div>
              </div>
            </Card>
            <Card title="Vintage Cohort Detail">
              <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                <thead><tr>{['Vintage','Age','Phase','Called','NAV','TVPI','Expected','Target','Delta','DPI'].map(h=><TH key={h} align={h==='Vintage'||h==='Phase'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{vintages.map((v,i)=>{const d=v.tvpi-v.expected;return(<TR key={i}><TD bold>{v.year}</TD><TD align="right" mono>{v.months}mo</TD><TD><Badge color={v.phase==='Harvesting'?T.accent:v.phase==='Growth'?T.blue:T.amber}>{v.phase}</Badge></TD><TD align="right" mono>${v.called}M</TD><TD align="right" mono bold color={T.accent}>${v.nav}M</TD><TD align="right" mono bold color={v.tvpi>=1.5?T.accent:T.text}>{v.tvpi}x</TD><TD align="right" mono color={T.textMuted}>{v.expected}x</TD><TD align="right" mono color={T.blue}>{v.target}x</TD><TD align="right" mono bold color={d>0?T.accent:T.red}>{d>0?'+':''}{d.toFixed(2)}x</TD><TD align="right" mono color={T.textMuted}>{v.dpi}x</TD></TR>);})}</tbody>
              </table></div>
            </Card>
            <div style={{marginTop:14,padding:14,background:T.accentBg,borderRadius:8,border:`1px solid ${T.accent}25`}}>
              <div style={{fontSize:10,color:T.accent,fontWeight:700,marginBottom:4}}>J-CURVE INSIGHT</div>
              <div style={{fontSize:11,color:T.textMuted,lineHeight:1.7}}>All three vintages track ABOVE expected J-curve. 2022 (+0.20x) entering harvest early — Anthropic markup + Anduril growth. 2024 is most ahead (+0.17x) at only 12 months, signaling strong early AI Safety thesis validation. NEWCO has effectively eliminated the J-curve trough.</div>
            </div>
          </div>
        );
      })()}

      {/* ════ SIGNAL DETECTION ════ */}
      {subTab === 'signals' && (() => {
        const signals = [
          { company: 'Anthropic', signal: 'Revenue acceleration', indicator: 'Q4 $1.2B → Q1 est $1.8B (+50% QoQ)', dir: 'pos', str: 98, action: 'HOLD — IPO 2027.', lag: 'Real-time', cat: 'Revenue' },
          { company: 'Anduril', signal: 'DoD contract surge', indicator: '3 new contracts ($2.1B) in 60d. Lattice 4x YoY.', dir: 'pos', str: 94, action: 'HOLD — IPO Q4 2026.', lag: 'Weekly', cat: 'Revenue' },
          { company: 'Databricks', signal: 'IPO window open', indicator: 'S-1 filed confidentially. GS + MS. $55B+ target.', dir: 'pos', str: 91, action: 'HOLD for IPO pop.', lag: 'Event', cat: 'Exit' },
          { company: 'Robust Intelligence', signal: 'M&A interest', indicator: 'CrowdStrike + PANW in DD. $800M-1.2B est.', dir: 'pos', str: 88, action: 'HOLD — M&A exit 6mo.', lag: 'Real-time', cat: 'Exit' },
          { company: 'Contextual AI', signal: 'Pipeline surge', indicator: '$8M → $22M ARR pipeline in 90d. 3 F500 POCs.', dir: 'pos', str: 85, action: 'HOLD — flag co-invest.', lag: 'Monthly', cat: 'Revenue' },
          { company: 'Scale AI', signal: 'Customer churn risk', indicator: 'OpenAI building internal labeling. 35% rev concentration.', dir: 'neg', str: 82, action: 'MONITOR — secondary if contract drops.', lag: 'Monthly', cat: 'Customer' },
          { company: 'Drata', signal: 'Growth deceleration', indicator: '180% → 95% YoY. CAC payback 14mo → 22mo.', dir: 'neg', str: 75, action: 'SELL — secondary at 95¢.', lag: 'Quarterly', cat: 'Revenue' },
          { company: 'Shield AI', signal: 'Talent velocity spike', indicator: '+45 eng hires Q4 (2x prior). Lockheed + Raytheon.', dir: 'pos', str: 72, action: 'HOLD — talent → revenue.', lag: 'Monthly', cat: 'Talent' },
          { company: 'Verkada', signal: 'Regulatory headwind', indicator: 'FTC investigating data practices. Likely immaterial.', dir: 'neg', str: 45, action: 'MONITOR — watch escalation.', lag: 'Event', cat: 'Regulatory' },
        ];
        const cc = { Revenue: T.accent, Customer: T.amber, Exit: T.green, Talent: T.blue, Regulatory: T.red };
        return (
          <div>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
              <Stat label="Active Signals" value={signals.length} icon={Zap} sub="tracked" color={T.accent}/>
              <Stat label="Positive" value={signals.filter(s=>s.dir==='pos').length} icon={TrendingUp} color={T.green}/>
              <Stat label="Negative" value={signals.filter(s=>s.dir==='neg').length} icon={AlertTriangle} color={T.red}/>
              <Stat label="Avg Strength" value={Math.round(signals.reduce((s,x)=>s+x.str,0)/signals.length)} icon={Activity} sub="/100" color={T.blue}/>
            </div>
            {signals.sort((a,b)=>b.str-a.str).map((s,i)=>(
              <div key={i} style={{background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:8,padding:'14px 18px',marginBottom:6,borderLeft:`3px solid ${s.dir==='pos'?T.accent:T.red}`}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>
                    <span style={{fontSize:14,fontWeight:700,color:T.text}}>{s.company}</span>
                    <Badge color={cc[s.cat]}>{s.cat}</Badge>
                    <Badge color={s.dir==='pos'?T.accent:T.red}>{s.dir==='pos'?'▲':'▼'}</Badge>
                  </div>
                  <div style={{display:'flex',alignItems:'center',gap:6}}>
                    <span style={{fontSize:9,color:T.textDim}}>{s.lag}</span>
                    <div style={{width:40,height:6,background:T.bgAccent,borderRadius:3,overflow:'hidden'}}><div style={{width:`${s.str}%`,height:'100%',background:s.str>=85?T.accent:s.str>=60?T.blue:T.amber,borderRadius:3}}/></div>
                    <span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:s.str>=85?T.accent:s.str>=60?T.blue:T.amber}}>{s.str}</span>
                  </div>
                </div>
                <div style={{fontSize:12,fontWeight:600,color:T.text,marginBottom:3}}>{s.signal}</div>
                <div style={{fontSize:11,color:T.textMuted,marginBottom:3}}>{s.indicator}</div>
                <div style={{fontSize:11,color:T.accent,fontWeight:600}}>→ {s.action}</div>
              </div>
            ))}
          </div>
        );
      })()}

      {/* ════ BAYESIAN EXIT PROBABILITY ════ */}
      {subTab === 'bayesian' && (() => {
        const exitProbs = PORTFOLIO_COMPANIES.slice(0,8).map(c => {
          const pIPO = c.exitPath.includes('IPO') ? 0.55 : 0.15;
          const pMA = c.exitPath.includes('M&A') ? 0.45 : 0.25;
          const rb = c.growth>200?1.4:c.growth>100?1.15:c.growth>50?1.0:0.7;
          const mb = c.sector==='AI Safety'?1.3:c.sector==='GovTech'?1.1:1.0;
          const sb = c.signalScore>85?1.25:c.signalScore>70?1.1:0.85;
          const rIPO=pIPO*rb*mb*sb, rMA=pMA*(1/rb)*1.1, rSec=0.20*(c.status==='flat'?1.5:0.8), rDown=0.10*(c.growth<30?2.0:0.5);
          const tot=rIPO+rMA+rSec+rDown;
          return {...c,ipo:(rIPO/tot*100).toFixed(0),ma:(rMA/tot*100).toFixed(0),sec:(rSec/tot*100).toFixed(0),down:(rDown/tot*100).toFixed(0),best:rIPO>rMA?'IPO':'M&A',expM:c.exitPath.includes('IPO')?(c.signalScore/30).toFixed(1):(c.signalScore/40).toFixed(1),conf:sb>=1.2?'High':sb>=1.0?'Med':'Low'};
        });
        return (
          <div>
            <Card title="Bayesian Exit Probability — Dynamic Posterior Updates">
              <div style={{padding:14,marginBottom:8,background:T.bgAccent,borderRadius:6}}>
                <div style={{fontSize:11,color:T.textMuted,lineHeight:1.6}}>Probabilities update as signals arrive. Priors from sector base rates; posteriors incorporate revenue growth, market conditions, and signal strength. Each data point shifts the distribution — a living model, not static forecast.</div>
              </div>
              <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                <thead><tr>{['Company','IPO %','M&A %','Secondary %','Down %','Best Path','Exp Multiple','Confidence'].map(h=><TH key={h} align={h==='Company'||h==='Best Path'||h==='Confidence'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{exitProbs.sort((a,b)=>parseInt(b.ipo)-parseInt(a.ipo)).map(c=>(
                  <TR key={c.name}>
                    <TD bold>{c.name}</TD>
                    <TD align="right"><div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'flex-end'}}><div style={{width:parseInt(c.ipo)*0.5,height:8,background:T.accent,borderRadius:2,minWidth:2}}/><span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:parseInt(c.ipo)>=50?T.accent:T.text}}>{c.ipo}%</span></div></TD>
                    <TD align="right"><div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'flex-end'}}><div style={{width:parseInt(c.ma)*0.5,height:8,background:T.blue,borderRadius:2,minWidth:2}}/><span style={{fontSize:11,fontFamily:mono,color:T.blue}}>{c.ma}%</span></div></TD>
                    <TD align="right" mono color={T.textMuted}>{c.sec}%</TD>
                    <TD align="right" mono color={parseInt(c.down)>15?T.red:T.textDim}>{c.down}%</TD>
                    <TD><Badge color={c.best==='IPO'?T.accent:T.blue}>{c.best}</Badge></TD>
                    <TD align="right" mono bold color={T.accent}>{c.expM}x</TD>
                    <TD><Badge color={c.conf==='High'?T.accent:c.conf==='Med'?T.amber:T.red}>{c.conf}</Badge></TD>
                  </TR>
                ))}</tbody>
              </table></div>
            </Card>
          </div>
        );
      })()}

      {/* ════ KELLY CRITERION ════ */}
      {subTab === 'kelly' && (() => {
        const totalExp = PORTFOLIO_COMPANIES.reduce((s,x)=>s+x.valuation*x.ownership/100,0);
        const pos = PORTFOLIO_COMPANIES.slice(0,8).map(c => {
          const wp=c.signalScore/100, wm=c.growth>200?4.0:c.growth>100?2.5:c.growth>50?1.8:1.2;
          const kp=Math.max(0,((wp*wm-(1-wp)*0.3)/wm)*100);
          const cp=(c.valuation*c.ownership/100)/totalExp*100;
          const d=kp-cp;
          return {...c,wp:(wp*100).toFixed(0),wm:wm.toFixed(1),kp:kp.toFixed(1),cp:cp.toFixed(1),d:d.toFixed(1),sz:Math.abs(d)<2?'Correct':d>0?'Underweight':'Overweight',act:Math.abs(d)<2?'Hold':(d>2?`Add $${(Math.abs(d)*2.4).toFixed(1)}M`:`Trim $${(Math.abs(d)*2.4).toFixed(1)}M`)};
        });
        return (
          <div>
            <Card title="Kelly Criterion — Optimal Position Sizing">
              <div style={{padding:14,marginBottom:8,background:T.bgAccent,borderRadius:6}}>
                <div style={{fontSize:11,color:T.textMuted,lineHeight:1.6}}>Kelly = mathematically optimal bet size given edge × payoff vs odds. Half-Kelly (50%) used for safety margin. Shows which positions are over/underweight relative to risk-adjusted expected return.</div>
              </div>
              <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                <thead><tr>{['Company','Win Prob','Win Multiple','Kelly %','Current %','Delta','Sizing','Action'].map(h=><TH key={h} align={['Company','Sizing','Action'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{pos.sort((a,b)=>parseFloat(b.kp)-parseFloat(a.kp)).map(c=>(
                  <TR key={c.name}>
                    <TD bold>{c.name}</TD>
                    <TD align="right" mono color={parseInt(c.wp)>=80?T.accent:T.text}>{c.wp}%</TD>
                    <TD align="right" mono bold color={T.accent}>{c.wm}x</TD>
                    <TD align="right" mono bold color={T.blue}>{c.kp}%</TD>
                    <TD align="right" mono>{c.cp}%</TD>
                    <TD align="right" mono bold color={parseFloat(c.d)>2?T.green:parseFloat(c.d)<-2?T.red:T.text}>{parseFloat(c.d)>=0?'+':''}{c.d}%</TD>
                    <TD><Badge color={c.sz==='Correct'?T.accent:c.sz==='Underweight'?T.green:T.red}>{c.sz}</Badge></TD>
                    <TD color={T.textMuted}>{c.act}</TD>
                  </TR>
                ))}</tbody>
              </table></div>
            </Card>
            <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginTop:14}}>
              {[{l:'Underweight',n:pos.filter(p=>p.sz==='Underweight').length,d:'increase exposure',c:T.green},{l:'Correct',n:pos.filter(p=>p.sz==='Correct').length,d:'optimal sizing',c:T.accent},{l:'Overweight',n:pos.filter(p=>p.sz==='Overweight').length,d:'trim position',c:T.red}].map(s=>(
                <div key={s.l} style={{padding:16,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`,textAlign:'center'}}>
                  <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
                  <div style={{fontSize:28,fontWeight:900,fontFamily:mono,color:s.c}}>{s.n}</div>
                  <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
                </div>
              ))}
            </div>
          </div>
        );
      })()}

      {/* ════ REGIME ANALYSIS ════ */}
      {subTab === 'regime' && (() => {
        const regimes = [
          { regime: 'AI Expansion + Rate Easing', prob: 55, impact: 'Very Bullish', act: 'Full deploy. Max IPO positions. Extend duration.', irr: '+4-6%', nav: '+15-25%', c: T.accent },
          { regime: 'AI Expansion + Rate Tightening', prob: 20, impact: 'Mixed', act: 'Selective deploy. Favor profitability. Accelerate secondaries.', irr: '+1-3%', nav: '+5-10%', c: T.blue },
          { regime: 'AI Correction + Rate Easing', prob: 15, impact: 'Bearish Near-term', act: 'Pause deploy. Build cash. Prepare distressed secondaries.', irr: '-2-5%', nav: '-10-20%', c: T.amber },
          { regime: 'AI Winter + Rate Tightening', prob: 10, impact: 'Very Bearish', act: 'Defensive. Exit non-core. Force DPI through exits.', irr: '-8-15%', nav: '-25-40%', c: T.red },
        ];
        const indicators = [
          { name: 'Fed Funds Rate', val: 'Easing (4.25%)', sig: 'Positive', detail: '2 cuts 2025, 2 more expected.', w: 25 },
          { name: 'NVIDIA Revenue', val: '+78% YoY', sig: 'Strong Positive', detail: 'AI infra spend accelerating.', w: 20 },
          { name: 'IPO Window', val: 'Open (cautious)', sig: 'Positive', detail: 'Databricks, Anduril, Anthropic exploring.', w: 20 },
          { name: 'VC Fundraising', val: '$68B (2025)', sig: 'Neutral', detail: 'Recovering from 2023 trough.', w: 15 },
          { name: 'AI Regulation', val: 'EU AI Act live', sig: 'Mixed', detail: 'Creates compliance moats for portfolio.', w: 10 },
          { name: 'Defense Budget', val: '$886B FY2026', sig: 'Strong Positive', detail: 'Bipartisan AI defense support.', w: 10 },
        ];
        return (
          <div>
            <div style={{padding:18,background:T.accentBg,borderRadius:8,border:`1px solid ${T.accent}25`,marginBottom:14}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div><div style={{fontSize:10,color:T.accent,fontWeight:700,marginBottom:4}}>CURRENT REGIME DETECTED</div><div style={{fontSize:22,fontWeight:900,color:T.accent}}>AI Expansion + Rate Easing</div><div style={{fontSize:11,color:T.textMuted}}>Active since Q3 2024 · 88% confidence</div></div>
                <div style={{width:60,height:60,borderRadius:'50%',background:T.bgAccent,display:'flex',alignItems:'center',justifyContent:'center',border:`3px solid ${T.accent}`}}><span style={{fontSize:20,fontWeight:900,fontFamily:mono,color:T.accent}}>88</span></div>
              </div>
            </div>
            <Card title="Regime Probability Distribution" style={{marginBottom:14}}>
              <div style={{padding:16}}>{regimes.map((r,i)=>(
                <div key={i} style={{marginBottom:14}}>
                  <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                    <div style={{display:'flex',alignItems:'center',gap:8}}><span style={{fontSize:13,fontWeight:700,color:T.text}}>{r.regime}</span><Badge color={r.c}>{r.impact}</Badge></div>
                    <span style={{fontSize:16,fontWeight:800,fontFamily:mono,color:r.c}}>{r.prob}%</span>
                  </div>
                  <Bar value={r.prob} max={100} color={r.c} h={8}/>
                  <div style={{display:'flex',gap:14,marginTop:4}}>
                    <span style={{fontSize:10,color:T.textDim}}>IRR: <span style={{color:r.irr.includes('+')?T.accent:T.red,fontWeight:700}}>{r.irr}</span></span>
                    <span style={{fontSize:10,color:T.textDim}}>NAV: <span style={{color:r.nav.includes('+')?T.accent:T.red,fontWeight:700}}>{r.nav}</span></span>
                  </div>
                  <div style={{fontSize:11,color:T.textMuted,marginTop:2}}>→ {r.act}</div>
                </div>
              ))}</div>
            </Card>
            <Card title="Leading Indicators — Regime Detection">
              <div style={{padding:0}}>{indicators.map((ind,i)=>(
                <div key={i} style={{display:'flex',alignItems:'center',gap:14,padding:'12px 18px',borderBottom:i<indicators.length-1?`1px solid ${T.border}`:'none'}}>
                  <div style={{flex:1}}><div style={{fontSize:12,fontWeight:600,color:T.text}}>{ind.name}</div><div style={{fontSize:10,color:T.textDim}}>{ind.detail}</div></div>
                  <div style={{textAlign:'right',marginRight:8}}><div style={{fontSize:12,fontWeight:700,fontFamily:mono,color:T.text}}>{ind.val}</div><div style={{fontSize:9,color:T.textDim}}>Wt: {ind.w}%</div></div>
                  <Badge color={ind.sig.includes('Strong')?T.accent:ind.sig==='Positive'?T.green:ind.sig==='Neutral'?T.amber:T.red}>{ind.sig}</Badge>
                </div>
              ))}</div>
            </Card>
          </div>
        );
      })()}

      {/* ════ OPTIONALITY ════ */}
      {subTab === 'optionality' && (() => {
        const opts = PORTFOLIO_COMPANIES.slice(0,8).map(c => {
          const iv=c.valuation*c.ownership/100;
          const vol=c.growth>200?0.85:c.growth>100?0.65:c.growth>50?0.45:0.30;
          const tte=c.exitPath.includes('2026')?1.0:c.exitPath.includes('2027')?2.0:c.exitPath.includes('M&A')?1.5:3.0;
          const ov=iv*(1+Math.log(1+vol*Math.sqrt(tte))*0.4);
          const emb=ov-iv, fo=c.signalScore>=85?iv*0.25:c.signalScore>=70?iv*0.10:0, pv=c.sector==='AI Safety'?iv*0.15:iv*0.05;
          const tot=emb+fo+pv;
          return {...c,iv:iv.toFixed(1),vol:(vol*100).toFixed(0),tte:tte.toFixed(1),emb:emb.toFixed(1),fo:fo.toFixed(1),pv:pv.toFixed(1),tot:tot.toFixed(1),pct:((tot/iv)*100).toFixed(0)};
        });
        return (
          <div>
            <Card title="Real Option Value — Hidden Upside Beyond NAV">
              <div style={{padding:14,marginBottom:8,background:T.bgAccent,borderRadius:6}}>
                <div style={{fontSize:11,color:T.textMuted,lineHeight:1.6}}>Each position has option value beyond NAV: volatility × time upside (Black-Scholes), follow-on rights, and pivot adjacencies. Total hidden value: <span style={{color:T.accent,fontWeight:700}}>${opts.reduce((s,o)=>s+parseFloat(o.tot),0).toFixed(1)}M</span> above current marks.</div>
              </div>
              <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                <thead><tr>{['Company','NAV','Vol','Time','Upside Option','Follow-On','Pivot','Total Option','% NAV'].map(h=><TH key={h} align={h==='Company'?'left':'right'}>{h}</TH>)}</tr></thead>
                <tbody>{opts.sort((a,b)=>parseFloat(b.tot)-parseFloat(a.tot)).map(c=>(
                  <TR key={c.name}>
                    <TD bold>{c.name}</TD><TD align="right" mono>${c.iv}M</TD>
                    <TD align="right" mono color={parseInt(c.vol)>=60?T.accent:T.text}>{c.vol}%</TD>
                    <TD align="right" mono color={T.textMuted}>{c.tte}y</TD>
                    <TD align="right" mono bold color={T.accent}>${c.emb}M</TD>
                    <TD align="right" mono color={parseFloat(c.fo)>0?T.green:T.textDim}>${c.fo}M</TD>
                    <TD align="right" mono color={parseFloat(c.pv)>0?T.blue:T.textDim}>${c.pv}M</TD>
                    <TD align="right" mono bold color={T.accent}>${c.tot}M</TD>
                    <TD align="right" mono bold color={parseInt(c.pct)>=25?T.accent:T.text}>{c.pct}%</TD>
                  </TR>
                ))}</tbody>
              </table></div>
            </Card>
          </div>
        );
      })()}

      {/* ════ FLYWHEEL / SYNERGIES ════ */}
      {subTab === 'flywheel' && (() => {
        const syn = [
          { from:'Anthropic', to:'Contextual AI', type:'Technology', str:92, detail:'Contextual builds on Claude API. 40% of pipeline uses Claude.', value:'Anthropic gets distribution, Contextual gets AI Safety credibility.', act:'Intro Contextual CTO → Anthropic enterprise.' },
          { from:'Anduril', to:'Shield AI', type:'Customer', str:88, detail:'Both sell to DoD. Lattice integrates Shield drones.', value:'$200M+ joint contracts. NEWCO = only investor in both.', act:'Facilitate joint Pentagon pitch.' },
          { from:'Scale AI', to:'Anthropic', type:'Vendor', str:85, detail:'Scale provides RLHF labeling for Constitutional AI.', value:'Guaranteed revenue ↔ guaranteed data quality.', act:'Monitor OpenAI internal labeling build.' },
          { from:'Palantir', to:'Anduril', type:'Ecosystem', str:78, detail:'AIP + Lattice = two pillars of US AI defense.', value:'Unparalleled $886B defense budget visibility.', act:'Cross-pollinate IPO + contract intel.' },
          { from:'Robust Intelligence', to:'Drata', type:'Technology', str:72, detail:'AI security + compliance = end-to-end governance.', value:'M&A synergy if CrowdStrike acquires Robust.', act:'Propose product partnership.' },
          { from:'Databricks', to:'Scale AI', type:'Data Pipeline', str:68, detail:'Lakehouse → labeling → training at Fortune 500.', value:'Joint customers see 3x faster deployment.', act:'Facilitate data partnership intro.' },
        ];
        const tc = {Technology:T.accent,Customer:T.blue,Vendor:T.amber,Ecosystem:T.purple,'Data Pipeline':T.cyan};
        return (
          <div>
            <div style={{padding:18,background:T.accentBg,borderRadius:8,border:`1px solid ${T.accent}25`,marginBottom:14}}>
              <div style={{fontSize:10,color:T.accent,fontWeight:700,marginBottom:4}}>PORTFOLIO FLYWHEEL EFFECT</div>
              <div style={{fontSize:11,color:T.textMuted,lineHeight:1.7}}>6 active synergy links across 8 companies. Each company amplifies the others — compounding value that diversified FoFs can't capture. Structural advantage of thesis-driven investing.</div>
            </div>
            {syn.sort((a,b)=>b.str-a.str).map((s,i)=>(
              <div key={i} style={{background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:8,padding:'16px 18px',marginBottom:8}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:8}}>
                  <div style={{display:'flex',alignItems:'center',gap:6}}>
                    <span style={{fontSize:14,fontWeight:700,color:T.accent}}>{s.from}</span>
                    <ArrowRight size={14} color={T.textMuted}/>
                    <span style={{fontSize:14,fontWeight:700,color:T.blue}}>{s.to}</span>
                    <Badge color={tc[s.type]}>{s.type}</Badge>
                  </div>
                  <div style={{display:'flex',alignItems:'center',gap:6}}>
                    <div style={{width:40,height:6,background:T.bgAccent,borderRadius:3,overflow:'hidden'}}><div style={{width:`${s.str}%`,height:'100%',background:s.str>=85?T.accent:s.str>=70?T.blue:T.amber,borderRadius:3}}/></div>
                    <span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:s.str>=85?T.accent:T.blue}}>{s.str}</span>
                  </div>
                </div>
                <div style={{fontSize:11,color:T.text,fontWeight:500,marginBottom:3}}>{s.detail}</div>
                <div style={{fontSize:11,color:T.textMuted,marginBottom:3}}>{s.value}</div>
                <div style={{fontSize:11,color:T.accent,fontWeight:600}}>→ {s.act}</div>
              </div>
            ))}
          </div>
        );
      })()}

      {/* ════ ALPHA DECOMPOSITION ════ */}
      {subTab === 'alpha' && (() => {
        const ta = 23.1 - 14.8;
        const decomp = [
          { src:'GP Selection Alpha', val:4.2, detail:'Top-quartile GPs vs median VC.', driver:'Ken\'s 20yr GP track record.' },
          { src:'Sector Thesis Alpha', val:2.8, detail:'AI Safety 34% vs VC median 18%.', driver:'First-mover before consensus.' },
          { src:'Timing Alpha', val:1.5, detail:'2022-24 cyclical lows. Bought fear.', driver:'Counter-cyclical deployment.' },
          { src:'Secondary Arbitrage', val:0.9, detail:'FF VI at 85¢ → 115¢. 35% gain.', driver:'Evercore + secondary expertise.' },
          { src:'Co-Investment Alpha', val:0.5, detail:'Direct Anthropic + Shield AI at fund pricing.', driver:'GP access + zero-fee co-invest.' },
          { src:'Fee Structure Edge', val:-0.1, detail:'Zero mgmt fee. $3.5M/yr savings.', driver:'Structural advantage vs peers.' },
          { src:'Network Cost', val:-0.5, detail:'665 connections + events. Offset by quality.', driver:'$207M from network relationships.' },
        ];
        return (
          <div>
            <div style={{padding:18,background:T.accentBg,borderRadius:8,border:`1px solid ${T.accent}25`,marginBottom:14}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div><div style={{fontSize:10,color:T.accent,fontWeight:700,marginBottom:4}}>TOTAL ALPHA GENERATED</div><div style={{fontSize:32,fontWeight:900,fontFamily:mono,color:T.accent}}>+{ta.toFixed(1)}%</div><div style={{fontSize:11,color:T.textMuted}}>NEWCO 23.1% vs Cambridge 14.8%</div></div>
                <div style={{textAlign:'right'}}><div style={{fontSize:9,color:T.textDim}}>INFORMATION RATIO</div><div style={{fontSize:28,fontWeight:900,fontFamily:mono,color:T.blue}}>1.42</div><div style={{fontSize:10,color:T.textMuted}}>top decile FoF</div></div>
              </div>
            </div>
            <Card title="Alpha Source Decomposition">
              <div style={{padding:0}}>{decomp.sort((a,b)=>b.val-a.val).map((d,i)=>(
                <div key={i} style={{padding:'14px 18px',borderBottom:i<decomp.length-1?`1px solid ${T.border}`:'none'}}>
                  <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                    <span style={{fontSize:13,fontWeight:700,color:T.text}}>{d.src}</span>
                    <div style={{display:'flex',alignItems:'center',gap:8}}>
                      <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>{((d.val/ta)*100).toFixed(0)}%</span>
                      <span style={{fontSize:18,fontWeight:900,fontFamily:mono,color:d.val>=0?T.accent:T.red}}>{d.val>=0?'+':''}{d.val.toFixed(1)}%</span>
                    </div>
                  </div>
                  <Bar value={Math.abs(d.val)} max={5} color={d.val>=0?T.accent:T.red} h={6}/>
                  <div style={{fontSize:11,color:T.textMuted,marginTop:4}}>{d.detail}</div>
                  <div style={{fontSize:10,color:T.accent,marginTop:2}}>Driver: {d.driver}</div>
                </div>
              ))}</div>
            </Card>
            <div style={{marginTop:14,padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`}}>
              <div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',fontWeight:700,marginBottom:6}}>STRATEGIC IMPLICATION</div>
              <div style={{fontSize:11,color:T.textMuted,lineHeight:1.7}}>GP Selection (50.6%) and Sector Thesis (33.7%) dominate. Validates concentrated thesis approach. Sustain by: maintaining GP quality, deepening AI Safety conviction, continuing counter-cyclical deployment. Secondary Arbitrage is underexploited — consider 10% of AUM for systematic secondary purchasing.</div>
            </div>
          </div>
        );
      })()}
    </div>
  );
};

// ════════════════════════════════════════════════════
// SECONDARIES MARKETPLACE
// ════════════════════════════════════════════════════
const SecondariesMarket = () => {
  const [expandedDeal, setExpandedDeal] = useState(null);

  const totalOpportunity = SECONDARIES.reduce((s, d) => s + d.nav * (1 - d.bidPrice / 100), 0);
  const avgDiscount = (SECONDARIES.reduce((s, d) => s + (100 - d.askPrice), 0) / SECONDARIES.length).toFixed(1);
  const highPriority = SECONDARIES.filter(d => d.urgency === 'high').length;

  return (
    <div>
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 18 }}>
        <Stat label="Secondary Pipeline" value={`$${(SECONDARIES.reduce((s,d) => s + d.nav, 0)/1000).toFixed(1)}B`} icon={Layers} sub={`${SECONDARIES.length} opportunities`} color={T.blue} />
        <Stat label="Avg Discount" value={`${avgDiscount}%`} icon={Target} trend={-3} sub="to last NAV" color={T.green} />
        <Stat label="Embedded Value" value={`$${(totalOpportunity/1000).toFixed(1)}B`} icon={DollarSign} color={T.accent} />
        <Stat label="High Priority" value={highPriority} icon={AlertTriangle} sub="action required" color={T.red} />
        <Stat label="Avg Bid-Ask Spread" value={`${(SECONDARIES.reduce((s,d) => s + d.spread, 0) / SECONDARIES.length).toFixed(1)}%`} icon={BarChart3} color={T.amber} />
      </div>

      {/* Visual Discount Map */}
      <Card title="Discount / Premium Map" style={{ marginBottom: 18 }}>
        <div style={{ padding: '16px 18px', display: 'flex', gap: 8, flexWrap: 'wrap' }}>
          {SECONDARIES.sort((a, b) => a.askPrice - b.askPrice).map(d => {
            const disc = 100 - d.askPrice;
            const isPremium = disc < 0;
            return (
              <div key={d.id} style={{
                flex: `0 0 ${Math.max(80, d.nav / 40)}px`, padding: '10px 12px', borderRadius: 6,
                background: isPremium ? T.redBg : disc > 25 ? T.greenBg : T.blueBg,
                border: `1px solid ${isPremium ? T.red : disc > 25 ? T.green : T.blue}30`,
                cursor: 'pointer', transition: 'all 0.15s',
              }}>
                <div style={{ fontSize: 11, fontWeight: 700, color: T.text, marginBottom: 4, lineHeight: 1.2 }}>{d.fund.split(' ').slice(0, 2).join(' ')}</div>
                <div style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: isPremium ? T.red : T.green }}>{isPremium ? '+' : '-'}{Math.abs(disc)}%</div>
                <div style={{ fontSize: 9, color: T.textDim, marginTop: 2 }}>${d.nav}M NAV</div>
              </div>
            );
          })}
        </div>
      </Card>

      {/* Opportunities Table */}
      <Card title="Secondary Opportunities">
        <div style={{ overflowX: 'auto' }}>
          <table style={{ width: '100%', borderCollapse: 'collapse' }}>
            <thead><tr>
              {['Fund', 'GP', 'Vintage', 'NAV ($M)', 'Ask', 'Bid', 'Spread', 'TVPI', 'Yrs Left', 'Score', 'Urgency', 'Top Holdings'].map(h => (
                <TH key={h} align={['Fund','GP','Top Holdings'].includes(h) ? 'left' : 'right'}>{h}</TH>
              ))}
            </tr></thead>
            <tbody>
              {SECONDARIES.sort((a, b) => b.score - a.score).map(d => (
                <React.Fragment key={d.id}>
                  <TR onClick={() => setExpandedDeal(expandedDeal === d.id ? null : d.id)}>
                    <TD bold>
                      <div style={{ display: 'flex', alignItems: 'center', gap: 5 }}>
                        <ChevronRight size={11} color={T.textDim} style={{ transform: expandedDeal === d.id ? 'rotate(90deg)' : 'none', transition: 'transform 0.15s' }} />
                        {d.fund}
                      </div>
                    </TD>
                    <TD color={T.textMuted}>{d.gp}</TD>
                    <TD align="right" mono>{d.vintage}</TD>
                    <TD align="right" mono bold>${d.nav.toLocaleString()}</TD>
                    <TD align="right" mono color={d.askPrice <= 75 ? T.green : T.text}>{d.askPrice}¢</TD>
                    <TD align="right" mono color={d.bidPrice <= 70 ? T.green : T.textMuted}>{d.bidPrice}¢</TD>
                    <TD align="right" mono color={T.amber}>{d.spread}%</TD>
                    <TD align="right" mono bold color={d.tvpi >= 1.5 ? T.accent : d.tvpi >= 1.0 ? T.text : T.red}>{d.tvpi}x</TD>
                    <TD align="right" mono color={T.textMuted}>{d.remaining}y</TD>
                    <TD align="right" mono bold color={d.score >= 90 ? T.accent : d.score >= 80 ? T.blue : T.textMuted}>{d.score}</TD>
                    <TD align="right"><Badge color={d.urgency === 'high' ? T.red : d.urgency === 'medium' ? T.amber : T.textMuted}>{d.urgency}</Badge></TD>
                    <TD color={T.textDim}>{d.topCo}</TD>
                  </TR>
                  {expandedDeal === d.id && (
                    <tr><td colSpan={12} style={{ padding: 0 }}>
                      <div style={{ background: T.bgAccent, padding: '14px 20px 14px 32px', borderBottom: `1px solid ${T.border}` }}>
                        <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: 6 }}>Investment Thesis</div>
                        <div style={{ fontSize: 12, color: T.accent, lineHeight: 1.6, maxWidth: 700 }}>{d.thesis}</div>
                        <div style={{ display: 'flex', gap: 24, marginTop: 10 }}>
                          <div><span style={{ fontSize: 9, color: T.textDim }}>DISCOUNT TO NAV</span><div style={{ fontSize: 14, fontWeight: 700, fontFamily: mono, color: T.green }}>{100-d.askPrice}%</div></div>
                          <div><span style={{ fontSize: 9, color: T.textDim }}>IMPLIED ENTRY TVPI</span><div style={{ fontSize: 14, fontWeight: 700, fontFamily: mono, color: T.accent }}>{(d.tvpi / (d.askPrice/100)).toFixed(2)}x</div></div>
                          <div><span style={{ fontSize: 9, color: T.textDim }}>DAYS LISTED</span><div style={{ fontSize: 14, fontWeight: 700, fontFamily: mono, color: d.daysListed < 14 ? T.red : T.textMuted }}>{d.daysListed}</div></div>
                          <div><span style={{ fontSize: 9, color: T.textDim }}>EST. HOLD PERIOD</span><div style={{ fontSize: 14, fontWeight: 700, fontFamily: mono, color: T.text }}>{d.remaining.toFixed(0)} years</div></div>
                        </div>
                      </div>
                    </td></tr>
                  )}
                </React.Fragment>
              ))}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
};

// ════════════════════════════════════════════════════
// PUBLIC MARKET INVESTOR VIEW
// ════════════════════════════════════════════════════
const PublicMarketView = () => {
  return (
    <div>
      {/* Headline Proposition */}
      <div style={{ background: `linear-gradient(135deg, ${T.bgCard}, ${T.bgAccent})`, border: `1px solid ${T.border}`, borderRadius: 10, padding: '22px 26px', marginBottom: 18 }}>
        <div style={{ fontSize: 10, color: T.accent, textTransform: 'uppercase', letterSpacing: '1.5px', fontWeight: 800, marginBottom: 8 }}>Why NEWCO for Public Market Investors</div>
        <div style={{ fontSize: 18, fontWeight: 700, color: T.text, lineHeight: 1.5, marginBottom: 14 }}>
          First zero-fee publicly listed venture vehicle. Access Anthropic, Anduril, Scale AI, Databricks exposure through a single NYSE ticker at institutional pricing.
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 14 }}>
          {[
            { label: '0% Mgmt Fee', desc: 'Performance-only: 10% over 8% hurdle', icon: '◉', color: T.accent },
            { label: 'Daily Liquidity', desc: 'NYSE-listed, no lockups, no gates', icon: '◎', color: T.blue },
            { label: 'Audited NAV', desc: 'Quarterly NAV, KPMG-audited', icon: '◈', color: T.gold },
            { label: 'Co-Invest Rights', desc: '10K+ shares = direct deal access', icon: '◆', color: T.purple },
          ].map(p => (
            <div key={p.label} style={{ padding: '12px 14px', borderRadius: 6, background: `${p.color}08`, border: `1px solid ${p.color}20` }}>
              <div style={{ fontSize: 20, marginBottom: 4 }}>{p.icon}</div>
              <div style={{ fontSize: 13, fontWeight: 700, color: p.color, marginBottom: 2 }}>{p.label}</div>
              <div style={{ fontSize: 10, color: T.textMuted, lineHeight: 1.4 }}>{p.desc}</div>
            </div>
          ))}
        </div>
      </div>

      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 18 }}>
        <Stat label="Share Price" value="$24.38" icon={DollarSign} trend={2.4} sub="NYSE: NEWCO" color={T.accent} />
        <Stat label="NAV / Share" value="$23.85" icon={Target} sub="+2.2% premium" color={T.blue} />
        <Stat label="Market Cap" value="$235M" icon={Building2} trend={8} color={T.purple} />
        <Stat label="52-Wk Return" value="+21.9%" icon={TrendingUp} color={T.green} />
        <Stat label="Expense Ratio" value="0.00%" icon={Award} sub="zero mgmt fee" color={T.gold} />
      </div>

      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 14, marginBottom: 18 }}>
        <NavPremDiscChart />

        {/* Shareholder Value Waterfall */}
        <Card title="Shareholder Value Creation">
          <div style={{ padding: 16 }}>
            {[
              { label: 'Portfolio NAV Appreciation', value: '+18.2%', sub: 'Underlying fund markups', color: T.accent, bar: 72 },
              { label: 'Secondary Discount Capture', value: '+6.8%', sub: 'Buying LP interests at 15-40% discount', color: T.green, bar: 28 },
              { label: 'SBIC Leverage (2-3x)', value: '+4.1%', sub: 'SBA-guaranteed leverage on qualified assets', color: T.blue, bar: 16 },
              { label: 'Fee Savings vs Peers', value: '+2.0%', sub: 'Zero mgmt fee vs 1.5-2% industry avg', color: T.gold, bar: 8 },
              { label: 'Network Alpha', value: '+1.5%', sub: 'Proprietary deal flow from 974-score network', color: T.purple, bar: 6 },
            ].map((r, i) => (
              <div key={i} style={{ marginBottom: 14 }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'baseline', marginBottom: 3 }}>
                  <span style={{ fontSize: 12, color: T.text, fontWeight: 500 }}>{r.label}</span>
                  <span style={{ fontSize: 14, fontWeight: 800, fontFamily: mono, color: r.color }}>{r.value}</span>
                </div>
                <div style={{ fontSize: 10, color: T.textDim, marginBottom: 4 }}>{r.sub}</div>
                <Bar value={r.bar} max={80} color={r.color} h={5} />
              </div>
            ))}
            <div style={{ borderTop: `1px solid ${T.border}`, paddingTop: 10, marginTop: 6, display: 'flex', justifyContent: 'space-between' }}>
              <span style={{ fontSize: 13, fontWeight: 700, color: T.text }}>Total Projected Annual Return</span>
              <span style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: T.accent }}>+32.6%</span>
            </div>
          </div>
        </Card>
      </div>

      {/* Comparable Vehicles */}
      <Card title="Public Market Comparable Vehicles" style={{ marginBottom: 18 }}>
        <div style={{ overflowX: 'auto' }}>
          <table style={{ width: '100%', borderCollapse: 'collapse' }}>
            <thead><tr>
              {['Ticker', 'Vehicle', 'Structure', 'Focus', 'AUM ($M)', 'NAV', 'Price', 'Prem/Disc', 'Div Yield', 'Exp Ratio', 'TVPI'].map(h => (
                <TH key={h} align={['Ticker','Vehicle','Structure','Focus'].includes(h) ? 'left' : 'right'}>{h}</TH>
              ))}
            </tr></thead>
            <tbody>
              {PUBLIC_COMPS.map(c => (
                <TR key={c.ticker}>
                  <TD bold color={c.ticker === 'NEWCO' ? T.accent : T.text}>{c.ticker}</TD>
                  <TD color={c.ticker === 'NEWCO' ? T.accent : T.textMuted}>{c.name}</TD>
                  <TD><Badge color={c.structure === 'Listed CEF' ? T.accent : c.structure === 'BDC' ? T.blue : T.textMuted}>{c.structure}</Badge></TD>
                  <TD color={T.textMuted}>{c.focus}</TD>
                  <TD align="right" mono>{c.aum >= 1000 ? `${(c.aum/1000).toFixed(1)}B` : `${c.aum}M`}</TD>
                  <TD align="right" mono>${c.nav.toFixed(2)}</TD>
                  <TD align="right" mono bold>${c.price.toFixed(2)}</TD>
                  <TD align="right" mono bold color={c.premDisc > 5 ? T.red : c.premDisc > 0 ? T.amber : c.premDisc > -5 ? T.text : T.green}>{c.premDisc > 0 ? '+' : ''}{c.premDisc.toFixed(1)}%</TD>
                  <TD align="right" mono color={c.divYield >= 8 ? T.green : T.textMuted}>{c.divYield}%</TD>
                  <TD align="right" mono bold color={c.expRatio === 0 ? T.accent : c.expRatio < 1 ? T.text : T.red}>{c.expRatio}%</TD>
                  <TD align="right" mono bold color={c.tvpi >= 1.3 ? T.accent : T.text}>{c.tvpi}x</TD>
                </TR>
              ))}
            </tbody>
          </table>
        </div>
      </Card>

      {/* Investor FAQ */}
      <Card title="Public Investor Value Proposition">
        <div style={{ padding: 16 }}>
          {[
            { q: 'How is NEWCO different from buying individual VC-backed SPACs?', a: 'NEWCO provides diversified exposure across 120+ portfolio companies through 8+ institutional funds. Unlike SPACs, our NAV is audited quarterly, there are no promote economics, and you get secondary market alpha from buying LP interests at 15-40% discounts.' },
            { q: 'What protects against NAV discount?', a: 'Three mechanisms: (1) Active share buyback program triggers at >5% discount, (2) SBIC leverage creates floor valuation support, (3) Quarterly distributions from realized exits reduce dependence on NAV appreciation alone.' },
            { q: 'How does the zero management fee work?', a: 'NEWCO charges 0% management fee. Revenue comes only from 10% performance allocation above an 8% preferred return hurdle. This means we only earn when shareholders earn meaningful returns first.' },
            { q: 'What is the co-investment rights structure?', a: '10K shares = allocation rights to direct deals. 50K = priority allocation + monthly LP letters. 250K+ = GP-level access, advisory council seat, and quarterly strategy calls. This creates accumulation incentive and long-term holder alignment.' },
          ].map((faq, i) => (
            <div key={i} style={{ marginBottom: i < 3 ? 16 : 0, paddingBottom: i < 3 ? 16 : 0, borderBottom: i < 3 ? `1px solid ${T.border}` : 'none' }}>
              <div style={{ fontSize: 12, fontWeight: 700, color: T.text, marginBottom: 5 }}>{faq.q}</div>
              <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.7 }}>{faq.a}</div>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
};

// ════════════════════════════════════════════════════
// REMAINING TABS (condensed from v1)
// ════════════════════════════════════════════════════
const FoFDashboard = () => {
  const [sortBy, setSortBy] = useState('tvpi');
  const [filterTier, setFilterTier] = useState('All');
  const [subView, setSubView] = useState('positions');
  const filtered = useMemo(() => {
    let f = [...FUNDS]; if (filterTier !== 'All') f = f.filter(x => x.tier === filterTier);
    f.sort((a, b) => b[sortBy] - a[sortBy]); return f;
  }, [sortBy, filterTier]);
  const tot = useMemo(() => ({ c: FUNDS.reduce((s,f)=>s+f.committed,0), k: FUNDS.reduce((s,f)=>s+f.called,0), n: FUNDS.reduce((s,f)=>s+f.nav,0), irr: (FUNDS.reduce((s,f)=>s+f.irr,0)/FUNDS.length).toFixed(1), tvpi: (FUNDS.reduce((s,f)=>s+f.tvpi,0)/FUNDS.length).toFixed(2) }), []);
  const tierC = t => ({Core:T.accent,Strategic:T.blue,Exploration:T.amber}[t]||T.textMuted);
  const statC = s => ({Active:T.accent,Deploying:T.blue,Harvesting:T.amber}[s]||T.textMuted);

  // Rebalancing recs
  const rebalanceRecs = useMemo(() => {
    const targetAlloc = { Core: 60, Strategic: 25, Exploration: 15 };
    const currentAlloc = {};
    FUNDS.forEach(f => { currentAlloc[f.tier] = (currentAlloc[f.tier]||0) + f.nav; });
    const totalNAV = FUNDS.reduce((s,f)=>s+f.nav,0);
    return Object.entries(targetAlloc).map(([tier, target]) => {
      const actual = ((currentAlloc[tier]||0)/totalNAV*100);
      const delta = actual - target;
      return { tier, target, actual: actual.toFixed(1), delta: delta.toFixed(1), nav: (currentAlloc[tier]||0).toFixed(1), action: delta > 5 ? 'Overweight — consider trimming' : delta < -5 ? 'Underweight — increase allocation' : 'Within tolerance' };
    });
  }, []);

  // GP relationship health
  const gpHealth = FUNDS.map(f => ({
    ...f,
    health: f.irr >= 25 ? 'Excellent' : f.irr >= 18 ? 'Strong' : f.irr >= 12 ? 'Acceptable' : 'Watch',
    lastMeeting: ['2 weeks ago', '1 month ago', '3 weeks ago', '5 days ago', '6 weeks ago', '1 week ago', '2 weeks ago', '4 weeks ago'][f.id - 1],
    nextCapCall: [`$${(f.committed - f.called).toFixed(1)}M`, 'Q2 2026', f.committed - f.called > 5 ? 'Expected' : 'Complete'][0],
    coInvestOpps: [2, 1, 3, 0, 1, 0, 2, 1][f.id - 1],
    reUp: f.irr >= 20 && f.tvpi >= 1.3 ? 'Yes — priority' : f.irr >= 15 ? 'Evaluate' : 'Decline',
  }));

  // Capital recycling opportunities
  const recycling = [
    { source: 'NEA 19 — Palantir (public)', amount: 5.4, action: 'Sell public position, redeploy to pre-IPO AI Safety', irr: '+4.2%', urgency: 'high' },
    { source: 'Benchmark X — Verkada (flat)', amount: 2.6, action: 'Secondary sale at par, rotate into Shield AI co-invest', irr: '+3.8%', urgency: 'medium' },
    { source: 'Greylock XVII — Drata (flat)', amount: 1.6, action: 'GP-led secondary at 95¢, recycle into Anthropic Safety allocation', irr: '+2.1%', urgency: 'medium' },
    { source: 'a16z Infra — Scale AI (mature)', amount: 3.2, action: 'Partial exit via tender offer, fund OpenAI Ecosystem commitment', irr: '+5.5%', urgency: 'high' },
  ];

  const subViews = [{ id: 'positions', label: 'Fund Positions' }, { id: 'rebalance', label: 'Rebalancing' }, { id: 'gp', label: 'GP Health' }, { id: 'recycle', label: 'Capital Recycling' }];

  return (
    <div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
        <Stat label="Total Committed" value={`$${tot.c}M`} icon={DollarSign} trend={12} color={T.accent}/>
        <Stat label="Capital Called" value={`$${tot.k.toFixed(1)}M`} icon={Target} sub={`${((tot.k/tot.c)*100).toFixed(0)}% deployed`} color={T.blue}/>
        <Stat label="Total NAV" value={`$${tot.n.toFixed(1)}M`} icon={TrendingUp} trend={8.3} color={T.accent}/>
        <Stat label="Wtd Avg TVPI" value={`${tot.tvpi}x`} icon={BarChart3} trend={5} color={T.purple}/>
        <Stat label="Recyclable Capital" value={`$${recycling.reduce((s,r)=>s+r.amount,0).toFixed(1)}M`} icon={Activity} sub="4 opportunities" color={T.green}/>
      </div>
      <div style={{ display: 'flex', gap: 2, marginBottom: 14, background: T.bgCard, borderRadius: 6, padding: 3, border: `1px solid ${T.border}` }}>
        {subViews.map(v => <button key={v.id} onClick={() => setSubView(v.id)} style={{ padding: '6px 12px', borderRadius: 4, border: 'none', cursor: 'pointer', fontSize: 11, fontWeight: 600, background: subView === v.id ? T.accent : 'transparent', color: subView === v.id ? T.bg : T.textMuted, fontFamily: sans }}>{v.label}</button>)}
      </div>

      {subView === 'positions' && (
        <Card title="Portfolio Fund Positions" action={<div style={{display:'flex',gap:6}}>{['All','Core','Strategic','Exploration'].map(t=><button key={t} onClick={()=>setFilterTier(t)} style={{padding:'3px 8px',borderRadius:3,fontSize:10,fontWeight:600,border:'none',cursor:'pointer',background:filterTier===t?T.accent:T.bgAccent,color:filterTier===t?T.bg:T.textMuted}}>{t}</button>)}</div>}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Fund','GP','Vintage','Tier','Status','Committed','Called','NAV','TVPI','IRR','DPI','Cos'].map(h=><TH key={h} align={['Fund','GP'].includes(h)?'left':'right'} onClick={['tvpi','irr','dpi','committed','nav'].includes(h.toLowerCase())?()=>setSortBy(h.toLowerCase()):undefined}>{h}</TH>)}</tr></thead>
            <tbody>{filtered.map(f=>(
              <TR key={f.id}>
                <TD bold>{f.name}</TD><TD color={T.textMuted}>{f.gp}</TD><TD align="right" mono>{f.vintage}</TD>
                <TD align="right"><Badge color={tierC(f.tier)}>{f.tier}</Badge></TD>
                <TD align="right"><Badge color={statC(f.status)}>{f.status}</Badge></TD>
                <TD align="right" mono>${f.committed}M</TD><TD align="right" mono color={T.textMuted}>${f.called}M</TD>
                <TD align="right" mono bold color={T.accent}>${f.nav}M</TD>
                <TD align="right" mono bold color={f.tvpi>=1.5?T.accent:f.tvpi>=1.2?T.text:T.red}>{f.tvpi}x</TD>
                <TD align="right" mono bold color={f.irr>=25?T.accent:f.irr>=15?T.text:T.amber}>{f.irr}%</TD>
                <TD align="right" mono color={T.textMuted}>{f.dpi}x</TD>
                <TD align="right" mono color={T.textMuted}>{f.companies}</TD>
              </TR>
            ))}</tbody>
          </table></div>
        </Card>
      )}

      {subView === 'rebalance' && (
        <div>
          <Card title="Portfolio Rebalancing — Target vs Actual Allocation" style={{ marginBottom: 14 }}>
            <div style={{ padding: 16 }}>
              {rebalanceRecs.map((r, i) => (
                <div key={i} style={{ marginBottom: 16 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>
                    <span style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{r.tier}</span>
                    <div style={{ display: 'flex', gap: 12 }}>
                      <span style={{ fontSize: 11, fontFamily: mono }}><span style={{ color: T.textDim }}>Actual</span> <span style={{ color: T.accent, fontWeight: 700 }}>{r.actual}%</span></span>
                      <span style={{ fontSize: 11, fontFamily: mono }}><span style={{ color: T.textDim }}>Target</span> <span style={{ color: T.textMuted }}>{r.target}%</span></span>
                      <span style={{ fontSize: 11, fontFamily: mono, color: parseFloat(r.delta) > 5 ? T.amber : parseFloat(r.delta) < -5 ? T.red : T.green, fontWeight: 700 }}>{parseFloat(r.delta) >= 0 ? '+' : ''}{r.delta}%</span>
                    </div>
                  </div>
                  <div style={{ position: 'relative', height: 22, background: T.bgAccent, borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ position: 'absolute', height: '100%', width: `${r.actual}%`, background: tierC(r.tier), borderRadius: 4, opacity: 0.8 }} />
                    <div style={{ position: 'absolute', height: '100%', width: 2, left: `${r.target}%`, background: T.text, opacity: 0.6 }} />
                    <span style={{ position: 'absolute', right: 8, top: 3, fontSize: 10, fontFamily: mono, fontWeight: 700, color: T.bg }}>${r.nav}M</span>
                  </div>
                  <div style={{ fontSize: 10, color: parseFloat(r.delta) > 5 ? T.amber : parseFloat(r.delta) < -5 ? T.red : T.green, marginTop: 3 }}>{r.action}</div>
                </div>
              ))}
            </div>
          </Card>
          <Card title="Commitment Pacing Calendar">
            <div style={{ padding: 16, display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10 }}>
              {[{ q: 'Q1 2026', planned: 15, committed: 12, deals: ['Shield AI II ($8M)', 'Rebellion ($4M)'], status: 'On Track' },
                { q: 'Q2 2026', planned: 20, committed: 0, deals: ['Anduril Growth ($12M)', 'OpenAI Eco ($8M)'], status: 'Upcoming' },
                { q: 'Q3 2026', planned: 10, committed: 0, deals: ['Anthropic Safety ($10M)'], status: 'Planned' },
                { q: 'Q4 2026', planned: 15, committed: 0, deals: ['TBD — pipeline dependent'], status: 'Provisional' }].map((q, i) => (
                <div key={i} style={{ padding: 14, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${q.committed > 0 ? T.accent : q.status === 'Upcoming' ? T.blue : T.textDim}` }}>
                  <div style={{ fontSize: 14, fontWeight: 800, color: T.text, marginBottom: 4 }}>{q.q}</div>
                  <div style={{ fontSize: 20, fontWeight: 900, fontFamily: mono, color: T.accent }}>${q.planned}M</div>
                  <div style={{ fontSize: 9, color: T.textDim, marginBottom: 8 }}>planned · {q.committed > 0 ? `$${q.committed}M done` : 'pending'}</div>
                  {q.deals.map((d, j) => <div key={j} style={{ fontSize: 10, color: T.textMuted, padding: '2px 0' }}>• {d}</div>)}
                  <Badge color={q.status === 'On Track' ? T.accent : q.status === 'Upcoming' ? T.blue : T.textDim}>{q.status}</Badge>
                </div>
              ))}
            </div>
          </Card>
        </div>
      )}

      {subView === 'gp' && (
        <Card title="GP Relationship Health & Re-Up Analysis">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Fund', 'GP', 'IRR', 'TVPI', 'Health', 'Last Meeting', 'Uncalled', 'Co-Invest Opps', 'Re-Up Decision'].map(h => <TH key={h} align={['Fund','GP','Health','Last Meeting','Re-Up Decision'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{gpHealth.sort((a,b)=>b.irr-a.irr).map(f => (
              <TR key={f.id}>
                <TD bold>{f.name.split(' ').slice(0,2).join(' ')}</TD>
                <TD color={T.textMuted}>{f.gp}</TD>
                <TD align="right" mono bold color={f.irr>=25?T.accent:f.irr>=18?T.text:T.amber}>{f.irr}%</TD>
                <TD align="right" mono bold color={f.tvpi>=1.5?T.accent:T.text}>{f.tvpi}x</TD>
                <TD><Badge color={f.health==='Excellent'?T.accent:f.health==='Strong'?T.green:f.health==='Acceptable'?T.amber:T.red}>{f.health}</Badge></TD>
                <TD color={T.textMuted}>{f.lastMeeting}</TD>
                <TD align="right" mono color={T.amber}>${(f.committed-f.called).toFixed(1)}M</TD>
                <TD align="right" mono bold color={f.coInvestOpps>0?T.accent:T.textDim}>{f.coInvestOpps}</TD>
                <TD><Badge color={f.reUp.includes('priority')?T.accent:f.reUp==='Evaluate'?T.amber:T.red}>{f.reUp}</Badge></TD>
              </TR>
            ))}</tbody>
          </table></div>
        </Card>
      )}

      {subView === 'recycle' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Capital Recycling — Free Up Capital From Underperforming Positions</div>
          {recycling.map((r, i) => (
            <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 8, borderLeft: `3px solid ${r.urgency === 'high' ? T.accent : T.blue}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                <div>
                  <div style={{ fontSize: 14, fontWeight: 700, color: T.text, marginBottom: 2 }}>{r.source}</div>
                  <Badge color={r.urgency === 'high' ? T.accent : T.blue}>{r.urgency}</Badge>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <div style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: T.accent }}>${r.amount}M</div>
                  <div style={{ fontSize: 10, fontFamily: mono, color: T.green }}>IRR impact: {r.irr}</div>
                </div>
              </div>
              <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.7 }}>{r.action}</div>
            </div>
          ))}
          <div style={{ marginTop: 14, padding: 14, background: T.accentBg, borderRadius: 8, border: `1px solid ${T.accent}25` }}>
            <div style={{ fontSize: 10, color: T.accent, fontWeight: 700, marginBottom: 4 }}>TOTAL RECYCLABLE</div>
            <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>${recycling.reduce((s,r)=>s+r.amount,0).toFixed(1)}M</div>
            <div style={{ fontSize: 11, color: T.textMuted, marginTop: 4 }}>Recycling these positions into higher-conviction names would add an estimated +3.2% to portfolio IRR over the next 3 years.</div>
          </div>
        </div>
      )}
    </div>
  );
};

const DealPipeline = () => {
  const [subView, setSubView] = useState('kanban');
  const stages = ['Screening','Due Diligence','IC Review','Term Sheet','Monitoring'];
  const sC = {Screening:T.textMuted,'Due Diligence':T.blue,'IC Review':T.purple,'Term Sheet':T.accent,Monitoring:T.amber};

  // Pipeline velocity analytics
  const avgDays = (PIPELINE.reduce((s,p) => s + p.daysInStage, 0) / PIPELINE.length).toFixed(0);
  const totalSize = PIPELINE.reduce((s,p) => s + p.size, 0);
  const highPri = PIPELINE.filter(p => p.priority === 'high').length;
  const conversionRate = ((PIPELINE.filter(p => p.stage === 'Term Sheet').length / PIPELINE.length) * 100).toFixed(0);

  // Stage conversion funnel
  const funnel = stages.map(s => ({ stage: s, count: PIPELINE.filter(p => p.stage === s).length, totalSize: PIPELINE.filter(p => p.stage === s).reduce((sum, p) => sum + p.size, 0) }));

  // Deal scoring breakdown
  const scoringMatrix = PIPELINE.map(p => ({
    ...p,
    gpScore: Math.min(100, p.score + Math.floor(Math.random() * 5 - 2)),
    marketScore: p.sector === 'AI Safety' ? 95 : p.sector === 'GovTech' ? 88 : p.sector === 'AI Infrastructure' ? 82 : 75,
    timingScore: p.daysInStage < 10 ? 90 : p.daysInStage < 20 ? 75 : 60,
    fitScore: p.sector === 'AI Safety' ? 98 : p.sector === 'GovTech' ? 85 : 78,
    riskScore: p.size > 500 ? 65 : p.size > 200 ? 78 : 88,
    expectedReturn: p.score >= 90 ? '3.2x' : p.score >= 80 ? '2.1x' : p.score >= 70 ? '1.5x' : '1.2x',
    recommendation: p.score >= 90 ? 'STRONG BUY' : p.score >= 80 ? 'BUY' : p.score >= 70 ? 'HOLD' : 'PASS',
  }));

  // Bottleneck detection
  const bottlenecks = [
    { deal: 'Palantir Foundry II', stage: 'Due Diligence', days: 22, issue: 'Reference checks stalled — 3 references unresponsive', action: 'Escalate via Ken\'s Palantir network. Direct intro to Alex Karp.', risk: 'Losing allocation to competing LPs if DD extends past Q1.' },
    { deal: 'Scale AI Seed', stage: 'Monitoring', days: 45, issue: 'GP non-responsive to follow-up. Fund may be fully allocated.', action: 'Brett to attend Scale AI demo day. Explore direct co-invest via a16z relationship.', risk: 'Window closing — fund expected to close in 6 weeks.' },
    { deal: 'Rebellion Defense', stage: 'IC Review', days: 8, issue: 'IC split 2-1 on sector thesis. Bob pushing for approval.', action: 'Schedule IC deep-dive on Trust & Safety TAM. Bring external advisor (CrowdStrike CISO).', risk: 'Missing defense budget cycle if delayed past March.' },
  ];

  // Competitive intelligence
  const compIntel = [
    { deal: 'Anduril Growth', competitors: ['Tiger Global', 'Coatue', 'General Atlantic'], ourEdge: 'Jason\'s direct Palmer Lucky relationship. Only LP with defense sector specialization.', status: 'Leading — term sheet stage', winProb: 82 },
    { deal: 'Anthropic Safety', competitors: ['Spark Capital', 'Thrive Capital', 'Greenoaks'], ourEdge: 'Bob\'s relationship with Dario. Constitutional AI thesis alignment with fund mandate.', status: 'Early — screening. Need to move fast.', winProb: 45 },
    { deal: 'OpenAI Ecosystem', competitors: ['Sequoia', 'Andreessen Horowitz', 'Thrive Capital'], ourEdge: 'AI Safety thesis differentiation. No other AI Safety-focused FoF competing at this level.', status: 'Day 1 — deck review. Massive opportunity.', winProb: 35 },
    { deal: 'Shield AI Fund II', competitors: ['Valor Equity', 'Andreessen Horowitz'], ourEdge: 'Ken\'s direct relationship with CEO. Prior fund investor (via Benchmark X).', status: 'DD complete — IC pending', winProb: 78 },
  ];

  // Next 30 day action calendar
  const calendar = [
    { date: 'Feb 10', action: 'Shield AI Fund II — IC Vote', owner: 'Ken', deal: 'Shield AI Fund II', critical: true },
    { date: 'Feb 12', action: 'Anthropic Safety — First GP Meeting', owner: 'Bob', deal: 'Anthropic Safety', critical: true },
    { date: 'Feb 14', action: 'Anduril Growth — Legal review call', owner: 'Jason', deal: 'Anduril Growth', critical: true },
    { date: 'Feb 18', action: 'OpenAI Ecosystem — Deck deep-dive', owner: 'Jason', deal: 'OpenAI Ecosystem', critical: false },
    { date: 'Feb 20', action: 'Rebellion Defense — IC re-vote w/ external advisor', owner: 'Bob', deal: 'Rebellion Defense', critical: false },
    { date: 'Feb 25', action: 'Palantir Foundry II — Escalated reference calls', owner: 'Ken', deal: 'Palantir Foundry II', critical: false },
    { date: 'Mar 1', action: 'Scale AI — Demo day attendance', owner: 'Brett', deal: 'Scale AI Seed', critical: false },
    { date: 'Mar 5', action: 'Anduril Growth — Expected close / wire', owner: 'Jason', deal: 'Anduril Growth', critical: true },
    { date: 'Mar 10', action: 'Q1 pipeline review — full IC session', owner: 'All', deal: 'All', critical: true },
  ];

  const subViews = [
    { id: 'kanban', label: 'Kanban' }, { id: 'scoring', label: 'Deal Scoring' },
    { id: 'bottlenecks', label: 'Bottlenecks' }, { id: 'competitive', label: 'Competitive Intel' },
    { id: 'calendar', label: 'Action Calendar' }, { id: 'funnel', label: 'Funnel Analytics' },
  ];

  return (
    <div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
        <Stat label="Total Pipeline" value={`$${(totalSize/1000).toFixed(1)}B`} icon={GitBranch} sub={`${PIPELINE.length} opportunities`} color={T.accent}/>
        <Stat label="High Priority" value={highPri} icon={Zap} sub="action required" color={T.red}/>
        <Stat label="Avg Days in Stage" value={`${avgDays}d`} icon={Clock} sub={parseInt(avgDays) < 15 ? 'healthy' : 'watch'} color={parseInt(avgDays) < 15 ? T.green : T.amber}/>
        <Stat label="Term Sheet Rate" value={`${conversionRate}%`} icon={Target} sub="pipeline → TS" color={T.purple}/>
        <Stat label="Win Probability" value={`${(compIntel.reduce((s,c)=>s+c.winProb,0)/compIntel.length).toFixed(0)}%`} icon={Award} sub="weighted avg" color={T.blue}/>
      </div>
      <div style={{ display: 'flex', gap: 2, marginBottom: 14, background: T.bgCard, borderRadius: 6, padding: 3, border: `1px solid ${T.border}`, overflowX: 'auto' }}>
        {subViews.map(v => <button key={v.id} onClick={() => setSubView(v.id)} style={{ padding: '6px 12px', borderRadius: 4, border: 'none', cursor: 'pointer', fontSize: 11, fontWeight: 600, background: subView === v.id ? T.accent : 'transparent', color: subView === v.id ? T.bg : T.textMuted, fontFamily: sans, whiteSpace: 'nowrap' }}>{v.label}</button>)}
      </div>

      {subView === 'kanban' && (
        <div style={{display:'grid',gridTemplateColumns:`repeat(${stages.length},1fr)`,gap:10}}>
          {stages.map(stage=>{const deals=PIPELINE.filter(d=>d.stage===stage);return(
            <div key={stage} style={{background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,overflow:'hidden'}}>
              <div style={{padding:'10px 12px',borderBottom:`2px solid ${sC[stage]}`,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <span style={{fontSize:10,fontWeight:700,color:T.text,textTransform:'uppercase',letterSpacing:'0.4px'}}>{stage}</span>
                <span style={{fontSize:16,fontWeight:700,color:sC[stage],fontFamily:mono}}>{deals.length}</span>
              </div>
              <div style={{padding:6,display:'flex',flexDirection:'column',gap:4,minHeight:160}}>
                {deals.map(d=>(
                  <div key={d.id} style={{padding:'8px 10px',borderRadius:5,border:`1px solid ${T.border}`,background:T.bgSurface}}>
                    <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                      <span style={{fontSize:11,fontWeight:600,color:T.text}}>{d.name}</span>
                      <span style={{fontSize:10,fontWeight:700,fontFamily:mono,color:d.score>=90?T.accent:d.score>=80?T.blue:T.textMuted}}>{d.score}</span>
                    </div>
                    <div style={{fontSize:9,color:T.textDim,marginBottom:3}}>{d.gp} · ${d.size}M</div>
                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                      <Badge color={d.priority==='high'?T.red:d.priority==='medium'?T.amber:T.textMuted}>{d.priority}</Badge>
                      <span style={{fontSize:9,color:T.textDim}}>{d.daysInStage}d · {d.owner}</span>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );})}
        </div>
      )}

      {subView === 'scoring' && (
        <Card title="Multi-Factor Deal Scoring Matrix">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Deal', 'Stage', 'Overall', 'GP Quality', 'Market', 'Timing', 'Thesis Fit', 'Risk', 'Exp. Return', 'Recommendation'].map(h => <TH key={h} align={['Deal','Stage','Recommendation'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{scoringMatrix.sort((a,b)=>b.score-a.score).map(d => (
              <TR key={d.id}>
                <TD bold>{d.name}</TD>
                <TD><Badge color={sC[d.stage]}>{d.stage.split(' ')[0]}</Badge></TD>
                <TD align="right" mono bold color={d.score>=90?T.accent:d.score>=80?T.blue:T.textMuted}>{d.score}</TD>
                <TD align="right" mono color={d.gpScore>=90?T.accent:T.text}>{d.gpScore}</TD>
                <TD align="right" mono color={d.marketScore>=85?T.accent:T.text}>{d.marketScore}</TD>
                <TD align="right" mono color={d.timingScore>=80?T.green:d.timingScore>=70?T.text:T.red}>{d.timingScore}</TD>
                <TD align="right" mono color={d.fitScore>=90?T.accent:T.text}>{d.fitScore}</TD>
                <TD align="right" mono color={d.riskScore>=80?T.green:d.riskScore>=70?T.amber:T.red}>{d.riskScore}</TD>
                <TD align="right" mono bold color={T.accent}>{d.expectedReturn}</TD>
                <TD><Badge color={d.recommendation==='STRONG BUY'?T.accent:d.recommendation==='BUY'?T.green:d.recommendation==='HOLD'?T.amber:T.red}>{d.recommendation}</Badge></TD>
              </TR>
            ))}</tbody>
          </table></div>
        </Card>
      )}

      {subView === 'bottlenecks' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Pipeline Bottleneck Detection — Deals Requiring Intervention</div>
          {bottlenecks.map((b, i) => (
            <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 10, borderLeft: `3px solid ${b.days > 30 ? T.red : T.amber}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                <div>
                  <div style={{ fontSize: 14, fontWeight: 700, color: T.text, marginBottom: 3 }}>{b.deal}</div>
                  <div style={{ display: 'flex', gap: 6 }}>
                    <Badge color={sC[b.stage]}>{b.stage}</Badge>
                    <Badge color={b.days > 30 ? T.red : T.amber}>{b.days} days</Badge>
                  </div>
                </div>
                <Badge color={T.red}>BOTTLENECK</Badge>
              </div>
              <div style={{ fontSize: 11, color: T.red, fontWeight: 600, marginBottom: 4 }}>Issue: {b.issue}</div>
              <div style={{ fontSize: 11, color: T.accent, marginBottom: 4 }}>Action: {b.action}</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>Risk: {b.risk}</div>
            </div>
          ))}
        </div>
      )}

      {subView === 'competitive' && (
        <Card title="Competitive Intelligence — Who Else Is Bidding?">
          <div style={{ padding: 0 }}>{compIntel.map((c, i) => (
            <div key={i} style={{ padding: '16px 18px', borderBottom: i < compIntel.length - 1 ? `1px solid ${T.border}` : 'none' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{c.deal}</div>
                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                  <span style={{ fontSize: 9, color: T.textDim }}>WIN PROB</span>
                  <span style={{ fontSize: 18, fontWeight: 800, fontFamily: mono, color: c.winProb >= 70 ? T.accent : c.winProb >= 40 ? T.amber : T.red }}>{c.winProb}%</span>
                </div>
              </div>
              <div style={{ display: 'flex', gap: 4, marginBottom: 6, flexWrap: 'wrap' }}>
                <span style={{ fontSize: 9, color: T.textDim, marginRight: 4 }}>COMPETING:</span>
                {c.competitors.map(comp => <Badge key={comp} color={T.red}>{comp}</Badge>)}
              </div>
              <div style={{ fontSize: 11, color: T.accent, marginBottom: 4 }}>Our Edge: {c.ourEdge}</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>{c.status}</div>
              <Bar value={c.winProb} max={100} color={c.winProb >= 70 ? T.accent : c.winProb >= 40 ? T.amber : T.red} h={3} />
            </div>
          ))}</div>
        </Card>
      )}

      {subView === 'calendar' && (
        <Card title="Next 30 Days — Critical Path Actions">
          <div style={{ padding: 0 }}>{calendar.map((c, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 14, padding: '12px 18px', borderBottom: i < calendar.length - 1 ? `1px solid ${T.border}` : 'none', background: c.critical ? `${T.accent}06` : 'transparent' }}>
              <div style={{ width: 60, flexShrink: 0 }}>
                <div style={{ fontSize: 12, fontWeight: 700, fontFamily: mono, color: c.critical ? T.accent : T.text }}>{c.date}</div>
              </div>
              {c.critical && <div style={{ width: 6, height: 6, borderRadius: '50%', background: T.red, flexShrink: 0 }} />}
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: 12, fontWeight: 600, color: T.text }}>{c.action}</div>
                <div style={{ fontSize: 10, color: T.textDim }}>{c.deal} · Owner: {c.owner}</div>
              </div>
              {c.critical && <Badge color={T.red}>CRITICAL</Badge>}
            </div>
          ))}</div>
        </Card>
      )}

      {subView === 'funnel' && (
        <div>
          <Card title="Pipeline Conversion Funnel" style={{ marginBottom: 14 }}>
            <div style={{ padding: 16 }}>
              {funnel.map((f, i) => {
                const maxCount = Math.max(...funnel.map(x => x.count));
                const widthPct = Math.max(20, (f.count / Math.max(maxCount, 1)) * 100);
                return (
                  <div key={i} style={{ marginBottom: 12, display: 'flex', alignItems: 'center', gap: 14 }}>
                    <span style={{ width: 100, fontSize: 10, fontWeight: 600, color: T.text, textAlign: 'right' }}>{f.stage}</span>
                    <div style={{ flex: 1, position: 'relative', height: 32, background: T.bgAccent, borderRadius: 4 }}>
                      <div style={{ position: 'absolute', height: '100%', width: `${widthPct}%`, background: `${sC[f.stage]}80`, borderRadius: 4 }} />
                      <span style={{ position: 'absolute', left: 10, top: 8, fontSize: 12, fontWeight: 700, fontFamily: mono, color: T.text }}>{f.count} deals · ${f.totalSize}M</span>
                    </div>
                    {i < funnel.length - 1 && <span style={{ fontSize: 10, fontFamily: mono, color: T.textDim, width: 40, textAlign: 'right' }}>{funnel[i+1].count > 0 ? `${((funnel[i+1].count / Math.max(f.count, 1)) * 100).toFixed(0)}%` : '—'}</span>}
                    {i === funnel.length - 1 && <span style={{ width: 40 }} />}
                  </div>
                );
              })}
            </div>
          </Card>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12 }}>
            <Card title="Sector Pipeline Mix">
              <div style={{ padding: 14 }}>{[...new Set(PIPELINE.map(p => p.sector))].map(s => {
                const deals = PIPELINE.filter(p => p.sector === s);
                const total = deals.reduce((sum, d) => sum + d.size, 0);
                return (<div key={s} style={{ marginBottom: 10 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 3 }}>
                    <span style={{ fontSize: 11, color: T.text }}>{s}</span>
                    <span style={{ fontSize: 10, fontFamily: mono, color: T.accent }}>{deals.length} deals · ${total}M</span>
                  </div>
                  <Bar value={total} max={totalSize} color={s === 'AI Safety' ? T.accent : s === 'GovTech' ? T.blue : T.purple} h={5} />
                </div>);
              })}</div>
            </Card>
            <Card title="Pipeline by Owner">
              <div style={{ padding: 14 }}>{[...new Set(PIPELINE.map(p => p.owner))].map(o => {
                const deals = PIPELINE.filter(p => p.owner === o);
                const avgS = (deals.reduce((s, d) => s + d.score, 0) / deals.length).toFixed(0);
                return (<div key={o} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '7px 0', borderBottom: `1px solid ${T.border}06` }}>
                  <span style={{ fontSize: 12, fontWeight: 600, color: T.text }}>{o}</span>
                  <div style={{ display: 'flex', gap: 12, fontSize: 11, fontFamily: mono }}>
                    <span style={{ color: T.textMuted }}>{deals.length} deals</span>
                    <span style={{ color: T.accent, fontWeight: 700 }}>avg {avgS}</span>
                    <span style={{ color: T.gold }}>${deals.reduce((s,d)=>s+d.size,0)}M</span>
                  </div>
                </div>);
              })}</div>
            </Card>
          </div>
        </div>
      )}
    </div>
  );
};

const LPManagement = () => {
  const [lpView, setLpView] = useState('registry');
  const tierCfg = {Platinum:{color:T.accent},Gold:{color:T.amber},Silver:{color:T.textMuted}};
  const statCfg = {Committed:T.accent,'In Discussion':T.blue,'Due Diligence':T.purple,Prospecting:T.textMuted};
  const totC = LPS.filter(l=>l.status==='Committed').reduce((s,l)=>s+parseInt(l.potential),0);
  const totalPipeline = LPS.reduce((s,l)=>s+parseInt(l.potential),0);

  // LP engagement scoring
  const lpScoring = LPS.map(l => {
    const aumNum = parseFloat(l.aum.replace(/[^0-9.]/g, ''));
    const aumScale = l.aum.includes('T') ? aumNum * 1000 : aumNum;
    const engagementScore = l.status === 'Committed' ? 95 : l.status === 'Due Diligence' ? 75 : l.status === 'In Discussion' ? 55 : 30;
    const checkRatio = parseInt(l.potential) / Math.max(aumScale, 1) * 10000;
    const shareValue = l.shares * 24.38;
    const upselPotential = l.tier === 'Platinum' ? parseInt(l.potential) * 0.5 : l.tier === 'Gold' ? parseInt(l.potential) * 0.3 : 0;
    const nextAction = l.status === 'Committed' ? 'Quarterly update call' : l.status === 'Due Diligence' ? 'Send data room access' : l.status === 'In Discussion' ? 'Schedule in-person meeting' : 'Warm intro via network';
    const daysToClose = l.status === 'Committed' ? 0 : l.status === 'Due Diligence' ? 30 : l.status === 'In Discussion' ? 60 : 120;
    const conversionProb = l.status === 'Committed' ? 100 : l.status === 'Due Diligence' ? 72 : l.status === 'In Discussion' ? 38 : 12;
    const lastTouch = ['3 days ago', '1 week ago', '2 days ago', '2 weeks ago', '5 days ago', '4 weeks ago', '1 week ago'][l.id - 1];
    const touchHealth = l.status === 'Prospecting' && lastTouch.includes('4 weeks') ? 'Cold' : lastTouch.includes('week') && !lastTouch.includes('1 week') ? 'Cooling' : 'Warm';
    return { ...l, engagementScore, checkRatio: checkRatio.toFixed(2), shareValue, upselPotential: upselPotential.toFixed(0), nextAction, daysToClose, conversionProb, lastTouch, touchHealth };
  });

  // Fundraising funnel
  const funnelStages = [
    { stage: 'Prospects Identified', count: 24, capital: '$480M', color: T.textDim, pct: 100 },
    { stage: 'Outreach Completed', count: 16, capital: '$340M', color: T.textMuted, pct: 67 },
    { stage: 'First Meeting Done', count: 11, capital: '$240M', color: T.blue, pct: 46 },
    { stage: 'In Discussion', count: LPS.filter(l=>l.status==='In Discussion').length, capital: `$${LPS.filter(l=>l.status==='In Discussion').reduce((s,l)=>s+parseInt(l.potential),0)}M`, color: T.purple, pct: 21 },
    { stage: 'Due Diligence', count: LPS.filter(l=>l.status==='Due Diligence').length, capital: `$${LPS.filter(l=>l.status==='Due Diligence').reduce((s,l)=>s+parseInt(l.potential),0)}M`, color: T.amber, pct: 8 },
    { stage: 'Committed', count: LPS.filter(l=>l.status==='Committed').length, capital: `$${totC}M`, color: T.accent, pct: Math.round(LPS.filter(l=>l.status==='Committed').length / 24 * 100) },
  ];

  // Co-invest matching
  const coInvestOpps = [
    { company: 'Anthropic (Series E)', allocation: '$8M', minCheck: '$2M', match: ['J.P. Morgan Wealth', 'Goldman Sachs PWM', 'Bessemer Trust'], thesis: 'Constitutional AI leadership, $2.8B rev, 340% growth. IPO 2027.', urgency: 'HIGH' },
    { company: 'Shield AI (Growth)', allocation: '$5M', minCheck: '$1M', match: ['J.P. Morgan Wealth', 'Pathstone', 'Mercer Advisors'], thesis: 'Autonomous defense. $886B defense budget catalyst. IPO 2028.', urgency: 'MEDIUM' },
    { company: 'Crusoe Energy (Series D)', allocation: '$3M', minCheck: '$500K', match: ['Goldman Sachs PWM', 'Robertson Stephens'], thesis: 'Stranded gas → GPU compute. 310% growth. ESG angle.', urgency: 'MEDIUM' },
  ];

  // Communication calendar
  const commsCalendar = [
    { date: 'Feb 10', lp: 'Northern Trust', contact: 'Stacy Singer', type: 'Intro Meeting', owner: 'Matthew', prep: 'Send deck + NEWCO thesis memo. Highlight zero-fee structure vs BDC peers.', impact: '$40M' },
    { date: 'Feb 12', lp: 'Goldman Sachs PWM', contact: 'John Goldstein', type: 'Follow-up Dinner', owner: 'Jason', prep: 'Bring Q4 NAV report + Anthropic co-invest deck. Ask about internal allocation committee timing.', impact: '$35M' },
    { date: 'Feb 14', lp: 'Bessemer Trust', contact: 'Mike Selfridge', type: 'Data Room Review', owner: 'Ken', prep: 'Ensure data room is current. Add GP attribution analysis + Cambridge benchmarking data.', impact: '$15M' },
    { date: 'Feb 18', lp: 'J.P. Morgan Wealth', contact: 'Alistair Savides', type: 'Quarterly Update', owner: 'Ken', prep: 'NAV update, DPI progress, Anduril IPO timeline. Discuss upsell to $75M.', impact: '$25M upsell' },
    { date: 'Feb 25', lp: 'All Committed LPs', contact: 'Multiple', type: 'LP Letter', owner: 'Matthew', prep: 'Draft Q4 2025 LP letter. Include: NAV performance, IPO pipeline, fee savings analysis, macro outlook.', impact: 'Retention' },
  ];

  // Weighted pipeline value
  const weightedPipeline = lpScoring.reduce((s, l) => s + parseInt(l.potential) * l.conversionProb / 100, 0).toFixed(1);

  const lpViews = [{ id: 'registry', label: 'Registry' }, { id: 'scoring', label: 'Engagement Scoring' }, { id: 'funnel', label: 'Fundraising Funnel' }, { id: 'coinvest', label: 'Co-Invest Matching' }, { id: 'comms', label: 'Comms Calendar' }, { id: 'upsell', label: 'Upsell & Retention' }, { id: 'concentration', label: 'Concentration Risk' }, { id: 'expansion', label: 'Expansion Playbook' }, { id: 'benchmark', label: 'LP Benchmarking' }];

  return (
    <div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
        <Stat label="LP Committed" value={`$${totC}M`} icon={DollarSign} trend={18} color={T.accent}/>
        <Stat label="Weighted Pipeline" value={`$${weightedPipeline}M`} icon={Target} sub="probability-adjusted" color={T.blue}/>
        <Stat label="Total Pipeline" value={`$${totalPipeline}M`} icon={Users} sub={`${LPS.length} relationships`} color={T.purple}/>
        <Stat label="Conversion Rate" value={`${Math.round(LPS.filter(l=>l.status==='Committed').length/LPS.length*100)}%`} icon={TrendingUp} sub="LP → committed" color={T.green}/>
        <Stat label="Co-Invest Available" value={`$${coInvestOpps.reduce((s,c)=>s+parseInt(c.allocation),0)}M`} icon={Zap} sub={`${coInvestOpps.length} opportunities`} color={T.gold}/>
      </div>
      <div style={{ display: 'flex', gap: 2, marginBottom: 14, background: T.bgCard, borderRadius: 6, padding: 3, border: `1px solid ${T.border}`, overflowX: 'auto' }}>
        {lpViews.map(v => <button key={v.id} onClick={() => setLpView(v.id)} style={{ padding: '6px 12px', borderRadius: 4, border: 'none', cursor: 'pointer', fontSize: 11, fontWeight: 600, background: lpView === v.id ? T.accent : 'transparent', color: lpView === v.id ? T.bg : T.textMuted, fontFamily: sans, whiteSpace: 'nowrap' }}>{v.label}</button>)}
      </div>

      {lpView === 'registry' && (
        <Card title="LP Relationships & Shareholder Registry">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Institution','Contact','AUM','Tier','Shares','Status','Potential','Owner'].map(h=><TH key={h} align={['Institution','Contact'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{LPS.sort((a,b)=>parseInt(b.potential)-parseInt(a.potential)).map(l=>(
              <TR key={l.id}>
                <TD bold>{l.name}</TD>
                <TD><div style={{color:T.text,fontSize:11}}>{l.contact}</div><div style={{color:T.textDim,fontSize:9}}>{l.role}</div></TD>
                <TD align="right" mono color={T.textMuted}>{l.aum}</TD>
                <TD align="right"><Badge color={tierCfg[l.tier]?.color}>{l.tier}</Badge></TD>
                <TD align="right" mono color={l.shares>=250000?T.accent:T.text}>{l.shares>0?l.shares.toLocaleString():'—'}</TD>
                <TD align="right"><Badge color={statCfg[l.status]}>{l.status}</Badge></TD>
                <TD align="right" mono bold color={T.accent}>${l.potential}</TD>
                <TD align="right" color={T.textMuted}>{l.relationship}</TD>
              </TR>
            ))}</tbody>
          </table></div>
        </Card>
      )}

      {lpView === 'scoring' && (
        <Card title="LP Engagement Scoring — Who to Prioritize">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['LP', 'Engagement', 'Conv. Prob', 'Check', 'Share Value', 'Touch Health', 'Last Touch', 'Next Action', 'Days to Close'].map(h => <TH key={h} align={['LP','Next Action'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{lpScoring.sort((a,b) => b.engagementScore - a.engagementScore).map(l => (
              <TR key={l.id}>
                <TD bold><div>{l.name}</div><div style={{fontSize:9,color:T.textDim}}>{l.contact}</div></TD>
                <TD align="right"><div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'flex-end'}}>
                  <div style={{width:32,height:4,background:T.bgAccent,borderRadius:2,overflow:'hidden'}}><div style={{width:`${l.engagementScore}%`,height:'100%',background:l.engagementScore>=80?T.accent:l.engagementScore>=50?T.blue:T.amber,borderRadius:2}}/></div>
                  <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:l.engagementScore>=80?T.accent:l.engagementScore>=50?T.blue:T.amber}}>{l.engagementScore}</span>
                </div></TD>
                <TD align="right" mono bold color={l.conversionProb>=70?T.accent:l.conversionProb>=30?T.blue:T.textMuted}>{l.conversionProb}%</TD>
                <TD align="right" mono bold color={T.accent}>${l.potential}</TD>
                <TD align="right" mono color={T.textMuted}>${(l.shareValue/1000).toFixed(0)}K</TD>
                <TD align="right"><Badge color={l.touchHealth==='Warm'?T.accent:l.touchHealth==='Cooling'?T.amber:T.red}>{l.touchHealth}</Badge></TD>
                <TD align="right" mono color={T.textDim}>{l.lastTouch}</TD>
                <TD color={T.textMuted}>{l.nextAction}</TD>
                <TD align="right" mono bold color={l.daysToClose===0?T.accent:l.daysToClose<=30?T.blue:T.amber}>{l.daysToClose===0?'Done':l.daysToClose+'d'}</TD>
              </TR>
            ))}</tbody>
          </table></div>
        </Card>
      )}

      {lpView === 'funnel' && (
        <div>
          <Card title="Fundraising Conversion Funnel" style={{ marginBottom: 14 }}>
            <div style={{ padding: '20px 18px' }}>
              {funnelStages.map((f, i) => (
                <div key={i} style={{ marginBottom: 8, display: 'flex', alignItems: 'center', gap: 12 }}>
                  <span style={{ width: 130, fontSize: 11, color: T.text, fontWeight: 600, textAlign: 'right' }}>{f.stage}</span>
                  <div style={{ flex: 1, position: 'relative', height: 32 }}>
                    <div style={{ width: `${Math.max(f.pct, 3)}%`, height: '100%', background: f.color, borderRadius: 4, opacity: 0.7, display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 10px' }}>
                      {f.pct >= 15 && <span style={{ fontSize: 11, fontWeight: 800, fontFamily: mono, color: T.bg }}>{f.count}</span>}
                      {f.pct >= 25 && <span style={{ fontSize: 10, fontFamily: mono, color: T.bg, opacity: 0.8 }}>{f.capital}</span>}
                    </div>
                  </div>
                  <span style={{ width: 50, fontSize: 12, fontFamily: mono, fontWeight: 700, color: f.color, textAlign: 'right' }}>{f.pct}%</span>
                </div>
              ))}
            </div>
          </Card>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>
            <Card title="Funnel Bottleneck"><div style={{ padding: 14 }}>
              <div style={{ fontSize: 24, fontWeight: 900, fontFamily: mono, color: T.amber }}>Outreach → Meeting</div>
              <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6, marginTop: 6 }}>Only 46% of contacted prospects take a first meeting. Consider warmer intros — network-sourced LPs convert at 68% vs cold at 31%.</div>
            </div></Card>
            <Card title="Avg Close Cycle"><div style={{ padding: 14 }}>
              <div style={{ fontSize: 24, fontWeight: 900, fontFamily: mono, color: T.blue }}>78 days</div>
              <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6, marginTop: 6 }}>First meeting to commitment. Platinum tier closes faster (52d) vs Silver (110d). Focus bandwidth on Platinum prospects.</div>
            </div></Card>
            <Card title="Capital Efficiency"><div style={{ padding: 14 }}>
              <div style={{ fontSize: 24, fontWeight: 900, fontFamily: mono, color: T.accent }}>${(totC / 4).toFixed(0)}M/LP</div>
              <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6, marginTop: 6 }}>Avg committed check is ${(totC / LPS.filter(l=>l.status==='Committed').length).toFixed(0)}M. Increasing avg to $30M would reach $150M target with just 5 LPs.</div>
            </div></Card>
          </div>
        </div>
      )}

      {lpView === 'coinvest' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Co-Investment Opportunities — Match LPs to Direct Deals</div>
          {coInvestOpps.map((c, i) => (
            <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 10, borderLeft: `3px solid ${c.urgency === 'HIGH' ? T.accent : T.blue}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 10 }}>
                <div>
                  <div style={{ fontSize: 15, fontWeight: 700, color: T.text }}>{c.company}</div>
                  <div style={{ fontSize: 10, color: T.textDim }}>{c.thesis}</div>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <div style={{ fontSize: 20, fontWeight: 900, fontFamily: mono, color: T.accent }}>{c.allocation}</div>
                  <div style={{ fontSize: 9, color: T.textDim }}>min check: {c.minCheck}</div>
                  <Badge color={c.urgency === 'HIGH' ? T.accent : T.blue}>{c.urgency}</Badge>
                </div>
              </div>
              <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', marginBottom: 6 }}>Matched LPs:</div>
              <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap' }}>
                {c.match.map(m => {
                  const lp = LPS.find(l => l.name === m);
                  return <div key={m} style={{ padding: '8px 12px', background: T.bgAccent, borderRadius: 6, border: `1px solid ${T.border}` }}>
                    <div style={{ fontSize: 12, fontWeight: 700, color: T.text }}>{m}</div>
                    <div style={{ fontSize: 9, color: T.textDim }}>{lp?.contact} · {lp?.tier} · {lp?.status}</div>
                  </div>;
                })}
              </div>
            </div>
          ))}
          <div style={{ padding: 12, background: T.accentBg, borderRadius: 6, border: `1px solid ${T.accent}25`, marginTop: 6 }}>
            <div style={{ fontSize: 10, color: T.accent, fontWeight: 700, marginBottom: 4 }}>CO-INVEST REVENUE MODEL</div>
            <div style={{ fontSize: 11, color: T.textMuted }}>Co-invest capital deployed alongside the fund generates no management fee but earns 10% carry above 8% hurdle. On $16M co-invest capital at 2.5x gross, this generates $2.7M in carried interest — accretive to NEWCO shareholders without diluting AUM-based fee economics.</div>
          </div>
        </div>
      )}

      {lpView === 'comms' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>LP Communication Calendar — Next 30 Days</div>
          {commsCalendar.map((c, i) => (
            <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '14px 16px', marginBottom: 6, display: 'flex', gap: 14, alignItems: 'flex-start' }}>
              <div style={{ minWidth: 56, padding: '8px 10px', background: T.bgAccent, borderRadius: 6, textAlign: 'center' }}>
                <div style={{ fontSize: 14, fontWeight: 900, color: T.accent, fontFamily: mono }}>{c.date.split(' ')[1]}</div>
                <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>{c.date.split(' ')[0]}</div>
              </div>
              <div style={{ flex: 1 }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                  <div>
                    <span style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{c.lp}</span>
                    <span style={{ fontSize: 10, color: T.textDim, marginLeft: 8 }}>{c.contact}</span>
                  </div>
                  <div style={{ display: 'flex', gap: 6, alignItems: 'center' }}>
                    <Badge color={c.type.includes('Intro') ? T.blue : c.type.includes('Dinner') || c.type.includes('Meeting') ? T.purple : c.type.includes('Data') ? T.amber : T.accent}>{c.type}</Badge>
                    <span style={{ fontSize: 10, fontFamily: mono, color: T.textMuted }}>{c.owner}</span>
                  </div>
                </div>
                <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6 }}>{c.prep}</div>
                <div style={{ fontSize: 10, fontFamily: mono, color: T.gold, marginTop: 4, fontWeight: 700 }}>Impact: {c.impact}</div>
              </div>
            </div>
          ))}
        </div>
      )}

      {lpView === 'upsell' && (
        <div>
          <Card title="Upsell & Retention Strategy" style={{ marginBottom: 14 }}>
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['LP', 'Current', 'Upsell Target', 'Strategy', 'Probability', 'Timeline'].map(h => <TH key={h} align={['LP','Strategy'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
              <tbody>{lpScoring.filter(l => l.status === 'Committed').map(l => {
                const current = parseInt(l.potential);
                const upsell = parseInt(l.upselPotential);
                return (
                  <TR key={l.id}>
                    <TD bold>{l.name}</TD>
                    <TD align="right" mono bold color={T.text}>${l.potential}</TD>
                    <TD align="right" mono bold color={T.accent}>${upsell > 0 ? `+${upsell}M` : '—'}</TD>
                    <TD>{upsell > 0 ? (current >= 25 ? 'Propose Fund II allocation at LP Advisory Board meeting. Offer co-invest access.' : 'Demonstrate DPI progress, share IPO pipeline. Position as "graduating" to Platinum.') : <span style={{color:T.textDim}}>At capacity for tier</span>}</TD>
                    <TD align="right" mono color={upsell >= 10 ? T.accent : upsell > 0 ? T.blue : T.textDim}>{upsell >= 10 ? '65%' : upsell > 0 ? '45%' : '—'}</TD>
                    <TD align="right" mono color={T.textMuted}>{upsell > 0 ? 'H2 2026' : '—'}</TD>
                  </TR>
                );
              })}</tbody>
            </table></div>
          </Card>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>
            <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${T.accent}`, textAlign: 'center' }}>
              <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Total Upsell Opportunity</div>
              <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>${lpScoring.filter(l=>l.status==='Committed').reduce((s,l)=>s+parseInt(l.upselPotential),0)}M</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>from existing committed LPs</div>
            </div>
            <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${T.blue}`, textAlign: 'center' }}>
              <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>LP NPS Score</div>
              <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.blue }}>72</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>above industry avg (58)</div>
            </div>
            <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${T.green}`, textAlign: 'center' }}>
              <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Retention Rate</div>
              <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.green }}>100%</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>zero LP churn since inception</div>
            </div>
          </div>
        </div>
      )}

      {lpView === 'concentration' && (
        <div>
          <Card title="LP Concentration Risk Dashboard" style={{ marginBottom: 14 }}>
            <div style={{ padding: 0 }}>{[
              { metric: 'Largest Single LP', value: `${((parseInt(LPS.sort((a,b)=>parseInt(b.potential)-parseInt(a.potential))[0].potential) / totalPipeline) * 100).toFixed(0)}%`, detail: `${LPS.sort((a,b)=>parseInt(b.potential)-parseInt(a.potential))[0].name} — $${LPS.sort((a,b)=>parseInt(b.potential)-parseInt(a.potential))[0].potential}`, threshold: '<25% of committed', status: parseInt(LPS.sort((a,b)=>parseInt(b.potential)-parseInt(a.potential))[0].potential) / totalPipeline < 0.25 ? 'PASS' : 'WARN' },
              { metric: 'Top 3 LP Concentration', value: `${((LPS.sort((a,b)=>parseInt(b.potential)-parseInt(a.potential)).slice(0,3).reduce((s,l)=>s+parseInt(l.potential),0) / totalPipeline) * 100).toFixed(0)}%`, detail: 'J.P. Morgan + Northern Trust + Goldman Sachs', threshold: '<60% of committed', status: 'WARN' },
              { metric: 'Single Relationship Owner', value: '42%', detail: 'Ken owns $65M of LP capital (JPM + Bessemer)', threshold: '<35% per person', status: 'WARN' },
              { metric: 'Institutional vs Family Office', value: '100% / 0%', detail: 'No family office LPs — single channel risk', threshold: '70/30 target', status: 'FAIL' },
              { metric: 'Geographic Concentration', value: '100% US', detail: 'No international LP diversification', threshold: '<80% single geography', status: 'FAIL' },
              { metric: 'Re-Up Dependency', value: `$${totC}M`, detail: 'All committed LPs are Fund I — no re-up data points yet', threshold: 'Track re-up rates', status: 'NEW' },
            ].map((r, i) => (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 14, padding: '14px 18px', borderBottom: i < 5 ? `1px solid ${T.border}` : 'none' }}>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 12, fontWeight: 600, color: T.text, marginBottom: 2 }}>{r.metric}</div>
                  <div style={{ fontSize: 10, color: T.textDim }}>{r.detail}</div>
                </div>
                <div style={{ textAlign: 'right', marginRight: 10 }}>
                  <div style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: T.text }}>{r.value}</div>
                  <div style={{ fontSize: 9, color: T.textDim }}>{r.threshold}</div>
                </div>
                <Badge color={r.status === 'PASS' ? T.accent : r.status === 'WARN' ? T.amber : r.status === 'FAIL' ? T.red : T.blue}>{r.status}</Badge>
              </div>
            ))}</div>
          </Card>
          <Card title="Diversification Action Plan">
            <div style={{ padding: 16 }}>{[
              { action: 'Add 2-3 family office LPs', target: '$15-25M', rationale: 'Diversify away from 100% institutional. Family offices have lower reporting burden and faster decisions.', owner: 'Jason', timeline: 'Q2 2026', status: 'Not Started' },
              { action: 'International LP — Sovereign wealth or EU pension', target: '$20-40M', rationale: 'Zero international exposure creates regulatory and FX diversification opportunity.', owner: 'Ken', timeline: 'Q3 2026', status: 'Exploring' },
              { action: 'Reduce Ken\'s single-owner risk', target: 'Redistribute $20M of LP coverage', rationale: 'Bob and Jason should co-own JPM and Bessemer relationships for succession planning.', owner: 'All', timeline: 'Immediate', status: 'In Progress' },
              { action: 'Endowment / Foundation channel', target: '$10-20M', rationale: 'UC Berkeley / Goldman School connections → endowment introductions. AI Safety thesis aligns with university mission.', owner: 'Jason', timeline: 'Q2 2026', status: 'Not Started' },
            ].map((a, i) => (
              <div key={i} style={{ marginBottom: 14, padding: 14, background: T.bgSurface, borderRadius: 8, border: `1px solid ${T.border}`, borderLeft: `3px solid ${a.status === 'In Progress' ? T.accent : a.status === 'Exploring' ? T.blue : T.textMuted}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                  <div style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{a.action}</div>
                  <div style={{ display: 'flex', gap: 6 }}>
                    <Badge color={T.accent}>{a.target}</Badge>
                    <Badge color={a.status === 'In Progress' ? T.accent : a.status === 'Exploring' ? T.blue : T.textMuted}>{a.status}</Badge>
                  </div>
                </div>
                <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 4 }}>{a.rationale}</div>
                <div style={{ fontSize: 10, color: T.textDim }}>Owner: {a.owner} · Timeline: {a.timeline}</div>
              </div>
            ))}</div>
          </Card>
        </div>
      )}

      {lpView === 'expansion' && (
        <div>
          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>LP Expansion Playbook — New Capital Targets</div>
          {[
            { lp: 'UBS Global Wealth Management', aum: '$3.2T', currentPotential: 0, target: 50, strategy: 'UBS rebalancing VC allocation post-CS merger. AI Safety thesis is differentiated — no competing FoF in this space. Public listing structure simplifies their due diligence.', nextStep: 'Jason to leverage Haas/SF society network for warm intro to UBS US head of alternatives. Prepare custom tear sheet.', timeline: 'Q3 2026', probability: 25, channel: 'Network Intro' },
            { lp: 'Hightower Advisors', aum: '$150B+', currentPotential: 0, target: 20, strategy: 'Major RIA platform with growing alternatives appetite. NEWCO\'s public listing = easier advisor access than traditional LP commitments. Zero-fee structure resonates with fee-conscious RIA model.', nextStep: 'Brett to attend Hightower conference in April. Prepare single-page due diligence summary + model portfolio insert.', timeline: 'Q2 2026', probability: 35, channel: 'Conference' },
            { lp: 'ADIA / Mubadala', aum: '$1T+', currentPotential: 0, target: 75, strategy: 'Sovereign wealth pivot to AI safety & defense. NEWCO thesis alignment with national security AI investments. Anchor allocation would signal institutional credibility.', nextStep: 'Ken to engage placement agent (Park Hill or Evercore). Prepare sovereign-wealth-specific DDQ with ESG overlay.', timeline: 'H2 2026', probability: 15, channel: 'Placement Agent' },
            { lp: 'Goldman Sachs PWM → Platform', aum: '$2T+', currentPotential: 35, target: 100, strategy: 'Convert John Goldstein relationship from single commitment to model portfolio inclusion. 800+ advisors × avg $62K allocation = massive scale.', nextStep: 'Jason + Matthew dinner with Goldstein. Present model portfolio fit analysis + institutional performance data.', timeline: 'Q2 2026', probability: 55, channel: 'Existing Relationship' },
            { lp: 'UC Berkeley Endowment', aum: '$7.8B', currentPotential: 0, target: 10, strategy: 'Jason\'s 5th-generation Berkeley connection + Goldman School Board seat. AI Safety thesis aligns with university research mission. Co-investment in Berkeley AI Safety research outputs.', nextStep: 'Jason to present at Goldman School alumni event. Invite endowment CIO to portfolio company showcase.', timeline: 'Q2 2026', probability: 40, channel: 'Personal Network' },
          ].map((e, i) => (
            <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 10, borderLeft: `3px solid ${e.probability >= 40 ? T.accent : e.probability >= 25 ? T.blue : T.textMuted}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                <div>
                  <div style={{ fontSize: 14, fontWeight: 700, color: T.text, marginBottom: 3 }}>{e.lp}</div>
                  <div style={{ display: 'flex', gap: 6 }}>
                    <Badge color={T.textMuted}>{e.aum} AUM</Badge>
                    {e.currentPotential > 0 ? <Badge color={T.blue}>Existing: ${e.currentPotential}M</Badge> : <Badge color={T.green}>NEW LP</Badge>}
                    <Badge color={T.purple}>{e.channel}</Badge>
                  </div>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <div style={{ fontSize: 22, fontWeight: 800, fontFamily: mono, color: T.accent }}>${e.target}M</div>
                  <div style={{ fontSize: 10, color: T.textDim }}>{e.timeline} · {e.probability}% prob</div>
                </div>
              </div>
              <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 6, lineHeight: 1.7 }}>{e.strategy}</div>
              <div style={{ fontSize: 11, color: T.accent, fontWeight: 500 }}>Next: {e.nextStep}</div>
              <div style={{ marginTop: 6 }}><Bar value={e.probability} max={100} color={e.probability >= 40 ? T.accent : e.probability >= 25 ? T.blue : T.textMuted} h={3} /></div>
            </div>
          ))}
          <div style={{ marginTop: 14, display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 12 }}>
            <div style={{ padding: 16, background: T.accentBg, borderRadius: 8, border: `1px solid ${T.accent}25`, textAlign: 'center' }}>
              <div style={{ fontSize: 9, color: T.accent, fontWeight: 700, marginBottom: 4 }}>TOTAL EXPANSION TARGET</div>
              <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>$255M</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>5 new LP strategies</div>
            </div>
            <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, textAlign: 'center' }}>
              <div style={{ fontSize: 9, color: T.textDim, fontWeight: 700, marginBottom: 4 }}>PROBABILITY-WEIGHTED</div>
              <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.blue }}>$82M</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>expected incremental capital</div>
            </div>
            <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, textAlign: 'center' }}>
              <div style={{ fontSize: 9, color: T.textDim, fontWeight: 700, marginBottom: 4 }}>FUND II IMPLICATIONS</div>
              <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.green }}>$500M</div>
              <div style={{ fontSize: 10, color: T.textMuted }}>potential Fund II target</div>
            </div>
          </div>
        </div>
      )}

      {lpView === 'benchmark' && (
        <div>
          <Card title="LP Benchmarking — NEWCO vs. Peer FoF Fundraising" style={{ marginBottom: 14 }}>
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Metric', 'NEWCO', 'Avg VC FoF', 'Top Quartile FoF', 'Listed BDC', 'NEWCO vs Avg'].map(h => <TH key={h} align={h === 'Metric' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
              <tbody>{[
                { metric: 'Fund Size', newco: '$250M', avg: '$180M', top: '$500M+', bdc: '$1.2B', delta: '+39%' },
                { metric: 'Avg LP Check', newco: `$${Math.round(totC / LPS.filter(l=>l.status==='Committed').length)}M`, avg: '$8M', top: '$25M', bdc: '$50K', delta: '+163%' },
                { metric: 'Time to First Close', newco: '8 months', avg: '14 months', top: '6 months', bdc: 'N/A (public)', delta: '-43%' },
                { metric: 'LP Count at Close', newco: LPS.filter(l=>l.status==='Committed').length.toString(), avg: '22', top: '15', bdc: '5000+', delta: '-82%' },
                { metric: 'Mgmt Fee', newco: '0.0%', avg: '1.25%', top: '1.0%', bdc: '1.75%', delta: '-100%' },
                { metric: 'Carry Rate', newco: '10%', avg: '10%', top: '15%', bdc: '20%', delta: '0%' },
                { metric: 'Hurdle Rate', newco: '8%', avg: '8%', top: '8%', bdc: '7%', delta: '0%' },
                { metric: 'LP Retention', newco: '100%', avg: '72%', top: '90%', bdc: 'N/A', delta: '+39%' },
                { metric: 'Co-Invest Access', newco: 'Yes (Platinum)', avg: 'Rare', top: 'Common', bdc: 'No', delta: 'Advantage' },
              ].map((r, i) => (
                <TR key={i}>
                  <TD bold>{r.metric}</TD>
                  <TD align="right" mono bold color={T.accent}>{r.newco}</TD>
                  <TD align="right" mono color={T.textMuted}>{r.avg}</TD>
                  <TD align="right" mono color={T.blue}>{r.top}</TD>
                  <TD align="right" mono color={T.textMuted}>{r.bdc}</TD>
                  <TD align="right" mono bold color={r.delta.includes('-') || r.delta === 'Advantage' ? T.accent : r.delta === '0%' ? T.text : T.amber}>{r.delta}</TD>
                </TR>
              ))}</tbody>
            </table></div>
          </Card>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12 }}>
            <Card title="NEWCO Competitive Advantages for LPs">
              <div style={{ padding: 14 }}>{[
                { advantage: 'Zero Management Fee', impact: '$3.5M/yr savings vs industry avg', detail: 'Only public VC FoF with no management fee. All economics through carry above hurdle.' },
                { advantage: 'Public Market Liquidity', impact: 'Daily NAV / NYSE listing', detail: 'LPs can exit via secondary market. No J-curve lock-up like traditional VC.' },
                { advantage: 'AI Safety Thesis Purity', impact: '80% of NAV in AI Safety/Trust', detail: 'Only institutional-grade vehicle focused exclusively on AI Safety, Trust & GovTech.' },
                { advantage: 'Co-Investment Rights', impact: '$16M allocated', detail: 'Platinum LPs get direct deal access at zero additional carry. Rare in FoF structures.' },
              ].map((a, i) => (
                <div key={i} style={{ marginBottom: 12, padding: 12, background: T.bgSurface, borderRadius: 6, border: `1px solid ${T.border}`, borderLeft: `3px solid ${T.accent}` }}>
                  <div style={{ fontSize: 12, fontWeight: 700, color: T.accent, marginBottom: 2 }}>{a.advantage}</div>
                  <div style={{ fontSize: 11, fontWeight: 600, color: T.text, marginBottom: 2 }}>{a.impact}</div>
                  <div style={{ fontSize: 10, color: T.textDim }}>{a.detail}</div>
                </div>
              ))}</div>
            </Card>
            <Card title="LP Objection Handling">
              <div style={{ padding: 14 }}>{[
                { objection: '"Why no management fee? What\'s the catch?"', response: 'Public listing + carried interest alignment. We earn when you earn — zero revenue unless we exceed 8% hurdle.', frequency: 'Every LP meeting' },
                { objection: '"How liquid is a public FoF really?"', response: 'Daily NYSE trading. Current volume: 45K shares/day. 12-month avg discount to NAV: only 3.2% vs 15% for BDC peers.', frequency: 'Due diligence stage' },
                { objection: '"Isn\'t AI Safety too niche?"', response: '$28B TAM growing 40%+ CAGR. Anthropic alone: $2.8B revenue, 340% growth. Defense AI: $886B budget. The niche is becoming the mainstream.', frequency: 'Screening calls' },
                { objection: '"Fund I is too small to be institutional"', response: 'Deliberately concentrated — 8 GPs, 68 companies. Cambridge benchmarking: 81st percentile. Scaling to $500M Fund II based on performance.', frequency: 'Prospect meetings' },
              ].map((o, i) => (
                <div key={i} style={{ marginBottom: 12, padding: 12, background: T.bgSurface, borderRadius: 6, border: `1px solid ${T.border}` }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: T.red, marginBottom: 4 }}>{o.objection}</div>
                  <div style={{ fontSize: 11, color: T.text, lineHeight: 1.6, marginBottom: 2 }}>{o.response}</div>
                  <div style={{ fontSize: 9, color: T.textDim, fontStyle: 'italic' }}>Frequency: {o.frequency}</div>
                </div>
              ))}</div>
            </Card>
          </div>
        </div>
      )}
    </div>
  );
};

// ════════════════════════════════════════════════════
// DECISION SCIENCE ENGINE
// ════════════════════════════════════════════════════
const DecisionScienceEngine = () => {
  const [dsView, setDsView] = useState('bayesian');
  const dsViews = [
    { id: 'bayesian', label: 'Bayesian Signals' }, { id: 'regime', label: 'Regime & Timing' },
    { id: 'sizing', label: 'Optimal Sizing' }, { id: 'graph', label: 'Network Graph' },
    { id: 'resilience', label: 'Resilience Matrix' },
  ];

  // ── Bayesian Signal Data ──
  const bayesianSignals = [
    { entity: 'Anthropic', type: 'Portfolio Co', priorConviction: 92, signals: [
      { signal: 'Revenue hit $2.8B (+340% YoY)', direction: 'pos', weight: +4, date: 'Jan 2026', source: 'GP Report' },
      { signal: 'Claude 4.5 launch — enterprise adoption surge', direction: 'pos', weight: +3, date: 'Dec 2025', source: 'Market Intel' },
      { signal: 'Google invested additional $2B', direction: 'pos', weight: +2, date: 'Nov 2025', source: 'Public Filing' },
      { signal: 'Key researcher departed to xAI', direction: 'neg', weight: -2, date: 'Oct 2025', source: 'LinkedIn Alert' },
      { signal: 'EU AI Act compliance costs estimated $180M', direction: 'neg', weight: -1, date: 'Sep 2025', source: 'Regulatory Intel' },
    ], posteriorConviction: 98, delta: '+6', action: 'INCREASE EXPOSURE — exercise co-invest right on next round' },
    { entity: 'Anduril Industries', type: 'Portfolio Co', priorConviction: 88, signals: [
      { signal: 'USAF $1.2B CJADC2 contract awarded', direction: 'pos', weight: +5, date: 'Jan 2026', source: 'DoD Filing' },
      { signal: 'IPO S-1 draft reportedly in review', direction: 'pos', weight: +3, date: 'Dec 2025', source: 'Bloomberg' },
      { signal: 'Palmer Luckey security clearance expanded', direction: 'pos', weight: +1, date: 'Nov 2025', source: 'Network Intel' },
      { signal: 'Competitor Shield AI raised $300M at $5.2B', direction: 'neg', weight: -1, date: 'Oct 2025', source: 'Market Intel' },
    ], posteriorConviction: 96, delta: '+8', action: 'HOLD & MONITOR — IPO timing critical for NAV catalyst' },
    { entity: 'Scale AI', type: 'Portfolio Co', priorConviction: 85, signals: [
      { signal: 'Pentagon CDAO contract renewed + expanded', direction: 'pos', weight: +3, date: 'Jan 2026', source: 'DoD Filing' },
      { signal: 'Revenue deceleration: 95% → 62% YoY', direction: 'neg', weight: -4, date: 'Dec 2025', source: 'GP Report' },
      { signal: 'Amazon building competing data labeling infra', direction: 'neg', weight: -3, date: 'Nov 2025', source: 'Market Intel' },
      { signal: 'Launched SEAL benchmark — standard-setting move', direction: 'pos', weight: +2, date: 'Oct 2025', source: 'Product Intel' },
    ], posteriorConviction: 83, delta: '-2', action: 'WATCH — moat erosion risk. Flag for GP discussion at Q2 review' },
    { entity: 'Founders Fund VII', type: 'GP Fund', priorConviction: 90, signals: [
      { signal: 'SpaceX secondary at $350B implied valuation', direction: 'pos', weight: +4, date: 'Jan 2026', source: 'Secondary Market' },
      { signal: 'Fund TVPI 1.46x at month 18 — top decile pace', direction: 'pos', weight: +3, date: 'Dec 2025', source: 'GP Report' },
      { signal: 'Thiel shifting focus to politics/policy', direction: 'neg', weight: -2, date: 'Nov 2025', source: 'Network Intel' },
    ], posteriorConviction: 95, delta: '+5', action: 'STRONG CONVICTION — anchor Fund VIII commitment early' },
    { entity: 'Greylock XVII', type: 'GP Fund', priorConviction: 72, signals: [
      { signal: 'TVPI 1.18x at month 14 — below median', direction: 'neg', weight: -3, date: 'Jan 2026', source: 'GP Report' },
      { signal: 'Portfolio co Drata growth slowed to 35%', direction: 'neg', weight: -2, date: 'Dec 2025', source: 'GP Report' },
      { signal: 'New partner hire — former Palantir CTO', direction: 'pos', weight: +2, date: 'Nov 2025', source: 'Market Intel' },
      { signal: 'GovTech thesis needs 18+ months to materialize', direction: 'neutral', weight: 0, date: 'Oct 2025', source: 'Internal Review' },
    ], posteriorConviction: 69, delta: '-3', action: 'REDUCE — do not re-up Fund XVIII unless Q3 marks improve materially' },
    { entity: 'AI Safety Sector', type: 'Macro Thesis', priorConviction: 94, signals: [
      { signal: 'EU AI Act enforcement begins — $28B TAM validated', direction: 'pos', weight: +3, date: 'Feb 2026', source: 'Regulatory' },
      { signal: 'US executive order expands AI safety mandates', direction: 'pos', weight: +4, date: 'Jan 2026', source: 'Policy' },
      { signal: 'Anthropic revenue 340% growth validates market', direction: 'pos', weight: +2, date: 'Dec 2025', source: 'Market' },
      { signal: 'Open-source AI models reducing moat duration', direction: 'neg', weight: -2, date: 'Nov 2025', source: 'Market Intel' },
    ], posteriorConviction: 97, delta: '+3', action: 'THESIS STRENGTHENING — increase sector allocation ceiling to 85%' },
  ];

  // ── Regime Detection Data ──
  const regimeData = {
    currentRegime: 'Late Expansion',
    regimeHistory: [
      { period: 'Q1-Q2 2022', regime: 'Contraction', color: T.red, description: 'Rate hikes, ZIRP unwind, valuations reset 40-60%' },
      { period: 'Q3-Q4 2022', regime: 'Dislocation', color: T.amber, description: 'Tiger/SoftBank pullback, secondary discounts 30-45%' },
      { period: 'Q1-Q3 2023', regime: 'Recovery', color: T.blue, description: 'AI thesis emerges post-ChatGPT, selective capital return' },
      { period: 'Q4 2023-Q2 2024', regime: 'Early Expansion', color: T.green, description: 'AI funding boom, mega-rounds return, IPO window cracks open' },
      { period: 'Q3 2024-Q1 2025', regime: 'Mid Expansion', color: T.accent, description: 'Broad recovery, multiples normalize, M&A picks up' },
      { period: 'Q2 2025-Present', regime: 'Late Expansion', color: T.gold, description: 'Peak valuations in AI, IPO window open, froth signals emerging' },
    ],
    regimeIndicators: [
      { indicator: 'VC Deployment Pace', value: '$78B/quarter', signal: 'Above 5yr average (+32%)', regime: 'Expansion', weight: 0.15, status: 'hot' },
      { indicator: 'Median Series B Multiple', value: '42x ARR', signal: 'Historical avg 28x — elevated', regime: 'Late Expansion', weight: 0.15, status: 'hot' },
      { indicator: 'IPO Pipeline', value: '47 filings', signal: 'Highest since 2021 — window wide open', regime: 'Expansion', weight: 0.12, status: 'hot' },
      { indicator: 'Secondary Discounts', value: '-12% avg', signal: 'Compressing from -28% in 2023', regime: 'Recovery→Expansion', weight: 0.12, status: 'warm' },
      { indicator: 'LP Re-Up Rate', value: '68%', signal: 'Below 2021 peak (82%) but healthy', regime: 'Mid Expansion', weight: 0.10, status: 'warm' },
      { indicator: 'Down Round %', value: '14%', signal: 'Declining from 28% peak in Q2 2023', regime: 'Expansion', weight: 0.10, status: 'cool' },
      { indicator: 'Fund Duration Extension', value: '1.8yr avg', signal: 'GPs extending — exits delayed', regime: 'Late Expansion', weight: 0.10, status: 'warm' },
      { indicator: 'DPI at Year 5', value: '0.12x', signal: 'Well below historical 0.35x — J-curve persists', regime: 'Delayed Returns', weight: 0.08, status: 'hot' },
      { indicator: 'AI Safety Funding Velocity', value: '+62% QoQ', signal: 'Accelerating — regulatory tailwind', regime: 'Sector Boom', weight: 0.08, status: 'hot' },
    ],
    reflexivityPosition: {
      cycle: 'AI Safety Investment Cycle',
      stage: 'Stage 4 of 6 — Acceleration Phase',
      stages: [
        { num: 1, name: 'Thesis Formation', desc: 'AI Safety identified as investable category', timing: '2021-2022', status: 'complete' },
        { num: 2, name: 'Early Movers', desc: 'Anthropic, Scale AI raise breakout rounds', timing: '2022-2023', status: 'complete' },
        { num: 3, name: 'Narrative Solidifies', desc: 'EU AI Act + executive orders validate market', timing: '2023-2024', status: 'complete' },
        { num: 4, name: 'Acceleration', desc: 'Capital floods in, valuations overshoot, NEWCO thesis peak alignment', timing: '2024-2026', status: 'current' },
        { num: 5, name: 'Overshoot', desc: 'Too many competitors, margin compression, hype cycle correction', timing: '2026-2027', status: 'upcoming' },
        { num: 6, name: 'Consolidation', desc: 'Winners emerge, M&A wave, sustainable returns normalize', timing: '2027-2029', status: 'future' },
      ],
      implication: 'NEWCO is optimally positioned in Stage 4. Deploy aggressively now, begin harvesting by Stage 5. Fund II should be raised and deployed before Stage 5 begins.'
    },
    signalDecay: [
      { signal: 'GP reference check (direct)', halfLife: '90 days', currentAge: '15 days', remainingValue: '89%', status: 'fresh', entity: 'All GP relationships' },
      { signal: 'Reid Hoffman relationship', halfLife: '120 days', currentAge: '150 days', remainingValue: '42%', status: 'decaying', entity: 'Reid Hoffman / Greylock' },
      { signal: 'Anduril IPO intel', halfLife: '30 days', currentAge: '22 days', remainingValue: '61%', status: 'decaying', entity: 'Anduril Industries' },
      { signal: 'Secondary pricing data', halfLife: '14 days', currentAge: '8 days', remainingValue: '67%', status: 'active', entity: 'All secondary positions' },
      { signal: 'LP commitment verbal', halfLife: '60 days', currentAge: '45 days', remainingValue: '58%', status: 'decaying', entity: 'Hightower Advisors' },
      { signal: 'Jensen Huang warm intro path', halfLife: '45 days', currentAge: '38 days', remainingValue: '54%', status: 'decaying', entity: 'NVIDIA / Jensen Huang' },
      { signal: 'Dario Amodei co-invest signal', halfLife: '21 days', currentAge: '5 days', remainingValue: '85%', status: 'fresh', entity: 'Anthropic' },
      { signal: 'Cambridge Associates benchmark', halfLife: '180 days', currentAge: '60 days', remainingValue: '79%', status: 'active', entity: 'Benchmark data' },
    ],
  };

  // ── Kelly Criterion & Optimal Sizing Data ──
  const kellySizing = [
    { fund: 'Founders Fund VIII', edge: 0.35, odds: 2.8, kellyFraction: 0.22, currentAllocation: 0.11, optimalAllocation: 0.22, action: 'INCREASE — current allocation is 50% of Kelly optimal', conviction: 95, maxDrawdown: '-28%' },
    { fund: 'Lux Capital VII', edge: 0.28, odds: 2.4, kellyFraction: 0.18, currentAllocation: 0.06, optimalAllocation: 0.14, action: 'INCREASE — deep tech edge justifies 2.3x current allocation', conviction: 88, maxDrawdown: '-32%' },
    { fund: 'a16z Infra Fund II', edge: 0.20, odds: 2.0, kellyFraction: 0.15, currentAllocation: 0.21, optimalAllocation: 0.12, action: 'REDUCE — over-allocated relative to edge. Platform risk.', conviction: 78, maxDrawdown: '-25%' },
    { fund: 'Benchmark XI', edge: 0.32, odds: 2.6, kellyFraction: 0.20, currentAllocation: 0.08, optimalAllocation: 0.16, action: 'INCREASE — concentrated portfolio = higher edge per bet', conviction: 91, maxDrawdown: '-22%' },
    { fund: 'NEA 20', edge: 0.15, odds: 1.8, kellyFraction: 0.12, currentAllocation: 0.17, optimalAllocation: 0.10, action: 'REDUCE — multi-stage dilutes edge. Consider half-Kelly.', conviction: 69, maxDrawdown: '-35%' },
    { fund: 'Sequoia US IX', edge: 0.25, odds: 2.2, kellyFraction: 0.16, currentAllocation: 0.15, optimalAllocation: 0.13, action: 'HOLD — near-optimal at half-Kelly (conservative approach)', conviction: 82, maxDrawdown: '-30%' },
    { fund: 'Khosla Ventures X', edge: 0.30, odds: 3.0, kellyFraction: 0.20, currentAllocation: 0.08, optimalAllocation: 0.16, action: 'INCREASE — climate/AI crossover has asymmetric upside', conviction: 85, maxDrawdown: '-38%' },
    { fund: 'Greylock XVIII', edge: 0.08, odds: 1.5, kellyFraction: 0.07, currentAllocation: 0.13, optimalAllocation: 0.06, action: 'CUT — edge below threshold. Do NOT re-up unless thesis changes.', conviction: 55, maxDrawdown: '-40%' },
  ];

  const realOptions = [
    { option: 'Anthropic Co-Invest Right', type: 'Call Option', underlying: 'Next funding round access', strikeEquiv: '$61.5B current val', timeToExpiry: '8 months', volatility: '65%', estimatedValue: '$4.2M', probability: '70%', trigger: 'Series E announcement' },
    { option: 'Anduril IPO Allocation', type: 'Call Option', underlying: 'IPO share allocation via FF', strikeEquiv: 'IPO price TBD', timeToExpiry: '6-12 months', volatility: '55%', estimatedValue: '$8.5M', probability: '60%', trigger: 'S-1 filing' },
    { option: 'Fund II First Close', type: 'Call Option', underlying: '$500M target raise', strikeEquiv: 'Min viable $200M', timeToExpiry: '12 months', volatility: '40%', estimatedValue: '$15M', probability: '75%', trigger: 'Fund I DPI > 0.5x or TVPI > 2.0x' },
    { option: 'Secondary Market Access', type: 'Put Protection', underlying: 'Liquidity on illiquid positions', strikeEquiv: '15-25% discount to NAV', timeToExpiry: 'Continuous', volatility: '30%', estimatedValue: '$3.8M', probability: '90%', trigger: 'Evercore relationship active' },
    { option: 'SBIC Leverage Facility', type: 'Call Option', underlying: '$150M SBA leverage at 2.5%', strikeEquiv: 'Regulatory approval', timeToExpiry: '18 months', volatility: '25%', estimatedValue: '$22M', probability: '50%', trigger: 'SBA application submitted' },
    { option: 'SpaceX Secondary Block', type: 'Call Option', underlying: '$10M block at $350B val', strikeEquiv: '$350B implied', timeToExpiry: '3 months', volatility: '45%', estimatedValue: '$2.1M', probability: '40%', trigger: 'Founders Fund allocation available' },
  ];

  const ergodicity = [
    { scenario: 'Current NEWCO (8 GP, concentrated)', ensembleAvg: '22% IRR', timeAvg: '18% IRR', gap: '-4%', ergodic: false, risk: 'Concentration amplifies path-dependency. One GP blowup = time-average diverges significantly from ensemble.', recommendation: 'Acceptable gap — 8 GPs provides enough diversification for time-average to track ensemble within ±5%.' },
    { scenario: 'Hyper-Concentrated (4 GP)', ensembleAvg: '28% IRR', timeAvg: '12% IRR', gap: '-16%', ergodic: false, risk: 'DANGEROUS — looks great on paper but actual experienced return is 43% lower than expected. Ruin risk is non-trivial.', recommendation: 'DO NOT — the ensemble average is misleading. No single path reliably achieves 28%.' },
    { scenario: 'Diversified (15 GP)', ensembleAvg: '16% IRR', timeAvg: '15% IRR', gap: '-1%', ergodic: true, risk: 'Near-ergodic but dilutes edge. Returns converge to market average. Defeats purpose of active FoF.', recommendation: 'TOO SAFE — gives up alpha for ergodicity. Not what LPs are paying carry for.' },
    { scenario: 'Fund II Target (10 GP, Kelly-sized)', ensembleAvg: '24% IRR', timeAvg: '21% IRR', gap: '-3%', ergodic: false, risk: 'Optimal zone — slightly non-ergodic but gap is within acceptable bounds. Kelly sizing ensures no single bet can cause ruin.', recommendation: 'OPTIMAL — preserves edge while limiting path-dependency. This is the Fund II target construction.' },
  ];

  // ── Network Centrality Data ──
  const centralityData = [
    { node: 'Peter Thiel', influence: 98, betweenness: 0.42, eigenvector: 0.95, closeness: 0.78, structuralHole: 2, clusters: ['Defense-AI', 'Crypto', 'Politics'], bridgeTo: 'xAI / Musk ecosystem', insight: 'Highest eigenvector — connected to most powerful nodes. But low structural holes — operates within known clusters.' },
    { node: 'Reid Hoffman', influence: 85, betweenness: 0.68, eigenvector: 0.72, closeness: 0.85, structuralHole: 5, clusters: ['OpenAI', 'Microsoft', 'LinkedIn/SaaS', 'Greylock', 'Policy'], bridgeTo: 'OpenAI board + Microsoft AI', insight: 'HIGHEST betweenness — bridges 5 otherwise disconnected clusters. Re-engage URGENTLY. Structural hole broker.' },
    { node: 'Jensen Huang', influence: 96, betweenness: 0.35, eigenvector: 0.91, closeness: 0.65, structuralHole: 1, clusters: ['GPU/Compute', 'AI Infrastructure'], bridgeTo: 'Hardware supply chain', insight: 'Massive eigenvector but low betweenness — powerful within cluster but doesn\'t bridge. Access via a16z (Ken).' },
    { node: 'Dario Amodei', influence: 95, betweenness: 0.52, eigenvector: 0.88, closeness: 0.82, structuralHole: 3, clusters: ['AI Safety', 'Google/Alphabet', 'Policy/DC'], bridgeTo: 'AI Safety research + policy', insight: 'High across all metrics. Direct relationship (Bob). Critical node for thesis validation and co-invest.' },
    { node: 'Marc Andreessen', influence: 94, betweenness: 0.55, eigenvector: 0.90, closeness: 0.80, structuralHole: 4, clusters: ['a16z Portfolio', 'Crypto', 'Media', 'AI Infra'], bridgeTo: 'a16z deal flow + narrative', insight: 'Second-highest betweenness. Bridges AI Infra to media narrative. Ken relationship active.' },
    { node: 'Alex Karp', influence: 88, betweenness: 0.28, eigenvector: 0.65, closeness: 0.55, structuralHole: 1, clusters: ['GovTech/IC'], bridgeTo: 'Intelligence community', insight: 'Low betweenness — deep but narrow. Exclusively bridges to government/IC cluster. Irreplaceable for GovTech intel.' },
    { node: 'Palmer Luckey', influence: 87, betweenness: 0.32, eigenvector: 0.60, closeness: 0.58, structuralHole: 2, clusters: ['Defense Tech', 'Hardware'], bridgeTo: 'Defense acquisition + hardware', insight: 'Rising eigenvector as defense tech grows. IPO will increase all centrality metrics. Direct relationship (Jason).' },
    { node: 'Jason Goldman', influence: 78, betweenness: 0.61, eigenvector: 0.55, closeness: 0.88, structuralHole: 6, clusters: ['UC Berkeley', 'SF Society', 'VC/LP', 'Hospitality', 'Consumer', 'Policy'], bridgeTo: 'LP channel + Berkeley ecosystem', insight: 'HIGHEST closeness + structural holes on NEWCO team. Bridges 6 clusters. Key network architect.' },
    { node: 'Ken Wallace', influence: 75, betweenness: 0.48, eigenvector: 0.58, closeness: 0.75, structuralHole: 3, clusters: ['GP Relationships', 'Secondary Market', 'Institutional LP'], bridgeTo: 'GP deal flow + secondary pricing', insight: 'Strongest GP-facing node. High betweenness between GPs and LPs. Owns $65M in LP relationships.' },
  ];

  const herdingAlerts = [
    { deal: 'Anthropic Series E', gpsInvolved: ['Founders Fund', 'a16z', 'Benchmark (via SPV)'], overlapScore: 82, signal: 'HERDING WARNING', detail: '3 of 8 NEWCO GPs bidding on same round. If all win allocation, portfolio correlation spikes to 0.85 on single company. Valuation validation is strong, but concentration risk is real.', action: 'Cap combined exposure at 8% of NAV. Ensure no more than 2 GPs close allocation.' },
    { deal: 'Shield AI Series G', gpsInvolved: ['Lux Capital', 'NEA'], overlapScore: 45, signal: 'MODERATE OVERLAP', detail: '2 GPs co-investing. Acceptable — different vintages and entry points provide diversification. Correlation is sector-level (defense) not company-level.', action: 'Monitor but no action needed. Defense sector correlation is desired per thesis.' },
    { deal: 'Databricks IPO', gpsInvolved: ['a16z', 'NEA', 'Greylock'], overlapScore: 71, signal: 'HERDING WARNING', detail: '3 GPs with exposure. Post-IPO lockup overlap creates concentrated selling pressure risk. If all 3 distribute shares simultaneously, NEWCO receives ~$12M in illiquid public stock.', action: 'Stagger distribution agreement — negotiate with each GP for different lockup release schedules.' },
    { deal: 'Crusoe Energy Series D', gpsInvolved: ['Khosla Ventures'], overlapScore: 12, signal: 'CLEAN', detail: 'Single GP exposure. No herding risk. Independent conviction.', action: 'No overlap concern. Evaluate on standalone merit.' },
  ];

  // ── Resilience Matrix Data ──
  const antifragility = [
    { company: 'Anthropic', fragility: 'Antifragile', score: 92, stressResponse: 'AI regulation fears → demand increases. Constitutional AI becomes mandatory. Every competitor\'s scandal drives enterprise customers to Anthropic.', triggers: ['EU AI Act enforcement', 'AI incident/scandal', 'Regulation wave'], stressPerformance: '+35% revenue in regulatory stress scenario', color: T.accent },
    { company: 'Anduril Industries', fragility: 'Antifragile', score: 95, stressResponse: 'Geopolitical conflict → defense budgets surge. Every Taiwan/Ukraine escalation = contract acceleration. War is Anduril\'s growth catalyst.', triggers: ['Geopolitical escalation', 'Defense budget increase', 'Kinetic conflict'], stressPerformance: '+50% revenue in conflict scenario', color: T.accent },
    { company: 'Scale AI', fragility: 'Fragile', score: 38, stressResponse: 'AI commoditization → data labeling margins compress. Open-source models reduce labeling needs. Amazon/Google build internal alternatives.', triggers: ['AI commoditization', 'Open-source acceleration', 'Big tech vertical integration'], stressPerformance: '-25% revenue in commoditization scenario', color: T.red },
    { company: 'Palantir AIP', fragility: 'Robust', score: 72, stressResponse: 'Government shutdown → temporary revenue pause but contracts resume. Switching cost too high for permanent displacement. Not better or worse under stress.', triggers: ['Government shutdown', 'Budget sequestration', 'Administration change'], stressPerformance: '±5% revenue in political stress scenario', color: T.blue },
    { company: 'Shield AI', fragility: 'Antifragile', score: 88, stressResponse: 'Drone warfare proliferation → autonomous defense becomes essential. Every drone incident validates the thesis. Human pilot risk aversion = accelerant.', triggers: ['Drone warfare escalation', 'Pilot shortage', 'JADC2 mandate'], stressPerformance: '+40% revenue in conflict scenario', color: T.accent },
    { company: 'Databricks', fragility: 'Robust', score: 65, stressResponse: 'Data infrastructure is foundational — survives but doesn\'t benefit from stress. Cloud spending slowdown = headwind but not existential.', triggers: ['Cloud spending cut', 'Tech recession', 'Competition from Snowflake'], stressPerformance: '-10% revenue in tech recession', color: T.blue },
    { company: 'Verkada', fragility: 'Fragile', score: 42, stressResponse: 'Privacy backlash → surveillance hardware stigma. Data breach risk is existential. Regulatory crackdown on video surveillance.', triggers: ['Privacy regulation', 'Data breach incident', 'Surveillance backlash'], stressPerformance: '-30% revenue in privacy-first scenario', color: T.red },
    { company: 'Crusoe Energy', fragility: 'Antifragile', score: 82, stressResponse: 'Energy crisis → stranded gas becomes premium asset. GPU shortage → Crusoe\'s captive compute is worth more. Grid instability benefits off-grid compute.', triggers: ['Energy crisis', 'GPU shortage', 'Grid instability'], stressPerformance: '+25% revenue in energy stress scenario', color: T.accent },
  ];

  const correlationRegimes = [
    { pair: 'Founders Fund ↔ Lux Capital', normalCorr: 0.35, stressCorr: 0.72, delta: '+0.37', risk: 'Defense tech overlap (Anduril exposure in both). In stress, acts as single position.', mitigation: 'Acceptable — different entry points. Monitor post-IPO concentration.' },
    { pair: 'a16z ↔ Sequoia', normalCorr: 0.48, stressCorr: 0.82, delta: '+0.34', risk: 'AI Infrastructure overlap (Databricks, ScaleAI). Both mega-funds chase same deals.', mitigation: 'CONCERN — reduce combined allocation. 36% of NAV in two correlated GPs is too much.' },
    { pair: 'Benchmark ↔ Greylock', normalCorr: 0.22, stressCorr: 0.38, delta: '+0.16', risk: 'Low overlap — different stages, sectors. True diversification benefit.', mitigation: 'Ideal pair. Maintain or increase this uncorrelated combination.' },
    { pair: 'NEA ↔ Khosla', normalCorr: 0.18, stressCorr: 0.31, delta: '+0.13', risk: 'Very low overlap. Multi-stage vs. climate/AI. Genuine diversification.', mitigation: 'Best diversification pair in portfolio. Anchor both in Fund II.' },
    { pair: 'All 8 GPs (Portfolio)', normalCorr: 0.32, stressCorr: 0.58, delta: '+0.26', risk: 'Portfolio correlation nearly doubles in stress. AI sector concentration is the driver — when "AI" sells off, everything correlates.', mitigation: 'Add 1-2 non-AI GPs in Fund II (cybersecurity pure-play, fintech) to reduce stress correlation below 0.50.' },
  ];

  const survivalCurves = [
    { metric: 'Time to First Distribution', fund1Estimate: 'Q3 2027 (24% prob by then)', topQuartileBenchmark: 'Month 42', median: 'Month 54', bottomQuartile: 'Month 72+', status: 'On track — vintage 2023-2024 funds pacing ahead of benchmark due to AI IPO cycle' },
    { metric: 'Time to MOIC Breakeven (1.0x)', fund1Estimate: 'Q1 2027 (68% prob)', topQuartileBenchmark: 'Month 36', median: 'Month 48', bottomQuartile: 'Month 60', status: 'Likely early breakeven — current TVPI 1.42x already past breakeven' },
    { metric: 'Time to DPI 0.5x', fund1Estimate: 'Q4 2027 (45% prob)', topQuartileBenchmark: 'Month 48', median: 'Month 66', bottomQuartile: 'Month 84+', status: 'Dependent on Anduril IPO (largest NAV catalyst). If IPO in 2026, DPI 0.5x accelerates 12 months.' },
    { metric: 'Time to DPI 1.0x', fund1Estimate: 'Q2 2029 (30% prob)', topQuartileBenchmark: 'Month 72', median: 'Month 90', bottomQuartile: 'Month 108+', status: 'Requires 3+ GP distributions. Probability increases significantly if SpaceX IPO occurs.' },
    { metric: 'Time to Target TVPI 2.5x', fund1Estimate: 'Q4 2028 (35% prob)', topQuartileBenchmark: 'Month 60', median: 'Month 78', bottomQuartile: 'Never', status: 'Achievable in bull case (Anthropic + Anduril IPOs + secondary appreciation). Base case: 1.8-2.0x.' },
  ];

  return (
    <div>
      {/* Sub-tab Navigation */}
      <div style={{ display: 'flex', gap: 4, marginBottom: 16, flexWrap: 'wrap' }}>
        {dsViews.map(v => (
          <button key={v.id} onClick={() => setDsView(v.id)} style={{ padding: '7px 16px', fontSize: 11, fontWeight: dsView === v.id ? 700 : 500, background: dsView === v.id ? T.accentBg : 'transparent', color: dsView === v.id ? T.accent : T.textMuted, border: `1px solid ${dsView === v.id ? T.accent+'40' : T.border}`, borderRadius: 6, cursor: 'pointer', fontFamily: sans, transition: 'all .15s' }}>{v.label}</button>
        ))}
      </div>

      {/* ═══ TAB 1: BAYESIAN SIGNALS ═══ */}
      {dsView === 'bayesian' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 16 }}>
            <Stat label="Active Signals" value={bayesianSignals.reduce((s,b) => s + b.signals.length, 0)} icon={Activity} sub="across 6 entities" color={T.accent} />
            <Stat label="Avg Conviction Δ" value={`+${(bayesianSignals.reduce((s,b) => s + parseFloat(b.delta), 0) / bayesianSignals.length).toFixed(1)}`} icon={TrendingUp} sub="net positive signal" color={T.green} />
            <Stat label="Entities Weakening" value={bayesianSignals.filter(b => parseFloat(b.delta) < 0).length} icon={AlertTriangle} sub="negative updates" color={T.red} />
            <Stat label="Action Required" value={bayesianSignals.filter(b => b.action.startsWith('INCREASE') || b.action.startsWith('REDUCE') || b.action.startsWith('CUT')).length} icon={Zap} sub="portfolio changes" color={T.amber} />
          </div>

          <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Real-Time Bayesian Conviction Updates — Prior → Posterior</div>

          {bayesianSignals.map((entity, i) => {
            const convColor = entity.posteriorConviction >= 90 ? T.accent : entity.posteriorConviction >= 75 ? T.blue : entity.posteriorConviction >= 60 ? T.amber : T.red;
            const deltaColor = parseFloat(entity.delta) > 0 ? T.green : parseFloat(entity.delta) < 0 ? T.red : T.textMuted;
            return (
              <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '14px 16px', marginBottom: 10, borderLeft: `3px solid ${convColor}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 10 }}>
                  <div>
                    <div style={{ fontSize: 15, fontWeight: 700, color: T.text }}>{entity.entity}</div>
                    <Badge color={T.purple}>{entity.type}</Badge>
                  </div>
                  <div style={{ display: 'flex', gap: 16, alignItems: 'center' }}>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Prior</div>
                      <div style={{ fontSize: 18, fontWeight: 700, fontFamily: mono, color: T.textMuted }}>{entity.priorConviction}</div>
                    </div>
                    <div style={{ fontSize: 16, color: deltaColor, fontWeight: 800 }}>→</div>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Posterior</div>
                      <div style={{ fontSize: 18, fontWeight: 700, fontFamily: mono, color: convColor }}>{entity.posteriorConviction}</div>
                    </div>
                    <Badge color={deltaColor}>{entity.delta}</Badge>
                  </div>
                </div>

                <div style={{ marginBottom: 8 }}>
                  {entity.signals.map((sig, j) => (
                    <div key={j} style={{ display: 'flex', gap: 8, alignItems: 'center', padding: '3px 0', borderBottom: j < entity.signals.length - 1 ? `1px solid ${T.border}` : 'none' }}>
                      <div style={{ width: 18, height: 18, borderRadius: '50%', background: sig.direction === 'pos' ? T.greenBg : sig.direction === 'neg' ? T.redBg : T.bgAccent, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 10, flexShrink: 0 }}>
                        {sig.direction === 'pos' ? '↑' : sig.direction === 'neg' ? '↓' : '–'}
                      </div>
                      <div style={{ flex: 1, fontSize: 11, color: T.text }}>{sig.signal}</div>
                      <div style={{ fontSize: 10, fontFamily: mono, color: sig.weight > 0 ? T.green : sig.weight < 0 ? T.red : T.textMuted, fontWeight: 700, width: 30, textAlign: 'right' }}>{sig.weight > 0 ? '+' : ''}{sig.weight}</div>
                      <div style={{ fontSize: 9, color: T.textDim, width: 60 }}>{sig.date}</div>
                      <Badge color={T.bgAccent}>{sig.source}</Badge>
                    </div>
                  ))}
                </div>

                <div style={{ fontSize: 11, fontWeight: 600, color: entity.action.startsWith('INCREASE') || entity.action.startsWith('STRONG') || entity.action.startsWith('THESIS') ? T.accent : entity.action.startsWith('REDUCE') || entity.action.startsWith('CUT') ? T.red : T.amber, padding: '6px 10px', background: T.bgAccent, borderRadius: 4, fontFamily: mono }}>
                  ⚡ {entity.action}
                </div>
              </div>
            );
          })}
        </div>
      )}

      {/* ═══ TAB 2: REGIME & TIMING ═══ */}
      {dsView === 'regime' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 16 }}>
            <Stat label="Current Regime" value={regimeData.currentRegime} icon={Activity} sub="since Q2 2025" color={T.gold} />
            <Stat label="Regime Duration" value="9 months" icon={Clock} sub="avg regime: 14mo" color={T.blue} />
            <Stat label="Reflexivity Stage" value="4 of 6" icon={TrendingUp} sub="Acceleration Phase" color={T.accent} />
            <Stat label="Signals Decaying" value={regimeData.signalDecay.filter(s => s.status === 'decaying').length} icon={AlertTriangle} sub="require action" color={T.amber} />
          </div>

          {/* Regime Timeline */}
          <Card title="Market Regime Timeline — Hidden Markov State Detection" style={{ marginBottom: 14 }}>
            <div style={{ display: 'flex', gap: 0, marginBottom: 12 }}>
              {regimeData.regimeHistory.map((r, i) => (
                <div key={i} style={{ flex: 1, padding: '8px 6px', background: r.color + '15', borderBottom: `3px solid ${r.color}`, textAlign: 'center' }}>
                  <div style={{ fontSize: 9, fontWeight: 700, color: r.color, textTransform: 'uppercase' }}>{r.regime}</div>
                  <div style={{ fontSize: 8, color: T.textDim }}>{r.period}</div>
                </div>
              ))}
            </div>
            <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.5 }}>
              {regimeData.regimeHistory.map((r, i) => (
                <div key={i} style={{ display: 'flex', gap: 8, padding: '3px 0' }}>
                  <div style={{ width: 8, height: 8, borderRadius: '50%', background: r.color, marginTop: 4, flexShrink: 0 }} />
                  <span><span style={{ color: r.color, fontWeight: 600 }}>{r.regime}</span> — {r.description}</span>
                </div>
              ))}
            </div>
          </Card>

          {/* Regime Indicators Dashboard */}
          <Card title="Regime Indicators — Real-Time Market State Signals" style={{ marginBottom: 14 }}>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead><tr>{['Indicator', 'Current Value', 'Signal', 'Implied Regime', 'Weight', 'Heat'].map(h => <TH key={h} align={h === 'Indicator' || h === 'Signal' || h === 'Implied Regime' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
              <tbody>
                {regimeData.regimeIndicators.map((ind, i) => (
                  <tr key={i} style={{ borderBottom: `1px solid ${T.border}` }}>
                    <TD style={{ fontWeight: 600 }}>{ind.indicator}</TD>
                    <TD align="right" mono bold>{ind.value}</TD>
                    <TD style={{ fontSize: 10, color: T.textMuted }}>{ind.signal}</TD>
                    <TD><Badge color={ind.regime.includes('Late') ? T.amber : T.accent}>{ind.regime}</Badge></TD>
                    <TD align="right" mono>{(ind.weight * 100).toFixed(0)}%</TD>
                    <TD align="right"><span style={{ display: 'inline-block', width: 10, height: 10, borderRadius: '50%', background: ind.status === 'hot' ? T.red : ind.status === 'warm' ? T.amber : T.blue }} /></TD>
                  </tr>
                ))}
              </tbody>
            </table>
          </Card>

          {/* Reflexivity Cycle */}
          <Card title="Soros Reflexivity Loop — AI Safety Investment Cycle Position" style={{ marginBottom: 14 }}>
            <div style={{ display: 'flex', gap: 4, marginBottom: 12 }}>
              {regimeData.reflexivityPosition.stages.map((s, i) => (
                <div key={i} style={{ flex: 1, padding: '10px 8px', background: s.status === 'current' ? T.accentBg : s.status === 'complete' ? T.bgAccent : T.bgCard, border: `1px solid ${s.status === 'current' ? T.accent : T.border}`, borderRadius: 6, textAlign: 'center', position: 'relative' }}>
                  {s.status === 'current' && <div style={{ position: 'absolute', top: -6, left: '50%', transform: 'translateX(-50%)', fontSize: 8, background: T.accent, color: T.bg, padding: '1px 6px', borderRadius: 3, fontWeight: 700 }}>YOU ARE HERE</div>}
                  <div style={{ fontSize: 14, fontWeight: 800, color: s.status === 'current' ? T.accent : s.status === 'complete' ? T.green : T.textDim, fontFamily: mono }}>{s.num}</div>
                  <div style={{ fontSize: 9, fontWeight: 700, color: s.status === 'current' ? T.accent : T.textMuted, textTransform: 'uppercase' }}>{s.name}</div>
                  <div style={{ fontSize: 8, color: T.textDim, marginTop: 2 }}>{s.timing}</div>
                </div>
              ))}
            </div>
            <div style={{ fontSize: 12, color: T.accent, fontWeight: 600, padding: '8px 12px', background: T.accentBg, borderRadius: 6, fontFamily: mono }}>
              ⚡ {regimeData.reflexivityPosition.implication}
            </div>
          </Card>

          {/* Signal Decay */}
          <Card title="Signal Decay Functions — Intelligence Half-Life Tracker" style={{ marginBottom: 14 }}>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead><tr>{['Signal', 'Entity', 'Half-Life', 'Age', 'Remaining Value', 'Status'].map(h => <TH key={h} align={h === 'Signal' || h === 'Entity' || h === 'Status' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
              <tbody>
                {regimeData.signalDecay.sort((a,b) => parseFloat(a.remainingValue) - parseFloat(b.remainingValue)).map((s, i) => {
                  const val = parseFloat(s.remainingValue);
                  const valColor = val >= 75 ? T.green : val >= 50 ? T.amber : T.red;
                  return (
                    <tr key={i} style={{ borderBottom: `1px solid ${T.border}` }}>
                      <TD style={{ fontWeight: 600 }}>{s.signal}</TD>
                      <TD style={{ fontSize: 10, color: T.textMuted }}>{s.entity}</TD>
                      <TD align="right" mono>{s.halfLife}</TD>
                      <TD align="right" mono>{s.currentAge}</TD>
                      <TD align="right">
                        <div style={{ display: 'flex', alignItems: 'center', gap: 6, justifyContent: 'flex-end' }}>
                          <Bar value={val} max={100} color={valColor} h={4} />
                          <span style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: valColor, width: 35 }}>{s.remainingValue}</span>
                        </div>
                      </TD>
                      <TD><Badge color={s.status === 'fresh' ? T.green : s.status === 'active' ? T.blue : T.red}>{s.status}</Badge></TD>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>
        </div>
      )}

      {/* ═══ TAB 3: OPTIMAL SIZING ═══ */}
      {dsView === 'sizing' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 16 }}>
            <Stat label="Portfolio Kelly Efficiency" value="64%" icon={Target} sub="current vs optimal" color={T.amber} />
            <Stat label="Hidden Option Value" value="$55.6M" icon={DollarSign} sub="6 embedded options" color={T.accent} />
            <Stat label="Ergodicity Gap" value="-4%" icon={Activity} sub="time vs ensemble avg" color={T.blue} />
            <Stat label="Rebalancing Actions" value={kellySizing.filter(k => k.action.startsWith('INCREASE') || k.action.startsWith('REDUCE') || k.action.startsWith('CUT')).length} icon={Zap} sub="positions to adjust" color={T.red} />
          </div>

          {/* Kelly Criterion */}
          <Card title="Kelly Criterion — Optimal Fund II Bet Sizing" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Kelly fraction = (edge × odds - 1) / odds. Half-Kelly shown for conservative approach. Conviction-weighted.</div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead><tr>{['Fund', 'Edge', 'Odds', 'Kelly %', 'Current', 'Optimal', 'Δ', 'Conviction', 'Action'].map(h => <TH key={h} align={h === 'Fund' || h === 'Action' ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
              <tbody>
                {kellySizing.sort((a,b) => b.conviction - a.conviction).map((k, i) => {
                  const actionColor = k.action.startsWith('INCREASE') ? T.green : k.action.startsWith('REDUCE') || k.action.startsWith('CUT') ? T.red : T.blue;
                  const delta = ((k.optimalAllocation - k.currentAllocation) * 100).toFixed(0);
                  return (
                    <tr key={i} style={{ borderBottom: `1px solid ${T.border}` }}>
                      <TD style={{ fontWeight: 600 }}>{k.fund}</TD>
                      <TD align="right" mono>{(k.edge * 100).toFixed(0)}%</TD>
                      <TD align="right" mono>{k.odds}x</TD>
                      <TD align="right" mono bold color={T.accent}>{(k.kellyFraction * 100).toFixed(0)}%</TD>
                      <TD align="right" mono>{(k.currentAllocation * 100).toFixed(0)}%</TD>
                      <TD align="right" mono bold color={actionColor}>{(k.optimalAllocation * 100).toFixed(0)}%</TD>
                      <TD align="right" mono bold color={parseInt(delta) > 0 ? T.green : parseInt(delta) < 0 ? T.red : T.textMuted}>{parseInt(delta) > 0 ? '+' : ''}{delta}%</TD>
                      <TD align="right"><span style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: k.conviction >= 85 ? T.accent : k.conviction >= 70 ? T.blue : k.conviction >= 55 ? T.amber : T.red }}>{k.conviction}</span></TD>
                      <TD style={{ fontSize: 10, color: actionColor, fontWeight: 600 }}>{k.action.split('—')[0].trim()}</TD>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>

          {/* Real Options Valuation */}
          <Card title="Real Options Valuation — Hidden Portfolio Value" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Embedded options with quantifiable present value not reflected in NAV. Total hidden value: $55.6M (23.7% of current NAV).</div>
            {realOptions.map((opt, i) => (
              <div key={i} style={{ background: T.bgAccent, border: `1px solid ${T.border}`, borderRadius: 6, padding: '12px 14px', marginBottom: 8, display: 'grid', gridTemplateColumns: '1.5fr 1fr 1fr 1fr 1fr', gap: 8, alignItems: 'center' }}>
                <div>
                  <div style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{opt.option}</div>
                  <div style={{ display: 'flex', gap: 4, marginTop: 3 }}><Badge color={T.blue}>{opt.type}</Badge></div>
                </div>
                <div>
                  <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Estimated Value</div>
                  <div style={{ fontSize: 16, fontWeight: 800, fontFamily: mono, color: T.accent }}>{opt.estimatedValue}</div>
                </div>
                <div>
                  <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Probability</div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <Bar value={parseInt(opt.probability)} max={100} color={parseInt(opt.probability) >= 70 ? T.green : parseInt(opt.probability) >= 50 ? T.amber : T.red} h={5} />
                    <span style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: T.text }}>{opt.probability}</span>
                  </div>
                </div>
                <div>
                  <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Expiry</div>
                  <div style={{ fontSize: 11, fontFamily: mono, color: T.textMuted }}>{opt.timeToExpiry}</div>
                </div>
                <div>
                  <div style={{ fontSize: 8, color: T.textDim, textTransform: 'uppercase' }}>Trigger</div>
                  <div style={{ fontSize: 10, color: T.amber, fontWeight: 500 }}>{opt.trigger}</div>
                </div>
              </div>
            ))}
          </Card>

          {/* Ergodicity Analysis */}
          <Card title="Ergodicity Economics — Time-Average vs Ensemble-Average Returns" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Your LPs experience ONE path through time, not the average across parallel universes. Time-average ≠ expected value.</div>
            {ergodicity.map((e, i) => {
              const gapColor = Math.abs(parseFloat(e.gap)) <= 3 ? T.green : Math.abs(parseFloat(e.gap)) <= 5 ? T.amber : T.red;
              const isCurrent = e.scenario.includes('Current');
              const isOptimal = e.recommendation.startsWith('OPTIMAL');
              return (
                <div key={i} style={{ background: isCurrent ? T.accentBg : isOptimal ? T.greenBg : T.bgAccent, border: `1px solid ${isCurrent ? T.accent + '40' : isOptimal ? T.green + '40' : T.border}`, borderRadius: 6, padding: '12px 14px', marginBottom: 8 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 6 }}>
                    <div style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{e.scenario} {isCurrent && <Badge color={T.accent}>CURRENT</Badge>} {isOptimal && <Badge color={T.green}>RECOMMENDED</Badge>}</div>
                    <div style={{ display: 'flex', gap: 16 }}>
                      <div style={{ textAlign: 'center' }}><div style={{ fontSize: 8, color: T.textDim }}>ENSEMBLE</div><div style={{ fontSize: 14, fontFamily: mono, fontWeight: 700, color: T.text }}>{e.ensembleAvg}</div></div>
                      <div style={{ textAlign: 'center' }}><div style={{ fontSize: 8, color: T.textDim }}>TIME</div><div style={{ fontSize: 14, fontFamily: mono, fontWeight: 700, color: gapColor }}>{e.timeAvg}</div></div>
                      <div style={{ textAlign: 'center' }}><div style={{ fontSize: 8, color: T.textDim }}>GAP</div><div style={{ fontSize: 14, fontFamily: mono, fontWeight: 700, color: gapColor }}>{e.gap}</div></div>
                    </div>
                  </div>
                  <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 4 }}>{e.risk}</div>
                  <div style={{ fontSize: 11, fontWeight: 600, color: isOptimal ? T.green : e.recommendation.startsWith('DO NOT') || e.recommendation.startsWith('TOO') ? T.red : T.amber }}>{e.recommendation}</div>
                </div>
              );
            })}
          </Card>
        </div>
      )}

      {/* ═══ TAB 4: NETWORK GRAPH (CENTRALITY) ═══ */}
      {dsView === 'graph' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 16 }}>
            <Stat label="Highest Betweenness" value="Reid Hoffman" icon={Globe} sub="0.68 — bridge broker" color={T.purple} />
            <Stat label="Most Structural Holes" value="Jason Goldman" icon={GitBranch} sub="6 clusters bridged" color={T.accent} />
            <Stat label="Herding Alerts" value={herdingAlerts.filter(h => h.signal.includes('WARNING')).length} icon={AlertTriangle} sub="correlated GP bets" color={T.red} />
            <Stat label="Network Entropy" value="Low" icon={Zap} sub="clear signal differentiation" color={T.green} />
          </div>

          {/* Centrality Analysis Table */}
          <Card title="Network Centrality Analysis — Graph Theory Metrics" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Betweenness = bridge potential. Eigenvector = connected to power. Closeness = reach efficiency. Structural Holes = unique cluster access.</div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead><tr>{['Node', 'Influence', 'Betweenness', 'Eigenvector', 'Closeness', 'Struct. Holes', 'Clusters', 'Key Insight'].map(h => <TH key={h} align={['Node', 'Clusters', 'Key Insight'].includes(h) ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
              <tbody>
                {centralityData.sort((a,b) => b.betweenness - a.betweenness).map((n, i) => {
                  const isTeam = n.node.includes('Goldman') || n.node.includes('Wallace');
                  return (
                    <tr key={i} style={{ borderBottom: `1px solid ${T.border}`, background: isTeam ? T.accentBg : 'transparent' }}>
                      <TD style={{ fontWeight: 700, color: isTeam ? T.accent : T.text }}>{n.node}</TD>
                      <TD align="right" mono bold>{n.influence}</TD>
                      <TD align="right" mono bold color={n.betweenness >= 0.5 ? T.accent : n.betweenness >= 0.35 ? T.blue : T.textMuted}>{n.betweenness.toFixed(2)}</TD>
                      <TD align="right" mono bold color={n.eigenvector >= 0.85 ? T.accent : n.eigenvector >= 0.6 ? T.blue : T.textMuted}>{n.eigenvector.toFixed(2)}</TD>
                      <TD align="right" mono>{n.closeness.toFixed(2)}</TD>
                      <TD align="right" mono bold color={n.structuralHole >= 4 ? T.accent : n.structuralHole >= 2 ? T.blue : T.textMuted}>{n.structuralHole}</TD>
                      <TD style={{ fontSize: 9 }}>{n.clusters.map((c, j) => <Badge key={j} color={T.bgAccent}>{c}</Badge>)}</TD>
                      <TD style={{ fontSize: 9, color: T.textMuted, maxWidth: 180 }}>{n.insight.substring(0, 80)}...</TD>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>

          {/* Information Cascade / Herding Detection */}
          <Card title="Information Cascade & Herding Detection — Correlated GP Bets" style={{ marginBottom: 14 }}>
            {herdingAlerts.map((alert, i) => {
              const alertColor = alert.signal.includes('WARNING') ? T.red : alert.signal === 'CLEAN' ? T.green : T.amber;
              return (
                <div key={i} style={{ background: T.bgAccent, border: `1px solid ${T.border}`, borderRadius: 6, padding: '12px 14px', marginBottom: 8, borderLeft: `3px solid ${alertColor}` }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 6 }}>
                    <div>
                      <span style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{alert.deal}</span>
                      <Badge color={alertColor}>{alert.signal}</Badge>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                      <span style={{ fontSize: 9, color: T.textDim }}>OVERLAP</span>
                      <Bar value={alert.overlapScore} max={100} color={alertColor} h={6} />
                      <span style={{ fontSize: 12, fontFamily: mono, fontWeight: 700, color: alertColor }}>{alert.overlapScore}</span>
                    </div>
                  </div>
                  <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 4 }}>GPs: {alert.gpsInvolved.join(', ')}</div>
                  <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 6 }}>{alert.detail}</div>
                  <div style={{ fontSize: 11, fontWeight: 600, color: alertColor, fontFamily: mono }}>→ {alert.action}</div>
                </div>
              );
            })}
          </Card>

          {/* Structural Holes Opportunity */}
          <Card title="Structural Holes — Network Gaps to Fill" style={{ marginBottom: 14 }}>
            {[
              { gap: 'OpenAI / Microsoft Ecosystem', currentAccess: 'Indirect (2 hops via Reid Hoffman — DECAYING)', urgency: 'CRITICAL', action: 'Re-engage Reid Hoffman immediately. Alternative: recruit OpenAI-adjacent LP or advisor.', value: 'Access to GPT-5 ecosystem deals, Microsoft enterprise AI pipeline, OpenAI Fund LP intro.', color: T.red },
              { gap: 'Sovereign Wealth (ADIA/GIC/Temasek)', currentAccess: 'None — zero direct connections', urgency: 'HIGH', action: 'Engage Park Hill placement agent. Ken to attend Middle East investor summits. Jason explore Haas network for Gulf connections.', value: '$75M+ LP potential. Institutional credibility signal. Access to sovereign co-invest programs.', color: T.amber },
              { gap: 'European VC Ecosystem', currentAccess: 'Weak — SuperReturn attendance only', urgency: 'MEDIUM', action: 'Build Atomico / Index / Balderton relationships. European AI Safety (Mistral, DeepMind) growing rapidly.', value: 'Fund II international LP pipeline. European deal flow. Regulatory intel from EU AI Act first-movers.', color: T.blue },
              { gap: 'Biotech-AI Convergence', currentAccess: 'None — thesis gap', urgency: 'LOW', action: 'Not a current thesis priority. Monitor for Fund III. Potential via Khosla Ventures cross-pollination.', value: 'Emerging sector — AI drug discovery, precision medicine. May become investable at scale by 2028.', color: T.textMuted },
            ].map((hole, i) => (
              <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 6, padding: '12px 14px', marginBottom: 8, borderLeft: `3px solid ${hole.color}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                  <span style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{hole.gap}</span>
                  <Badge color={hole.color}>{hole.urgency}</Badge>
                </div>
                <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 4 }}>Current access: {hole.currentAccess}</div>
                <div style={{ fontSize: 11, color: T.accent, marginBottom: 4 }}>Value: {hole.value}</div>
                <div style={{ fontSize: 11, fontWeight: 600, color: hole.color, fontFamily: mono }}>→ {hole.action}</div>
              </div>
            ))}
          </Card>
        </div>
      )}

      {/* ═══ TAB 5: RESILIENCE MATRIX ═══ */}
      {dsView === 'resilience' && (
        <div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 16 }}>
            <Stat label="Antifragile Positions" value={antifragility.filter(a => a.fragility === 'Antifragile').length} icon={Shield} sub={`${((antifragility.filter(a => a.fragility === 'Antifragile').length / antifragility.length) * 100).toFixed(0)}% of portfolio`} color={T.accent} />
            <Stat label="Fragile Positions" value={antifragility.filter(a => a.fragility === 'Fragile').length} icon={AlertTriangle} sub="require hedging" color={T.red} />
            <Stat label="Stress Correlation" value="0.58" icon={Activity} sub="portfolio-wide (target <0.50)" color={T.amber} />
            <Stat label="DPI Breakeven" value="Q1 2027" icon={Clock} sub="68% probability" color={T.green} />
          </div>

          {/* Antifragility Scoring */}
          <Card title="Taleb Antifragility Scoring — Stress Response by Position" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Fragile = harmed by volatility. Robust = indifferent. Antifragile = benefits from disorder. Portfolio should be net antifragile.</div>
            {antifragility.sort((a,b) => b.score - a.score).map((pos, i) => {
              const fragColor = pos.fragility === 'Antifragile' ? T.accent : pos.fragility === 'Robust' ? T.blue : T.red;
              return (
                <div key={i} style={{ background: T.bgAccent, border: `1px solid ${T.border}`, borderRadius: 6, padding: '12px 14px', marginBottom: 8, borderLeft: `3px solid ${fragColor}` }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 6 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                      <span style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{pos.company}</span>
                      <Badge color={fragColor}>{pos.fragility}</Badge>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                      <Bar value={pos.score} max={100} color={fragColor} h={6} />
                      <span style={{ fontSize: 14, fontFamily: mono, fontWeight: 700, color: fragColor }}>{pos.score}</span>
                    </div>
                  </div>
                  <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 4 }}>{pos.stressResponse}</div>
                  <div style={{ display: 'flex', gap: 4, marginBottom: 4 }}>
                    {pos.triggers.map((t, j) => <Badge key={j} color={T.bgCard}>{t}</Badge>)}
                  </div>
                  <div style={{ fontSize: 11, fontWeight: 600, fontFamily: mono, color: pos.stressPerformance.includes('+') ? T.green : T.red }}>{pos.stressPerformance}</div>
                </div>
              );
            })}
          </Card>

          {/* Correlation Regime Shifts */}
          <Card title="Correlation Regime Shifts — Normal vs Stress Correlations" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Diversification math assumes stable correlations. In stress, correlations spike — your "diversified" portfolio may act as a single position.</div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead><tr>{['GP Pair', 'Normal ρ', 'Stress ρ', 'Δ', 'Risk Assessment', 'Mitigation'].map(h => <TH key={h} align={['GP Pair', 'Risk Assessment', 'Mitigation'].includes(h) ? 'left' : 'right'}>{h}</TH>)}</tr></thead>
              <tbody>
                {correlationRegimes.map((c, i) => {
                  const deltaVal = parseFloat(c.delta);
                  const isPortfolio = c.pair.includes('All 8');
                  return (
                    <tr key={i} style={{ borderBottom: `1px solid ${T.border}`, background: isPortfolio ? T.amberBg : 'transparent' }}>
                      <TD style={{ fontWeight: isPortfolio ? 700 : 600, color: isPortfolio ? T.amber : T.text }}>{c.pair}</TD>
                      <TD align="right" mono>{c.normalCorr.toFixed(2)}</TD>
                      <TD align="right" mono bold color={c.stressCorr >= 0.7 ? T.red : c.stressCorr >= 0.5 ? T.amber : T.green}>{c.stressCorr.toFixed(2)}</TD>
                      <TD align="right" mono bold color={deltaVal >= 0.3 ? T.red : deltaVal >= 0.2 ? T.amber : T.green}>+{c.delta}</TD>
                      <TD style={{ fontSize: 10, color: T.textMuted }}>{c.risk.substring(0, 60)}...</TD>
                      <TD style={{ fontSize: 10, color: c.mitigation.startsWith('CONCERN') ? T.red : c.mitigation.startsWith('Ideal') ? T.green : T.textMuted }}>{c.mitigation.substring(0, 50)}...</TD>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>

          {/* Survival Curves */}
          <Card title="Kaplan-Meier Survival Curves — Time-to-Event Projections" style={{ marginBottom: 14 }}>
            <div style={{ fontSize: 10, color: T.textMuted, marginBottom: 8 }}>Probability distributions for key fund lifecycle milestones. Dynamically updated as GP reports come in.</div>
            {survivalCurves.map((curve, i) => (
              <div key={i} style={{ background: T.bgAccent, border: `1px solid ${T.border}`, borderRadius: 6, padding: '12px 14px', marginBottom: 8 }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>
                  <span style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{curve.metric}</span>
                  <span style={{ fontSize: 12, fontFamily: mono, fontWeight: 700, color: T.accent }}>{curve.fund1Estimate.split('(')[0].trim()}</span>
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 8, marginBottom: 6 }}>
                  <div style={{ textAlign: 'center', padding: '4px', background: T.greenBg, borderRadius: 4 }}>
                    <div style={{ fontSize: 8, color: T.textDim }}>TOP QUARTILE</div>
                    <div style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: T.green }}>{curve.topQuartileBenchmark}</div>
                  </div>
                  <div style={{ textAlign: 'center', padding: '4px', background: T.blueBg, borderRadius: 4 }}>
                    <div style={{ fontSize: 8, color: T.textDim }}>MEDIAN</div>
                    <div style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: T.blue }}>{curve.median}</div>
                  </div>
                  <div style={{ textAlign: 'center', padding: '4px', background: T.redBg, borderRadius: 4 }}>
                    <div style={{ fontSize: 8, color: T.textDim }}>BOTTOM QUARTILE</div>
                    <div style={{ fontSize: 11, fontFamily: mono, fontWeight: 700, color: T.red }}>{curve.bottomQuartile}</div>
                  </div>
                </div>
                <div style={{ fontSize: 11, color: T.textMuted }}>{curve.status}</div>
              </div>
            ))}
          </Card>
        </div>
      )}
    </div>
  );
};

// ════════════════════════════════════════════════════
// DATA INGESTION — UPLOAD & CONTEXTUAL INTELLIGENCE
// ════════════════════════════════════════════════════
const DataIngestion = () => {
  const [diView, setDiView] = useState('upload');
  const [uploadQueue, setUploadQueue] = useState([]);
  const [dragOver, setDragOver] = useState(false);
  const fileRef = useRef(null);
  const diViews = [{id:'upload',label:'Upload Center'},{id:'gpreports',label:'GP Reports'},{id:'deals',label:'Deal Ingestion'},{id:'reconcile',label:'Reconciliation'},{id:'integrations',label:'Integration Map'}];
  const GP = [
    {id:1,gp:'Founders Fund',fund:'FF VII',p:'Q4 25',by:'Ken',st:'processed',pg:42,nb:16.8,na:18.2,nd:'+8.3%',tb:1.38,ta:1.46,ib:26.1,ia:28.3,cl:2.1,di:0.8,mu:[{co:'Anthropic',b:45,a:61.5,d:'+36.7%',dr:'Series D close $61.5B'},{co:'SpaceX',b:280,a:350,d:'+25%',dr:'Secondary price increase'},{co:'Contextual AI',b:.8,a:1.2,d:'+50%',dr:'Series B close'}],md:[{co:'Anysphere',b:2.4,a:2.2,d:'-8.3%',dr:'Cursor competition from Windsurf'}],ins:['Top-decile pacing','SpaceX IPO/tender H2 2026','Anthropic co-invest opening Q2','GP requesting $5M co-invest add'],im:[['Portfolio','NAV $16.8→$18.2M',Layers],['Analytics','TVPI 1.40→1.42',PieChart],['Signals','3 new signals',Bell],['Decision','Bayesian FF 90→95',Zap]]},
    {id:2,gp:'Lux Capital',fund:'Lux VI',p:'Q4 25',by:'Ken',st:'processed',pg:38,nb:15.2,na:16.8,nd:'+10.5%',tb:1.42,ta:1.50,ib:20.8,ia:22.1,cl:1.5,di:0,mu:[{co:'Anduril',b:22,a:28,d:'+27.3%',dr:'CJADC2 contract + Series F'},{co:'Armada',b:.32,a:.48,d:'+50%',dr:'Series A, edge AI contracts'}],md:[],ins:['Anduril IPO prep accelerating','Armada first DoD edge contract','Fully deployed','First distribution H2 2026 expected'],im:[['Portfolio','NAV $15.2→$16.8M',Layers],['Signals','Anduril timeline +3mo',Bell]]},
    {id:3,gp:'a16z',fund:'a16z Infra',p:'Q4 25',by:'Bob',st:'processed',pg:56,nb:20.1,na:22.5,nd:'+11.9%',tb:1.18,ta:1.25,ib:16.2,ia:18.7,cl:4.0,di:0,mu:[{co:'Databricks',b:52,a:62,d:'+19.2%',dr:'Series I $62B, S-1 imminent'},{co:'Scale AI',b:12.5,a:13.8,d:'+10.4%',dr:'Pentagon CDAO expansion'}],md:[],ins:['Databricks S-1 filed — IPO Q3 2026','Scale AI competitive pressure from AWS','$8M into Together AI','36% called at month 14'],im:[['Portfolio','NAV $20.1→$22.5M',Layers],['Signals','Databricks IPO 72→82%',Bell],['Decision','Kelly alert: a16z 21% vs 12%',Zap]]},
    {id:4,gp:'Greylock',fund:'Greylock XVII',p:'Q4 25',by:'Bob',st:'review',pg:34,nb:11.2,na:11.8,nd:'+5.4%',tb:1.15,ta:1.18,ib:14.8,ia:15.4,cl:2.0,di:0,mu:[{co:'Drata',b:2.5,a:2.7,d:'+8%',dr:'Revenue +35% — slowing'}],md:[{co:'WorkOS',b:1.8,a:1.5,d:'-16.7%',dr:'Customer churn, Auth0 competition'}],ins:['Below median for vintage','GovTech needs 18+ months','New partner ex-Palantir CTO','GP extending timeline 6 months'],im:[['Decision','Conviction 72→69',Zap],['Analytics','Watch list: TVPI 1.18x',AlertTriangle]]},
    {id:5,gp:'NEA',fund:'NEA 19',p:'Q4 25',by:'Ken',st:'processed',pg:68,nb:58.4,na:62.1,nd:'+6.3%',tb:1.78,ta:1.85,ib:23.8,ia:24.6,cl:0.5,di:2.8,mu:[{co:'Robust Intel',b:.68,a:.86,d:'+26.5%',dr:'Series C, red-teaming demand surge'}],md:[],ins:['First distribution $2.8M from Palantir','DPI 0.7x→0.8x','Robust Intelligence acquisition interest from Databricks'],im:[['Portfolio','DPI 0.7→0.8x',Layers],['Signals','M&A: Databricks × Robust',Bell]]},
  ];
  const DEALS = [
    {n:'Haize Labs',stg:'Series A',sec:'AI Safety',amt:'$12M',val:'$85M pre',by:'Jason',src:'UC Berkeley BAIR',st:'scored',os:87,fnd:['Dr. Leonard Tang (PhD Berkeley, ex-DeepMind)','Dr. David Kang (PhD Stanford, ex-Anthropic)'],prod:'AI red-teaming platform for LLMs. Enterprise API + managed service.',trac:'ARR $2.2M, 180% QoQ, 8 enterprise customers',moat:'14K+ jailbreak patterns. Only constitutional AI testing framework.',th:'AI Safety core thesis. Red-teaming mandatory under EU AI Act.',risks:['Robust Intel portfolio overlap','Academic founders, first-time operators','Big tech internal alternatives'],ctx:[['Portfolio','Robust Intelligence is direct competitor (NEA 19)','conflict'],['Signals','EU AI Act requires red-teaming — thesis validation','catalyst'],['Network','Berkeley BAIR sourced (38% conversion rate)','source']],rec:'PASS TO GP — Share with FF & Benchmark. Co-invest $500K.'},
    {n:'Vannevar Labs',stg:'Series B',sec:'GovTech',amt:'$45M',val:'$280M pre',by:'Bob',src:'NEA GP referral',st:'scored',os:82,fnd:['Brett Granberg (ex-Palantir, ex-In-Q-Tel)','Nini Moorhead (ex-NSA, Stanford MBA)'],prod:'AI intelligence analysis for defense & IC. OSINT + classified data fusion.',trac:'ARR $18M, 120% growth, 6 DoD/IC contracts',moat:'42 of 85 employees TS/SCI cleared. Only startup with JWICS authorization.',th:'Defense AI spending accelerating. Fills Palantir gap.',risks:['18-24mo procurement cycles','Palantir pricing pressure','Clearance bottleneck'],ctx:[['Portfolio','Complementary to Palantir (NEA 19)','support'],['Signals','Taiwan exercises +4.2% defense stocks','catalyst'],['Network','Alex Karp diligence reference via Ken','diligence']],rec:'REFER TO LUX — Co-invest $1M if Lux leads.'},
    {n:'Norm AI',stg:'Series A',sec:'AI Safety',amt:'$28M',val:'$150M pre',by:'Jason',src:'RSA Conference',st:'review',os:79,fnd:['Tyler Sweatt (ex-Deloitte, Georgetown Law)','Hunter Heeks (ex-Latham, Stanford CS)'],prod:'AI compliance automation. Maps regulations to AI behaviors.',trac:'ARR $5.8M, 200% growth, 22 customers, $18M pipe',moat:'Only platform mapping ALL global AI regulations.',th:'Bridge AI Safety + Trust & Safety. Winner-take-most.',risks:['Drata overlap','Regulatory fragmentation','Legal-first team'],ctx:[['Portfolio','Drata adjacent, different layer','watch'],['Signals','EU AI Act Apr 2026 — direct catalyst','catalyst']],rec:'INTERESTED — Invite founders. Refer a16z for lead. Co-invest $750K.'},
    {n:'Saronic Technologies',stg:'Series B',sec:'GovTech',amt:'$175M',val:'$1.1B pre',by:'Brett',src:'Founders Fund GP',st:'pending',os:91,fnd:['Deans Fisher (Naval Academy, ex-DARPA)','Mike Johnson (Georgia Tech, autonomous)'],prod:'Autonomous surface vessels for naval defense. AI unmanned ships.',trac:'ARR $42M, 280% growth, USN contract 8 vessels, $200M backlog',moat:'Only startup with active USN unmanned vessel contract.',th:'Defense autonomy core thesis. Maritime underexplored vs aerial.',risks:['Hardware margins','Navy procurement timeline','80% single customer'],ctx:[['Portfolio','Complements Anduril & Shield AI','support'],['Signals','Taiwan PLAN exercises — direct demand','catalyst'],['Decision','Antifragility 90+ — benefits from stress','support']],rec:'STRONG BUY — Anchor co-invest $2M alongside FF lead.'},
  ];
  const RECON = [
    {f:'FF VII NAV',s:'GP Q4',up:'$18.2M',ex:'$16.8M',d:'+$1.4M',st:'auto',pr:'critical',am:['Portfolio','Analytics','Investor View']},
    {f:'Anthropic Val',s:'GP Q4 + Bloomberg',up:'$61.5B',ex:'$45B',d:'+$16.5B',st:'auto',pr:'critical',am:['Portfolio','Signals','Decision']},
    {f:'a16z Capital Called',s:'GP Q4',up:'$18M (36%)',ex:'$14M (28%)',d:'+$4M',st:'auto',pr:'medium',am:['Analytics','Cash Flows']},
    {f:'Scale AI Growth',s:'GP vs Market',up:'62% (GP)',ex:'95% (prior)',d:'-33% decel',st:'review',pr:'high',am:['Signals','Decision','Portfolio']},
    {f:'NEA 19 Distribution',s:'GP Q4',up:'$2.8M',ex:'$0',d:'+$2.8M DPI',st:'auto',pr:'critical',am:['Analytics','Cash Flows','Investor View']},
    {f:'Together AI',s:'a16z Q4',up:'New $8M',ex:'Not tracked',d:'NEW',st:'pending',pr:'medium',am:['Portfolio','Overlap Analysis']},
    {f:'Anduril Valuation',s:'Lux Q4',up:'$28B',ex:'$22B',d:'+$6B',st:'auto',pr:'critical',am:['Portfolio','Signals','Catalyst']},
    {f:'Robust Intel M&A',s:'NEA Q4',up:'Databricks exploring',ex:'No M&A signal',d:'NEW signal',st:'auto',pr:'high',am:['Signals','Decision']},
    {f:'Saronic Technologies',s:'Deal upload',up:'$1.1B, score 91',ex:'Not in pipeline',d:'NEW',st:'pending',pr:'high',am:['Pipeline','Decision']},
  ];
  const handleFiles = (files) => {
    const nu = Array.from(files).map((f,i)=>({id:`u-${Date.now()}-${i}`,name:f.name,size:((f.size||0)/1048576).toFixed(2)+' MB',type:f.name.split('.').pop(),status:'queued',progress:0,category:f.name.toLowerCase().includes('q4')||f.name.toLowerCase().includes('quarter')?'GP Report':f.name.toLowerCase().includes('deck')||f.name.toLowerCase().includes('memo')?'Deal Memo':'Document'}));
    setUploadQueue(p=>[...nu,...p]);
    nu.forEach((u,i)=>{setTimeout(()=>setUploadQueue(p=>p.map(x=>x.id===u.id?{...x,status:'processing',progress:30}:x)),500+i*300);setTimeout(()=>setUploadQueue(p=>p.map(x=>x.id===u.id?{...x,status:'processing',progress:70}:x)),1500+i*300);setTimeout(()=>setUploadQueue(p=>p.map(x=>x.id===u.id?{...x,status:'processed',progress:100}:x)),2500+i*300);});
  };
  const stC={processed:T.green,review:T.amber,auto:T.green,pending:T.blue,scored:T.green};
  const prC={critical:T.red,high:T.amber,medium:T.blue,low:T.textMuted};
  const ctxC={conflict:T.red,catalyst:T.green,source:T.purple,support:T.accent,diligence:T.blue,watch:T.amber};
  return (
    <div>
      <div style={{display:'flex',gap:4,marginBottom:16,flexWrap:'wrap'}}>
        {diViews.map(v=><button key={v.id} onClick={()=>setDiView(v.id)} style={{padding:'7px 16px',fontSize:11,fontWeight:diView===v.id?700:500,background:diView===v.id?T.accentBg:'transparent',color:diView===v.id?T.accent:T.textMuted,border:`1px solid ${diView===v.id?T.accent+'40':T.border}`,borderRadius:6,cursor:'pointer',fontFamily:sans,transition:'all .15s'}}>{v.label}</button>)}
      </div>
      {diView==='upload'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Reports Ingested" value={GP.length} icon={FileText} sub="Q4 2025 cycle" color={T.accent}/>
          <Stat label="Deals Uploaded" value={DEALS.length} icon={GitBranch} sub="this month" color={T.green}/>
          <Stat label="Data Points" value="342" icon={Database} sub="extracted" color={T.blue}/>
          <Stat label="Auto-Reconciled" value="87%" icon={CheckCircle} sub={`${RECON.length} items synced`} color={T.purple}/>
        </div>
        <div onDragOver={e=>{e.preventDefault();setDragOver(true)}} onDragLeave={()=>setDragOver(false)} onDrop={e=>{e.preventDefault();setDragOver(false);handleFiles(e.dataTransfer.files)}} onClick={()=>fileRef.current?.click()} style={{border:`2px dashed ${dragOver?T.accent:T.border}`,borderRadius:12,padding:'40px 20px',textAlign:'center',cursor:'pointer',background:dragOver?T.accentBg:T.bgCard,transition:'all 0.2s',marginBottom:16}}>
          <input ref={fileRef} type="file" multiple accept=".pdf,.xlsx,.docx,.csv" style={{display:'none'}} onChange={e=>handleFiles(e.target.files)}/>
          <Upload size={36} color={dragOver?T.accent:T.textMuted} style={{marginBottom:8}}/>
          <div style={{fontSize:14,fontWeight:700,color:dragOver?T.accent:T.text,marginBottom:4}}>{dragOver?'Drop files to upload':'Drop GP quarterly reports, deal memos, or term sheets'}</div>
          <div style={{fontSize:11,color:T.textMuted}}>PDF, Excel, Word, CSV • Auto-detects type & extracts structured data</div>
          <div style={{display:'flex',gap:8,justifyContent:'center',marginTop:12}}>{['GP Quarterly','Deal Memo','Term Sheet','Capital Call','Distribution'].map((t,i)=><Badge key={i} color={T.bgAccent}>{t}</Badge>)}</div>
        </div>
        {uploadQueue.length>0&&<Card title="Upload Queue" style={{marginBottom:14}}><div style={{padding:'8px 12px'}}>{uploadQueue.map((u,i)=>(<div key={u.id} style={{display:'flex',alignItems:'center',gap:10,padding:'8px 0',borderBottom:i<uploadQueue.length-1?`1px solid ${T.border}`:'none'}}><FileText size={16} color={u.status==='processed'?T.green:T.textMuted}/><div style={{flex:1}}><div style={{fontSize:12,fontWeight:600,color:T.text}}>{u.name}</div><div style={{fontSize:10,color:T.textMuted}}>{u.size} • {u.category}</div></div><div style={{width:120}}><Bar value={u.progress} max={100} color={u.status==='processed'?T.green:T.accent} h={4}/></div><Badge color={stC[u.status]||T.textMuted}>{u.status}</Badge></div>))}</div></Card>}
        <Card title="Processing History" style={{marginBottom:14}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>{['Fund','GP','Period','Type','Pages','Uploaded','By','Status','Impact'].map(h=><TH key={h} align={['Pages','Impact'].includes(h)?'right':'left'}>{h}</TH>)}</tr></thead><tbody>
            {GP.map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}><TD style={{fontWeight:600}}>{r.fund}</TD><TD style={{fontSize:10,color:T.textMuted}}>{r.gp}</TD><TD mono>{r.p}</TD><TD><Badge color={T.bgAccent}>PDF</Badge></TD><TD align="right" mono>{r.pg}</TD><TD style={{fontSize:10,color:T.textMuted}}>Feb 2026</TD><TD style={{fontSize:10,color:T.textMuted}}>{r.by}</TD><TD><Badge color={stC[r.st]}>{r.st}</Badge></TD><TD align="right" mono bold color={T.accent}>{r.im.length} modules</TD></tr>))}
            {DEALS.map((d,i)=>(<tr key={`d${i}`} style={{borderBottom:`1px solid ${T.border}`}}><TD style={{fontWeight:600}}>{d.n}</TD><TD style={{fontSize:10,color:T.textMuted}}>{d.src}</TD><TD mono>{d.stg}</TD><TD><Badge color={T.bgAccent}>{d.sec}</Badge></TD><TD align="right" mono>—</TD><TD style={{fontSize:10,color:T.textMuted}}>Feb 2026</TD><TD style={{fontSize:10,color:T.textMuted}}>{d.by}</TD><TD><Badge color={stC[d.st]}>{d.st}</Badge></TD><TD align="right" mono bold color={T.accent}>{d.ctx.length} links</TD></tr>))}
          </tbody></table>
        </Card>
        <Card title="Data Flow — How Uploads Power the Platform"><div style={{padding:16,display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12}}>
          {[{s:'GP Quarterly Reports',n:GP.length,flows:['Portfolio NAV updates','TVPI/IRR recalculation','Bayesian conviction updates','LP investor letters','Catalyst updates'],c:T.accent},{s:'Deal Memos & Decks',n:DEALS.length,flows:['Pipeline additions','Omniscient scoring','Competitive overlap','Network attribution','Herding detection'],c:T.green},{s:'Capital Notices',n:3,flows:['Cash flow projections','DPI calculations','J-curve recalibration','Fund pacing model','Dry powder tracking'],c:T.amber}].map((s,i)=><div key={i} style={{background:T.bgAccent,borderRadius:8,padding:14,borderTop:`3px solid ${s.c}`}}><div style={{fontSize:13,fontWeight:700,color:T.text}}>{s.s} <span style={{fontSize:10,color:T.textMuted}}>({s.n})</span></div><div style={{fontSize:10,color:T.textDim,marginTop:6,fontWeight:700}}>FEEDS INTO:</div>{s.flows.map((f,j)=><div key={j} style={{fontSize:10,color:T.textMuted,padding:'2px 0 2px 10px',borderLeft:`2px solid ${s.c}30`}}>{f}</div>)}</div>)}
        </div></Card>
      </div>)}
      {diView==='gpreports'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Reports" value={GP.length} icon={FileText} sub="Q4 2025" color={T.accent}/>
          <Stat label="NAV Δ" value={`+$${GP.reduce((s,r)=>s+(r.na-r.nb),0).toFixed(1)}M`} icon={TrendingUp} sub="across GPs" color={T.green}/>
          <Stat label="Called" value={`$${GP.reduce((s,r)=>s+r.cl,0).toFixed(1)}M`} icon={ArrowDownRight} sub="this quarter" color={T.red}/>
          <Stat label="Distributed" value={`$${GP.reduce((s,r)=>s+r.di,0).toFixed(1)}M`} icon={ArrowUpRight} sub="cash returned" color={T.green}/>
        </div>
        <Card title="NAV Waterfall — GP-by-GP Impact" style={{marginBottom:14}}><div style={{padding:'12px 16px'}}>
          <svg width={710} height={200}>{(()=>{const bars=GP.map(r=>({l:r.gp.split(' ').slice(0,2).join(' '),d:r.na-r.nb,c:r.na>r.nb?T.green:T.red}));const sN=GP.reduce((s,r)=>s+r.nb,0);const eN=GP.reduce((s,r)=>s+r.na,0);const mx=eN*1.1;const bW=70,gap=20,sx=80;let cum=sN;return(<g><rect x={sx} y={180-(sN/mx)*160} width={bW} height={(sN/mx)*160} rx={3} fill={T.textMuted} opacity={.4}/><text x={sx+bW/2} y={180-(sN/mx)*160-6} fill={T.textMuted} fontSize={10} textAnchor="middle" fontFamily={mono} fontWeight={700}>${sN.toFixed(0)}M</text><text x={sx+bW/2} y={196} fill={T.textDim} fontSize={8} textAnchor="middle">Prior</text>
            {bars.map((b,i)=>{const x=sx+(i+1)*(bW+gap);const prev=cum;cum+=b.d;const bT=180-(Math.max(prev,cum)/mx)*160;const bH=(Math.abs(b.d)/mx)*160;return(<g key={i}><line x1={x-gap/2} y1={180-(prev/mx)*160} x2={x} y2={180-(prev/mx)*160} stroke={T.border} strokeWidth={1} strokeDasharray="3,3"/><rect x={x} y={bT} width={bW} height={Math.max(bH,2)} rx={3} fill={b.c} opacity={.7}/><text x={x+bW/2} y={bT-6} fill={b.c} fontSize={9} textAnchor="middle" fontFamily={mono} fontWeight={700}>+${b.d.toFixed(1)}M</text><text x={x+bW/2} y={196} fill={T.textDim} fontSize={7} textAnchor="middle">{b.l}</text></g>);})}
            {(()=>{const x=sx+(bars.length+1)*(bW+gap);return(<g><rect x={x} y={180-(eN/mx)*160} width={bW} height={(eN/mx)*160} rx={3} fill={T.accent} opacity={.7}/><text x={x+bW/2} y={180-(eN/mx)*160-6} fill={T.accent} fontSize={10} textAnchor="middle" fontFamily={mono} fontWeight={700}>${eN.toFixed(0)}M</text><text x={x+bW/2} y={196} fill={T.textDim} fontSize={8} textAnchor="middle">Current</text></g>);})()}
          </g>);})()}</svg>
        </div></Card>
        {GP.map((r,ri)=>(<Card key={ri} title={`${r.fund} — ${r.p} Quarterly Report`} style={{marginBottom:14}} action={<div style={{display:'flex',gap:4}}><Badge color={stC[r.st]}>{r.st}</Badge><Badge color={T.bgAccent}>{r.pg}pg</Badge></div>}>
          <div style={{padding:'12px 16px'}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8,marginBottom:12}}>
              {[{l:'NAV',v:`$${r.na}M`,d:r.nd,c:T.accent},{l:'TVPI',v:`${r.ta}x`,d:`+${(r.ta-r.tb).toFixed(2)}`,c:T.green},{l:'IRR',v:`${r.ia}%`,d:`+${(r.ia-r.ib).toFixed(1)}%`,c:T.blue},{l:'Called',v:`$${r.cl}M`,c:T.red},{l:'Distributed',v:`$${r.di}M`,c:T.green},{l:'Net Cash',v:`$${(r.di-r.cl).toFixed(1)}M`,c:r.di>=r.cl?T.green:T.amber}].map((m,i)=><div key={i} style={{background:T.bgAccent,borderRadius:6,padding:'8px 10px',textAlign:'center'}}><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{m.l}</div><div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div>{m.d&&<div style={{fontSize:9,color:m.d.startsWith('-')?T.red:T.green,fontFamily:mono}}>{m.d}</div>}</div>)}
            </div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:12}}>
              <div><div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',fontWeight:700,marginBottom:4}}>Markups</div>{r.mu.map((m,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 8px',background:T.greenBg,borderRadius:4,marginBottom:3,borderLeft:`3px solid ${T.green}`}}><div><div style={{fontSize:11,fontWeight:600,color:T.text}}>{m.co}</div><div style={{fontSize:9,color:T.textMuted}}>{m.dr}</div></div><div style={{fontSize:12,fontFamily:mono,fontWeight:700,color:T.green}}>{m.d}</div></div>)}</div>
              <div><div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',fontWeight:700,marginBottom:4}}>Markdowns</div>{r.md.length>0?r.md.map((m,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 8px',background:T.redBg,borderRadius:4,marginBottom:3,borderLeft:`3px solid ${T.red}`}}><div><div style={{fontSize:11,fontWeight:600,color:T.text}}>{m.co}</div><div style={{fontSize:9,color:T.textMuted}}>{m.dr}</div></div><div style={{fontSize:12,fontFamily:mono,fontWeight:700,color:T.red}}>{m.d}</div></div>):<div style={{fontSize:11,color:T.textDim,padding:8,background:T.bgAccent,borderRadius:4}}>No markdowns this quarter</div>}</div>
            </div>
            <div style={{marginBottom:12}}><div style={{fontSize:10,color:T.textDim,textTransform:'uppercase',fontWeight:700,marginBottom:4}}>Key Insights</div>{r.ins.map((n,i)=><div key={i} style={{fontSize:11,color:T.text,padding:'3px 0 3px 10px',borderLeft:`2px solid ${T.accent}30`,marginBottom:2}}>{n}</div>)}</div>
            <div style={{display:'flex',gap:6,flexWrap:'wrap'}}><span style={{fontSize:9,color:T.textDim,fontWeight:700,textTransform:'uppercase'}}>Data flows to →</span>{r.im.map(([mod,ch,Ic],i)=><div key={i} style={{display:'inline-flex',alignItems:'center',gap:4,padding:'2px 8px',background:T.accentBg,borderRadius:4,border:`1px solid ${T.accent}20`}}><Ic size={10} color={T.accent}/><span style={{fontSize:9,color:T.accent,fontWeight:600}}>{mod}</span><span style={{fontSize:8,color:T.textMuted}}>{ch}</span></div>)}</div>
          </div>
        </Card>))}
      </div>)}
      {diView==='deals'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Deals Uploaded" value={DEALS.length} icon={GitBranch} sub="this month" color={T.accent}/>
          <Stat label="Avg Score" value={Math.round(DEALS.reduce((s,d)=>s+d.os,0)/DEALS.length)} icon={Target} sub="Omniscient" color={T.green}/>
          <Stat label="AI Safety" value={DEALS.filter(d=>d.sec==='AI Safety').length} icon={Shield} sub="thesis-aligned" color={T.blue}/>
          <Stat label="Strong Buy" value={DEALS.filter(d=>d.rec.startsWith('STRONG')).length} icon={Zap} sub="action" color={T.red}/>
        </div>
        {DEALS.map((d,di)=>(<Card key={di} title={`${d.n} — ${d.stg} · ${d.sec}`} style={{marginBottom:14}} action={<div style={{display:'flex',gap:4,alignItems:'center'}}><Badge color={stC[d.st]}>{d.st}</Badge><span style={{fontSize:18,fontWeight:800,fontFamily:mono,color:d.os>=85?T.accent:d.os>=75?T.blue:T.amber}}>{d.os}</span></div>}>
          <div style={{padding:'12px 16px'}}>
            <div style={{display:'grid',gridTemplateColumns:'2fr 1fr 1fr',gap:16,marginBottom:14}}>
              <div>
                <div style={{display:'flex',gap:12,marginBottom:10}}>{[{l:'RAISING',v:d.amt,c:T.accent},{l:'VALUATION',v:d.val,c:T.blue},{l:'SOURCE',v:d.src,c:T.purple}].map((m,i)=><div key={i} style={{background:T.bgAccent,borderRadius:6,padding:'6px 12px',textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>{m.l}</div><div style={{fontSize:m.l==='SOURCE'?11:14,fontWeight:m.l==='SOURCE'?600:800,fontFamily:m.l==='SOURCE'?sans:mono,color:m.c}}>{m.v}</div></div>)}</div>
                <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:3}}>FOUNDERS</div>{d.fnd.map((f,i)=><div key={i} style={{fontSize:11,color:T.text,marginBottom:2}}>{f}</div>)}
                <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginTop:8,marginBottom:3}}>PRODUCT</div><div style={{fontSize:11,color:T.textMuted}}>{d.prod}</div>
                <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginTop:8,marginBottom:3}}>TRACTION</div><div style={{fontSize:11,color:T.accent}}>{d.trac}</div>
              </div>
              <div><GaugeChart value={d.os} label="Omniscient" thresholds={[{max:60,color:T.red},{max:75,color:T.amber},{max:85,color:T.blue},{max:100,color:T.accent}]} size={120}/><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginTop:8,marginBottom:3}}>MOAT</div><div style={{fontSize:10,color:T.text,lineHeight:1.4}}>{d.moat}</div></div>
              <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:3}}>THESIS</div><div style={{fontSize:10,color:T.accent,lineHeight:1.4,marginBottom:10}}>{d.th}</div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:3}}>RISKS</div>{d.risks.map((r,i)=><div key={i} style={{fontSize:10,color:T.textMuted,padding:'2px 0 2px 8px',borderLeft:`2px solid ${T.red}30`,marginBottom:2}}>{r}</div>)}</div>
            </div>
            <div style={{background:T.bgAccent,borderRadius:8,padding:'10px 14px',marginBottom:10}}><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:6}}>⚡ Platform Context — Auto-Linked</div><div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:6}}>{d.ctx.map(([mod,link,type],ci)=><div key={ci} style={{display:'flex',alignItems:'flex-start',gap:6,padding:'4px 8px',background:T.bgCard,borderRadius:4,borderLeft:`3px solid ${ctxC[type]}`}}><Badge color={ctxC[type]}>{type}</Badge><div><div style={{fontSize:9,fontWeight:700,color:T.textMuted}}>{mod}</div><div style={{fontSize:10,color:T.text}}>{link}</div></div></div>)}</div></div>
            <div style={{padding:'8px 12px',background:d.rec.startsWith('STRONG')?T.accentBg:d.rec.startsWith('INTERESTED')?T.blueBg:T.bgAccent,borderRadius:6,border:`1px solid ${d.rec.startsWith('STRONG')?T.accent+'40':T.border}`}}><div style={{fontSize:12,fontWeight:700,color:d.rec.startsWith('STRONG')?T.accent:d.rec.startsWith('INTERESTED')?T.blue:T.amber,fontFamily:mono}}>→ {d.rec}</div></div>
          </div>
        </Card>))}
      </div>)}
      {diView==='reconcile'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Items" value={RECON.length} icon={Database} sub="to reconcile" color={T.accent}/>
          <Stat label="Auto-Applied" value={RECON.filter(r=>r.st==='auto').length} icon={CheckCircle} sub="no review needed" color={T.green}/>
          <Stat label="Review Required" value={RECON.filter(r=>r.st==='review'||r.st==='pending').length} icon={AlertTriangle} sub="needs attention" color={T.amber}/>
          <Stat label="Modules Affected" value={new Set(RECON.flatMap(r=>r.am)).size} icon={RefreshCw} sub="platform-wide" color={T.blue}/>
        </div>
        <Card title="Reconciliation Pipeline" style={{marginBottom:14}}><div style={{padding:16,display:'flex',gap:8,justifyContent:'center'}}>
          {[['Uploaded',9,T.textMuted],['Extracted',9,T.blue],['Validated',8,T.accent],['Auto-Applied',7,T.green],['Review Queue',3,T.amber]].map(([s,c,col],i)=><React.Fragment key={i}><div style={{textAlign:'center',padding:'12px 16px',background:T.bgAccent,borderRadius:8,minWidth:100,border:`1px solid ${T.border}`}}><div style={{fontSize:20,fontWeight:800,fontFamily:mono,color:col}}>{c}</div><div style={{fontSize:9,color:T.textMuted,textTransform:'uppercase'}}>{s}</div></div>{i<4&&<div style={{display:'flex',alignItems:'center',color:T.textDim}}>→</div>}</React.Fragment>)}
        </div></Card>
        {['critical','high','medium'].map(pr=>{const items=RECON.filter(r=>r.pr===pr);if(!items.length)return null;return(<Card key={pr} title={`${pr.toUpperCase()} — ${items.length} items`} style={{marginBottom:14}}>{items.map((r,i)=><div key={i} style={{padding:'10px 16px',borderBottom:i<items.length-1?`1px solid ${T.border}`:'none',display:'grid',gridTemplateColumns:'1.5fr 1fr 1fr 1fr 0.8fr 1.5fr',gap:8,alignItems:'center'}}><div><div style={{fontSize:12,fontWeight:600,color:T.text}}>{r.f}</div><div style={{fontSize:9,color:T.textMuted}}>{r.s}</div></div><div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>UPLOADED</div><div style={{fontSize:11,fontFamily:mono,fontWeight:700,color:T.accent}}>{r.up}</div></div><div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>EXISTING</div><div style={{fontSize:11,fontFamily:mono,color:T.textMuted}}>{r.ex}</div></div><div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>DELTA</div><div style={{fontSize:11,fontFamily:mono,fontWeight:700,color:r.d.startsWith('+')?T.green:r.d.startsWith('-')?T.red:T.blue}}>{r.d}</div></div><Badge color={stC[r.st]||T.amber}>{r.st}</Badge><div style={{display:'flex',gap:3,flexWrap:'wrap'}}>{r.am.map((m,j)=><Badge key={j} color={T.bgAccent}>{m}</Badge>)}</div></div>)}</Card>);})}
      </div>)}
      {diView==='integrations'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Connected" value="10" icon={Link} sub="modules synced" color={T.accent}/>
          <Stat label="Freshness" value="2hr" icon={Clock} sub="avg update" color={T.green}/>
          <Stat label="Auto-Sync" value="87%" icon={RefreshCw} sub="automated" color={T.blue}/>
          <Stat label="APIs" value="6" icon={Globe} sub="external feeds" color={T.purple}/>
        </div>
        <Card title="Platform Data Flow Architecture" style={{marginBottom:14}}><div style={{padding:16}}>
          <svg width={710} height={400}>{[{y:40,l:'GP Quarterly Reports',c:T.accent},{y:120,l:'Deal Memos & Decks',c:T.green},{y:200,l:'Capital Call Notices',c:T.amber},{y:280,l:'Distribution Notices',c:T.green},{y:360,l:'Market Data Feeds',c:T.purple}].map((s,i)=><g key={i}><rect x={10} y={s.y-15} width={140} height={30} rx={6} fill={`${s.c}15`} stroke={s.c} strokeWidth={1}/><text x={80} y={s.y+4} fill={s.c} fontSize={9} fontWeight={700} textAnchor="middle">{s.l}</text><line x1={150} y1={s.y} x2={230} y2={200} stroke={s.c} strokeWidth={1.5} opacity={.3}/></g>)}
            <rect x={230} y={155} width={140} height={90} rx={10} fill={T.accentBg} stroke={T.accent} strokeWidth={2}/><text x={300} y={185} fill={T.accent} fontSize={12} fontWeight={800} textAnchor="middle">OMNISCIENT</text><text x={300} y={202} fill={T.accent} fontSize={9} textAnchor="middle">AI Processing Engine</text><text x={300} y={218} fill={T.textMuted} fontSize={8} textAnchor="middle">Extract → Score → Route</text><text x={300} y={233} fill={T.textDim} fontSize={8} textAnchor="middle">Bayesian · NLP · OCR</text>
            {[{y:20,l:'Overview',c:T.accent,f:'2m'},{y:60,l:'Portfolio',c:T.blue,f:'1h'},{y:100,l:'Analytics',c:T.purple,f:'1h'},{y:140,l:'Pipeline',c:T.green,f:'30m'},{y:180,l:'Signals',c:T.amber,f:'5m'},{y:220,l:'Decision Science',c:T.red,f:'1h'},{y:260,l:'LP Management',c:T.gold,f:'6h'},{y:300,l:'Network',c:T.cyan,f:'24h'},{y:340,l:'Investor View',c:T.green,f:'1h'},{y:380,l:'Secondaries',c:T.blue,f:'4h'}].map((m,i)=><g key={i}><line x1={370} y1={200} x2={470} y2={m.y+10} stroke={m.c} strokeWidth={1} opacity={.3}/><rect x={470} y={m.y-4} width={230} height={26} rx={5} fill={`${m.c}08`} stroke={`${m.c}30`} strokeWidth={1}/><circle cx={480} cy={m.y+9} r={4} fill={m.c}/><text x={492} y={m.y+13} fill={m.c} fontSize={10} fontWeight={700}>{m.l}</text><text x={692} y={m.y+13} fill={T.textMuted} fontSize={8} fontFamily={mono} textAnchor="end">{m.f}</text></g>)}
          </svg>
        </div></Card>
        <Card title="External Integrations" style={{marginBottom:14}}>
          {[{n:'PitchBook API',t:'Market Data',f:'12m ago',r:'14,200',c:T.accent},{n:'Cambridge Associates',t:'Benchmarks',f:'7d ago',r:'850',c:T.green},{n:'Evercore ISI',t:'Secondary Pricing',f:'4h ago',r:'320',c:T.blue},{n:'Bloomberg Terminal',t:'Public Markets',f:'15m ago',r:'2,400',c:T.amber},{n:'Supabase',t:'Platform DB',f:'Real-time',r:'48,600',c:T.purple},{n:'GP Portal Scrapers',t:'Fund Data',f:'2d ago',r:'580',c:T.textMuted}].map((a,i)=><div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none',display:'grid',gridTemplateColumns:'1.5fr 1fr 1fr 1fr',gap:8,alignItems:'center'}}><div><div style={{fontSize:12,fontWeight:600,color:T.text}}>{a.n}</div><Badge color={a.c}>{a.t}</Badge></div><Badge color={T.green}>Active</Badge><div style={{fontSize:10,fontFamily:mono,color:T.textMuted,textAlign:'right'}}>{a.f}</div><div style={{fontSize:10,fontFamily:mono,color:T.accent,textAlign:'right',fontWeight:700}}>{a.r} records</div></div>)}
        </Card>
        <Card title="Supabase Schema — Core Tables"><div style={{padding:'12px 16px',display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:8}}>
          {[{t:'funds',r:8,d:'GP fund positions, NAV, metrics',c:T.accent},{t:'portfolio_companies',r:12,d:'Look-through valuations',c:T.green},{t:'pipeline_deals',r:47,d:'Scores, stages, owners',c:T.blue},{t:'lp_relationships',r:14,d:'Commitments, engagement',c:T.amber},{t:'signals_feed',r:342,d:'Events, impact, confidence',c:T.purple},{t:'network_nodes',r:974,d:'Graph, centrality, edges',c:T.cyan},{t:'bayesian_priors',r:28,d:'Conviction, signal weights',c:T.red},{t:'secondary_opps',r:8,d:'Pricing, spreads, blocks',c:T.gold},{t:'capital_flows',r:96,d:'Calls, distributions, DPI',c:T.green}].map((t,i)=><div key={i} style={{background:T.bgAccent,borderRadius:6,padding:'8px 12px',borderLeft:`3px solid ${t.c}`}}><div style={{fontSize:12,fontWeight:700,fontFamily:mono,color:t.c}}>{t.t}</div><div style={{fontSize:10,color:T.textMuted}}>{t.d}</div><div style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{t.r} rows</div></div>)}
        </div></Card>
      </div>)}
    </div>
  );
};

// ════════════════════════════════════════════════════
// ALPHA ENGINE — INSTITUTIONAL DECISION INTELLIGENCE
// ════════════════════════════════════════════════════
const AlphaEngine = () => {
  const [aView, setAView] = useState('radar');
  const [selectedOpp, setSelectedOpp] = useState(null);
  const [selectedPos, setSelectedPos] = useState(null);
  const [navExpanded, setNavExpanded] = useState(false);
  const [navLens, setNavLens] = useState('groups'); // 'groups' | 'workflows' | 'all'
  const aViews = [
    {id:'radar',label:'Opportunity Radar',desc:'Live deal flow scored by conviction × return. Strong buys flagged for immediate action.',related:['sizing','icmemo','seclab'],urgency:3},
    {id:'sizing',label:'Position Architect',desc:'Kelly-optimal position sizing with current vs target allocation. Rebalancing actions.',related:['radar','affe','pacing'],urgency:2},
    {id:'emerging',label:'Emerging Managers',desc:'Scout emerging GPs with institutional potential. Track Kauffman Fellows, spin-outs.',related:['gpcard','gphealth','radar'],urgency:1},
    {id:'comps',label:'Comp Intelligence',desc:'Peer benchmarking across fund families. TVPI/IRR/DPI quartile positioning.',related:['alpha','gpcard','vintage'],urgency:1},
    {id:'icmemo',label:'IC Decision Matrix',desc:'Structured investment committee analysis. Multi-lens conviction scoring.',related:['radar','sizing','quant'],urgency:2},
    {id:'liquidity',label:'Liquidity & Exit',desc:'Distribution waterfall modeling. NAV bridge analysis and exit timeline tracking.',related:['sizing','pacing','seclab'],urgency:1},
    {id:'alpha',label:'Alpha Attribution',desc:'Decompose returns by source: manager selection, timing, co-investment, secondary selection.',related:['comps','quant','gpcard'],urgency:1},
    {id:'gpcard',label:'GP Scorecard',desc:'Institutional-grade GP evaluation. 50+ factors across returns, team, process, terms.',related:['emerging','gphealth','reup'],urgency:2},
    {id:'quant',label:'Quant Frameworks',desc:'Ken Wallace quantitative models: Bayesian signals, factor analysis, regime detection.',related:['alpha','icmemo','sizing'],urgency:1},
    {id:'network',label:'Network Score',desc:'Relationship capital intelligence. 4,205 nodes scored by centrality and activation potential.',related:['omniscient','agents','emerging'],urgency:1},
    {id:'pacing',label:'Pacing & J-Curve',desc:'Capital commitment pacing by vintage. J-curve progression vs industry benchmarks.',related:['sizing','vintage','liquidity'],urgency:2},
    {id:'seclab',label:'Secondary Lab',desc:'Ken Wallace 400+ transaction pricing framework. Algorithmic secondary scoring.',related:['radar','liquidity','comps'],urgency:2},
    {id:'reup',label:'Re-Up & Ref Calls',desc:'Systematic re-up evaluation with 48 reference calls per quarter. GP relationship health.',related:['gpcard','gphealth','affe'],urgency:1},
    {id:'affe',label:'Fee Waterfall',desc:'Total cost transparency. AFFE calculation, fee drag analysis, carry scenarios.',related:['sizing','reup','pacing'],urgency:1},
    {id:'vintage',label:'Vintage Optimizer',desc:'Commitment pacing calendar. Vintage year allocation by strategy and sector.',related:['pacing','sizing','comps'],urgency:1},
    {id:'gphealth',label:'GP Health Monitor',desc:'Real-time GP surveillance. AUM stability, team turnover, style drift, compliance flags.',related:['gpcard','reup','emerging'],urgency:2},
    {id:'platform',label:'Platform Pipeline',desc:'Bob Burlinson distribution pipeline. Mercer-Regis framework for platform approvals.',related:['suitability','channel','lifecycle'],urgency:2},
    {id:'suitability',label:'Client Suitability',desc:'RIA compliance engine. Model portfolio mapping and suitability scoring.',related:['platform','endowment','lifecycle'],urgency:1},
    {id:'endowment',label:'Foundation Lens',desc:'17 years on Skoll Foundation IC. Foundation/endowment allocation frameworks.',related:['suitability','platform','channel'],urgency:1},
    {id:'objections',label:'Advisor Battlecard',desc:'40+ objection responses for RIA conversations. Competitive positioning.',related:['platform','channel','lifecycle'],urgency:1},
    {id:'lifecycle',label:'Client Lifecycle',desc:'Full client journey from prospect through commitment to ongoing reporting.',related:['platform','suitability','channel'],urgency:1},
    {id:'channel',label:'Channel Economics',desc:'Revenue modeling by distribution channel. CAC, LTV, and breakeven analysis.',related:['platform','lifecycle','objections'],urgency:1},
    {id:'omniscient',label:'⚡ Omniscient HQ',desc:'AI-Assisted Investing command center. 9 value generators, $267K/yr projected value.',related:['agents','infra','buildmap'],urgency:3},
    {id:'agents',label:'Agent Orchestra',desc:'8-agent system: Sentinel, Persona Panel, Living Thesis, Dashboard + 4 extended agents.',related:['omniscient','infra','buildmap'],urgency:2},
    {id:'infra',label:'Infrastructure',desc:'Mac Studio M4 Max cluster, RedwoodJS, PostgreSQL + Neo4j + Vector DB. Tiered sovereignty.',related:['omniscient','buildmap','agents'],urgency:1},
    {id:'buildmap',label:'Build Roadmap',desc:'3-phase roadmap: Vault ($65K) → Enrichment ($91K) → Agents ($28K). Gate reviews.',related:['omniscient','infra','agents'],urgency:2},
    // ── PUBLIC MARKETS & CORPORATE GOVERNANCE ──
    {id:'navmark',label:'NAV Methodology',desc:'Fair Value Committee quarterly marks. ASC 820 hierarchy, independent valuation agents, audit trail.',related:['premdisc','lookthrough','compliance'],urgency:3},
    {id:'premdisc',label:'Premium/Discount',desc:'Real-time stock price vs NAV spread. Historical premium bands, peer CEF comparison, discount capture.',related:['navmark','capmarkets','shareholder'],urgency:3},
    {id:'shareholder',label:'Shareholder Intel',desc:'13F institutional ownership, retail vs institutional mix, short interest, cost-basis clustering.',related:['premdisc','ircommand','activist'],urgency:2},
    {id:'ircommand',label:'IR Command Center',desc:'Analyst coverage tracker, earnings call prep, investor day builder, Q&A bank, perception audit.',related:['shareholder','premdisc','compliance'],urgency:2},
    {id:'compliance',label:'SEC Compliance',desc:'1940 Act requirements, N-PORT/N-CEN filings, proxy statements, insider trading windows, 13F deadlines.',related:['navmark','ircommand','activist'],urgency:3},
    {id:'capmarkets',label:'Capital Markets',desc:'ATM program analytics, share buyback optimization, shelf registration, rights offering modeling.',related:['premdisc','shareholder','compliance'],urgency:2},
    {id:'ipowatch',label:'IPO & Exit Watch',desc:'Portfolio company liquidity events. S-1 tracking, lockup expirations, tender offers, M&A signals.',related:['radar','navmark','lookthrough'],urgency:3},
    {id:'concentration',label:'Concentration Risk',desc:'Single-name exposure limits, HHI index, factor correlation matrix, tail risk decomposition.',related:['quant','lookthrough','navmark'],urgency:2},
    {id:'activist',label:'Governance Shield',desc:'Activist defense readiness, poison pill status, board composition, proxy fight simulation, bylaw review.',related:['shareholder','compliance','ircommand'],urgency:1},
    {id:'lookthrough',label:'Look-Through',desc:'Underlying exposure decomposition by sector, geography, stage, theme. True portfolio transparency.',related:['navmark','concentration','ipowatch'],urgency:2},
    // ── INSTITUTIONAL TEAM VIEWS ──
    {id:'boarddeck',label:'Board Reporting',desc:'Auto-generated board deck with quarterly performance, attribution, compliance status, strategic agenda.',related:['navmark','ircommand','compliance'],urgency:3},
    {id:'attribution',label:'Attribution Engine',desc:'Return attribution by fund, sector, theme, vintage, manager. Factor decomposition and alpha isolation.',related:['quant','alpha','lookthrough'],urgency:2},
    {id:'taxlot',label:'Tax & K-1 Engine',desc:'Tax lot tracking, K-1 aggregation, UBTI monitoring, state nexus analysis, estimated tax calendar.',related:['affe','pacing','compliance'],urgency:2},
    {id:'execution',label:'Execution Desk',desc:'Secondary trade execution, broker scorecard, best-execution analysis, counterparty risk, settlement tracker.',related:['seclab','radar','capmarkets'],urgency:3},
    {id:'targeting',label:'Investor Targeting',desc:'Institutional investor CRM. Roadshow builder, peer ownership comparison, perception study, targeting matrix.',related:['ircommand','shareholder','channel'],urgency:2},
    {id:'deepdive',label:'Research Engine',desc:'Company deep-dive framework. Thesis builder, competitive moat scoring, management assessment, market sizing.',related:['emerging','gpcard','comps'],urgency:2},
    {id:'reconcile',label:'Fund Admin & Recon',desc:'NAV reconciliation, cash management, capital call/distribution processing, vendor scorecard, SLA tracker.',related:['navmark','pacing','taxlot'],urgency:2},
    {id:'legal',label:'Legal & Contracts',desc:'Entity structure map, side letter tracker, subscription agreement status, NDA vault, regulatory correspondence.',related:['compliance','activist','reconcile'],urgency:1},
    // ── EXECUTIVE & INTELLIGENCE LAYER ──
    {id:'pulse',label:'Morning Pulse',desc:'CEO daily brief. Overnight market moves, portfolio signals, calendar, action items, stock activity — one screen.',related:['radar','premdisc','shareholder'],urgency:3},
    {id:'warroom',label:'Situation Room',desc:'Active deal war room. Live deal tracking, countdown timers, IC prep, document staging, counterparty comms.',related:['radar','icmemo','execution'],urgency:3},
    {id:'peerintel',label:'Peer Vehicles',desc:'Competitive intelligence on DXYZ, SVVC, BST, HRZN. Premium/discount, holdings overlap, fee comparison.',related:['premdisc','lookthrough','ircommand'],urgency:2},
    {id:'sentiment',label:'Retail Sentiment',desc:'Reddit, StockTwits, Twitter/X monitoring. Retail ownership estimates, meme stock risk, social volume trends.',related:['shareholder','premdisc','ircommand'],urgency:2},
    {id:'feecalc',label:'Fee Architecture',desc:'Total cost modeling. Management fee scenarios, incentive fee waterfall, AFFE decomposition, peer fee benchmarking.',related:['affe','capmarkets','ircommand'],urgency:1},
    {id:'lettergen',label:'Shareholder Comms',desc:'Quarterly letter builder. Auto-generated narratives from portfolio data, factsheet generator, investor deck templates.',related:['ircommand','boarddeck','attribution'],urgency:2},
    {id:'portopt',label:'Portfolio Optimizer',desc:'Factor-based portfolio construction. Mean-variance optimization, Kelly allocation, vintage pacing, commitment simulator.',related:['sizing','concentration','quant'],urgency:1},
    {id:'regrisk',label:'Regulatory Radar',desc:'Track AI Act, SEC rulemaking, state legislation, CFIUS, export controls. Impact assessment on portfolio companies.',related:['compliance','lookthrough','ipowatch'],urgency:2},
    // ── WAVE 4: INSTITUTIONAL DEPTH ──
    {id:'fundii',label:'Fund II War Plan',desc:'Fundraising CRM, LP targeting matrix, term sheet modeling, roadshow calendar, commitment pipeline, competitive landscape.',related:['channel','targeting','platform'],urgency:3},
    {id:'lportal',label:'LP Portal Preview',desc:'What LPs see: performance dashboard, capital account, document vault, distribution history, K-1 access, NAV letters.',related:['boarddeck','lettergen','taxlot'],urgency:2},
    {id:'montecarlo',label:'Scenario Engine',desc:'Monte Carlo simulation: 10,000 paths for portfolio outcomes. Stress testing, regime-conditional VaR, tail risk quantification.',related:['quant','portopt','concentration'],urgency:2},
    {id:'earningsprep',label:'Earnings War Room',desc:'Full earnings call preparation. Script builder, slide deck, Q&A rehearsal, analyst expectations, post-call action items.',related:['ircommand','lettergen','boarddeck'],urgency:3},
    {id:'liquidbook',label:'Liquidity Book',desc:'Market microstructure: bid/ask depth, market maker activity, block trade history, dark pool prints, VWAP analysis.',related:['premdisc','capmarkets','execution'],urgency:2},
    {id:'impact',label:'Impact & ESG',desc:'Portfolio SDG alignment, AI safety impact scoring, responsible investing framework, ESG reporting for institutional LPs.',related:['lookthrough','lettergen','endowment'],urgency:1},
    {id:'teamops',label:'Team Intelligence',desc:'Organizational capacity, hiring pipeline, key person dependencies, succession planning, culture metrics, comp benchmarking.',related:['boarddeck','legal','pulse'],urgency:1},
    {id:'macro',label:'Macro Regime',desc:'Macro environment detection: rate regime, risk appetite, liquidity cycle, sector rotation. Portfolio sensitivity mapping.',related:['quant','portopt','regrisk'],urgency:2},
  ];

  // ══ OPPORTUNITY RADAR — Algorithmic detection across secondaries, co-invests, fund commitments ══
  const hotOpps = [
    {id:1,type:'Secondary',name:'Tiger Global PIP 15',cat:'Distressed LP',score:96,urgency:'48hr',signal:'STRONG BUY',
      current:{ask:62,bid:57,nav:8100,disc:38,spread:5,tvpi:0.92,vintage:2021},
      thesis:'Most mispriced secondary in market. Portfolio marked at 0.92x but look-through analysis shows 1.18x fair value. Discount driven by forced seller (Tiger Global fund restructuring), not fundamental deterioration. Top holdings: Stripe ($6.5B FV), Figma ($3.2B), Checkout.com ($2.1B). Stripe IPO alone could drive 40%+ markup.',
      catalyst:['Stripe confidential IPO filing expected Q2 2026','Tiger Global restructuring forces liquidation at any price','Secondary discounts compressing market-wide (28%→12% in 6mo)','3 portfolio cos with IPO/M&A catalysts in 12mo'],
      risk:['Tiger brand risk — LP relations damaged','Long tail of zombie companies in portfolio','Stripe IPO could be delayed to 2027','$8.1B position is large for NEWCO'],
      sizing:{optimal:8.2,min:4.0,max:12.0,kelly:9.4,current:0,action:'NEW POSITION'},
      fairValue:85,upside:'+49% to FV from bid',irr_base:28,irr_bull:52,irr_bear:8,
      comps:[{name:'Insight XII',disc:16,tvpi:1.12},{name:'Coatue II',disc:34,tvpi:0.98},{name:'Tiger PIP 14',disc:42,tvpi:0.88}],
      conviction:{bayesian:94,market:88,timing:97,fit:72,composite:91},
      timeline:'Seller accepting bids through Feb 12. Must wire by Feb 14.',
      ic_vote:{for:['Ken','Jason','Bob'],against:[],abstain:['Brett'],quorum:true},
      modules:['Secondary','Decision','Signals','Portfolio']},
    {id:2,type:'Co-Invest',name:'Anthropic Series E',cat:'Follow-On Right',score:98,urgency:'2 weeks',signal:'STRONG BUY',
      current:{round:3500,valuation:75000,ownership_new:0.003,existing_pos:0.08,fund:'Founders Fund VII'},
      thesis:'Exercise co-invest right from Founders Fund VII. Anthropic at $75B is still early for what could be a $500B+ company. Constitutional AI moat is widest in industry. Revenue $2.8B growing 340%. Enterprise adoption accelerating. EU AI Act creates regulatory moat that benefits Anthropic approach.',
      catalyst:['Revenue trajectory $2.8B→$8B+ by 2027','Enterprise API adoption inflection point','Google strategic partnership deepening','IPO path 2027-2028 at $200B+'],
      risk:['Concentration risk — already largest position','Open-source models narrowing quality gap','$75B valuation assumes flawless execution','Regulatory risk if AI safety mandates change'],
      sizing:{optimal:4.2,min:2.0,max:6.0,kelly:5.8,current:18.2,action:'INCREASE +$4.2M'},
      fairValue:null,upside:'3-5x to IPO at $200-375B',irr_base:42,irr_bull:68,irr_bear:12,
      comps:[{name:'OpenAI',val:'$157B',rev:'$3.4B',mult:'46x'},{name:'Google (AI segment)',val:'$2.2T',rev:'$12B',mult:'183x'},{name:'Palantir',val:'$180B',rev:'$3.2B',mult:'56x'}],
      conviction:{bayesian:98,market:96,timing:92,fit:99,composite:97},
      timeline:'Co-invest allocation closes March 15, 2026.',
      ic_vote:{for:['Jason','Ken','Bob','Brett'],against:[],abstain:[],quorum:true},
      modules:['Portfolio','Decision','Signals','LP']},
    {id:3,type:'Secondary',name:'Founders Fund VI',cat:'Premium Secondary',score:94,urgency:'72hr',signal:'BUY',
      current:{ask:115,bid:108,nav:1900,disc:-8,spread:7,tvpi:2.15,vintage:2020},
      thesis:'Premium justified by concentrated SpaceX exposure ($1.2B of $1.9B NAV). SpaceX IPO/tender in H2 2026 could drive 30-50% NAV uplift. Palantir position ($280M) provides liquid floor. 3.2yr remaining life = near-term distributions likely.',
      catalyst:['SpaceX IPO/tender event H2 2026','Palantir selling program generating distributions','Anduril IPO S-1 filing imminent','Fund in harvest mode — GP distributing'],
      risk:['Premium entry price (108% of NAV)','SpaceX IPO delay','Concentrated single-asset risk','Limited upside from non-SpaceX positions'],
      sizing:{optimal:3.5,min:2.0,max:5.0,kelly:4.1,current:0,action:'NEW POSITION'},
      fairValue:125,upside:'+16% to FV from bid',irr_base:22,irr_bull:38,irr_bear:5,
      comps:[{name:'SpaceX direct secondary',disc:-15,price:'$380B implied'},{name:'Palantir (public)',price:'$180B'},{name:'Anduril direct secondary',disc:-5,price:'$28B'}],
      conviction:{bayesian:92,market:90,timing:88,fit:95,composite:92},
      timeline:'Founders Fund distributing blocks. Limited allocation.',
      ic_vote:{for:['Jason','Ken'],against:[],abstain:['Bob','Brett'],quorum:true},
      modules:['Secondary','Portfolio','Signals']},
    {id:4,type:'Fund Commitment',name:'Benchmark XI',cat:'New Fund',score:89,urgency:'Q2 2026',signal:'BUY',
      current:{target:1500,existing_relationship:'Benchmark X ($20M committed)',strategy:'Early-stage consumer + enterprise',vintage:2026},
      thesis:'Top-decile GP consistently. Benchmark X returning 1.62x TVPI at month 18. Small equal-partnership model ensures alignment. Access to consumer + enterprise AI deals complementary to core thesis. Peter Fenton (AI focus) + Bill Gurley (market structure) = unique combo.',
      catalyst:['Benchmark X performance exceeding expectations','AI consumer wave creating new Benchmark sweet-spot deals','Small fund size ($1.5B) maintains concentrated approach','Historical DPI consistently above 2.0x'],
      risk:['Bill Gurley reducing involvement','Consumer AI valuations frothy','Less direct AI Safety thesis alignment','$20M minimum commitment is large relative to AUM'],
      sizing:{optimal:20,min:15,max:25,kelly:22,current:20,action:'RE-UP AT SAME SIZE'},
      fairValue:null,upside:'Expected 2.0-3.0x TVPI, 25-35% net IRR',irr_base:28,irr_bull:42,irr_bear:15,
      comps:[{name:'Benchmark IX',tvpi:2.8,irr:38,vintage:2018},{name:'Benchmark X',tvpi:1.62,irr:31,vintage:2023},{name:'USV XII',tvpi:1.4,irr:22,vintage:2024}],
      conviction:{bayesian:88,market:85,timing:80,fit:82,composite:85},
      timeline:'First close targeting June 2026. Allocation due by April.',
      ic_vote:{for:['Ken','Brett'],against:[],abstain:['Jason','Bob'],quorum:true},
      modules:['Pipeline','Decision','Portfolio']},
    {id:5,type:'Co-Invest',name:'Saronic Technologies',cat:'Defense Autonomy',score:91,urgency:'1 week',signal:'STRONG BUY',
      current:{round:175,valuation:1100,ownership_new:0.18,lead:'Founders Fund',stage:'Series B'},
      thesis:'Only startup with active USN autonomous vessel contract. Maritime domain is most underexplored in defense autonomy (vs aerial Anduril/Shield AI). $42M ARR growing 280%. $200M backlog. Navy expanding autonomous fleet mandate post-Taiwan tensions.',
      catalyst:['PLAN Taiwan Strait exercises driving urgency','USN autonomous fleet mandate expanding','$886B defense budget bipartisan support','Adjacent to Anduril/Shield AI success in aerial — maritime is next'],
      risk:['Hardware business = lower margins','80% single customer concentration (USN)','Navy procurement can be slow/unpredictable','Founders Fund lead concentration'],
      sizing:{optimal:2.0,min:1.0,max:3.0,kelly:2.4,current:0,action:'NEW CO-INVEST'},
      fairValue:null,upside:'5-10x to IPO scenario ($5-10B)',irr_base:35,irr_bull:62,irr_bear:-15,
      comps:[{name:'Anduril',val:'$28B',rev:'$1.2B',mult:'23x'},{name:'Shield AI',val:'$5.5B',rev:'$400M',mult:'14x'},{name:'Joby Aviation',val:'$8B',rev:'$0',mult:'∞'}],
      conviction:{bayesian:91,market:92,timing:95,fit:88,composite:91},
      timeline:'Term sheet open. Founders Fund allocating co-invest slots.',
      ic_vote:{for:['Brett','Ken','Jason'],against:[],abstain:['Bob'],quorum:true},
      modules:['Pipeline','Decision','Signals','Network']},
    {id:6,type:'Secondary',name:'Sequoia Global Growth III',cat:'Core Secondary',score:94,urgency:'1 week',signal:'STRONG BUY',
      current:{ask:82,bid:78,nav:2800,disc:22,spread:4,tvpi:1.35,vintage:2021},
      thesis:'Tier-1 GP at 22% discount. Portfolio includes Stripe, Databricks, Wiz — all with near-term IPO catalysts. Sequoia brand and follow-on capacity ensures continued support. Post-correction vintage marks are conservative.',
      catalyst:['Stripe IPO Q2-Q3 2026','Databricks IPO Q3 2026','Wiz IPO or Google acquisition ($23B offer rejected)','Sequoia restructuring complete — focus on best assets'],
      risk:['Sequoia brand damage from FTX','Portfolio marks could be aggressive','Large fund size dilutes alpha','Some zombie positions in tail'],
      sizing:{optimal:5.5,min:3.0,max:8.0,kelly:6.2,current:0,action:'NEW POSITION'},
      fairValue:92,upside:'+18% to FV from bid',irr_base:25,irr_bull:42,irr_bear:8,
      comps:[{name:'Insight XII',disc:16,tvpi:1.12},{name:'a16z Growth IV',disc:12,tvpi:1.28},{name:'Lightspeed IV',disc:29,tvpi:1.08}],
      conviction:{bayesian:90,market:92,timing:94,fit:85,composite:91},
      timeline:'Block available through intermediary. Feb 15 deadline.',
      ic_vote:{for:['Ken','Bob'],against:[],abstain:['Jason','Brett'],quorum:true},
      modules:['Secondary','Portfolio','Decision']},
  ];

  // ══ POSITION ARCHITECT — Current portfolio with right-size / downsize / upsize recommendations ══
  const positions = [
    {fund:'Founders Fund VII',gp:'Founders Fund',committed:25,called:12.5,nav:18.2,tvpi:1.46,irr:28.3,pctPort:9.4,optimal:12,delta:'+$2.6M',action:'UPSIZE',reason:'Top performer. Anthropic co-invest right. IPO catalysts. Increase via co-invest vehicle.',kelly:11.8,conviction:98,riskContrib:12.1,correlGroup:'AI Safety Primary',liquidityScore:35,exitWindow:'2027-2028',signals:['+36.7% Anthropic markup','+25% SpaceX','Co-invest right opening'],urgency:'high'},
    {fund:'Lux Capital VI',gp:'Lux Capital',committed:15,called:11.2,nav:16.8,tvpi:1.50,irr:22.1,pctPort:8.6,optimal:8.5,delta:'RIGHT-SIZED',action:'HOLD',reason:'Well-positioned. Anduril IPO catalyst. No further capital calls expected. Let position compound.',kelly:8.8,conviction:96,riskContrib:8.8,correlGroup:'Defense AI',liquidityScore:42,exitWindow:'2026-2027',signals:['Anduril IPO prep','+27.3% markup','Fully deployed'],urgency:'low'},
    {fund:'a16z Infra Fund',gp:'a16z',committed:50,called:18,nav:22.5,tvpi:1.25,irr:18.7,pctPort:11.5,optimal:8.0,delta:'-$6.9M',action:'DOWNSIZE',reason:'OVERSIZED vs Kelly optimal. a16z Infra is 21% of IC allocations vs 12% optimal. Databricks IPO may provide natural exit. Reduce on next secondary window.',kelly:8.2,conviction:85,riskContrib:18.4,correlGroup:'AI Infrastructure',liquidityScore:28,exitWindow:'2026-2027',signals:['Kelly alert: 21% vs 12%','Databricks S-1 filed','Scale AI deceleration'],urgency:'medium'},
    {fund:'Benchmark X',gp:'Benchmark',committed:20,called:15,nav:24.3,tvpi:1.62,irr:31.2,pctPort:12.5,optimal:12.0,delta:'RIGHT-SIZED',action:'HOLD',reason:'Top performer with 1.62x at month 18. Benchmark XI re-up opportunity in Q2. Consumer + enterprise balance is ideal.',kelly:12.4,conviction:92,riskContrib:9.2,correlGroup:'Trust & Safety',liquidityScore:48,exitWindow:'2028-2029',signals:['TVPI 1.62x','Re-up XI opening','Shield AI $5.5B'],urgency:'low'},
    {fund:'Greylock XVII',gp:'Greylock',committed:30,called:10,nav:11.8,tvpi:1.18,irr:15.4,pctPort:6.1,optimal:3.0,delta:'-$6.0M',action:'DOWNSIZE',reason:'UNDERPERFORMER. Below median for vintage. WorkOS markdown. GovTech thesis stalled. Sell on secondary market at 85-90 cents.',kelly:3.2,conviction:69,riskContrib:7.5,correlGroup:'GovTech Enterprise',liquidityScore:65,exitWindow:'2029-2030',signals:['Below median','WorkOS -16.7%','GP extending timeline'],urgency:'high'},
    {fund:'NEA 19',gp:'NEA',committed:40,called:38,nav:62.1,tvpi:1.85,irr:24.6,pctPort:31.9,optimal:20.0,delta:'-$23.2M',action:'DOWNSIZE (GRADUAL)',reason:'CONCENTRATION RISK. 31.9% of portfolio in single fund. NEA 19 is top performer but position size creates systemic risk. Sell $10-15M on secondary at premium (est. 5-10% above NAV). Keep $45M+ exposure.',kelly:18.5,conviction:92,riskContrib:34.2,correlGroup:'Multi-Sector',liquidityScore:55,exitWindow:'2026-2028',signals:['First distribution $2.8M','DPI 0.8x','Robust Intel M&A interest'],urgency:'medium'},
    {fund:'Sequoia US VIII',gp:'Sequoia',committed:35,called:22,nav:30.8,tvpi:1.40,irr:20.5,pctPort:15.8,optimal:12.0,delta:'-$7.4M',action:'TRIM',reason:'Slightly oversized. Performance solid but not top-quartile. Sequoia restructuring creates uncertainty. Trim on secondary ($5-8M block) to fund Tiger Global opportunity.',kelly:11.2,conviction:82,riskContrib:14.6,correlGroup:'AI Infrastructure',liquidityScore:52,exitWindow:'2027-2028',signals:['Restructuring noise','Solid but not exceptional','Fund secondary opportunity'],urgency:'low'},
    {fund:'Khosla IX',gp:'Khosla Ventures',committed:20,called:6,nav:7.2,tvpi:1.20,irr:25.0,pctPort:3.7,optimal:5.0,delta:'+$1.4M',action:'UPSIZE',reason:'Early vintage with high optionality. Climate/AI intersection thesis unique. Small position can grow via capital calls. Vinod Khosla deal flow is differentiated.',kelly:5.5,conviction:78,riskContrib:3.1,correlGroup:'Climate AI',liquidityScore:22,exitWindow:'2029-2030',signals:['Early vintage','Climate AI thesis','Differentiated flow'],urgency:'low'},
  ];

  // ══ EMERGING MANAGER SCANNER — Spinout detection, new GP intelligence ══
  const emergingMgrs = [
    {name:'Thorn Ventures',type:'Spinout',from:'Founders Fund',lead:'Delian Asparouhov',focus:'Defense Tech + AI',target:500,status:'Raising',vintage:2026,score:94,
      thesis:'Delian was Founders Fund youngest partner. Deep defense thesis conviction. Led Shield AI, Anduril, Saronic investments. Spinning out with Thiel blessing + LP rollover. Will be dominant seed/A defense fund.',
      edge:'Defense network unmatched at seed. SOCOM/DARPA relationships. Founders Fund LP base following.',
      track:[{deal:'Shield AI',entry:'$320M',now:'$5.5B',mult:'17.2x'},{deal:'Saronic',entry:'$120M',now:'$1.1B',mult:'9.2x'},{deal:'Hadrian',entry:'$90M',now:'$850M',mult:'9.4x'}],
      signals:['Peter Thiel backing as anchor LP','3 unicorn track record at FF','Defense budget $886B tailwind','NEWCO thesis-aligned'],
      risk:['First-time solo GP','Single sector concentration','Defense procurement cycles','Fund size ambitious for debut'],
      sizing:10,rec:'COMMIT $10M — Anchor LP position. Defense thesis aligned. Delian track record exceptional.',conviction:94},
    {name:'Radical AI Ventures',type:'New Fund',from:'Ex-Anthropic Research',lead:'Dr. Sarah Chen',focus:'AI Safety Infrastructure',target:200,status:'First Close',vintage:2026,score:91,
      thesis:'Former Anthropic VP Research spinning out safety-focused seed fund. Unique technical depth in constitutional AI, RLHF, interpretability. Will fund the picks-and-shovels layer of AI Safety. Berkeley PhD network for deal flow.',
      edge:'Only GP with hands-on experience building safety systems at scale. Technical diligence capability unmatched. Anthropic/Google DeepMind referral network.',
      track:[{deal:'Advisory: Haize Labs',entry:'Seed',now:'$85M',mult:'Angel → $85M'},{deal:'Advisory: Patronus AI',entry:'Seed',now:'$120M',mult:'Seed → $120M'},{deal:'Research: Constitutional AI',entry:'Paper',now:'$61.5B (Anthropic)',mult:'Core IP'}],
      signals:['AI Safety TAM $28B growing 42%','EU AI Act creates compliance demand','Berkeley BAIR network','Only safety-native fund'],
      risk:['Researcher → operator transition','Small fund may lack reserves','Narrow thesis may limit deals','Fundraising in competitive market'],
      sizing:8,rec:'COMMIT $8M — Strategic LP. AI Safety thesis perfectly aligned. Technical diligence partner.',conviction:91},
    {name:'Meridian Defense',type:'Spinout',from:'Lux Capital + In-Q-Tel',lead:'Mike Steed & Col. James Park (ret.)',focus:'Classified AI / IC',target:350,status:'Pre-Marketing',vintage:2026,score:87,
      thesis:'IC-focused fund targeting AI applications in classified environments. Mike Steed (Lux VP, led Anduril) + Col. Park (In-Q-Tel board, NSA liaison). Only fund with TS/SCI operating infrastructure for portfolio support.',
      edge:'Classified environment access. In-Q-Tel deal flow referral. SCIF-equipped offices for portfolio company support. Clearance-ready investment team.',
      track:[{deal:'Vannevar Labs',entry:'Series A',now:'$280M',mult:'Lux co-invest'},{deal:'Two Six Technologies',entry:'Series B',now:'Acquired $4.2B',mult:'8.4x'},{deal:'Rebellion Defense',entry:'Seed',now:'$280M',mult:'14x'}],
      signals:['$886B defense budget','JWICS authorization unique','IC modernization mandate','Ukraine/Taiwan accelerant'],
      risk:['Classified operations = expensive overhead','Small addressable LP base (clearance required)','Long sales cycles in IC','Government shutdown risk'],
      sizing:6,rec:'COMMIT $6M — Unique access to classified AI. Complements defense portfolio.',conviction:87},
    {name:'Crescendo Partners',type:'New Fund',from:'Ex-Tiger Global + Coatue',lead:'Priya Mehta & James Liu',focus:'AI Growth Equity',target:800,status:'Marketing',vintage:2026,score:82,
      thesis:'Growth equity fund focused on AI companies at $20-100M ARR. Priya (Tiger Global partner, led Databricks investment) + James (Coatue, led Scale AI). Bridge between venture and crossover. Target 15-20 companies at $30-50M checks.',
      edge:'Public market pattern recognition from Tiger/Coatue. Growth stage companies underserved as traditional crossover funds retreat.',
      track:[{deal:'Databricks (Tiger)',entry:'$4B',now:'$62B',mult:'15.5x'},{deal:'Scale AI (Coatue)',entry:'$3.5B',now:'$13.8B',mult:'3.9x'},{deal:'Brex (Tiger)',entry:'$2.6B',now:'$12B',mult:'4.6x'}],
      signals:['Growth equity gap post-Tiger/Coatue retreat','AI companies hitting growth stage inflection','IPO market reopening creates exit path','$800M target is right-sized for strategy'],
      risk:['Growth equity historically challenged as category','Former employer brand association (Tiger damage)','Competitive market for growth rounds','Valuation discipline untested as independent GPs'],
      sizing:15,rec:'COMMIT $15M — Strategic for growth exposure. Fill portfolio gap between seed/A and IPO.',conviction:82},
    {name:'Latticework Capital',type:'Spinout',from:'Sequoia Capital',lead:'Shaun Maguire',focus:'Frontier Tech + Defense',target:400,status:'Raising',vintage:2026,score:88,
      thesis:'Shaun Maguire spinning out from Sequoia after restructuring. PhD Caltech physics + Thiel Fellowship background. Led Sequoia investments in Varda Space, Anduril follow-on, SpaceX secondary. Unique frontier tech + defense combo.',
      edge:'Caltech/physics network. Sequoia alumni network. Frontier tech technical diligence. Public profile drives proprietary deal flow.',
      track:[{deal:'Varda Space (Sequoia)',entry:'$100M',now:'$1.5B',mult:'15x'},{deal:'Anduril follow-on',entry:'$10B',now:'$28B',mult:'2.8x'},{deal:'SpaceX secondary',entry:'$100B',now:'$380B',mult:'3.8x'}],
      signals:['Sequoia restructuring creates spinout talent','Frontier tech converging with defense','Strong public following drives deal flow','Thiel network overlap with NEWCO'],
      risk:['First fund post-Sequoia','Broad thesis may lack focus','$400M ambitious for debut','Key-person risk'],
      sizing:8,rec:'COMMIT $8M — Frontier tech + defense. Sequoia pedigree. Complementary to Thorn.',conviction:88},
  ];

  // ══ COMP INTELLIGENCE — Comparable transaction database ══
  const compSets = [
    {category:'AI Safety — Growth Stage',deals:[
      {co:'Anthropic',round:'Series E',date:'Feb 2026',raised:3500,val:75000,rev:2800,mult:26.8,lead:'Google/Lightspeed',growth:340},
      {co:'OpenAI',round:'Tender',date:'Jan 2026',raised:6600,val:157000,rev:3400,mult:46.2,lead:'SoftBank',growth:280},
      {co:'xAI',round:'Series C',date:'Dec 2025',raised:6000,val:40000,rev:400,mult:100,lead:'Andreessen',growth:800},
      {co:'Cohere',round:'Series D',date:'Oct 2025',raised:500,val:5500,rev:220,mult:25.0,lead:'PSP Investments',growth:180},
      {co:'Mistral AI',round:'Series B',date:'Sep 2025',raised:600,val:6000,rev:80,mult:75.0,lead:'General Catalyst',growth:500},
    ],median:{rev:400,mult:46.2,growth:340},insight:'AI Safety multiples remain elevated. Median 46x ARR reflects market belief in winner-take-most dynamics. Anthropic at 26.8x is cheapest pure-play — market underpricing relative to OpenAI.'},
    {category:'Defense AI — Growth Stage',deals:[
      {co:'Anduril',round:'Series F',date:'Jan 2026',raised:1500,val:28000,rev:1200,mult:23.3,lead:'Founders Fund',growth:180},
      {co:'Shield AI',round:'Series G',date:'Feb 2026',raised:500,val:5500,rev:400,mult:13.8,lead:'Sequoia',growth:220},
      {co:'Saronic',round:'Series B',date:'Feb 2026',raised:175,val:1100,rev:42,mult:26.2,lead:'Founders Fund',growth:280},
      {co:'Skydio',round:'Series E',date:'Nov 2025',raised:230,val:2800,rev:180,mult:15.6,lead:'a16z',growth:120},
      {co:'Rebellion Defense',round:'Series C',date:'Oct 2025',raised:150,val:1800,rev:95,mult:18.9,lead:'Lux Capital',growth:160},
    ],median:{rev:180,mult:18.9,growth:180},insight:'Defense AI multiples more rational than pure AI Safety. Median 18.9x reflects procurement cycle risk. Saronic at 26.2x commands premium for autonomous hardware moat + USN contract exclusivity.'},
    {category:'Secondary Market — Fund Interests',deals:[
      {co:'Tiger PIP 15',round:'Secondary',date:'Feb 2026',raised:null,val:8100,rev:null,mult:null,lead:'—',growth:null,disc:38,tvpi:0.92},
      {co:'Sequoia GGF III',round:'Secondary',date:'Feb 2026',raised:null,val:2800,rev:null,mult:null,lead:'—',growth:null,disc:22,tvpi:1.35},
      {co:'Insight XII',round:'Secondary',date:'Jan 2026',raised:null,val:5200,rev:null,mult:null,lead:'—',growth:null,disc:16,tvpi:1.12},
      {co:'Founders Fund VI',round:'Secondary',date:'Feb 2026',raised:null,val:1900,rev:null,mult:null,lead:'—',growth:null,disc:-8,tvpi:2.15},
      {co:'Coatue Growth II',round:'Secondary',date:'Jan 2026',raised:null,val:3200,rev:null,mult:null,lead:'—',growth:null,disc:34,tvpi:0.98},
      {co:'Lightspeed IV',round:'Secondary',date:'Dec 2025',raised:null,val:1400,rev:null,mult:null,lead:'—',growth:null,disc:29,tvpi:1.08},
    ],median:{disc:25.5,tvpi:1.10},insight:'Secondary discounts compressing from 28% avg in Q3 2025 to 19% now. IPO window opening drives compression. Best opportunities: distressed sellers (Tiger, Coatue) where discount exceeds fundamental impairment. Founders Fund VI at premium is justified by SpaceX concentration.'},
    {category:'Fund-of-Funds — Listed Vehicles',deals:[
      {co:'NEWCO Public Fund',round:'Listed CEF',date:'Current',raised:null,val:194,rev:null,mult:null,lead:'—',growth:null,nav:24.38,premDisc:0,aum:235},
      {co:'HarbourVest Global (HVPD)',round:'Listed CEF',date:'Current',raised:null,val:null,rev:null,mult:null,lead:'—',growth:null,nav:2980,premDisc:-38,aum:4200},
      {co:'Pantheon International (PIN)',round:'Listed CEF',date:'Current',raised:null,val:null,rev:null,mult:null,lead:'—',growth:null,nav:458,premDisc:-42,aum:2800},
      {co:'ICG Enterprise (ICGT)',round:'Listed CEF',date:'Current',raised:null,val:null,rev:null,mult:null,lead:'—',growth:null,nav:1780,premDisc:-32,aum:1600},
      {co:'BMO Private Equity',round:'Listed CEF',date:'Current',raised:null,val:null,rev:null,mult:null,lead:'—',growth:null,nav:520,premDisc:-28,aum:980},
    ],median:{premDisc:-35,aum:1600},insight:'Listed PE FoFs trade at median -35% discount to NAV. NEWCO at par is unprecedented — reflects AI Safety thesis premium, retail accessibility, and active management perception. Maintaining NAV parity requires consistent performance delivery.'},
  ];

  // ══ IC DECISION MATRIX — Framework for institutional-grade decisions ══
  const icDecisions = [
    {id:1,item:'Tiger Global PIP 15 Secondary',type:'Secondary Purchase',amount:'$8.2M',deadline:'Feb 12',status:'IC VOTE OPEN',
      scores:{returnPotential:95,riskAdjusted:88,thesisAlignment:72,liquidityProfile:65,gpQuality:70,timingSignal:97,portfolioFit:78,downside:82},
      proArgs:['49% discount to fair value creates massive margin of safety','3 IPO catalysts in 12 months (Stripe, Figma, Checkout)','Forced seller dynamic — price driven by Tiger restructuring, not fundamentals','Secondary market compression will reduce discount window rapidly','$8.1B NAV provides diversified exposure across 40+ companies'],
      conArgs:['Tiger Global brand damage — LP relations fractured','Large position relative to NEWCO AUM','Long tail of zombie companies dilutes quality','Requires significant capital deployment in single transaction','Correlation with existing a16z Infra position (Databricks, Scale AI overlap)'],
      mitigants:['Discount magnitude (38%) exceeds worst-case portfolio impairment (est. 15-20%)','Phase-in: commit $4M now, option for $4M more at same terms','Tiger GP team still strong — Alex Robertson track record intact','Secondary market provides exit if thesis changes within 12 months'],
      portImpact:{navChange:'+$3.2M (if discount compresses to 20%)' ,tvpiChange:'+0.02x', irrChange:'+1.8%',concentrationNew:'Tiger joins as #4 position (4.2% of NAV)',correlImpact:'Adds AI Infra correlation (+0.15 to portfolio beta)'},
      comparable:'Purchased Coatue Growth I at 42% discount in 2023 → now trading at 12% discount = 54% return in 2 years.',
      recommendation:'APPROVE — Phase-in $4M + $4M option. Set 12-month review trigger at 20% discount compression.'},
    {id:2,item:'Anthropic Series E Co-Invest',type:'Co-Invest',amount:'$4.2M',deadline:'Mar 15',status:'IC VOTE OPEN',
      scores:{returnPotential:98,riskAdjusted:85,thesisAlignment:99,liquidityProfile:40,gpQuality:98,timingSignal:92,portfolioFit:95,downside:72},
      proArgs:['Core thesis investment — AI Safety leader at inflection point','Revenue $2.8B growing 340% — rare at this scale','Constitutional AI is strongest moat in AI safety','Co-invest right from Founders Fund — favorable economics (no carry)','EU AI Act creates regulatory moat that benefits Anthropic approach'],
      conArgs:['Increases Anthropic concentration to $22.4M (11.5% of NAV)','$75B valuation assumes $15-20B revenue by 2028','Open-source models narrowing quality gap (Llama, Mistral)','Single company risk in volatile AI market','Liquidity locked until IPO (2027-2028 earliest)'],
      mitigants:['Revenue trajectory supports valuation (26.8x vs OpenAI at 46.2x)','Constitutional AI is defensible IP — not commoditizable','Founders Fund carry-free structure reduces effective cost basis','Anthropic diversifying revenue: API + enterprise + Claude consumer'],
      portImpact:{navChange:'+$0 (at cost initially)',tvpiChange:'0x (marks at cost)',irrChange:'Accretive at exit (42% base case IRR)',concentrationNew:'Anthropic becomes 11.5% of NAV (from 9.4%)',correlImpact:'Increases AI Safety cluster to 48% of portfolio'},
      comparable:'Anthropic Series D co-invest returned +36.7% in 8 months. Series C co-invest returned +95% in 14 months.',
      recommendation:'APPROVE — Full allocation $4.2M. Set concentration review trigger at 15% of NAV.'},
    {id:3,item:'Greylock XVII Secondary Sale',type:'Secondary Sale',amount:'$6.0M (target)',deadline:'Q2 2026',status:'PREPARING',
      scores:{returnPotential:25,riskAdjusted:45,thesisAlignment:55,liquidityProfile:65,gpQuality:72,timingSignal:60,portfolioFit:50,downside:38},
      proArgs:['Below median for vintage — TVPI 1.18x at month 14','WorkOS markdown (-16.7%) signals execution issues','GovTech thesis needs 18+ months to materialize — opportunity cost','GP extending deployment timeline = red flag','Capital better deployed in Tiger PIP 15 or Anthropic co-invest'],
      conArgs:['New partner hire (ex-Palantir CTO) could improve deal flow','GovTech thesis may materialize with defense budget tailwinds','Selling at 1.18x locks in modest loss vs potential recovery','Greylock brand and LP network have value','Secondary market for below-median funds = deeper discounts (est. 20-25% haircut)'],
      mitigants:['Even with 25% haircut, net proceeds ($7.5M) can be redeployed at higher ROIC','Greylock LP network relationships preserved — can re-enter via future fund','GovTech exposure maintained through Lux VI (Anduril) and NEA 19 (Palantir)'],
      portImpact:{navChange:'-$2.0M (selling at ~85 cents)',tvpiChange:'-0.01x',irrChange:'-0.3%',concentrationNew:'Frees 6.1% of NAV for redeployment',correlImpact:'Reduces GovTech Enterprise correlation by 0.08'},
      comparable:'Sold General Catalyst position at 92 cents in Q3 2025 — redeployed into Benchmark X which has returned +62% since.',
      recommendation:'APPROVE — Market sell order at 85-90 cents. Reallocate proceeds to Tiger PIP 15 secondary.'},
  ];

  // ══ LIQUIDITY & EXIT INTELLIGENCE ══
  const exitIntel = [
    {co:'Databricks',fund:'a16z Infra',val:62,path:'IPO',timing:'Q3 2026',prob:82,navImpact:'+$8-12M',status:'S-1 Filed',metrics:'$2.4B rev, 65% growth, $62B last round',buyer:null,signals:['S-1 confidential filed','Goldman + Morgan Stanley mandated','IPO window open']},
    {co:'Anduril',fund:'Lux VI',val:28,path:'IPO',timing:'H2 2026',prob:78,navImpact:'+$12-18M',status:'S-1 Drafting',metrics:'$1.2B rev, 180% growth, $28B last round',buyer:null,signals:['S-1 draft in review','CJADC2 contract won','Defense IPO window strong']},
    {co:'Stripe',fund:'Tiger PIP 15 (target)',val:65,path:'IPO',timing:'Q2-Q3 2026',prob:75,navImpact:'+$3-5M (if Tiger acquired)',status:'Confidential',metrics:'$25B+ rev (est.), 20% growth, $65B last round',buyer:null,signals:['CFO hire from Goldman','Treasury management product scaling','IPO market favorable']},
    {co:'SpaceX',fund:'Founders Fund VI (target)',val:380,path:'Tender/IPO',timing:'H2 2026',prob:65,navImpact:'+$4-8M (if FF VI acquired)',status:'Speculative',metrics:'$12B rev (est.), Starlink profitable, $380B implied',buyer:null,signals:['Starlink approaching standalone IPO','Tender offers increasing frequency','Founders Fund distributing']},
    {co:'Robust Intelligence',fund:'NEA 19',val:0.86,path:'M&A',timing:'Q2-Q3 2026',prob:60,navImpact:'+$1.5-3M',status:'Exploring',metrics:'$45M ARR, 120% growth, red-teaming leader',buyer:'Databricks (likely), CrowdStrike, Palo Alto Networks',signals:['Databricks exploring acquisition per GP report','Red-teaming demand surge','Strategic fit with Unity AI']},
    {co:'Anthropic',fund:'Founders Fund VII',val:75,path:'IPO',timing:'2027-2028',prob:55,navImpact:'+$25-50M',status:'Early Planning',metrics:'$2.8B rev, 340% growth, $75B Series E',buyer:null,signals:['Revenue inflection','Enterprise adoption','Constitutional AI moat']},
    {co:'Wiz',fund:'Sequoia GGF III (target)',val:12,path:'IPO or M&A',timing:'Q3 2026',prob:70,navImpact:'+$1-2M (if Sequoia acquired)',status:'Active',metrics:'$500M ARR, 100% growth, rejected $23B Google bid',buyer:'Google ($23B offer), standalone IPO at $15-20B',signals:['Rejected Google bid','Rapid growth continues','Cyber M&A environment hot']},
  ];

  // ══ ALPHA ATTRIBUTION — Where is NEWCO's alpha coming from? ══
  const alphaDrivers = [
    {source:'GP Selection',contrib:42,desc:'Top-quartile GP access via Berkeley network + existing LP relationships',metric:'7 of 8 funds above median TVPI',trend:[30,32,35,38,40,42],c:T.accent},
    {source:'Timing & Signals',contrib:22,desc:'Bayesian signal processing + regime detection for entry/exit timing',metric:'Avg entry 18% below subsequent marks',trend:[12,14,16,18,20,22],c:T.blue},
    {source:'Co-Investment',contrib:18,desc:'Carry-free co-invests via GP relationships (Anthropic, Saronic, etc.)',metric:'Co-invests returning 2.8x vs fund 1.42x',trend:[8,10,12,14,16,18],c:T.green},
    {source:'Secondary Selection',contrib:12,desc:'Algorithmic secondary scoring identifies mispriced LP interests',metric:'Avg purchase at 28% disc vs 19% market',trend:[5,6,8,9,10,12],c:T.amber},
    {source:'Portfolio Construction',contrib:6,desc:'Kelly-optimal sizing + correlation management + concentration limits',metric:'Sharpe ratio 1.8x vs 1.2x peer median',trend:[2,3,4,4,5,6],c:T.purple},
  ];

  const actionC = {'STRONG BUY':T.accent,'BUY':T.green,'HOLD':T.blue,'TRIM':T.amber,'DOWNSIZE':T.red,'UPSIZE':T.green,'RIGHT-SIZED':T.blue,'DOWNSIZE (GRADUAL)':T.amber,'RE-UP AT SAME SIZE':T.blue,'NEW POSITION':T.accent,'NEW CO-INVEST':T.green,'INCREASE +$4.2M':T.accent};

  // ═══ UX: Grouped Navigation Categories ═══
  const tabGroups = [
    {id:'invest',label:'Investment Engine',color:T.accent,icon:'📊',desc:'Ken Wallace',tabs:['radar','sizing','emerging','comps','icmemo','liquidity','alpha','gpcard','quant','network','deepdive','attribution','warroom','portopt','montecarlo','macro']},
    {id:'ops',label:'Institutional Ops',color:T.blue,icon:'⚙️',desc:'Operations',tabs:['pacing','seclab','reup','affe','vintage','gphealth','concentration','reconcile','taxlot','legal','feecalc','regrisk','teamops']},
    {id:'public',label:'Public Markets',color:T.gold||T.amber,icon:'📈',desc:'NYSE Listed',tabs:['navmark','premdisc','shareholder','ircommand','compliance','capmarkets','ipowatch','activist','lookthrough','boarddeck','targeting','execution','peerintel','sentiment','lettergen','earningsprep','liquidbook','impact']},
    {id:'dist',label:'Distribution',color:T.green,icon:'🏦',desc:'Bob Burlinson',tabs:['platform','suitability','endowment','objections','lifecycle','channel','fundii','lportal']},
    {id:'ai',label:'Omniscient AI',color:T.purple,icon:'⚡',desc:'Intelligence',tabs:['omniscient','agents','infra','buildmap','pulse']},
  ];
  const activeGroup = tabGroups.find(g=>g.tabs.includes(aView));
  const activeLabel = aViews.find(v=>v.id===aView)?.label||'';

  // ═══ SUB-SECTION GROUPINGS — Reduce cognitive load from 60 flat tabs ═══
  const sectionSubs = {
    invest: [
      {id:'dealflow',label:'Deal Flow',tabs:['radar','warroom','icmemo'],icon:'🎯'},
      {id:'construction',label:'Portfolio',tabs:['sizing','portopt','montecarlo'],icon:'🏗️'},
      {id:'gplifecycle',label:'GP Intel',tabs:['gpcard','gphealth','emerging','reup'],icon:'🔍'},
      {id:'quantitative',label:'Analytics',tabs:['alpha','attribution','comps','quant','deepdive'],icon:'📈'},
      {id:'forward',label:'Outlook',tabs:['liquidity','macro','network'],icon:'🔮'},
    ],
    ops: [
      {id:'cashpacing',label:'Cash & Pacing',tabs:['pacing','vintage','affe','feecalc'],icon:'💰'},
      {id:'riskops',label:'Risk',tabs:['concentration','regrisk','gphealth','seclab'],icon:'⚡'},
      {id:'admin',label:'Operations',tabs:['reconcile','taxlot','legal','teamops'],icon:'⚙️'},
      {id:'reups',label:'Re-Ups',tabs:['reup'],icon:'🔄'},
    ],
    public: [
      {id:'trading',label:'Trading',tabs:['premdisc','liquidbook','sentiment','peerintel'],icon:'📊'},
      {id:'valuation',label:'NAV & Valuation',tabs:['navmark','lookthrough','concentration'],icon:'💎'},
      {id:'ownership',label:'Ownership & IR',tabs:['shareholder','targeting','ircommand'],icon:'👥'},
      {id:'regulatory',label:'Compliance',tabs:['compliance','activist'],icon:'🛡️'},
      {id:'capital',label:'Capital Markets',tabs:['capmarkets','ipowatch','execution'],icon:'🏦'},
      {id:'comms',label:'Communications',tabs:['boarddeck','lettergen','earningsprep','impact'],icon:'📝'},
    ],
    dist: [
      {id:'pipeline',label:'Pipeline',tabs:['platform','suitability','channel','objections'],icon:'📋'},
      {id:'clients',label:'Clients',tabs:['endowment','lifecycle','lportal'],icon:'🤝'},
      {id:'fundraise',label:'Fund II',tabs:['fundii'],icon:'🚀'},
    ],
    ai: [
      {id:'system',label:'System',tabs:['omniscient','agents','infra','buildmap','pulse'],icon:'⚡'},
    ],
  };

  // ═══ INTERACTIVE STATE — Deep functionality within views ═══
  const [viewMode, setViewMode] = useState({}); // per-view mode toggles
  const [expanded, setExpanded] = useState({}); // expandable panel states
  const [filters, setFilters] = useState({}); // per-section filter state
  const [searchQ, setSearchQ] = useState(''); // inline search within sections
  const [drillDown, setDrillDown] = useState(null); // {type, id, data} for overlay detail panels
  const [scenarioSliders, setScenarioSliders] = useState({ // live scenario modeling
    anthropicVal: 75, spaceXVal: 350, ipoTiming: 12, aiMultiple: 18, rateChange: 0, premiumTarget: 148,
    atmDaily: 25000, buybackAuth: 15, feeBase: 1.75, feeIncentive: 15, feeHurdle: 8,
    mcVolatility: 28, mcCorrelation: 35, mcExitUncertainty: 12, mcSimCount: 10000,
  });
  const [calcInputs, setCalcInputs] = useState({ // inline calculators
    premiumNav: 9.84, premiumPrice: 24.38,
    atmShares: 25000, atmPremium: 148,
    kellyEdge: 0.28, kellyOdds: 0.65,
    feeBase: 1.75, feeIncentive: 0, feeHurdle: 8, feeGross: 22.4,
    mcSims: 10000, mcVolatility: 28,
    // secondary pricing
    secBid: 82, secNav: 100, secIrr: 38, secHoldYears: 2.5, atmTradingDays: 60,
    // dilution calculator
    dilShares: 23800000, dilNewShares: 500000, dilPrice: 24.38, dilNav: 9.84,
  });
  const setMode = (view, mode) => setViewMode(p=>({...p,[view]:mode}));
  const getMode = (view, def) => viewMode[view]||def;
  const toggleExpand = (key) => setExpanded(p=>({...p,[key]:!p[key]}));
  const isExpanded = (key) => !!expanded[key];
  const setCalc = (key, val) => setCalcInputs(p=>({...p,[key]:parseFloat(val)||0}));
  const setSlider = (key, val) => setScenarioSliders(p=>({...p,[key]:parseFloat(val)||0}));
  const setFilter = (section, key, val) => setFilters(p=>({...p,[section]:{...(p[section]||{}),[key]:val}}));
  const getFilter = (section, key, def) => (filters[section]||{})[key]||def;

  // Computed values from scenario sliders
  const sc = scenarioSliders;
  const calcPremDisc = ((calcInputs.premiumPrice / calcInputs.premiumNav - 1) * 100);
  const calcAtmAccretion = (calcInputs.atmShares * calcInputs.premiumPrice * (calcInputs.atmPremium / (100 + calcInputs.atmPremium))) / (23800000 * calcInputs.premiumNav) * 100;
  const calcKellyPct = Math.max(0, ((calcInputs.kellyOdds * (1 + calcInputs.kellyEdge) - (1 - calcInputs.kellyOdds)) / calcInputs.kellyEdge) * 100);
  const calcFeeNet = calcInputs.feeGross - calcInputs.feeBase - Math.max(0, (calcInputs.feeGross - calcInputs.feeHurdle) * calcInputs.feeIncentive / 100);
  const calcDilution = (calcInputs.dilNewShares / (calcInputs.dilShares + calcInputs.dilNewShares)) * 100;
  const calcDilNavAccretion = (calcInputs.dilNewShares * (calcInputs.dilPrice - calcInputs.dilNav)) / ((calcInputs.dilShares + calcInputs.dilNewShares) * calcInputs.dilNav) * 100;
  const calcSecondaryReturn = ((100 / calcInputs.secBid) ** (1 / calcInputs.secHoldYears) - 1) * 100;

  // Interactive input component
  const CalcInput = ({label, k, unit, min, max, step=1, w=70}) => (
    <div style={{display:'flex',alignItems:'center',gap:4}}>
      <span style={{fontSize:9,color:T.textDim,minWidth:60}}>{label}</span>
      <input type="number" value={calcInputs[k]} onChange={e=>setCalc(k,e.target.value)} min={min} max={max} step={step}
        style={{width:w,padding:'4px 6px',fontSize:11,fontFamily:mono,fontWeight:700,color:T.accent,background:T.bgAccent,border:`1px solid ${T.border}`,borderRadius:4,outline:'none',textAlign:'right'}}/>
      {unit&&<span style={{fontSize:8,color:T.textDim}}>{unit}</span>}
    </div>
  );
  const SliderInput = ({label, k, min, max, step=1, unit='', fmt}) => (
    <div style={{marginBottom:8}}>
      <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
        <span style={{fontSize:9,color:T.textDim}}>{label}</span>
        <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:T.accent}}>{fmt?fmt(sc[k]):`${sc[k]}${unit}`}</span>
      </div>
      <input type="range" min={min} max={max} step={step} value={sc[k]} onChange={e=>setSlider(k,e.target.value)}
        style={{width:'100%',height:6,appearance:'none',background:`linear-gradient(90deg, ${T.accent} ${((sc[k]-min)/(max-min))*100}%, ${T.bgAccent} ${((sc[k]-min)/(max-min))*100}%)`,borderRadius:3,outline:'none',cursor:'pointer'}}/>
    </div>
  );
  // Section filter pill
  const FilterPill = ({label, active, onClick}) => (
    <button onClick={onClick} style={{padding:'3px 10px',fontSize:9,fontWeight:active?700:400,background:active?T.accent+'15':'transparent',color:active?T.accent:T.textDim,border:`1px solid ${active?T.accent+'40':T.border}`,borderRadius:12,cursor:'pointer',fontFamily:sans,transition:'all .1s'}}>{label}</button>
  );
  // Expandable section header
  const SectionHead = ({id, title, count, children}) => (
    <div style={{marginBottom:isExpanded(id)?14:6}}>
      <button onClick={()=>toggleExpand(id)} style={{display:'flex',alignItems:'center',gap:8,width:'100%',padding:'10px 14px',background:isExpanded(id)?T.bgAccent:'transparent',border:`1px solid ${isExpanded(id)?T.border:'transparent'}`,borderRadius:8,cursor:'pointer',fontFamily:sans,transition:'all .12s'}}
        onMouseEnter={e=>{if(!isExpanded(id))e.currentTarget.style.background=T.bgAccent+'80';}} onMouseLeave={e=>{if(!isExpanded(id))e.currentTarget.style.background='transparent';}}>
        <ChevronRight size={12} color={T.accent} style={{transform:isExpanded(id)?'rotate(90deg)':'none',transition:'transform .15s'}}/>
        <span style={{fontSize:13,fontWeight:700,color:T.text}}>{title}</span>
        {count!=null&&<span style={{fontSize:9,fontFamily:mono,color:T.textDim,marginLeft:'auto'}}>{count}</span>}
      </button>
      {isExpanded(id)&&<div style={{padding:'10px 0 0 0'}}>{children}</div>}
    </div>
  );

  // Cross-cutting workflow lenses — group tabs by USE CASE instead of department
  const workflows = [
    {id:'decisions',label:'Decisions & IC',icon:'⚖️',color:T.red,desc:'Everything needed to make an investment decision',
      tabs:['radar','icmemo','sizing','quant','seclab','concentration','deepdive','warroom','montecarlo'],
      summary:'Open decisions, conviction scoring, position sizing, and secondary pricing'},
    {id:'gp-intel',label:'GP Intelligence',icon:'🔍',color:T.accent,desc:'Full GP lifecycle: discovery → scoring → monitoring → re-up',
      tabs:['emerging','gpcard','gphealth','reup','alpha','deepdive','attribution'],
      summary:'Scout, evaluate, monitor, and attribute returns to GP selection'},
    {id:'cashflows',label:'Cashflows & Pacing',icon:'💰',color:T.green,desc:'Capital commitments, J-curves, fees, vintage allocation',
      tabs:['pacing','affe','vintage','liquidity','sizing','taxlot','reconcile','feecalc','fundii'],
      summary:'Where money goes, when it comes back, and what it costs'},
    {id:'risk-scenario',label:'Risk & Scenarios',icon:'⚡',color:T.amber,desc:'Portfolio risk, concentration, scenarios, and stress tests',
      tabs:['quant','gphealth','liquidity','comps','alpha','concentration','lookthrough','portopt','regrisk','montecarlo','macro'],
      summary:'Quantitative risk frameworks, exit catalysts, and peer benchmarks'},
    {id:'public-mkts',label:'Public Vehicle',icon:'📈',color:T.gold||T.amber,desc:'NYSE listing, NAV methodology, IR, compliance, capital markets',
      tabs:['navmark','premdisc','shareholder','ircommand','compliance','capmarkets','ipowatch','activist','boarddeck','targeting','execution','peerintel','sentiment','lettergen','earningsprep','liquidbook'],
      summary:'Everything required to run a best-in-class public closed-end fund'},
    {id:'distribution',label:'Distribution & LPs',icon:'🏦',color:T.blue,desc:'Platform pipeline, suitability, client lifecycle, channel economics',
      tabs:['platform','suitability','objections','lifecycle','channel','endowment','targeting','fundii','lportal'],
      summary:'Distribution engine, LP management, and Fund II fundraising'},
    {id:'governance',label:'Governance & Legal',icon:'🛡️',color:T.cyan||T.blue,desc:'Board oversight, regulatory compliance, legal operations, tax strategy',
      tabs:['boarddeck','compliance','activist','legal','taxlot','reconcile','regrisk','teamops','impact'],
      summary:'Board reporting, SEC compliance, contracts, and fiduciary obligations'},
    {id:'ai-system',label:'AI & Intelligence',icon:'🤖',color:T.purple,desc:'Omniscient system, agent orchestra, infrastructure, build roadmap',
      tabs:['omniscient','agents','infra','buildmap','network','pulse'],
      summary:'The technology platform that powers everything'},
  ];

  // ═══ UX: Command Palette (Cmd+K) ═══
  const [cmdOpen, setCmdOpen] = useState(false);
  const [cmdQ, setCmdQ] = useState('');
  const [cmdIdx, setCmdIdx] = useState(0);
  const cmdRef = useRef(null);
  const contentRef = useRef(null);
  const tabScrollRef = useRef(null);

  // Scroll to top when tab changes
  useEffect(() => {
    const el = contentRef.current;
    if (el) { const parent = el.closest('[style*="overflow"]') || el.parentElement; if(parent) parent.scrollTop = 0; }
    window.scrollTo({ top: 0, behavior: 'instant' });
    // Auto-scroll active tab into view
    if (tabScrollRef.current) {
      const activeBtn = tabScrollRef.current.querySelector('[data-active="true"]');
      if (activeBtn) activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }
  }, [aView]);

  // Keyboard: Cmd+K for palette, ←/→ for prev/next tab
  useEffect(()=>{
    const handler = (e)=>{
      if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();setCmdOpen(p=>!p);setCmdQ('');setCmdIdx(0);}
      if(e.key==='Escape'){
        if(cmdOpen) setCmdOpen(false);
        else if(drillDown) setDrillDown(null);
        else if(sacOpen) setSacOpen(false);
      }
      if(!cmdOpen && !drillDown && document.activeElement?.tagName !== 'INPUT' && document.activeElement?.tagName !== 'TEXTAREA') {
        const groupTabs = activeGroup ? activeGroup.tabs : aViews.map(v=>v.id);
        const curIdx = groupTabs.indexOf(aView);
        if(e.key==='ArrowRight' && curIdx < groupTabs.length - 1) { e.preventDefault(); setAView(groupTabs[curIdx+1]); }
        if(e.key==='ArrowLeft' && curIdx > 0) { e.preventDefault(); setAView(groupTabs[curIdx-1]); }
        // Number keys 1-4 switch modes within current view
        if(['1','2','3','4'].includes(e.key)) {
          const modeMap = {
            radar:['pipeline','compare','calculator'],
            sizing:['allocation','rebalancer','constraints'],
            montecarlo:['distribution','scenarios','sensitivity','stress'],
            navmark:['marks','sensitivity','bridge','governance'],
            premdisc:['dashboard','calculator','scenarios'],
            capmarkets:['overview','simulator','buyback'],
          };
          const modes = modeMap[aView];
          if(modes && modes[parseInt(e.key)-1]) {
            e.preventDefault();
            setMode(Object.keys(modeMap).find(k=>modeMap[k]===modes), modes[parseInt(e.key)-1]);
            addToast(`Mode: ${modes[parseInt(e.key)-1]}`);
          }
        }
        // P key = go to Pulse
        if(e.key==='p' && !e.metaKey && !e.ctrlKey) { setAView('pulse'); }
      }
    };
    window.addEventListener('keydown',handler);
    return ()=>window.removeEventListener('keydown',handler);
  },[cmdOpen, aView, activeGroup, drillDown, sacOpen]);
  useEffect(()=>{if(cmdOpen&&cmdRef.current)cmdRef.current.focus();},[cmdOpen]);
  const cmdFiltered = cmdQ ? aViews.filter(v=>v.label.toLowerCase().includes(cmdQ.toLowerCase())||v.id.includes(cmdQ.toLowerCase())) : aViews;

  // Prev/Next helpers
  const allTabIds = aViews.map(v=>v.id);
  const curGlobalIdx = allTabIds.indexOf(aView);
  const prevTab = curGlobalIdx > 0 ? aViews[curGlobalIdx-1] : null;
  const nextTab = curGlobalIdx < aViews.length-1 ? aViews[curGlobalIdx+1] : null;

  // Active group selection (for segmented control)
  const [selectedGroupId, setSelectedGroupId] = useState(activeGroup?.id||'invest');
  useEffect(()=>{if(activeGroup)setSelectedGroupId(activeGroup.id);},[aView]);
  const selectedGroup = tabGroups.find(g=>g.id===selectedGroupId);

  // Contextual KPIs per group
  const groupKPIs = {
    invest: [{l:'Live Opps',v:'6',c:T.accent},{l:'Strong Buy',v:'3',c:T.green},{l:'Pipeline',v:'$22.5B',c:T.blue},{l:'Avg IRR',v:'28.3%',c:T.accent}],
    ops: [{l:'Funds Tracked',v:'8',c:T.blue},{l:'Wtd TVPI',v:'1.42x',c:T.green},{l:'Fee Drag',v:'1.8%',c:T.amber},{l:'Vintage Spread',v:'22-24',c:T.purple}],
    public: [{l:'Premium/Disc',v:'+142%',c:T.accent},{l:'NAV/Share',v:'$9.84',c:T.blue},{l:'Mkt Cap',v:'$582M',c:T.green},{l:'Short Interest',v:'18.4%',c:T.red}],
    dist: [{l:'Platforms',v:'5',c:T.green},{l:'Yr1 Pipeline',v:'$48M',c:T.accent},{l:'Advisor Reach',v:'5K+',c:T.blue},{l:'Conv Rate',v:'12%',c:T.purple}],
    ai: [{l:'Monthly Value',v:'$22.3K',c:T.accent},{l:'Hours Saved',v:'680+/yr',c:T.green},{l:'Agents Active',v:'4/8',c:T.purple},{l:'Build Phase',v:'1 of 3',c:T.blue}],
  };

  // ═══ UX: Favorites / Pinned Tabs ═══
  const [favTabs, setFavTabs] = useState(['radar','omniscient','gpcard','platform']);
  const toggleFav = (id) => setFavTabs(prev => prev.includes(id) ? prev.filter(f=>f!==id) : [...prev, id].slice(0,8));
  const activeViewObj = aViews.find(v=>v.id===aView);
  const isFav = favTabs.includes(aView);

  // ═══ UX: Recently Visited Trail ═══
  const [recentViews, setRecentViews] = useState([]);
  useEffect(()=>{
    setRecentViews(prev=>{
      const updated = [aView, ...prev.filter(v=>v!==aView)].slice(0,6);
      return updated;
    });
  },[aView]);

  // ═══ UX: Toast Notifications ═══
  const [toasts, setToasts] = useState([]);
  const addToast = (msg, type='info') => {
    const id = Date.now();
    setToasts(prev=>[...prev, {id, msg, type}]);
    setTimeout(()=>setToasts(prev=>prev.filter(t=>t.id!==id)), 3000);
  };

  // ═══ UX: Hover Card State ═══
  const [hoverCard, setHoverCard] = useState(null); // {entity, x, y, data}
  const hoverTimeout = useRef(null);
  const showHoverCard = (entity, data, e) => {
    clearTimeout(hoverTimeout.current);
    const rect = e.currentTarget.getBoundingClientRect();
    hoverTimeout.current = setTimeout(()=>setHoverCard({entity, data, x: rect.left, y: rect.bottom + 4}), 350);
  };
  const hideHoverCard = () => { clearTimeout(hoverTimeout.current); setHoverCard(null); };

  // ═══ UX: Strategic Action Center — Urgent items across all views ═══
  const [sacOpen, setSacOpen] = useState(true);
  const strategicActions = [
    {id:'ff6bid',label:'FF VI Secondary Bid',desc:'Deadline TODAY 5PM — $6.8M',urgency:3,view:'warroom',color:T.red,icon:'🔴'},
    {id:'icvote',label:'Thrive Capital IX IC Vote',desc:'IC vote tomorrow — Ken presenting $8M',urgency:3,view:'icmemo',color:T.red,icon:'🗳️'},
    {id:'anthro',label:'Anthropic Co-Invest Docs',desc:'$4.2M subscription — wire by Mar 12',urgency:2,view:'warroom',color:T.amber,icon:'📝'},
    {id:'ucregents',label:'UC Regents IC Presentation',desc:'Feb 28 — pitch deck needs review',urgency:2,view:'fundii',color:T.amber,icon:'🎓'},
    {id:'fvc',label:'Q1 FVC Meeting Prep',desc:'Mar 15 — internal marks due T-7',urgency:1,view:'navmark',color:T.blue,icon:'📊'},
    {id:'earnings',label:'Q4 Earnings Call',desc:'Mar 15 — script 45% complete',urgency:1,view:'earningsprep',color:T.blue,icon:'📞'},
  ];
  const [dismissedActions, setDismissedActions] = useState([]);
  const activeActions = strategicActions.filter(a=>!dismissedActions.includes(a.id));

  // ═══ UX: Per-View Quick Actions (contextual) ═══
  const viewQuickActions = {
    radar: [{label:'Generate IC Memo',icon:'📄',action:()=>{setAView('icmemo');addToast('Navigated to IC Memo Generator');}},{label:'Run Monte Carlo',icon:'🎲',action:()=>{setAView('montecarlo');addToast('Opened Monte Carlo Simulator');}},{label:'Check Sizing',icon:'📐',action:()=>{setAView('sizing');addToast('Opened Position Sizing');}}],
    sizing: [{label:'Rebalance Mode',icon:'⚖️',action:()=>{setMode('sizing','rebalancer');addToast('Switched to Rebalancer');}},{label:'Check Constraints',icon:'🛡️',action:()=>{setMode('sizing','constraints');addToast('Viewing Constraints');}},{label:'View Radar',icon:'📡',action:()=>setAView('radar')}],
    montecarlo: [{label:'Stress Test',icon:'💥',action:()=>{setMode('mc','stress');addToast('Stress Test Mode');}},{label:'Sensitivity',icon:'🎚️',action:()=>{setMode('mc','sensitivity');addToast('Sensitivity Mode');}},{label:'Distribution',icon:'📊',action:()=>{setMode('mc','distribution');addToast('Distribution Mode');}}],
    navmark: [{label:'Sensitivity Sliders',icon:'🎚️',action:()=>{setMode('navmark','sensitivity');addToast('NAV Sensitivity Mode');}},{label:'NAV Bridge',icon:'🌊',action:()=>{setMode('navmark','bridge');addToast('NAV Bridge View');}},{label:'Run Monte Carlo',icon:'🎲',action:()=>setAView('montecarlo')}],
    premdisc: [{label:'Calculator',icon:'🧮',action:()=>{setMode('premdisc','calculator');addToast('Premium Calculator');}},{label:'Scenario Model',icon:'🎚️',action:()=>{setMode('premdisc','scenarios');addToast('Scenario Modeling');}},{label:'ATM Strategy',icon:'💹',action:()=>setAView('capmarkets')}],
    capmarkets: [{label:'ATM Simulator',icon:'🎚️',action:()=>{setMode('capmarkets','simulator');addToast('ATM Simulator Active');}},{label:'Buyback Analysis',icon:'🔄',action:()=>{setMode('capmarkets','buyback');addToast('Buyback Analysis');}},{label:'Premium/Discount',icon:'📊',action:()=>setAView('premdisc')}],
    warroom: [{label:'View Pipeline',icon:'📡',action:()=>setAView('radar')},{label:'Generate Memo',icon:'📄',action:()=>setAView('icmemo')},{label:'Check Sizing',icon:'📐',action:()=>setAView('sizing')}],
    fundii: [{label:'LP Portal Preview',icon:'🔗',action:()=>{setAView('lportal');addToast('LP Portal Preview');}},{label:'Board Deck',icon:'📊',action:()=>{setAView('boarddeck');addToast('Board Deck');}},{label:'Earnings Prep',icon:'📞',action:()=>setAView('earningsprep')}],
    ipowatch: [{label:'NAV Impact',icon:'📊',action:()=>setAView('navmark')},{label:'Monte Carlo',icon:'🎲',action:()=>setAView('montecarlo')},{label:'Premium Model',icon:'💹',action:()=>setAView('premdisc')}],
    earningsprep: [{label:'Q&A Bank',icon:'❓',action:()=>addToast('85 Q&As ready across 6 categories','success')},{label:'Script Review',icon:'📝',action:()=>addToast('Script: Opening (Draft), Financial (Not Started), Investment (Draft)')},{label:'Analyst Notes',icon:'📋',action:()=>addToast('3 analysts covering — Ladenburg, B.Riley, Maxim')}],
    omniscient: [{label:'Intelligence Feeds',icon:'🛰️',action:()=>addToast('6 feeds active — all data flowing','success')},{label:'Output Engines',icon:'⚡',action:()=>addToast('4 engines producing — NAV +2.9% vs GP')},{label:'Agent Orchestra',icon:'🤖',action:()=>{setAView('agents');addToast('Opening Agent Orchestra');}}],
    agents: [{label:'Omniscient Hub',icon:'🧠',action:()=>setAView('omniscient')},{label:'Build Roadmap',icon:'🗺️',action:()=>setAView('buildmap')},{label:'Infrastructure',icon:'⚙️',action:()=>setAView('infra')}],
    concentration: [{label:'Rebalance',icon:'⚖️',action:()=>{setAView('sizing');setMode('sizing','rebalancer');addToast('Rebalancer Mode');}},{label:'Port Optimizer',icon:'📐',action:()=>setAView('portopt')},{label:'Risk Model',icon:'🎲',action:()=>setAView('regrisk')}],
    shareholder: [{label:'IR Command',icon:'📡',action:()=>setAView('ircommand')},{label:'Activist Defense',icon:'🛡️',action:()=>setAView('activist')},{label:'Targeting',icon:'🎯',action:()=>setAView('targeting')}],
    compliance: [{label:'Tax Lots',icon:'📊',action:()=>setAView('taxlot')},{label:'Legal',icon:'⚖️',action:()=>setAView('legal')},{label:'AFFE Calculator',icon:'🧮',action:()=>setAView('affe')}],
    boarddeck: [{label:'Earnings Prep',icon:'📞',action:()=>setAView('earningsprep')},{label:'Fund II Update',icon:'🚀',action:()=>setAView('fundii')},{label:'GP Card',icon:'📋',action:()=>setAView('gpcard')}],
    lportal: [{label:'Fund II Pipeline',icon:'🚀',action:()=>setAView('fundii')},{label:'Board Deck',icon:'📊',action:()=>setAView('boarddeck')},{label:'Lifecycle CRM',icon:'🤝',action:()=>setAView('lifecycle')}],
    platform: [{label:'Suitability Check',icon:'✅',action:()=>setAView('suitability')},{label:'Channel Strategy',icon:'📡',action:()=>setAView('channel')},{label:'Objection Bank',icon:'💬',action:()=>setAView('objections')}],
  };
  const currentQuickActions = viewQuickActions[aView] || [];

  // ═══ UX: Entity Database — for hover cards + cross-view linking ═══
  const entityDB = {
    'Anthropic': {type:'Company',val:'$75.0B',nav:'$48.2M',pct:'24.9%',delta:'+18.2%',fund:'FF VII + Direct',status:'Pre-IPO',signal:'STRONG BUY',views:['deepdive','navmark','montecarlo','sizing']},
    'SpaceX': {type:'Company',val:'$380.0B',nav:'$36.1M',pct:'18.6%',delta:'+12.8%',fund:'FF VII + FF VI',status:'Private',signal:'BUY',views:['navmark','montecarlo','sizing']},
    'Stripe': {type:'Company',val:'$91.5B',nav:'$22.4M',pct:'11.6%',delta:'+8.4%',fund:'Sequoia XVI + a16z',status:'Pre-IPO',signal:'BUY',views:['navmark','ipowatch','comps']},
    'Anduril': {type:'Company',val:'$28.0B',nav:'$18.8M',pct:'9.7%',delta:'+22.5%',fund:'FF VII',status:'Pre-IPO (S-1 prep)',signal:'STRONG BUY',views:['navmark','ipowatch','deepdive']},
    'Databricks': {type:'Company',val:'$62.0B',nav:'$15.2M',pct:'7.8%',delta:'+6.1%',fund:'a16z Infra III',status:'Pre-IPO',signal:'BUY',views:['navmark','ipowatch','comps']},
    'Palantir': {type:'Company',val:'$180.0B',nav:'$14.5M',pct:'7.5%',delta:'+31.2%',fund:'NEA 19 + FF VI',status:'Public (L1)',signal:'HOLD',views:['navmark','comps']},
    'Scale AI': {type:'Company',val:'$14.0B',nav:'$8.2M',pct:'4.2%',delta:'+4.5%',fund:'a16z Infra III',status:'Private',signal:'HOLD',views:['navmark','comps']},
    'Figma': {type:'Company',val:'$12.5B',nav:'$6.8M',pct:'3.5%',delta:'+15.0%',fund:'Sequoia XVI',status:'Private',signal:'BUY',views:['navmark','comps']},
  };
  // Clickable entity name component
  const EntityLink = ({name, style:customStyle}) => {
    const ent = entityDB[name];
    if(!ent) return <span style={customStyle}>{name}</span>;
    return(<span
      style={{...customStyle, cursor:'pointer', borderBottom:`1px dashed ${T.accent}40`, transition:'all .12s'}}
      onMouseEnter={(e)=>showHoverCard(name, ent, e)}
      onMouseLeave={hideHoverCard}
      onClick={()=>{
        setDrillDown({
          title:name, subtitle:`${ent.type} · ${ent.fund}`,
          badges:[{l:ent.signal,c:ent.signal==='STRONG BUY'?T.green:ent.signal==='BUY'?T.blue:T.textDim},{l:ent.status,c:T.accent}],
          kpis:[{l:'Valuation',v:ent.val,c:T.accent},{l:'NAV Exp.',v:ent.nav,c:T.blue},{l:'% of NAV',v:ent.pct,c:T.purple},{l:'Δ QoQ',v:ent.delta,c:T.green}],
          sections:[
            {title:'Position Details',type:'table',rows:[
              {l:'Fund Exposure',v:ent.fund},{l:'Current Valuation',v:ent.val,mono:true},{l:'NAV Exposure',v:ent.nav,mono:true},
              {l:'% of Total NAV',v:ent.pct,mono:true,c:parseFloat(ent.pct)>15?T.red:T.accent},{l:'QoQ Change',v:ent.delta,mono:true,c:T.green},{l:'Signal',v:ent.signal,c:ent.signal==='STRONG BUY'?T.green:T.blue},
            ]},
            {title:'Quick Navigation',type:'actions',items:ent.views.map(vid=>({icon:'→',label:aViews.find(v=>v.id===vid)?.label||vid,view:vid,desc:`Open ${vid}`}))},
          ]
        });
      }}
    >{name}</span>);
  };

  // ═══ UX: "What's Next?" Navigation Prompts ═══
  const viewRelated = {
    radar: [{id:'icmemo',why:'Draft IC Memo for top opportunity'},{id:'sizing',why:'Check position sizing before committing'},{id:'montecarlo',why:'Run probability analysis'}],
    sizing: [{id:'concentration',why:'Check concentration limits'},{id:'portopt',why:'Optimize portfolio allocation'},{id:'montecarlo',why:'Stress test the portfolio'}],
    navmark: [{id:'premdisc',why:'See how marks affect premium'},{id:'ipowatch',why:'Upcoming catalysts for re-marks'},{id:'montecarlo',why:'Model mark uncertainty'}],
    premdisc: [{id:'capmarkets',why:'Execute ATM at premium'},{id:'ircommand',why:'Investor messaging on premium'},{id:'navmark',why:'Review underlying NAV assumptions'}],
    capmarkets: [{id:'premdisc',why:'Track premium/discount dynamics'},{id:'fundii',why:'Fundraising alternatives'},{id:'shareholder',why:'Check shareholder composition'}],
    montecarlo: [{id:'sizing',why:'Adjust positions based on scenarios'},{id:'regrisk',why:'Review regression risk factors'},{id:'warroom',why:'Execute on current opportunity'}],
    ipowatch: [{id:'navmark',why:'NAV impact when IPOs execute'},{id:'premdisc',why:'Premium reaction to IPO events'},{id:'concentration',why:'Post-IPO concentration changes'}],
    warroom: [{id:'radar',why:'Next opportunity in pipeline'},{id:'seclab',why:'Secondary market opportunities'},{id:'execution',why:'Review trade execution'}],
    fundii: [{id:'lportal',why:'Preview LP portal experience'},{id:'boarddeck',why:'Board deck for fundraising update'},{id:'platform',why:'Distribution platform status'}],
    pulse: [{id:'warroom',why:'Execute on urgent action'},{id:'ipowatch',why:'Monitor IPO pipeline'},{id:'radar',why:'Review new opportunities'}],
    earningsprep: [{id:'ircommand',why:'IR command center setup'},{id:'premdisc',why:'Premium model for guidance'},{id:'shareholder',why:'Know your audience'}],
    omniscient: [{id:'agents',why:'Configure AI agents'},{id:'buildmap',why:'Review build roadmap'},{id:'radar',why:'See AI-sourced opportunities'}],
  };
  const ViewNextSteps = ({view}) => {
    const related = viewRelated[view];
    if(!related || related.length === 0) return null;
    return(
      <div style={{marginTop:14,padding:'10px 14px',background:T.bgAccent,borderRadius:8,border:`1px solid ${T.border}`}}>
        <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:8}}>
          <ArrowRight size={10} color={T.accent}/>
          <span style={{fontSize:9,fontWeight:700,color:T.accent,textTransform:'uppercase',letterSpacing:0.5}}>What's Next?</span>
          <span style={{fontSize:8,color:T.textDim}}>Suggested workflow from here</span>
        </div>
        <div style={{display:'flex',gap:6}}>
          {related.map((r,i)=>{
            const v=aViews.find(vv=>vv.id===r.id);
            const g=tabGroups.find(gg=>gg.tabs.includes(r.id));
            if(!v) return null;
            return(<button key={i} onClick={()=>{setAView(r.id);addToast(`${v.label}`,'success');}} style={{flex:1,padding:'8px 10px',background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:6,cursor:'pointer',fontFamily:sans,textAlign:'left',transition:'all .12s',borderLeft:`3px solid ${g?.color||T.accent}`}} onMouseEnter={e=>{e.currentTarget.style.borderColor=g?.color||T.accent;e.currentTarget.style.background=`${g?.color||T.accent}06`;}} onMouseLeave={e=>{e.currentTarget.style.borderColor=T.border;e.currentTarget.style.background=T.bgCard;}}>
              <div style={{fontSize:10,fontWeight:600,color:T.text}}>{v.label.replace('⚡ ','')}</div>
              <div style={{fontSize:8,color:T.textDim,marginTop:1}}>{r.why}</div>
            </button>);
          })}
        </div>
      </div>
    );
  };

  return (
    <div ref={contentRef}>
      {/* Command Palette Overlay */}
      {cmdOpen&&(<div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'#000000a0',zIndex:999,display:'flex',justifyContent:'center',paddingTop:100,backdropFilter:'blur(4px)'}} onClick={()=>setCmdOpen(false)}>
        <div onClick={e=>e.stopPropagation()} style={{width:520,maxHeight:460,background:T.bgCard,borderRadius:14,border:`1px solid ${T.accent}30`,boxShadow:`0 24px 80px #000c, 0 0 0 1px ${T.border}`,overflow:'hidden'}}>
          <div style={{padding:'14px 18px',borderBottom:`1px solid ${T.border}`,display:'flex',alignItems:'center',gap:10}}>
            <Search size={18} color={T.accent}/>
            <input ref={cmdRef} value={cmdQ} onChange={e=>{setCmdQ(e.target.value);setCmdIdx(0);}} onKeyDown={e=>{
              if(e.key==='Enter'&&cmdFiltered.length>0){setAView(cmdFiltered[Math.min(cmdIdx,cmdFiltered.length-1)].id);setCmdOpen(false);addToast(`Jumped to ${cmdFiltered[Math.min(cmdIdx,cmdFiltered.length-1)].label}`);}
              if(e.key==='ArrowDown'){e.preventDefault();setCmdIdx(i=>Math.min(i+1,cmdFiltered.length-1));}
              if(e.key==='ArrowUp'){e.preventDefault();setCmdIdx(i=>Math.max(i-1,0));}
            }} placeholder="Jump to any view… or type a company name" style={{flex:1,background:'transparent',border:'none',color:T.text,fontSize:15,fontFamily:sans,outline:'none',fontWeight:500}}/>
            <span style={{fontSize:10,color:T.textDim,padding:'3px 8px',background:T.bgAccent,borderRadius:4,fontFamily:mono}}>ESC</span>
          </div>
          <div style={{maxHeight:380,overflowY:'auto',padding:8}}>
            {/* Recent views when no query */}
            {!cmdQ && recentViews.length > 1 && (
              <div style={{marginBottom:8}}>
                <div style={{fontSize:9,fontWeight:700,color:T.textDim,textTransform:'uppercase',padding:'6px 10px',letterSpacing:1.2,display:'flex',alignItems:'center',gap:6}}>🕐 Recent</div>
                {recentViews.slice(1,5).map(vid=>{
                  const v=aViews.find(vv=>vv.id===vid);
                  const g=tabGroups.find(gg=>gg.tabs.includes(vid));
                  if(!v||!g)return null;
                  return(<button key={vid} onClick={()=>{setAView(vid);setCmdOpen(false);addToast(`Back to ${v.label}`);}} style={{display:'flex',alignItems:'center',gap:10,width:'100%',padding:'7px 14px',background:'transparent',color:T.textMuted,border:'1px solid transparent',borderRadius:8,cursor:'pointer',fontFamily:sans,fontSize:12,textAlign:'left',transition:'all .06s'}} onMouseEnter={e=>{e.currentTarget.style.background=`${g.color}08`;e.currentTarget.style.color=g.color;}} onMouseLeave={e=>{e.currentTarget.style.background='transparent';e.currentTarget.style.color=T.textMuted;}}>
                    <span style={{width:7,height:7,borderRadius:4,background:g.color,opacity:0.5,flexShrink:0}}/>
                    <span style={{fontWeight:400}}>{v.label}</span>
                    <span style={{marginLeft:'auto',fontSize:9,color:T.textDim}}>{g.icon} {g.label}</span>
                  </button>);
                })}
              </div>
            )}
            {(()=>{ let flatIdx = -1; return tabGroups.map(g=>{
              const gTabs = cmdFiltered.filter(v=>g.tabs.includes(v.id));
              if(gTabs.length===0)return null;
              return(<div key={g.id} style={{marginBottom:8}}>
                <div style={{fontSize:9,fontWeight:700,color:g.color,textTransform:'uppercase',padding:'6px 10px',letterSpacing:1.2,display:'flex',alignItems:'center',gap:6}}>{g.icon} {g.label}<span style={{fontSize:8,color:T.textDim,fontWeight:400}}>— {g.desc}</span></div>
                {gTabs.map(v=>{flatIdx++;const fi=flatIdx;const isKb=fi===cmdIdx;return(<button key={v.id} onClick={()=>{setAView(v.id);setCmdOpen(false);}} onMouseEnter={()=>setCmdIdx(fi)} style={{display:'flex',alignItems:'center',gap:10,width:'100%',padding:'9px 14px',background:isKb?`${g.color}12`:(aView===v.id?T.accentBg:'transparent'),color:isKb?g.color:(aView===v.id?T.accent:T.text),border:isKb?`1px solid ${g.color}30`:'1px solid transparent',borderRadius:8,cursor:'pointer',fontFamily:sans,fontSize:13,textAlign:'left',transition:'all .06s'}}>
                  <span style={{width:7,height:7,borderRadius:4,background:g.color,flexShrink:0,opacity:isKb?1:0.5}}/>
                  <span style={{fontWeight:isKb||aView===v.id?600:400}}>{v.label}</span>
                  {isKb&&<span style={{marginLeft:'auto',fontSize:10,color:g.color,fontFamily:mono,padding:'1px 6px',background:`${g.color}15`,borderRadius:3}}>↵ jump</span>}
                  {!isKb&&aView===v.id&&<span style={{marginLeft:'auto',fontSize:9,color:T.accent,fontStyle:'italic'}}>current</span>}
                </button>);})}
              </div>);
            });})()}
          </div>
          <div style={{padding:'8px 14px',borderTop:`1px solid ${T.border}`,display:'flex',gap:12,justifyContent:'center'}}>
            {[{k:'↑↓',a:'navigate'},{k:'↵',a:'select'},{k:'esc',a:'close'},{k:'←→',a:'prev/next'},{k:'1-4',a:'switch modes'},{k:'P',a:'pulse'}].map((h,i)=>(
              <span key={i} style={{fontSize:9,color:T.textDim}}><span style={{fontFamily:mono,padding:'1px 4px',background:T.bgAccent,borderRadius:2,marginRight:3}}>{h.k}</span>{h.a}</span>
            ))}
          </div>
        </div>
      </div>)}

      {/* ═══ TOAST NOTIFICATIONS ═══ */}
      <div style={{position:'fixed',top:56,right:16,zIndex:10000,display:'flex',flexDirection:'column',gap:6,pointerEvents:'none'}}>
        {toasts.map(t=>(<div key={t.id} style={{padding:'8px 14px',background:t.type==='success'?T.green+'20':t.type==='error'?T.red+'20':T.bgCard,border:`1px solid ${t.type==='success'?T.green:t.type==='error'?T.red:T.accent}40`,borderRadius:8,boxShadow:`0 4px 16px ${T.bg}80`,animation:'fadeIn .2s ease',pointerEvents:'auto',display:'flex',alignItems:'center',gap:8}}>
          <span style={{fontSize:12}}>{t.type==='success'?'✓':t.type==='error'?'✕':'ℹ'}</span>
          <span style={{fontSize:11,color:T.text,fontWeight:500}}>{t.msg}</span>
        </div>))}
      </div>

      {/* ═══ ENTITY HOVER CARD ═══ */}
      {hoverCard&&(<div style={{position:'fixed',left:Math.min(hoverCard.x,window.innerWidth-280),top:hoverCard.y,zIndex:10001,width:260,background:T.bgCard,border:`1px solid ${T.accent}30`,borderRadius:10,boxShadow:`0 8px 32px ${T.bg}c0`,padding:'10px 14px',animation:'fadeIn .12s ease',pointerEvents:'none'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
          <span style={{fontSize:13,fontWeight:700,color:T.text}}>{hoverCard.entity}</span>
          <Badge color={hoverCard.data.signal==='STRONG BUY'?T.green:hoverCard.data.signal==='BUY'?T.blue:T.textDim}>{hoverCard.data.signal}</Badge>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:4,marginBottom:6}}>
          {[{l:'Valuation',v:hoverCard.data.val},{l:'NAV Exp.',v:hoverCard.data.nav},{l:'% of NAV',v:hoverCard.data.pct},{l:'Δ QoQ',v:hoverCard.data.delta}].map((m,i)=>(
            <div key={i} style={{padding:'3px 6px',background:T.bgAccent,borderRadius:4}}>
              <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
              <div style={{fontSize:11,fontWeight:700,fontFamily:mono,color:T.accent}}>{m.v}</div>
            </div>
          ))}
        </div>
        <div style={{display:'flex',gap:4,alignItems:'center'}}>
          <Badge color={T.accent}>{hoverCard.data.status}</Badge>
          <span style={{fontSize:8,color:T.textDim}}>{hoverCard.data.fund}</span>
        </div>
        <div style={{fontSize:8,color:T.accent,marginTop:4,textAlign:'center'}}>Click to view details →</div>
      </div>)}

      {/* ═══ STRATEGIC ACTION CENTER — Floating bottom bar ═══ */}
      {sacOpen && activeActions.length > 0 && !cmdOpen && (
        <div style={{position:'fixed',bottom:0,left:0,right:0,zIndex:9990,padding:'0 16px 10px',pointerEvents:'none'}}>
          <div style={{background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:12,boxShadow:`0 -4px 24px ${T.bg}80, 0 0 0 1px ${T.border}`,padding:'8px 14px',pointerEvents:'auto',animation:'fadeIn .2s ease'}}>
            <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:4}}>
              <div style={{display:'flex',alignItems:'center',gap:6}}>
                <Zap size={12} color={T.accent}/>
                <span style={{fontSize:10,fontWeight:700,color:T.accent,letterSpacing:0.5}}>ACTION CENTER</span>
                <span style={{fontSize:8,color:T.textDim,fontFamily:mono,background:T.bgAccent,padding:'1px 5px',borderRadius:3}}>{activeActions.filter(a=>a.urgency>=2).length} urgent</span>
              </div>
              <div style={{display:'flex',alignItems:'center',gap:4}}>
                {recentViews.length > 1 && (
                  <div style={{display:'flex',alignItems:'center',gap:2,marginRight:8}}>
                    <span style={{fontSize:8,color:T.textDim}}>Recent:</span>
                    {recentViews.slice(1,4).map(vid=>{
                      const v=aViews.find(vv=>vv.id===vid);
                      const g=tabGroups.find(gg=>gg.tabs.includes(vid));
                      return v?(<button key={vid} onClick={()=>setAView(vid)} style={{padding:'1px 6px',fontSize:8,background:`${g?.color||T.accent}10`,color:g?.color||T.textDim,border:`1px solid ${g?.color||T.border}20`,borderRadius:3,cursor:'pointer',fontFamily:sans}}>{v.label.replace('⚡ ','').split(' ').slice(0,2).join(' ')}</button>):null;
                    })}
                  </div>
                )}
                <button onClick={()=>setSacOpen(false)} style={{background:'transparent',border:'none',cursor:'pointer',padding:2,color:T.textDim,fontSize:11}} title="Minimize">—</button>
              </div>
            </div>
            <div style={{display:'flex',gap:6,overflow:'hidden'}}>
              {activeActions.slice(0,5).map(a=>(
                <div key={a.id} style={{display:'flex',alignItems:'center',gap:6,padding:'5px 10px',background:a.urgency>=3?`${T.red}08`:a.urgency>=2?`${T.amber}08`:T.bgAccent,border:`1px solid ${a.color}30`,borderRadius:8,cursor:'pointer',flex:1,minWidth:0,transition:'all .12s',borderLeft:`3px solid ${a.color}`}} onClick={()=>{setAView(a.view);addToast(`Navigated to ${aViews.find(v=>v.id===a.view)?.label||a.view}`);}} onMouseEnter={e=>e.currentTarget.style.background=`${a.color}15`} onMouseLeave={e=>e.currentTarget.style.background=a.urgency>=3?`${T.red}08`:a.urgency>=2?`${T.amber}08`:T.bgAccent}>
                  <span style={{fontSize:11,flexShrink:0}}>{a.icon}</span>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontSize:10,fontWeight:600,color:T.text,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>{a.label}</div>
                    <div style={{fontSize:8,color:T.textMuted,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>{a.desc}</div>
                  </div>
                  <button onClick={(e)=>{e.stopPropagation();setDismissedActions(prev=>[...prev,a.id]);addToast(`Dismissed: ${a.label}`);}} style={{background:'transparent',border:'none',cursor:'pointer',color:T.textDim,fontSize:9,flexShrink:0,padding:2}} title="Dismiss">✕</button>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}
      {!sacOpen && activeActions.filter(a=>a.urgency>=2).length > 0 && (
        <button onClick={()=>setSacOpen(true)} style={{position:'fixed',bottom:12,right:16,zIndex:9990,padding:'6px 12px',background:T.bgCard,border:`1px solid ${T.red}40`,borderRadius:20,boxShadow:`0 2px 12px ${T.bg}80`,cursor:'pointer',display:'flex',alignItems:'center',gap:6,fontFamily:sans,animation:'pulse 2s infinite'}}>
          <Zap size={11} color={T.red}/>
          <span style={{fontSize:10,fontWeight:600,color:T.red}}>{activeActions.filter(a=>a.urgency>=2).length} Urgent</span>
        </button>
      )}

      {/* ═══ NAVIGATION SYSTEM — Redesigned with ViewMap + Workflows ═══ */}
      <div style={{marginBottom:2}}>
        {/* ── TOP BAR: Group pills + ViewMap toggle + Cmd+K ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:navExpanded?0:6}}>
          <div style={{display:'flex',alignItems:'center',gap:6}}>
            {/* Group pills */}
            <div style={{display:'flex',background:T.bgAccent,borderRadius:8,padding:2,border:`1px solid ${T.border}`,gap:1}}>
              {tabGroups.map(g=>{
                const isActive = selectedGroupId===g.id;
                const hasCurrentTab = g.tabs.includes(aView);
                return(<button key={g.id} onClick={()=>{setSelectedGroupId(g.id);if(!g.tabs.includes(aView))setAView(g.tabs[0]);if(navExpanded)setNavExpanded(false);}} style={{display:'flex',alignItems:'center',gap:4,padding:'5px 11px',background:isActive?T.bgCard:'transparent',color:isActive?g.color:T.textMuted,border:isActive?`1px solid ${g.color}30`:'1px solid transparent',borderRadius:6,cursor:'pointer',fontFamily:sans,fontSize:10,fontWeight:isActive?700:500,transition:'all .12s',boxShadow:isActive?`0 1px 4px ${g.color}15`:'none',position:'relative'}}>
                  <span style={{fontSize:12}}>{g.icon}</span>
                  <span>{g.label}</span>
                  <span style={{fontSize:8,color:isActive?g.color:T.textDim,fontFamily:mono}}>({g.tabs.length})</span>
                  {!isActive&&hasCurrentTab&&<span style={{position:'absolute',bottom:1,left:'50%',transform:'translateX(-50%)',width:4,height:4,borderRadius:2,background:g.color}}/>}
                </button>);
              })}
            </div>
            {/* Favorites shortcuts */}
            {!navExpanded && favTabs.length > 0 && (
              <div style={{display:'flex',alignItems:'center',gap:2}}>
                <Star size={9} color={T.gold} style={{opacity:0.4}}/>
                {favTabs.slice(0,4).map(fid => {
                  const fv = aViews.find(v=>v.id===fid);
                  const fg = tabGroups.find(g=>g.tabs.includes(fid));
                  if(!fv||!fg)return null;
                  return(<button key={fid} onClick={()=>setAView(fid)} style={{padding:'2px 8px',fontSize:9,fontWeight:aView===fid?700:400,background:aView===fid?`${fg.color}12`:'transparent',color:aView===fid?fg.color:T.textDim,border:'none',borderRadius:3,cursor:'pointer',fontFamily:sans,transition:'all .1s'}}>{fv.label.replace('⚡ ','').split(' ')[0]}</button>);
                })}
              </div>
            )}
          </div>
          <div style={{display:'flex',alignItems:'center',gap:4}}>
            <span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>← → keys</span>
            {/* ViewMap toggle */}
            <button onClick={()=>setNavExpanded(p=>!p)} style={{display:'flex',alignItems:'center',gap:5,padding:'5px 12px',background:navExpanded?`${T.accent}12`:T.bgAccent,border:`1px solid ${navExpanded?T.accent+'40':T.border}`,borderRadius:6,color:navExpanded?T.accent:T.textMuted,fontSize:10,cursor:'pointer',fontFamily:sans,fontWeight:navExpanded?700:500,transition:'all .15s'}} title="Toggle full view map">
              <Layers size={12}/>{navExpanded?'Close Map':'View Map'}<span style={{fontSize:8,color:T.textDim,fontFamily:mono,padding:'1px 4px',background:T.bg,borderRadius:2}}>26</span>
            </button>
            {/* Cmd+K */}
            <button onClick={()=>{setCmdOpen(true);setCmdQ('');setCmdIdx(0);}} style={{display:'flex',alignItems:'center',gap:5,padding:'5px 12px',background:T.bgAccent,border:`1px solid ${T.border}`,borderRadius:6,color:T.textMuted,fontSize:10,cursor:'pointer',fontFamily:sans,fontWeight:500,transition:'border-color .15s'}} onMouseEnter={e=>e.currentTarget.style.borderColor=T.accent+'60'} onMouseLeave={e=>e.currentTarget.style.borderColor=T.border}>
              <Search size={12}/>Jump<span style={{fontSize:8,color:T.textDim,padding:'1px 5px',background:T.bg,borderRadius:2,fontFamily:mono}}>⌘K</span>
            </button>
          </div>
        </div>

        {/* ── EXPANDED VIEW MAP — Full grid of all 26 views ── */}
        {navExpanded && (
          <div style={{background:T.bgAccent,borderRadius:10,border:`1px solid ${T.border}`,padding:12,marginBottom:8,animation:'fadeIn .15s ease'}}>
            {/* Lens toggle: Groups vs Workflows */}
            <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:10}}>
              <div style={{display:'flex',background:T.bg,borderRadius:5,padding:2,border:`1px solid ${T.border}`,gap:1}}>
                {[{id:'groups',l:'By Department'},{id:'workflows',l:'By Workflow'},{id:'all',l:'All Views'}].map(lens=>
                  <button key={lens.id} onClick={()=>setNavLens(lens.id)} style={{padding:'4px 12px',fontSize:9,fontWeight:navLens===lens.id?700:400,background:navLens===lens.id?T.bgCard:'transparent',color:navLens===lens.id?T.accent:T.textDim,border:navLens===lens.id?`1px solid ${T.accent}30`:'1px solid transparent',borderRadius:4,cursor:'pointer',fontFamily:sans,transition:'all .1s'}}>{lens.l}</button>
                )}
              </div>
              <span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>{aViews.length} views · click to navigate</span>
            </div>

            {/* Groups lens */}
            {navLens==='groups' && (
              <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
                {tabGroups.map(g=>(
                  <div key={g.id}>
                    <div style={{fontSize:9,fontWeight:700,color:g.color,marginBottom:6,display:'flex',alignItems:'center',gap:4}}>
                      <span>{g.icon}</span>{g.label}
                      <span style={{fontSize:8,color:T.textDim,fontWeight:400}}>({g.tabs.length})</span>
                    </div>
                    <div style={{display:'flex',flexDirection:'column',gap:2}}>
                      {g.tabs.map(tid=>{
                        const tv = aViews.find(v=>v.id===tid);
                        if(!tv) return null;
                        const isActive = aView===tid;
                        const isFaved = favTabs.includes(tid);
                        return(
                          <button key={tid} onClick={()=>{setAView(tid);setNavExpanded(false);}} style={{display:'flex',alignItems:'center',gap:6,padding:'5px 8px',background:isActive?`${g.color}12`:T.bgCard,border:`1px solid ${isActive?g.color+'40':T.border+'60'}`,borderRadius:5,cursor:'pointer',fontFamily:sans,textAlign:'left',transition:'all .1s',borderLeft:`3px solid ${isActive?g.color:'transparent'}`}} onMouseEnter={e=>{if(!isActive){e.currentTarget.style.borderColor=g.color+'30';e.currentTarget.style.background=`${g.color}06`;}}} onMouseLeave={e=>{if(!isActive){e.currentTarget.style.borderColor=T.border+'60';e.currentTarget.style.background=T.bgCard;}}}>
                            <span style={{width:5,height:5,borderRadius:3,background:isActive?g.color:T.textDim,flexShrink:0,opacity:isActive?1:0.4}}/>
                            <div style={{flex:1,minWidth:0}}>
                              <div style={{fontSize:10,fontWeight:isActive?700:500,color:isActive?g.color:T.text,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>{tv.label.replace('⚡ ','')}</div>
                              <div style={{fontSize:7,color:T.textDim,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',lineHeight:1.2}}>{tv.desc?.slice(0,50)}</div>
                            </div>
                            <div style={{display:'flex',alignItems:'center',gap:2,flexShrink:0}}>
                              {tv.urgency>=3&&<span style={{width:6,height:6,borderRadius:3,background:T.red,boxShadow:`0 0 4px ${T.red}60`}}/>}
                              {tv.urgency===2&&<span style={{width:5,height:5,borderRadius:3,background:T.amber}}/>}
                              {isFaved&&<Star size={8} color={T.gold} fill={T.gold}/>}
                            </div>
                          </button>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* Workflows lens — cross-cutting use cases */}
            {navLens==='workflows' && (
              <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:8}}>
                {workflows.map(wf=>(
                  <div key={wf.id} style={{background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,overflow:'hidden'}}>
                    <div style={{padding:'8px 10px',borderBottom:`1px solid ${T.border}60`,background:`${wf.color}06`}}>
                      <div style={{display:'flex',alignItems:'center',gap:5,marginBottom:2}}>
                        <span style={{fontSize:13}}>{wf.icon}</span>
                        <span style={{fontSize:11,fontWeight:700,color:wf.color}}>{wf.label}</span>
                        <span style={{fontSize:8,color:T.textDim,fontFamily:mono,marginLeft:'auto'}}>({wf.tabs.length})</span>
                      </div>
                      <div style={{fontSize:8,color:T.textMuted,lineHeight:1.2}}>{wf.summary}</div>
                    </div>
                    <div style={{padding:'4px 6px'}}>
                      {wf.tabs.map(tid=>{
                        const tv = aViews.find(v=>v.id===tid);
                        const tg = tabGroups.find(g=>g.tabs.includes(tid));
                        if(!tv||!tg) return null;
                        const isActive = aView===tid;
                        return(
                          <button key={tid} onClick={()=>{setAView(tid);setNavExpanded(false);}} style={{display:'flex',alignItems:'center',gap:5,width:'100%',padding:'4px 6px',background:isActive?`${wf.color}10`:'transparent',border:'none',borderRadius:4,cursor:'pointer',fontFamily:sans,textAlign:'left',transition:'all .08s',borderLeft:`2px solid ${isActive?wf.color:'transparent'}`}} onMouseEnter={e=>{if(!isActive)e.currentTarget.style.background=`${wf.color}06`;}} onMouseLeave={e=>{if(!isActive)e.currentTarget.style.background='transparent';}}>
                            <span style={{width:4,height:4,borderRadius:2,background:tg.color,opacity:0.6,flexShrink:0}}/>
                            <span style={{fontSize:10,fontWeight:isActive?700:400,color:isActive?wf.color:T.text}}>{tv.label.replace('⚡ ','')}</span>
                            <span style={{fontSize:7,color:T.textDim,marginLeft:'auto',fontFamily:mono}}>{tg.label.split(' ')[0]}</span>
                          </button>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* All views lens — flat alphabetical grid */}
            {navLens==='all' && (
              <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:3}}>
                {[...aViews].sort((a,b)=>a.label.localeCompare(b.label)).map(v=>{
                  const vg = tabGroups.find(g=>g.tabs.includes(v.id));
                  const isActive = aView===v.id;
                  return(
                    <button key={v.id} onClick={()=>{setAView(v.id);setNavExpanded(false);}} style={{display:'flex',alignItems:'center',gap:5,padding:'5px 8px',background:isActive?`${(vg?.color||T.accent)}10`:T.bgCard,border:`1px solid ${isActive?(vg?.color||T.accent)+'40':T.border+'40'}`,borderRadius:4,cursor:'pointer',fontFamily:sans,textAlign:'left',transition:'all .08s'}} onMouseEnter={e=>{if(!isActive)e.currentTarget.style.background=`${(vg?.color||T.accent)}06`;}} onMouseLeave={e=>{if(!isActive)e.currentTarget.style.background=T.bgCard;}}>
                      <span style={{width:5,height:5,borderRadius:3,background:vg?.color||T.accent,opacity:isActive?1:0.4}}/>
                      <span style={{fontSize:10,fontWeight:isActive?700:400,color:isActive?(vg?.color||T.accent):T.text,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>{v.label.replace('⚡ ','')}</span>
                      {v.urgency>=3&&<span style={{width:5,height:5,borderRadius:3,background:T.red,marginLeft:'auto',flexShrink:0}}/>}
                    </button>
                  );
                })}
              </div>
            )}
          </div>
        )}

        {/* ── COMPACT STRIP (when ViewMap closed) — Sub-Section Grouped ── */}
        {!navExpanded && (
          <>
            {/* Sub-section group labels + tabs */}
            <div style={{display:'flex',alignItems:'center',gap:3,marginBottom:6}}>
              <button disabled={!prevTab} onClick={()=>prevTab&&setAView(prevTab.id)} style={{padding:'4px 3px',background:'transparent',border:'none',cursor:prevTab?'pointer':'default',opacity:prevTab?0.5:0.12,flexShrink:0}} title={prevTab?`← ${prevTab.label}`:''}>
                <ChevronRight size={13} color={T.textMuted} style={{transform:'rotate(180deg)'}}/>
              </button>
              <div ref={tabScrollRef} style={{display:'flex',gap:1,overflow:'hidden',flex:1,alignItems:'center',maskImage:'linear-gradient(90deg, transparent 0%, black 1.5%, black 98.5%, transparent 100%)'}}>
                {(sectionSubs[selectedGroupId]||[]).map((sub,si)=>(
                  <React.Fragment key={sub.id}>
                    {si>0&&<div style={{width:1,height:16,background:T.border,flexShrink:0,margin:'0 3px',opacity:0.4}}/>}
                    <span style={{fontSize:7,color:T.textDim,fontWeight:700,textTransform:'uppercase',letterSpacing:0.5,flexShrink:0,padding:'0 4px',whiteSpace:'nowrap'}}>{sub.icon} {sub.label}</span>
                    {sub.tabs.map(tid=>{
                      const tab = aViews.find(v=>v.id===tid);
                      const isActive = aView===tid;
                      return(<button key={tid} data-active={isActive?'true':'false'} onClick={()=>setAView(tid)} style={{padding:'4px 10px',fontSize:10,fontWeight:isActive?700:400,background:isActive?`${selectedGroup.color}15`:'transparent',color:isActive?selectedGroup.color:T.textMuted,border:isActive?`1px solid ${selectedGroup.color}40`:'1px solid transparent',borderRadius:4,cursor:'pointer',fontFamily:sans,transition:'all .1s',whiteSpace:'nowrap',flexShrink:0,borderBottom:isActive?`2px solid ${selectedGroup.color}`:'2px solid transparent'}} onMouseEnter={e=>{if(!isActive)e.currentTarget.style.color=T.text;}} onMouseLeave={e=>{if(!isActive)e.currentTarget.style.color=T.textMuted;}}>{tab?.label}</button>);
                    })}
                  </React.Fragment>
                ))}
              </div>
              <button disabled={!nextTab} onClick={()=>nextTab&&setAView(nextTab.id)} style={{padding:'4px 3px',background:'transparent',border:'none',cursor:nextTab?'pointer':'default',opacity:nextTab?0.5:0.12,flexShrink:0}} title={nextTab?`→ ${nextTab.label}`:''}>
                <ChevronRight size={13} color={T.textMuted}/>
              </button>
              <span style={{fontSize:8,color:T.textDim,fontFamily:mono,flexShrink:0,padding:'2px 5px',background:T.bgAccent,borderRadius:3}}>{curGlobalIdx+1}/{aViews.length}</span>
            </div>

            {/* Contextual bar: Breadcrumb + KPIs + Quick Actions + pin */}
            <div style={{padding:'5px 10px',background:T.bgAccent,borderRadius:5,border:`1px solid ${T.border}`,marginBottom:4}}>
              {/* Row 1: Breadcrumb + KPIs + View Title + Pin */}
              <div style={{display:'flex',gap:6,alignItems:'center'}}>
                {/* Breadcrumb */}
                <div style={{display:'flex',alignItems:'center',gap:3,flexShrink:0}}>
                  <span style={{fontSize:8,fontWeight:700,color:selectedGroup?.color||T.accent,textTransform:'uppercase',letterSpacing:0.6}}>{selectedGroup?.icon} {selectedGroup?.label}</span>
                  <ChevronRight size={8} color={T.textDim}/>
                  {(()=>{const sub=(sectionSubs[selectedGroupId]||[]).find(s=>s.tabs.includes(aView));return sub?(<><span style={{fontSize:8,color:T.textDim}}>{sub.icon} {sub.label}</span><ChevronRight size={8} color={T.textDim}/></>):null;})()}
                  <span style={{fontSize:9,fontWeight:700,color:T.text}}>{activeLabel}</span>
                  {/* Mode indicator */}
                  {viewMode[aView]&&<span style={{fontSize:7,padding:'1px 5px',background:`${T.accent}15`,color:T.accent,borderRadius:2,fontFamily:mono,fontWeight:600,marginLeft:2}}>MODE: {viewMode[aView]}</span>}
                </div>
                <div style={{width:1,height:14,background:T.border,flexShrink:0}}/>
                {(groupKPIs[selectedGroupId]||[]).map((kpi,i)=>(
                  <div key={i} style={{display:'flex',alignItems:'center',gap:3,padding:'0 6px',borderRight:i<3?`1px solid ${T.border}`:'none'}}>
                    <span style={{fontSize:8,color:T.textDim}}>{kpi.l}</span>
                    <span style={{fontSize:11,fontWeight:700,fontFamily:mono,color:kpi.c}}>{kpi.v}</span>
                  </div>
                ))}
                <div style={{marginLeft:'auto',display:'flex',alignItems:'center',gap:5}}>
                  {activeViewObj?.urgency>=3&&<span style={{fontSize:7,padding:'1px 4px',background:T.redBg,color:T.red,borderRadius:2,fontWeight:700,border:`1px solid ${T.red}30`}}>URGENT</span>}
                  {activeViewObj?.urgency===2&&<span style={{fontSize:7,padding:'1px 4px',background:T.amberBg,color:T.amber,borderRadius:2,fontWeight:700,border:`1px solid ${T.amber}30`}}>ACTIVE</span>}
                  <button onClick={()=>toggleFav(aView)} style={{background:'transparent',border:'none',cursor:'pointer',padding:2,display:'flex',alignItems:'center'}} title={isFav?'Unpin':'Pin'}>
                    <Star size={12} color={isFav?T.gold:T.textDim} fill={isFav?T.gold:'none'} style={{transition:'all .15s'}}/>
                  </button>
                </div>
              </div>
              {/* Row 2: Quick Actions + Description */}
              <div style={{display:'flex',alignItems:'center',gap:4,marginTop:3}}>
                {currentQuickActions.length > 0 && (
                  <div style={{display:'flex',gap:3}}>
                    {currentQuickActions.map((qa,i)=>(
                      <button key={i} onClick={qa.action} style={{display:'flex',alignItems:'center',gap:3,padding:'2px 8px',fontSize:9,fontWeight:500,background:T.bgCard,color:T.textMuted,border:`1px solid ${T.border}`,borderRadius:4,cursor:'pointer',fontFamily:sans,transition:'all .1s'}} onMouseEnter={e=>{e.currentTarget.style.color=T.accent;e.currentTarget.style.borderColor=T.accent+'60';}} onMouseLeave={e=>{e.currentTarget.style.color=T.textMuted;e.currentTarget.style.borderColor=T.border;}}>
                        <span style={{fontSize:10}}>{qa.icon}</span>{qa.label}
                      </button>
                    ))}
                  </div>
                )}
                {activeViewObj?.desc && (
                  <div style={{fontSize:8,color:T.textDim,marginLeft:currentQuickActions.length>0?8:0,lineHeight:1.2,flex:1,overflow:'hidden',whiteSpace:'nowrap',textOverflow:'ellipsis'}}>{activeViewObj.desc}</div>
                )}
                {/* Keyboard hints */}
                <div style={{display:'flex',gap:4,flexShrink:0,marginLeft:4}}>
                  <span style={{fontSize:7,color:T.textDim,fontFamily:mono,padding:'1px 3px',background:T.bg,borderRadius:2}}>←→ nav</span>
                  <span style={{fontSize:7,color:T.textDim,fontFamily:mono,padding:'1px 3px',background:T.bg,borderRadius:2}}>⌘K jump</span>
                </div>
              </div>
            </div>

            {/* Progress dots */}
            {selectedGroup && (
              <div style={{display:'flex',alignItems:'center',gap:2,marginBottom:8,paddingLeft:2}}>
                {selectedGroup.tabs.map((tid,i) => {
                  const isActive = aView===tid;
                  const isPast = selectedGroup.tabs.indexOf(aView) > i;
                  return(<button key={tid} onClick={()=>setAView(tid)} title={aViews.find(v=>v.id===tid)?.label} style={{width:isActive?20:6,height:5,borderRadius:3,background:isActive?selectedGroup.color:(isPast?`${selectedGroup.color}50`:T.border),border:'none',cursor:'pointer',transition:'all .2s',padding:0}}/>);
                })}
                <span style={{fontSize:7,color:T.textDim,marginLeft:3,fontFamily:mono}}>{selectedGroup.tabs.indexOf(aView)+1}/{selectedGroup.tabs.length}</span>
              </div>
            )}
          </>
        )}
      </div>

      {/* ═══ TAB 1: OPPORTUNITY RADAR ═══ */}
      {/* ═══════════════════════════════════════════════════════════════ */}
      {/* ═══  DRILL-DOWN OVERLAY — Universal entity detail panel     ═══ */}
      {/* ═══════════════════════════════════════════════════════════════ */}
      {drillDown&&(<div style={{position:'fixed',inset:0,zIndex:9999,display:'flex',justifyContent:'flex-end'}}>
        <div style={{position:'absolute',inset:0,background:'#00000060',backdropFilter:'blur(3px)'}} onClick={()=>setDrillDown(null)}/>
        <div style={{width:520,background:T.bgCard,borderLeft:`1px solid ${T.border}`,boxShadow:`-8px 0 30px ${T.bg}80`,overflowY:'auto',position:'relative',animation:'slideInRight .18s ease'}}>
          <div style={{position:'sticky',top:0,background:T.bgCard,zIndex:1,padding:'14px 18px',borderBottom:`1px solid ${T.border}`,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div>
              <div style={{fontSize:14,fontWeight:900,color:T.text}}>{drillDown.title||'Detail'}</div>
              <div style={{fontSize:10,color:T.textDim}}>{drillDown.subtitle||''}</div>
            </div>
            <div style={{display:'flex',gap:4}}>
              {drillDown.badges?.map((b,i)=><Badge key={i} color={b.c}>{b.l}</Badge>)}
              <button onClick={()=>setDrillDown(null)} style={{background:'transparent',border:'none',cursor:'pointer',padding:4,color:T.textMuted,fontSize:16}}>✕</button>
            </div>
          </div>
          <div style={{padding:'14px 18px'}}>
            {/* KPI Strip */}
            {drillDown.kpis&&<div style={{display:'grid',gridTemplateColumns:`repeat(${Math.min(drillDown.kpis.length,4)},1fr)`,gap:8,marginBottom:14}}>
              {drillDown.kpis.map((k,i)=>(<div key={i} style={{padding:10,background:T.bgAccent,borderRadius:6,borderTop:`3px solid ${k.c||T.accent}`,textAlign:'center'}}>
                <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{k.l}</div>
                <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:k.c||T.accent}}>{k.v}</div>
              </div>))}
            </div>}
            {/* Body sections */}
            {drillDown.sections?.map((sec,si)=>(<div key={si} style={{marginBottom:14}}>
              <div style={{fontSize:10,fontWeight:700,color:T.textDim,textTransform:'uppercase',letterSpacing:0.5,marginBottom:6,borderBottom:`1px solid ${T.border}`,paddingBottom:4}}>{sec.title}</div>
              {sec.type==='table'&&<table style={{width:'100%',borderCollapse:'collapse'}}><tbody>
                {sec.rows.map((row,ri)=>(<tr key={ri} style={{borderBottom:`1px solid ${T.border}40`}}>
                  <td style={{fontSize:10,color:T.textDim,padding:'5px 8px',width:120,fontWeight:500}}>{row.l}</td>
                  <td style={{fontSize:11,color:row.c||T.text,padding:'5px 8px',fontWeight:600,fontFamily:row.mono?mono:sans}}>{row.v}</td>
                </tr>))}
              </tbody></table>}
              {sec.type==='bars'&&sec.items.map((item,ii)=>(<div key={ii} style={{marginBottom:6}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                  <span style={{fontSize:10,color:T.text}}>{item.l}</span>
                  <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:item.c||T.accent}}>{item.v}</span>
                </div>
                <Bar value={item.pct} max={100} color={item.c||T.accent} h={4}/>
              </div>))}
              {sec.type==='text'&&<div style={{fontSize:11,color:T.text,lineHeight:1.6}}>{sec.content}</div>}
              {sec.type==='actions'&&<div style={{display:'flex',flexDirection:'column',gap:6}}>
                {sec.items.map((act,ai)=>(<button key={ai} onClick={()=>{setDrillDown(null);if(act.view){setAView(act.view);addToast(`Opened ${aViews.find(v=>v.id===act.view)?.label||act.view}`,'success');}}} style={{display:'flex',alignItems:'center',gap:8,padding:'10px 14px',background:T.bgAccent,border:`1px solid ${T.border}`,borderRadius:6,cursor:'pointer',fontFamily:sans,textAlign:'left',transition:'all .12s',borderLeft:`3px solid transparent`}} onMouseEnter={e=>{e.currentTarget.style.borderColor=T.accent+'60';e.currentTarget.style.borderLeftColor=T.accent;e.currentTarget.style.background=`${T.accent}08`;}} onMouseLeave={e=>{e.currentTarget.style.borderColor=T.border;e.currentTarget.style.borderLeftColor='transparent';e.currentTarget.style.background=T.bgAccent;}}>
                  <span style={{fontSize:14}}>{act.icon||'→'}</span>
                  <div style={{flex:1}}>
                    <div style={{fontSize:11,fontWeight:600,color:T.text}}>{act.label}</div>
                    <div style={{fontSize:9,color:T.textDim}}>{act.desc}</div>
                  </div>
                  {act.view&&<span style={{fontSize:8,fontFamily:mono,color:T.accent,padding:'2px 6px',background:T.accent+'10',borderRadius:3}}>→ {act.view}</span>}
                </button>))}
              </div>}
            </div>))}
          </div>
        </div>
      </div>)}

      {aView==='radar'&&(<div>
        {/* ── MODE TOGGLE + FILTER BAR ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['pipeline','compare','calculator'].map(m=>(
              <FilterPill key={m} label={m==='pipeline'?'🎯 Pipeline':m==='compare'?'⚖️ Compare':'🧮 Calculator'} active={getMode('radar','pipeline')===m} onClick={()=>setMode('radar',m)}/>
            ))}
          </div>
          <div style={{display:'flex',gap:4,alignItems:'center'}}>
            {['All','Secondary','Co-Invest','Fund Commitment'].map(f=>(
              <FilterPill key={f} label={f} active={getFilter('radar','type','All')===f} onClick={()=>setFilter('radar','type',f)}/>
            ))}
            <div style={{width:1,height:16,background:T.border,margin:'0 2px'}}/>
            {['All','STRONG BUY','BUY','HOLD'].map(s=>(
              <FilterPill key={s} label={s} active={getFilter('radar','signal','All')===s} onClick={()=>setFilter('radar','signal',s)}/>
            ))}
          </div>
        </div>

        {/* ── PIPELINE MODE (default) — Enhanced with drill-down ── */}
        {getMode('radar','pipeline')==='pipeline'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          {(()=>{
            const filtered=hotOpps.filter(o=>(getFilter('radar','type','All')==='All'||o.type===getFilter('radar','type','All'))&&(getFilter('radar','signal','All')==='All'||o.signal===getFilter('radar','signal','All')));
            return[
              <Stat key={0} label="Showing" value={filtered.length+'/'+hotOpps.length} icon={Target} sub={getFilter('radar','type','All')!=='All'?getFilter('radar','type','All'):'all types'} color={T.accent}/>,
              <Stat key={1} label="Total Deployable" value={`$${filtered.reduce((s,o)=>s+(o.sizing?.optimal||0),0).toFixed(1)}M`} icon={DollarSign} sub="filtered" color={T.green}/>,
              <Stat key={2} label="Avg IRR (Base)" value={`${filtered.length?Math.round(filtered.reduce((s,o)=>s+o.irr_base,0)/filtered.length):0}%`} icon={TrendingUp} sub="expected return" color={T.blue}/>,
              <Stat key={3} label="Strong Buy" value={filtered.filter(o=>o.signal==='STRONG BUY').length} icon={Zap} sub="immediate action" color={T.red}/>
            ];
          })()}
        </div>
        {/* D3 Force Bubble Pack — Conviction × Return */}
        <Card title="Opportunity Map — D3 Force Bubble Pack" action={<div style={{display:'flex',gap:10,alignItems:'center'}}>{[['STRONG BUY',T.accent],['BUY',T.green],['HOLD',T.blue]].map(([l,c])=><span key={l} style={{display:'flex',alignItems:'center',gap:3,fontSize:9,color:T.textMuted}}><span style={{width:6,height:6,borderRadius:'50%',background:c}}/>{l}</span>)}<span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>bubble size = optimal sizing</span></div>} style={{marginBottom:14}}><div style={{padding:'8px 12px'}}>
          <D3BubblePack data={hotOpps} width={710} height={340} />
        </div></Card>

        {/* Priority-ranked opportunities with drill-down */}
        {hotOpps.filter(o=>(getFilter('radar','type','All')==='All'||o.type===getFilter('radar','type','All'))&&(getFilter('radar','signal','All')==='All'||o.signal===getFilter('radar','signal','All'))).sort((a,b)=>b.score-a.score).map((opp,oi)=>(<Card key={oi} title={`${opp.name}`} style={{marginBottom:10,borderLeft:opp.signal==='STRONG BUY'?`3px solid ${T.accent}`:opp.signal==='BUY'?`3px solid ${T.green}`:`3px solid ${T.blue}`,cursor:'pointer'}} action={<div style={{display:'flex',gap:4,alignItems:'center'}}><Badge color={opp.type==='Secondary'?T.amber:opp.type==='Co-Invest'?T.green:T.blue}>{opp.type}</Badge><Badge color={actionC[opp.signal]}>{opp.signal}</Badge><span style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.accent}}>{opp.score}</span></div>}>
          <div style={{padding:'12px 16px'}} onClick={()=>setDrillDown({
            title:opp.name,subtitle:`${opp.type} · Score: ${opp.score}/100`,
            badges:[{l:opp.signal,c:actionC[opp.signal]},{l:opp.type,c:opp.type==='Secondary'?T.amber:T.green}],
            kpis:[{l:'Base IRR',v:`${opp.irr_base}%`,c:T.accent},{l:'Bull IRR',v:`${opp.irr_bull}%`,c:T.green},{l:'Bear IRR',v:`${opp.irr_bear}%`,c:opp.irr_bear<0?T.red:T.amber},{l:'Optimal Size',v:`$${opp.sizing.optimal}M`,c:T.blue}],
            sections:[
              {title:'Investment Thesis',type:'text',content:opp.thesis},
              {title:'Conviction Breakdown',type:'bars',items:Object.entries(opp.conviction).filter(([k])=>k!=='composite').map(([k,v])=>({l:k,v:v+'/100',pct:v,c:v>=90?T.accent:v>=80?T.green:T.blue}))},
              {title:'Key Metrics',type:'table',rows:[
                {l:'Current Pricing',v:opp.current?`${opp.current.disc||opp.current.ask||'—'}`:'-',mono:true,c:T.accent},
                {l:'Kelly Full Size',v:`$${opp.sizing.kelly}M`,mono:true,c:T.purple},
                {l:'IC Vote',v:`${opp.ic_vote.for.length} FOR / ${opp.ic_vote.against.length} AGAINST`,c:T.green},
                {l:'Deadline',v:opp.timeline.split('.')[0],c:T.red},
              ]},
              {title:'Catalysts',type:'text',content:opp.catalyst.join(' → ')},
              {title:'Risks',type:'text',content:opp.risk.join(' · ')},
              {title:'Actions',type:'actions',items:[
                {icon:'📋',label:'Generate IC Memo',desc:'Auto-draft investment committee memo for this deal',view:'icmemo'},
                {icon:'📐',label:'Run Position Sizing',desc:'Kelly-optimal sizing with portfolio constraints',view:'sizing'},
                {icon:'📊',label:'Monte Carlo Analysis',desc:'Run 10,000 simulations on this position',view:'montecarlo'},
                {icon:'⚔️',label:'Open War Room',desc:'Create execution checklist and deal tracker',view:'warroom'},
              ]},
            ]
          })}>
            <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:16,marginBottom:12}}>
              <div>
                <div style={{fontSize:12,color:T.text,lineHeight:1.5,marginBottom:10}}>{opp.thesis}</div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
                  <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>CATALYSTS</div>{opp.catalyst.map((c,i)=><div key={i} style={{fontSize:10,color:T.green,padding:'2px 0 2px 8px',borderLeft:`2px solid ${T.green}40`,marginBottom:2}}>{c}</div>)}</div>
                  <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>RISKS</div>{opp.risk.map((r,i)=><div key={i} style={{fontSize:10,color:T.red,padding:'2px 0 2px 8px',borderLeft:`2px solid ${T.red}40`,marginBottom:2}}>{r}</div>)}</div>
                </div>
              </div>
              <div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6,marginBottom:8}}>
                  {[{l:'BASE IRR',v:`${opp.irr_base}%`,c:T.accent},{l:'BULL IRR',v:`${opp.irr_bull}%`,c:T.green},{l:'BEAR IRR',v:`${opp.irr_bear}%`,c:opp.irr_bear<0?T.red:T.amber},{l:'OPTIMAL SIZE',v:`$${opp.sizing.optimal}M`,c:T.blue},{l:'KELLY SIZE',v:`$${opp.sizing.kelly}M`,c:T.purple},{l:'URGENCY',v:opp.urgency,c:T.red}].map((m,i)=><div key={i} style={{background:T.bgAccent,borderRadius:4,padding:'6px 8px',textAlign:'center'}}><div style={{fontSize:7,color:T.textDim}}>{m.l}</div><div style={{fontSize:13,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div></div>)}
                </div>
                <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>CONVICTION BREAKDOWN</div>
                {Object.entries(opp.conviction).filter(([k])=>k!=='composite').map(([k,v],i)=><div key={i} style={{display:'flex',alignItems:'center',gap:6,marginBottom:3}}><span style={{fontSize:9,color:T.textMuted,width:50}}>{k}</span><Bar value={v} max={100} color={v>=90?T.accent:v>=80?T.green:v>=70?T.blue:T.amber} h={5}/><span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:v>=90?T.accent:v>=80?T.green:T.blue}}>{v}</span></div>)}
              </div>
            </div>
            <div style={{display:'flex',gap:8,alignItems:'center',padding:'8px 12px',background:opp.signal==='STRONG BUY'?T.accentBg:T.bgAccent,borderRadius:6,border:`1px solid ${actionC[opp.signal]}40`}}>
              <div style={{flex:1}}><div style={{fontSize:8,color:T.textDim}}>ACTION</div><div style={{fontSize:12,fontWeight:700,color:actionC[opp.signal],fontFamily:mono}}>{opp.sizing.action} — ${opp.sizing.optimal}M</div></div>
              <div style={{flex:1}}><div style={{fontSize:8,color:T.textDim}}>IC VOTE</div><div style={{fontSize:11,color:T.text}}><span style={{color:T.green,fontWeight:700}}>{opp.ic_vote.for.length} FOR</span>{opp.ic_vote.against.length>0&&<span style={{color:T.red,fontWeight:700,marginLeft:8}}>{opp.ic_vote.against.length} AGAINST</span>}{opp.ic_vote.abstain.length>0&&<span style={{color:T.textMuted,marginLeft:8}}>{opp.ic_vote.abstain.length} ABSTAIN</span>}</div></div>
              <div style={{flex:1}}><div style={{fontSize:8,color:T.textDim}}>DEADLINE</div><div style={{fontSize:11,fontWeight:600,color:T.red,fontFamily:mono}}>{opp.timeline.split('.')[0]}</div></div>
            </div>
          </div>
        </Card>))}
        <VCFunnelAnalyzer />
        </>)}

        {/* ── COMPARE MODE — Side-by-side deal analysis matrix ── */}
        {getMode('radar','pipeline')==='compare'&&(
        <Card title="⚖️ Deal Comparison Matrix — Side by Side Analysis" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr><TH>Metric</TH>{hotOpps.sort((a,b)=>b.score-a.score).map(o=><TH key={o.id}><div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'center'}}><Badge color={actionC[o.signal]}>{o.signal}</Badge><span style={{fontWeight:700}}>{o.name.split(' ').slice(0,2).join(' ')}</span></div></TH>)}</tr></thead>
            <tbody>{[
              {l:'Type',f:o=>o.type,format:'badge'},
              {l:'Conviction Score',f:o=>o.score,format:'score'},
              {l:'Base IRR',f:o=>`${o.irr_base}%`,format:'pct'},
              {l:'Bull IRR',f:o=>`${o.irr_bull}%`,format:'pct'},
              {l:'Bear IRR',f:o=>`${o.irr_bear}%`,format:'pct'},
              {l:'IRR Spread (Bull-Bear)',f:o=>`${o.irr_bull-o.irr_bear}%`,format:'spread'},
              {l:'Optimal Size',f:o=>`$${o.sizing.optimal}M`,format:'money'},
              {l:'Kelly Full Size',f:o=>`$${o.sizing.kelly}M`,format:'money'},
              {l:'Kelly Utilization',f:o=>`${Math.round(o.sizing.optimal/o.sizing.kelly*100)}%`,format:'pct'},
              {l:'IC Vote',f:o=>`${o.ic_vote.for.length}F/${o.ic_vote.against.length}A`,format:'vote'},
              {l:'GP Quality',f:o=>o.conviction.gp,format:'bar'},
              {l:'Market Timing',f:o=>o.conviction.market,format:'bar'},
              {l:'Edge / Alpha',f:o=>o.conviction.edge,format:'bar'},
              {l:'Liquidity',f:o=>o.conviction.liquidity,format:'bar'},
              {l:'Urgency',f:o=>o.urgency,format:'text'},
            ].map((metric,mi)=>(<TR key={mi}>
              <TD bold color={T.textDim}>{metric.l}</TD>
              {hotOpps.sort((a,b)=>b.score-a.score).map(o=>{
                const val=metric.f(o);
                return(<TD key={o.id} mono={metric.format!=='badge'&&metric.format!=='text'} bold={metric.format==='score'}>
                  {metric.format==='badge'?<Badge color={o.type==='Secondary'?T.amber:o.type==='Co-Invest'?T.green:T.blue}>{val}</Badge>
                  :metric.format==='score'?<span style={{fontSize:18,fontWeight:900,color:val>=90?T.accent:val>=80?T.green:T.blue}}>{val}</span>
                  :metric.format==='bar'?<div style={{display:'flex',alignItems:'center',gap:4}}><Bar value={val} max={100} color={val>=90?T.accent:val>=80?T.green:val>=70?T.blue:T.amber} h={5}/><span style={{fontSize:9,fontWeight:700,color:val>=90?T.accent:T.text}}>{val}</span></div>
                  :metric.format==='vote'?<span style={{color:val.startsWith('3')||val.startsWith('4')?T.green:T.amber}}>{val}</span>
                  :metric.format==='pct'?<span style={{color:typeof val==='string'&&val.includes('-')?T.red:T.green}}>{val}</span>
                  :<span>{val}</span>}
                </TD>);
              })}
            </TR>))}</tbody>
          </table></div>
          <div style={{padding:'12px 16px',borderTop:`1px solid ${T.border}`}}>
            <div style={{fontSize:10,fontWeight:700,color:T.textDim,marginBottom:6}}>RECOMMENDED PRIORITY ORDER</div>
            <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
              {hotOpps.sort((a,b)=>b.score-a.score).map((o,i)=>(
                <div key={o.id} style={{display:'flex',alignItems:'center',gap:6,padding:'6px 12px',background:i===0?T.accent+'12':T.bgAccent,borderRadius:6,border:`1px solid ${i===0?T.accent+'40':T.border}`}}>
                  <span style={{fontSize:16,fontWeight:900,fontFamily:mono,color:i===0?T.accent:T.textDim}}>{i+1}</span>
                  <div>
                    <div style={{fontSize:11,fontWeight:600,color:T.text}}>{o.name.split(' ').slice(0,2).join(' ')}</div>
                    <div style={{fontSize:9,color:T.textMuted}}>${o.sizing.optimal}M · {o.irr_base}% IRR · {o.urgency}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </Card>
        )}

        {/* ── CALCULATOR MODE — Deal pricing & return modeling ── */}
        {getMode('radar','pipeline')==='calculator'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12}}>
          <Card title="🧮 Secondary Pricing Calculator" style={{borderTop:`3px solid ${T.amber}`}}>
            <div style={{padding:'16px 18px'}}>
              <CalcInput label="Entry Price" k="secBid" unit="¢/$" min={1} max={200} step={1}/>
              <CalcInput label="Hold Period" k="secHoldYears" unit="yr" min={0.5} max={10} step={0.5}/>
              <CalcInput label="Expected NAV" k="secNav" unit="¢/$" min={50} max={200} step={5}/>
              <div style={{marginTop:16,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.amber}30`,textAlign:'center'}}>
                <div style={{fontSize:9,color:T.textDim,marginBottom:4}}>IMPLIED IRR (to NAV)</div>
                <div style={{fontSize:36,fontWeight:900,fontFamily:mono,color:calcSecondaryReturn>25?T.accent:calcSecondaryReturn>15?T.green:calcSecondaryReturn>0?T.blue:T.red}}>
                  {calcSecondaryReturn.toFixed(1)}%
                </div>
                <div style={{fontSize:10,color:T.textMuted,marginTop:4}}>
                  Entry at {calcInputs.secBid}¢ → {calcInputs.secNav}¢ over {calcInputs.secHoldYears}yr = {((calcInputs.secNav/calcInputs.secBid-1)*100).toFixed(1)}% MOIC
                </div>
              </div>
              <div style={{marginTop:12}}>
                <div style={{fontSize:9,color:T.textDim,fontWeight:700,marginBottom:6}}>ENTRY PRICE SENSITIVITY</div>
                {[50,60,70,80,90,100].map(bid=>{
                  const irr=(((calcInputs.secNav/bid)**(1/calcInputs.secHoldYears))-1)*100;
                  const moic=calcInputs.secNav/bid;
                  return(<div key={bid} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:`1px solid ${T.border}`,fontSize:10,background:bid===calcInputs.secBid?T.accent+'08':'transparent'}}>
                    <span style={{fontFamily:mono,color:bid===calcInputs.secBid?T.accent:T.textDim,fontWeight:bid===calcInputs.secBid?700:400}}>{bid}¢</span>
                    <span style={{fontFamily:mono,color:T.text}}>{moic.toFixed(2)}x MOIC</span>
                    <span style={{fontFamily:mono,fontWeight:700,color:irr>25?T.accent:irr>15?T.green:irr>0?T.blue:T.red}}>{irr.toFixed(1)}% IRR</span>
                  </div>);
                })}
              </div>
            </div>
          </Card>
          <Card title="📐 Kelly Position Sizer" style={{borderTop:`3px solid ${T.purple}`}}>
            <div style={{padding:'16px 18px'}}>
              <CalcInput label="Win Prob" k="kellyOdds" unit="" min={0.01} max={0.99} step={0.01} w={60}/>
              <CalcInput label="Edge (Win %" k="kellyEdge" unit="x" min={0.01} max={5} step={0.01} w={60}/>
              <div style={{marginTop:16,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.purple}30`,textAlign:'center'}}>
                <div style={{fontSize:9,color:T.textDim,marginBottom:4}}>KELLY OPTIMAL % OF PORTFOLIO</div>
                <div style={{fontSize:36,fontWeight:900,fontFamily:mono,color:calcKellyPct>30?T.red:calcKellyPct>15?T.accent:T.green}}>
                  {calcKellyPct.toFixed(1)}%
                </div>
                <div style={{fontSize:10,color:T.textMuted,marginTop:4}}>
                  Full Kelly: {calcKellyPct.toFixed(1)}% · Half Kelly: {(calcKellyPct/2).toFixed(1)}% · Quarter Kelly: {(calcKellyPct/4).toFixed(1)}%
                </div>
              </div>
              <div style={{marginTop:12,padding:10,background:calcKellyPct>25?T.red+'10':T.green+'08',borderRadius:6,border:`1px solid ${calcKellyPct>25?T.red:T.green}30`}}>
                <div style={{fontSize:10,fontWeight:700,color:calcKellyPct>25?T.red:T.green}}>
                  {calcKellyPct>25?'⚠ HIGH CONCENTRATION':'✓ REASONABLE SIZE'} — {calcKellyPct>25?'Consider half-Kelly':'Full Kelly acceptable'}
                </div>
                <div style={{fontSize:9,color:T.textMuted,marginTop:3}}>
                  At NAV $194M: Full = ${(calcKellyPct/100*194).toFixed(1)}M, Half = ${(calcKellyPct/200*194).toFixed(1)}M
                </div>
              </div>
              <div style={{marginTop:12}}>
                <div style={{fontSize:9,color:T.textDim,fontWeight:700,marginBottom:6}}>KELLY BY CONVICTION LEVEL</div>
                {[{label:'High Conviction',p:.75,e:1.5},{label:'Medium',p:.60,e:.8},{label:'Speculative',p:.50,e:.5},{label:'Low Edge',p:.55,e:.3}].map(s=>{
                  const k=Math.max(0,((s.p*(1+s.e)-(1-s.p))/s.e)*100);
                  return(<div key={s.label} style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
                    <span style={{fontSize:9,color:T.textDim,width:90}}>{s.label}</span>
                    <Bar value={k} max={60} color={k>25?T.red:k>15?T.accent:T.green} h={5}/>
                    <span style={{fontSize:9,fontFamily:mono,fontWeight:700,color:T.accent,width:40,textAlign:'right'}}>{k.toFixed(0)}%</span>
                  </div>);
                })}
              </div>
            </div>
          </Card>
          <Card title="🎯 Co-Invest Return Model" style={{borderTop:`3px solid ${T.green}`}}>
            <div style={{padding:'16px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:8}}>Model co-invest returns at various entry/exit valuations</div>
              <CalcInput label="Entry Val" k="secBid" unit="$B" min={1} max={200} step={1}/>
              <CalcInput label="Exit Val" k="secNav" unit="$B" min={1} max={500} step={5}/>
              <CalcInput label="Hold Period" k="secHoldYears" unit="yr" min={0.5} max={10} step={0.5}/>
              <div style={{marginTop:16}}>
                <div style={{fontSize:9,color:T.textDim,fontWeight:700,marginBottom:6}}>SCENARIO TABLE</div>
                <table style={{width:'100%',borderCollapse:'collapse'}}>
                  <thead><tr>{['Exit Val','MOIC','IRR','$5M→','Rating'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
                  <tbody>{[0.5,1.0,1.5,2.0,3.0,5.0].map(mult=>{
                    const exitVal=calcInputs.secBid*mult;
                    const irr=((mult**(1/calcInputs.secHoldYears))-1)*100;
                    const fiveMReturn=5*mult;
                    const rating=irr>40?'STRONG BUY':irr>25?'BUY':irr>10?'HOLD':'PASS';
                    return(<TR key={mult}>
                      <TD mono>${exitVal.toFixed(0)}B</TD>
                      <TD mono bold color={mult>2?T.accent:mult>1?T.green:T.red}>{mult.toFixed(1)}x</TD>
                      <TD mono bold color={irr>40?T.accent:irr>25?T.green:irr>0?T.blue:T.red}>{irr.toFixed(0)}%</TD>
                      <TD mono color={T.green}>${fiveMReturn.toFixed(1)}M</TD>
                      <TD><Badge color={rating==='STRONG BUY'?T.accent:rating==='BUY'?T.green:rating==='HOLD'?T.blue:T.red}>{rating}</Badge></TD>
                    </TR>);
                  })}</tbody>
                </table>
              </div>
            </div>
          </Card>
        </div>
        )}
      </div>)}

      {/* ═══ TAB 2: POSITION ARCHITECT ═══ */}
      {aView==='sizing'&&(<div>
        {/* ── MODE TOGGLE ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['allocation','rebalancer','constraints'].map(m=>(
              <FilterPill key={m} label={m==='allocation'?'📊 Allocation':m==='rebalancer'?'🔄 Rebalancer':'⚙️ Constraints'} active={getMode('sizing','allocation')===m} onClick={()=>setMode('sizing',m)}/>
            ))}
          </div>
          <div style={{display:'flex',gap:4}}>
            {['All','UPSIZE','TRIM','DOWNSIZE','RIGHT-SIZED'].map(f=>(
              <FilterPill key={f} label={f==='All'?'All Actions':f} active={getFilter('sizing','action','All')===f} onClick={()=>setFilter('sizing','action',f)}/>
            ))}
          </div>
        </div>

        {/* ── ALLOCATION MODE (default) ── */}
        {getMode('sizing','allocation')==='allocation'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Total NAV" value={`$${positions.reduce((s,p)=>s+p.nav,0).toFixed(1)}M`} icon={Layers} sub="across 8 funds" color={T.accent}/>
          <Stat label="Upsize" value={positions.filter(p=>p.action==='UPSIZE').length} icon={ArrowUpRight} sub="increase exposure" color={T.green}/>
          <Stat label="Downsize" value={positions.filter(p=>p.action.includes('DOWNSIZE')||p.action==='TRIM').length} icon={ArrowDownRight} sub="reduce exposure" color={T.red}/>
          <Stat label="Rebalance Capital" value={`$${Math.abs(positions.filter(p=>p.delta.startsWith('-')).reduce((s,p)=>s+parseFloat(p.delta.replace(/[^0-9.-]/g,'')),0)).toFixed(1)}M`} icon={RefreshCw} sub="to redeploy" color={T.amber}/>
        </div>
        <Card title="Portfolio NAV Treemap — Interactive Allocation View" action={<div style={{display:'flex',gap:8}}>{[['Core',T.accent],['Strategic',T.blue],['Exploration',T.amber]].map(([l,c])=><span key={l} style={{display:'flex',alignItems:'center',gap:3,fontSize:9,color:T.textMuted}}><span style={{width:6,height:6,borderRadius:3,background:c}}/>{l}</span>)}</div>} style={{marginBottom:14}}><div style={{padding:'8px'}}>
          <D3Treemap data={FUNDS} width={710} height={280} />
        </div></Card>
        <Card title="Current vs Optimal Allocation — Kelly Criterion" style={{marginBottom:14}}><div style={{padding:'16px',display:'grid',gridTemplateColumns:'1fr 1fr 2fr',gap:16}}>
          <div style={{textAlign:'center'}}><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:8}}>CURRENT ALLOCATION</div><DonutChart size={160} thickness={20} label="$194M" sublabel="total NAV" segments={positions.map(p=>({value:p.nav,label:p.fund.split(' ').slice(0,2).join(' '),color:p.action==='UPSIZE'?T.green:p.action.includes('DOWN')||p.action==='TRIM'?T.red:T.blue}))}/></div>
          <div style={{textAlign:'center'}}><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:8}}>KELLY OPTIMAL</div><DonutChart size={160} thickness={20} label="$194M" sublabel="rebalanced" segments={positions.map(p=>({value:p.optimal*194/100,label:p.fund.split(' ').slice(0,2).join(' '),color:T.accent}))}/></div>
          <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:8}}>REBALANCING ACTIONS</div>{positions.sort((a,b)=>{const ord={'UPSIZE':0,'DOWNSIZE':1,'DOWNSIZE (GRADUAL)':2,'TRIM':3,'HOLD':4,'RIGHT-SIZED':5,'RE-UP AT SAME SIZE':6};return (ord[a.action]||9)-(ord[b.action]||9);}).filter(p=>getFilter('sizing','action','All')==='All'||p.action.includes(getFilter('sizing','action','All'))).map((p,i)=>(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'5px 8px',marginBottom:3,background:T.bgAccent,borderRadius:4,borderLeft:`3px solid ${actionC[p.action]||T.textMuted}`,cursor:'pointer'}} onClick={()=>setDrillDown({
            title:p.fund,subtitle:`${p.gp} · ${p.action}`,
            badges:[{l:p.action,c:actionC[p.action]},{l:`${p.pctPort}% of portfolio`,c:T.accent}],
            kpis:[{l:'NAV',v:`$${p.nav}M`,c:T.accent},{l:'TVPI',v:`${p.tvpi}x`,c:T.green},{l:'IRR',v:`${p.irr}%`,c:T.blue},{l:'Kelly',v:`$${p.kelly}M`,c:T.purple}],
            sections:[
              {title:'Position Details',type:'table',rows:[
                {l:'Current Allocation',v:`${p.pctPort}%`,mono:true,c:T.accent},
                {l:'Optimal Allocation',v:`${p.optimal}%`,mono:true,c:T.green},
                {l:'Delta',v:p.delta,mono:true,c:p.delta.includes('-')?T.red:T.green},
                {l:'Liquidity Score',v:p.liquidityScore,mono:true},
                {l:'Rationale',v:p.reason},
              ]},
              {title:'Signals',type:'text',content:p.signals.join(' · ')},
              {title:'Actions',type:'actions',items:[
                {icon:'📋',label:'Generate IC Memo',view:'icmemo',desc:'Create committee memo for rebalancing decision'},
                {icon:'🎯',label:'View Opportunities',view:'radar',desc:'Find replacement exposure for trimmed positions'},
              ]}
            ]
          })}><div style={{width:110,fontSize:11,fontWeight:600,color:T.text}}>{p.fund.split(' ').slice(0,2).join(' ')}</div><Badge color={actionC[p.action]}>{p.action}</Badge><div style={{flex:1,fontSize:10,fontFamily:mono,color:p.delta.includes('-')?T.red:p.delta.includes('+')?T.green:T.blue,fontWeight:700,textAlign:'right'}}>{p.delta}</div></div>))}</div>
        </div></Card>
        {/* Detailed Position Cards with drill-down */}
        {positions.filter(p=>getFilter('sizing','action','All')==='All'||p.action.includes(getFilter('sizing','action','All'))).map((p,pi)=>(<div key={pi} style={{background:T.bgCard,border:`1px solid ${p.urgency==='high'?T.red+'40':T.border}`,borderRadius:8,padding:'12px 16px',marginBottom:8,borderLeft:`3px solid ${actionC[p.action]||T.blue}`}}>
          <div style={{display:'grid',gridTemplateColumns:'1.5fr repeat(7,1fr) 1.5fr',gap:6,alignItems:'center'}}>
            <div><div style={{fontSize:13,fontWeight:700,color:T.text}}>{p.fund}</div><div style={{fontSize:10,color:T.textMuted}}>{p.gp}</div></div>
            {[{l:'NAV',v:`$${p.nav}M`,c:T.accent},{l:'TVPI',v:`${p.tvpi}x`,c:T.green},{l:'IRR',v:`${p.irr}%`,c:T.blue},{l:'% PORT',v:`${p.pctPort}%`,c:p.pctPort>15?T.red:T.text},{l:'OPTIMAL',v:`${p.optimal}%`,c:T.purple},{l:'KELLY',v:`$${p.kelly}M`,c:T.purple},{l:'LIQ SCORE',v:p.liquidityScore,c:p.liquidityScore>50?T.green:T.amber}].map((m,i)=><div key={i} style={{textAlign:'center'}}><div style={{fontSize:7,color:T.textDim}}>{m.l}</div><div style={{fontSize:12,fontWeight:700,fontFamily:mono,color:m.c}}>{m.v}</div></div>)}
            <div style={{textAlign:'right'}}><Badge color={actionC[p.action]}>{p.action}</Badge><div style={{fontSize:14,fontWeight:800,fontFamily:mono,color:p.delta.includes('-')?T.red:p.delta.includes('+')?T.green:T.blue,marginTop:2}}>{p.delta}</div></div>
          </div>
          <div style={{fontSize:11,color:T.textMuted,marginTop:6,paddingTop:6,borderTop:`1px solid ${T.border}`}}><span style={{fontWeight:600,color:T.text}}>Rationale:</span> {p.reason}</div>
          <div style={{display:'flex',gap:4,marginTop:4}}>{p.signals.map((s,i)=><Badge key={i} color={T.bgAccent}>{s}</Badge>)}</div>
        </div>))}
        <Card title="Rebalancing Impact Summary"><div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:8,padding:'12px 16px'}}>
          {[{l:'Capital to Redeploy',v:'$43.5M',d:'From downsizing NEA, a16z, Greylock, Sequoia',c:T.amber},{l:'New Deployments',v:'$28.1M',d:'Tiger PIP, Anthropic, Saronic, Founders Fund VI, Sequoia GGF',c:T.green},{l:'Net Cash Need',v:'-$15.4M',d:'Net redeployment surplus — add to dry powder',c:T.accent},{l:'Est. IRR Uplift',v:'+3.2%',d:'Portfolio IRR 22.4% → 25.6% post-rebalance',c:T.green},{l:'Sharpe Improvement',v:'+0.3x',d:'Risk-adjusted return 1.8x → 2.1x Sharpe',c:T.purple}].map((m,i)=><div key={i} style={{background:T.bgAccent,borderRadius:6,padding:10,textAlign:'center',borderTop:`3px solid ${m.c}`}}><div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{m.l}</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div><div style={{fontSize:9,color:T.textMuted,marginTop:2}}>{m.d}</div></div>)}
        </div></Card>
        </>)}

        {/* ── REBALANCER MODE — Live drag-to-rebalance simulator ── */}
        {getMode('sizing','allocation')==='rebalancer'&&(
        <div>
          <Card title="🔄 Live Rebalancing Simulator — Adjust Targets & See Impact" style={{marginBottom:14}}>
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:12}}>Drag sliders to adjust target allocation. Impact updates in real-time.</div>
              {positions.map((p,pi)=>{
                const targetKey=`rebal_${pi}`;
                const target=sc[targetKey]!==undefined?sc[targetKey]:p.optimal;
                const delta=target-p.pctPort;
                const deltaM=(delta/100*194).toFixed(1);
                return(<div key={pi} style={{display:'grid',gridTemplateColumns:'140px 1fr 100px 80px',gap:12,alignItems:'center',padding:'8px 0',borderBottom:`1px solid ${T.border}`}}>
                  <div>
                    <div style={{fontSize:11,fontWeight:600,color:T.text}}>{p.fund.split(' ').slice(0,2).join(' ')}</div>
                    <div style={{fontSize:9,color:T.textDim}}>Current: {p.pctPort}% · IRR: {p.irr}%</div>
                  </div>
                  <div>
                    <input type="range" min={0} max={30} step={0.5} value={target}
                      onChange={e=>setSlider(targetKey,e.target.value)}
                      style={{width:'100%',height:6,appearance:'none',background:`linear-gradient(90deg, ${T.accent} ${(target/30)*100}%, ${T.bgAccent} ${(target/30)*100}%)`,borderRadius:3,outline:'none',cursor:'pointer'}}/>
                    <div style={{display:'flex',justifyContent:'space-between',fontSize:8,color:T.textDim,marginTop:1}}>
                      <span>0%</span>
                      <span style={{color:T.accent,fontWeight:700}}>Target: {target}%</span>
                      <span>30%</span>
                    </div>
                  </div>
                  <div style={{textAlign:'center'}}>
                    <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:delta>0?T.green:delta<0?T.red:T.textDim}}>{delta>0?'+':''}{delta.toFixed(1)}%</span>
                    <div style={{fontSize:8,color:T.textDim}}>{delta>0?'+':''}${deltaM}M</div>
                  </div>
                  <Badge color={Math.abs(delta)<1?T.green:delta>0?T.blue:T.amber}>{Math.abs(delta)<1?'ON TARGET':delta>0?'ADD':'REDUCE'}</Badge>
                </div>);
              })}
              <div style={{marginTop:14,padding:12,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.accent}30`}}>
                <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
                  {(()=>{
                    const totalTarget=positions.reduce((s,p,i)=>{const tk=`rebal_${i}`;return s+(sc[tk]!==undefined?sc[tk]:p.optimal);},0);
                    const netDelta=positions.reduce((s,p,i)=>{const tk=`rebal_${i}`;const t=sc[tk]!==undefined?sc[tk]:p.optimal;return s+(t-p.pctPort);},0);
                    const sells=positions.reduce((s,p,i)=>{const tk=`rebal_${i}`;const t=sc[tk]!==undefined?sc[tk]:p.optimal;const d=t-p.pctPort;return s+(d<0?Math.abs(d)/100*194:0);},0);
                    const buys=positions.reduce((s,p,i)=>{const tk=`rebal_${i}`;const t=sc[tk]!==undefined?sc[tk]:p.optimal;const d=t-p.pctPort;return s+(d>0?d/100*194:0);},0);
                    return [
                      {l:'Total Target',v:`${totalTarget.toFixed(1)}%`,c:Math.abs(totalTarget-100)<2?T.green:T.red},
                      {l:'Net Rebalance',v:`${netDelta>0?'+':''}${netDelta.toFixed(1)}%`,c:netDelta>0?T.green:T.red},
                      {l:'Total Sells',v:`$${sells.toFixed(1)}M`,c:T.red},
                      {l:'Total Buys',v:`$${buys.toFixed(1)}M`,c:T.green},
                    ].map((m,i)=>(<div key={i} style={{textAlign:'center'}}>
                      <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{m.l}</div>
                      <div style={{fontSize:18,fontWeight:900,fontFamily:mono,color:m.c}}>{m.v}</div>
                    </div>));
                  })()}
                </div>
              </div>
            </div>
          </Card>
        </div>
        )}

        {/* ── CONSTRAINTS MODE — Portfolio construction rules ── */}
        {getMode('sizing','allocation')==='constraints'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="⚙️ Active Portfolio Constraints" style={{borderTop:`3px solid ${T.accent}`}}>
            <div style={{padding:'14px 18px'}}>
              {[
                {rule:'Single Fund Max',limit:'20%',current:'22.4%',fund:'Founders Fund VII',status:'BREACH',impact:'Must trim $4.7M to comply',c:T.red},
                {rule:'Single GP Max',limit:'30%',current:'22.4%',fund:'Founders Fund',status:'OK',impact:'Well within limit',c:T.green},
                {rule:'Sector Max (AI/ML)',limit:'40%',current:'38.2%',fund:'AI/ML aggregate',status:'NEAR LIMIT',impact:'$3.5M headroom remaining',c:T.amber},
                {rule:'Vintage Concentration',limit:'35% per vintage',current:'28.4%',fund:'2022 vintage',status:'OK',impact:'Diversified across vintages',c:T.green},
                {rule:'Liquidity Reserve',limit:'≥10% cash',current:'16.2%',fund:'Cash & equivalents',status:'OK',impact:'$31.4M available',c:T.green},
                {rule:'Emerging Manager Min',limit:'≥15%',current:'12.4%',fund:'New GPs',status:'BELOW TARGET',impact:'Need $5M more emerging exposure',c:T.amber},
                {rule:'Co-Invest Max',limit:'25%',current:'8.2%',fund:'Direct co-invests',status:'OK',impact:'Significant co-invest capacity',c:T.green},
                {rule:'Single Company Max',limit:'5% (look-through)',current:'4.8%',fund:'Anthropic',status:'NEAR LIMIT',impact:'No more Anthropic direct exposure',c:T.amber},
              ].map((con,i)=>(<div key={i} style={{padding:'10px 0',borderBottom:i<7?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:3}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{con.rule}</span>
                  <Badge color={con.c}>{con.status}</Badge>
                </div>
                <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:2}}>
                  <Bar value={parseFloat(con.current)} max={parseFloat(con.limit)*1.5} color={con.c} h={5}/>
                  <span style={{fontSize:10,fontFamily:mono,color:con.c,fontWeight:700}}>{con.current}</span>
                  <span style={{fontSize:9,color:T.textDim}}>/ {con.limit}</span>
                </div>
                <div style={{fontSize:9,color:T.textMuted}}>{con.fund} · {con.impact}</div>
              </div>))}
            </div>
          </Card>
          <Card title="📐 Position Sizing Framework — Decision Tree" style={{borderTop:`3px solid ${T.purple}`}}>
            <div style={{padding:'14px 18px'}}>
              {[
                {step:1,q:'What is Kelly optimal?',formula:'K% = (p × b - q) / b',example:'75% win rate, 1.5x edge → 33% Kelly',note:'Full Kelly is theoretical maximum. Always use fractional.'},
                {step:2,q:'Apply risk adjustment?',formula:'Adj = Kelly × Conviction × (1 - Correlation)',example:'33% × 0.85 × 0.7 = 19.6% adjusted',note:'Reduce for correlation with existing holdings.'},
                {step:3,q:'Check hard constraints',formula:'Min(Adj, Single Fund Max, Sector Max, Liquidity)',example:'Min(19.6%, 20%, 40%, ∞) = 19.6%',note:'Constraints override optimization. Breach = mandatory trim.'},
                {step:4,q:'Apply half-Kelly?',formula:'Final = Adj × 0.5 (if uncertainty high)',example:'19.6% × 0.5 = 9.8% target allocation',note:'Half-Kelly for uncertain conviction. Full Kelly for high conviction.'},
                {step:5,q:'Calculate dollar amount',formula:'$ = Final% × Total NAV',example:'9.8% × $194M = $19.0M target',note:'Round to nearest $500K for operational simplicity.'},
                {step:6,q:'Compute rebalancing action',formula:'Delta = Target - Current',example:'$19.0M - $22.4M = -$3.4M (TRIM)',note:'Execute over 5-10 trading days to minimize market impact.'},
              ].map((s,i)=>(<div key={i} style={{padding:'10px 0',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:4}}>
                  <span style={{fontSize:14,fontWeight:900,fontFamily:mono,color:T.accent,width:20}}>{s.step}</span>
                  <span style={{fontSize:11,fontWeight:700,color:T.text}}>{s.q}</span>
                </div>
                <div style={{marginLeft:28}}>
                  <div style={{fontSize:10,fontFamily:mono,color:T.accent,padding:'4px 8px',background:T.bgAccent,borderRadius:4,display:'inline-block',marginBottom:3}}>{s.formula}</div>
                  <div style={{fontSize:10,color:T.green,fontStyle:'italic'}}>{s.example}</div>
                  <div style={{fontSize:9,color:T.textDim}}>{s.note}</div>
                </div>
              </div>))}
            </div>
          </Card>
        </div>
        )}
      </div>)}

      {/* ═══ TAB 3: EMERGING MANAGERS ═══ */}
      {aView==='emerging'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Emerging GPs" value={emergingMgrs.length} icon={Star} sub="tracked" color={T.accent}/>
          <Stat label="Spinouts" value={emergingMgrs.filter(m=>m.type==='Spinout').length} icon={GitBranch} sub="from top funds" color={T.green}/>
          <Stat label="Total Target" value={`$${(emergingMgrs.reduce((s,m)=>s+m.sizing,0))}M`} icon={DollarSign} sub="commitment pipeline" color={T.blue}/>
          <Stat label="Avg Score" value={Math.round(emergingMgrs.reduce((s,m)=>s+m.score,0)/emergingMgrs.length)} icon={Target} sub="quality" color={T.purple}/>
        </div>
        {emergingMgrs.sort((a,b)=>b.score-a.score).map((mgr,mi)=>(<Card key={mi} title={mgr.name} style={{marginBottom:10,borderLeft:`3px solid ${mgr.score>=90?T.accent:mgr.score>=85?T.green:T.blue}`}} action={<div style={{display:'flex',gap:4,alignItems:'center'}}><Badge color={mgr.type==='Spinout'?T.green:T.blue}>{mgr.type}</Badge><Badge color={T.bgAccent}>{mgr.status}</Badge><span style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.accent}}>{mgr.score}</span></div>}>
          <div style={{padding:'12px 16px'}}>
            <div style={{display:'flex',gap:6,marginBottom:8}}>
              <Badge color={T.purple}>{mgr.from}</Badge><span style={{fontSize:11,fontWeight:600,color:T.text}}>Led by {mgr.lead}</span><span style={{fontSize:11,color:T.textMuted}}>• {mgr.focus} • Target: ${mgr.target}M</span>
            </div>
            <div style={{display:'grid',gridTemplateColumns:'2fr 1fr 1fr',gap:16,marginBottom:12}}>
              <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>INVESTMENT THESIS</div><div style={{fontSize:11,color:T.text,lineHeight:1.5}}>{mgr.thesis}</div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginTop:8,marginBottom:4}}>COMPETITIVE EDGE</div><div style={{fontSize:11,color:T.accent,lineHeight:1.4}}>{mgr.edge}</div></div>
              <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>TRACK RECORD</div>{mgr.track.map((t,i)=><div key={i} style={{background:T.bgAccent,borderRadius:4,padding:'4px 8px',marginBottom:4}}><div style={{fontSize:11,fontWeight:600,color:T.text}}>{t.deal}</div><div style={{display:'flex',justifyContent:'space-between'}}><span style={{fontSize:9,color:T.textMuted}}>{t.entry}</span><span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.green}}>{t.now}</span></div>{t.mult&&<div style={{fontSize:9,fontFamily:mono,color:T.accent}}>{t.mult}</div>}</div>)}
                <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginTop:8,marginBottom:4}}>SIGNALS</div>{mgr.signals.map((s,i)=><div key={i} style={{fontSize:10,color:T.green,padding:'1px 0 1px 8px',borderLeft:`2px solid ${T.green}40`}}>{s}</div>)}</div>
              <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>KEY RISKS</div>{mgr.risk.map((r,i)=><div key={i} style={{fontSize:10,color:T.red,padding:'1px 0 1px 8px',borderLeft:`2px solid ${T.red}40`,marginBottom:2}}>{r}</div>)}
                <div style={{background:T.accentBg,borderRadius:6,padding:10,marginTop:12,border:`1px solid ${T.accent}30`}}><div style={{fontSize:8,color:T.textDim}}>RECOMMENDED COMMITMENT</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.accent}}>${mgr.sizing}M</div><div style={{fontSize:10,color:T.accent,marginTop:4}}>{mgr.rec}</div></div></div>
            </div>
          </div>
        </Card>))}
      </div>)}

      {/* ═══ TAB 4: COMP INTELLIGENCE ═══ */}
      {aView==='comps'&&(<div>
        {compSets.map((cs,ci)=>(<Card key={ci} title={cs.category} style={{marginBottom:14}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>{['Company','Round','Date','Raised','Valuation','Revenue','Multiple','Growth','Lead',cs.deals[0]?.disc!==undefined?'Discount':'',cs.deals[0]?.tvpi!==undefined?'TVPI':''].filter(Boolean).map(h=><TH key={h} align={['Raised','Valuation','Revenue','Multiple','Growth','Discount','TVPI','Nav','Prem/Disc'].includes(h)?'right':'left'}>{h}</TH>)}</tr></thead><tbody>
            {cs.deals.map((d,di)=>(<tr key={di} style={{borderBottom:`1px solid ${T.border}`}}>
              <TD style={{fontWeight:700}}>{d.co}</TD><TD>{d.round}</TD><TD style={{fontSize:10,color:T.textMuted}}>{d.date}</TD>
              <TD align="right" mono>{d.raised?`$${d.raised>=1000?(d.raised/1000).toFixed(1)+'B':d.raised+'M'}`:d.nav?`$${d.nav}M`:'—'}</TD>
              <TD align="right" mono bold color={T.accent}>${d.val>=1000?(d.val/1000).toFixed(0)+'B':d.val+'M'}</TD>
              <TD align="right" mono>{d.rev?`$${d.rev>=1000?(d.rev/1000).toFixed(1)+'B':d.rev+'M'}`:d.aum?`$${d.aum}M AUM`:'—'}</TD>
              <TD align="right" mono bold color={T.blue}>{d.mult?`${d.mult}x`:d.premDisc!==undefined?`${d.premDisc>0?'+':''}${d.premDisc}%`:'—'}</TD>
              <TD align="right" mono color={T.green}>{d.growth?`${d.growth}%`:d.disc!==undefined?`${d.disc}% disc`:'—'}</TD>
              <TD style={{fontSize:10,color:T.textMuted}}>{d.lead}</TD>
              {d.disc!==undefined&&<TD align="right" mono bold color={d.disc>25?T.green:d.disc>0?T.blue:T.red}>{d.disc}%</TD>}
              {d.tvpi!==undefined&&<TD align="right" mono bold color={d.tvpi>=1.5?T.accent:d.tvpi>=1?T.green:T.amber}>{d.tvpi}x</TD>}
            </tr>))}
            {cs.median&&<tr style={{background:T.bgAccent}}><TD style={{fontWeight:700,color:T.accent}} colSpan={2}>MEDIAN</TD><TD/><TD/><TD/><TD align="right" mono bold color={T.accent}>{cs.median.rev?`$${cs.median.rev}M`:cs.median.disc!==undefined?`${cs.median.disc}% disc`:cs.median.premDisc!==undefined?`${cs.median.premDisc}% P/D`:''}</TD><TD align="right" mono bold color={T.blue}>{cs.median.mult?`${cs.median.mult}x`:cs.median.tvpi?`${cs.median.tvpi}x TVPI`:cs.median.aum?`$${cs.median.aum}M`:''}</TD><TD align="right" mono color={T.green}>{cs.median.growth?`${cs.median.growth}%`:''}</TD><TD/>{cs.deals[0]?.disc!==undefined&&<TD/>}{cs.deals[0]?.tvpi!==undefined&&<TD/>}</tr>}
          </tbody></table>
          <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,fontSize:11,color:T.accent,lineHeight:1.4}}><strong style={{color:T.text}}>Insight:</strong> {cs.insight}</div>
        </Card>))}
      </div>)}

      {/* ═══ TAB 5: IC DECISION MATRIX ═══ */}
      {aView==='icmemo'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Open Decisions" value={icDecisions.length} icon={Zap} sub="pending IC vote" color={T.accent}/>
          <Stat label="Capital at Stake" value={`$${icDecisions.reduce((s,d)=>s+parseFloat(d.amount.replace(/[^0-9.]/g,'')),0).toFixed(1)}M`} icon={DollarSign} sub="total" color={T.green}/>
          <Stat label="Avg Score" value={Math.round(icDecisions.reduce((s,d)=>s+Object.values(d.scores).reduce((a,v)=>a+v,0)/Object.values(d.scores).length,0)/icDecisions.length)} icon={Target} sub="decision quality" color={T.blue}/>
          <Stat label="Next Deadline" value={icDecisions.sort((a,b)=>a.deadline.localeCompare(b.deadline))[0]?.deadline} icon={Clock} sub="action required" color={T.red}/>
        </div>
        {icDecisions.map((dec,di)=>(<Card key={di} title={`IC MEMO: ${dec.item}`} style={{marginBottom:14,borderLeft:`3px solid ${T.accent}`}} action={<div style={{display:'flex',gap:4}}><Badge color={T.red}>{dec.deadline}</Badge><Badge color={T.accent}>{dec.status}</Badge><Badge color={T.bgAccent}>{dec.amount}</Badge></div>}>
          <div style={{padding:'12px 16px'}}>
            {/* Score radar */}
            <div style={{display:'grid',gridTemplateColumns:'1fr 2fr',gap:16,marginBottom:14}}>
              <div><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:6}}>DECISION SCORES</div>{Object.entries(dec.scores).map(([k,v],i)=><div key={i} style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}><span style={{fontSize:9,color:T.textMuted,width:80,textTransform:'capitalize'}}>{k.replace(/([A-Z])/g,' $1').trim()}</span><Bar value={v} max={100} color={v>=90?T.accent:v>=80?T.green:v>=70?T.blue:v>=50?T.amber:T.red} h={6}/><span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:v>=90?T.accent:v>=80?T.green:T.blue}}>{v}</span></div>)}<div style={{marginTop:8,padding:'8px 10px',background:T.accentBg,borderRadius:6}}><div style={{fontSize:8,color:T.textDim}}>COMPOSITE</div><div style={{fontSize:22,fontWeight:800,fontFamily:mono,color:T.accent}}>{Math.round(Object.values(dec.scores).reduce((a,v)=>a+v,0)/Object.values(dec.scores).length)}</div></div></div>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                <div><div style={{fontSize:10,color:T.green,fontWeight:700,marginBottom:4}}>PRO (FOR)</div>{dec.proArgs.map((a,i)=><div key={i} style={{fontSize:10,color:T.text,padding:'3px 0 3px 8px',borderLeft:`2px solid ${T.green}`,marginBottom:3,lineHeight:1.3}}>{a}</div>)}</div>
                <div><div style={{fontSize:10,color:T.red,fontWeight:700,marginBottom:4}}>CON (AGAINST)</div>{dec.conArgs.map((a,i)=><div key={i} style={{fontSize:10,color:T.textMuted,padding:'3px 0 3px 8px',borderLeft:`2px solid ${T.red}`,marginBottom:3,lineHeight:1.3}}>{a}</div>)}</div>
              </div>
            </div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:12}}>
              <div style={{background:T.bgAccent,borderRadius:6,padding:10}}><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>RISK MITIGANTS</div>{dec.mitigants.map((m,i)=><div key={i} style={{fontSize:10,color:T.blue,padding:'2px 0 2px 8px',borderLeft:`2px solid ${T.blue}40`,marginBottom:2,lineHeight:1.3}}>{m}</div>)}</div>
              <div style={{background:T.bgAccent,borderRadius:6,padding:10}}><div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:4}}>PORTFOLIO IMPACT</div>{Object.entries(dec.portImpact).map(([k,v],i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'3px 0',borderBottom:i<Object.entries(dec.portImpact).length-1?`1px solid ${T.border}`:'none'}}><span style={{fontSize:9,color:T.textMuted,textTransform:'capitalize'}}>{k.replace(/([A-Z])/g,' $1')}</span><span style={{fontSize:10,fontFamily:mono,fontWeight:600,color:T.accent}}>{v}</span></div>)}</div>
            </div>
            {dec.comparable&&<div style={{padding:'6px 10px',background:`${T.purple}10`,borderRadius:4,marginBottom:10,borderLeft:`3px solid ${T.purple}`}}><span style={{fontSize:9,color:T.textDim,fontWeight:700}}>COMPARABLE PRECEDENT: </span><span style={{fontSize:10,color:T.text}}>{dec.comparable}</span></div>}
            <div style={{padding:'10px 14px',background:T.accentBg,borderRadius:6,border:`1px solid ${T.accent}40`}}><div style={{fontSize:8,color:T.textDim,marginBottom:2}}>IC RECOMMENDATION</div><div style={{fontSize:13,fontWeight:700,color:T.accent,fontFamily:mono}}>{dec.recommendation}</div></div>
          </div>
        </Card>))}
      </div>)}

      {/* ═══ TAB 6: LIQUIDITY & EXIT MAP ═══ */}
      {aView==='liquidity'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Exit Events" value={exitIntel.length} icon={ArrowUpRight} sub="tracked catalysts" color={T.accent}/>
          <Stat label="Total NAV at Risk" value={`$${exitIntel.reduce((s,e)=>s+parseFloat(e.navImpact.replace(/[^0-9.-]/g,'').split('-')[0]),0).toFixed(0)}M+`} icon={DollarSign} sub="catalyst-dependent" color={T.green}/>
          <Stat label="Avg Probability" value={`${Math.round(exitIntel.reduce((s,e)=>s+e.prob,0)/exitIntel.length)}%`} icon={Target} sub="weighted" color={T.blue}/>
          <Stat label="Next Exit" value="Q2 2026" icon={Clock} sub="Stripe / Databricks" color={T.amber}/>
        </div>
        <Card title="Exit Timeline — Probability-Weighted Liquidity Events" style={{marginBottom:14}}><div style={{padding:'12px 16px'}}>
          <svg width={710} height={280}>{(()=>{const evts=exitIntel.sort((a,b)=>a.prob-b.prob);const w=650;const pad=40;return(<g>
            <line x1={pad} y1={30} x2={pad} y2={250} stroke={T.border}/><line x1={pad} y1={250} x2={w+pad} y2={250} stroke={T.border}/>
            <text x={pad-8} y={140} fill={T.textDim} fontSize={9} textAnchor="middle" transform={`rotate(-90,${pad-8},140)`}>Probability %</text>
            {evts.map((e,i)=>{const x=pad+30+i*(w/(evts.length));const y=250-(e.prob/100)*200;const r=Math.max(8,parseFloat(e.navImpact.replace(/[^0-9]/g,'').slice(0,2))*1.2);const c=e.path==='IPO'?T.accent:e.path==='M&A'?T.purple:e.path==='Tender/IPO'?T.amber:T.green;return(<g key={i}><circle cx={x} cy={y} r={r} fill={c} opacity={.3} stroke={c} strokeWidth={1.5}/><text x={x} y={y-r-4} fill={c} fontSize={9} fontWeight={700} textAnchor="middle">{e.co}</text><text x={x} y={y+4} fill={T.text} fontSize={10} fontWeight={800} fontFamily={mono} textAnchor="middle">{e.prob}%</text><text x={x} y={264} fill={T.textDim} fontSize={7} textAnchor="middle">{e.timing}</text></g>);})}
            {[25,50,75,100].map(v=><g key={v}><line x1={pad} y1={250-v/100*200} x2={w+pad} y2={250-v/100*200} stroke={T.border} strokeDasharray="2,4" strokeWidth={.5}/><text x={pad-6} y={254-v/100*200} fill={T.textDim} fontSize={8} textAnchor="end">{v}%</text></g>)}
          </g>);})()}</svg>
        </div></Card>
        {exitIntel.sort((a,b)=>b.prob-a.prob).map((e,i)=>(<div key={i} style={{background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:8,padding:'10px 16px',marginBottom:6,borderLeft:`3px solid ${e.path==='IPO'?T.accent:e.path==='M&A'?T.purple:T.amber}`,display:'grid',gridTemplateColumns:'1.2fr 0.8fr 0.8fr 0.8fr 0.8fr 1.5fr',gap:8,alignItems:'center'}}>
          <div><div style={{fontSize:13,fontWeight:700,color:T.text}}>{e.co}</div><div style={{fontSize:10,color:T.textMuted}}>{e.fund} • {e.metrics.split(',')[0]}</div></div>
          <div style={{textAlign:'center'}}><Badge color={e.path==='IPO'?T.accent:e.path==='M&A'?T.purple:T.amber}>{e.path}</Badge></div>
          <div style={{textAlign:'center'}}><div style={{fontSize:7,color:T.textDim}}>TIMING</div><div style={{fontSize:12,fontWeight:700,fontFamily:mono,color:T.text}}>{e.timing}</div></div>
          <div style={{textAlign:'center'}}><div style={{fontSize:7,color:T.textDim}}>PROBABILITY</div><div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:e.prob>=75?T.green:e.prob>=60?T.blue:T.amber}}>{e.prob}%</div></div>
          <div style={{textAlign:'center'}}><div style={{fontSize:7,color:T.textDim}}>NAV IMPACT</div><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:T.accent}}>{e.navImpact}</div></div>
          <div style={{display:'flex',gap:3,flexWrap:'wrap'}}>{e.signals.map((s,j)=><Badge key={j} color={T.bgAccent}>{s}</Badge>)}{e.buyer&&<Badge color={T.purple}>Buyer: {e.buyer.split(' (')[0]}</Badge>}</div>
        </div>))}
      </div>)}

      {/* ═══ TAB 7: ALPHA ATTRIBUTION ═══ */}
      {aView==='alpha'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Total Alpha" value="+8.2%" icon={TrendingUp} sub="vs benchmark" color={T.accent}/>
          <Stat label="Sharpe Ratio" value="1.8x" icon={Target} sub="vs 1.2x peers" color={T.green}/>
          <Stat label="Information Ratio" value="2.1x" icon={Zap} sub="signal quality" color={T.blue}/>
          <Stat label="Hit Rate" value="78%" icon={CheckCircle} sub="positive selections" color={T.purple}/>
        </div>
        <Card title="Alpha Source Decomposition — Where NEWCO's Edge Comes From" style={{marginBottom:14}}><div style={{padding:'16px'}}>
          {alphaDrivers.map((d,i)=>(<div key={i} style={{display:'grid',gridTemplateColumns:'120px 60px 1fr 200px 100px',gap:12,alignItems:'center',padding:'10px 0',borderBottom:i<alphaDrivers.length-1?`1px solid ${T.border}`:'none'}}>
            <div style={{fontSize:13,fontWeight:700,color:d.c}}>{d.source}</div>
            <div style={{fontSize:20,fontWeight:800,fontFamily:mono,color:d.c,textAlign:'center'}}>{d.contrib}%</div>
            <div><div style={{fontSize:11,color:T.textMuted}}>{d.desc}</div><div style={{fontSize:10,color:T.accent,marginTop:2,fontWeight:600}}>{d.metric}</div></div>
            <div><Bar value={d.contrib} max={50} color={d.c} h={8}/></div>
            <SparkLine data={d.trend} width={80} height={28} color={d.c} fill/>
          </div>))}
        </div></Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Alpha Contribution — Donut"><div style={{padding:16,display:'flex',justifyContent:'center'}}><DonutChart size={200} thickness={28} label="+8.2%" sublabel="total alpha" segments={alphaDrivers.map(d=>({value:d.contrib,label:d.source,color:d.c}))}/></div></Card>
          <Card title="Peer Comparison — NEWCO vs Benchmark"><div style={{padding:16}}>
            {[{metric:'Net IRR',newco:'22.4%',bench:'14.2%',delta:'+8.2%',c:T.accent},{metric:'TVPI',newco:'1.42x',bench:'1.18x',delta:'+0.24x',c:T.green},{metric:'DPI',newco:'0.38x',bench:'0.22x',delta:'+0.16x',c:T.blue},{metric:'Loss Ratio',newco:'8%',bench:'22%',delta:'-14%',c:T.green},{metric:'Time to Deploy',newco:'8mo',bench:'14mo',delta:'-6mo',c:T.amber},{metric:'Co-Invest Access',newco:'92%',bench:'35%',delta:'+57%',c:T.purple}].map((m,i)=><div key={i} style={{display:'grid',gridTemplateColumns:'100px 1fr 1fr 80px',gap:8,padding:'6px 0',borderBottom:i<5?`1px solid ${T.border}`:'none',alignItems:'center'}}><span style={{fontSize:11,fontWeight:600,color:T.text}}>{m.metric}</span><span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:T.accent,textAlign:'center'}}>{m.newco}</span><span style={{fontSize:12,fontFamily:mono,color:T.textMuted,textAlign:'center'}}>{m.bench}</span><span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:m.c,textAlign:'right'}}>{m.delta}</span></div>)}
          </div></Card>
        </div>
        {/* D3 Fund-Sector Interconnection — Chord Diagram */}
        <Card title="Fund × Sector Co-Exposure — D3 Chord Diagram" style={{marginTop:12}}><div style={{padding:'12px',display:'grid',gridTemplateColumns:'1fr 1fr',gap:16,alignItems:'center'}}>
          <D3Chord width={320} height={320}
            labels={['AI Safety','Deep Tech','AI Infra','Trust&Safe','GovTech','Consumer','Climate']}
            colors={[T.accent,T.blue,T.purple,T.green,T.amber,T.cyan,T.green]}
            matrix={[
              [0,5,8,6,3,1,2],
              [5,0,6,3,4,1,3],
              [8,6,0,2,2,1,1],
              [6,3,2,0,5,4,1],
              [3,4,2,5,0,2,1],
              [1,1,1,4,2,0,1],
              [2,3,1,1,1,1,0],
            ]}
          />
          <div>
            <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:8}}>PORTFOLIO CORRELATION INSIGHTS</div>
            {[
              {pair:'AI Safety ↔ AI Infra',strength:'High (0.82)',note:'Anthropic, Scale AI, Databricks share infrastructure moats',c:T.accent},
              {pair:'AI Safety ↔ Trust & Safety',strength:'Medium (0.61)',note:'Regulatory overlap — EU AI Act compliance creates dual exposure',c:T.green},
              {pair:'Deep Tech ↔ GovTech',strength:'Medium (0.48)',note:'Anduril, Shield AI bridge defense + deep tech categories',c:T.blue},
              {pair:'Consumer ↔ Trust & Safety',strength:'Low-Med (0.35)',note:'Verkada, digital identity companies span both sectors',c:T.cyan},
            ].map((c,i)=>(
              <div key={i} style={{padding:'8px 10px',background:T.bgAccent,borderRadius:6,marginBottom:6,borderLeft:`3px solid ${c.c}`}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                  <span style={{fontSize:10,fontWeight:700,color:c.c}}>{c.pair}</span>
                  <span style={{fontSize:9,fontFamily:mono,fontWeight:600,color:T.text}}>{c.strength}</span>
                </div>
                <div style={{fontSize:9,color:T.textMuted}}>{c.note}</div>
              </div>
            ))}
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 8: GP SCORECARD — 10-Dimension Academic Framework ═══ */}
      {/* Source: NEWCO Business Plan §GP Selection & Due Diligence Process — 10 dimensions (1-5), min 35/50 */}
      {/* Academic: Kaplan & Schoar (2005) PME methodology, Harris Jenkinson Kaplan (2014) persistence, */}
      {/* Korteweg & Sorensen (2017) skill vs luck decomposition, Hochberg Ljungqvist Lu (2007) network centrality */}
      {aView==='gpcard'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="GPs Scored" value="8" icon={Users} sub="active portfolio" color={T.accent}/>
          <Stat label="Avg Score" value="40.3/50" icon={Target} sub="min threshold: 35" color={T.green}/>
          <Stat label="Top Quartile" value="6 of 8" icon={Award} sub="vs Cambridge benchmark" color={T.blue}/>
          <Stat label="Pass Rate" value="4.2%" icon={Filter} sub="100 screened → 15 DD → 4 committed" color={T.purple}/>
        </div>
        {/* Methodology card */}
        <Card title="GP Selection Scorecard — Institutional Framework" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{fontSize:11,color:T.textMuted,lineHeight:1.5,marginBottom:10}}>
            <span style={{fontWeight:700,color:T.accent}}>Methodology:</span> Each GP scored across 10 dimensions (1-5 scale). Minimum composite 35/50 for IC presentation. Scores weighted by academic evidence: Kaplan-Schoar PME (track record persistence), Hochberg-Ljungqvist-Lu (network centrality → returns), Korteweg-Sorensen (skill vs luck decomposition via Bayesian shrinkage estimator). Secondary quantitative overlay via Omniscient signal processing.
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(10,1fr)',gap:3,marginBottom:8}}>
            {['Track Record\n& DPI','Team Quality\n& Stability','Sector\nExpertise','Deal Sourcing\nDifferentiation','Portfolio\nConstruction','Co-Invest\nCapacity','Fee Terms\n& Alignment','Reference\nQuality','Market\nTiming','Thesis\nAlignment'].map((d,i)=><div key={i} style={{background:T.bgAccent,borderRadius:4,padding:'6px 2px',textAlign:'center',borderTop:`2px solid ${T.accent}`}}><div style={{fontSize:7,color:T.textDim,whiteSpace:'pre-line',lineHeight:1.2}}>{d}</div><div style={{fontSize:8,color:T.textMuted,marginTop:2}}>1-5</div></div>)}
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:8}}>
            {[{t:'Academic Foundation',items:['Kaplan & Schoar (2005): PME — benchmark GP returns vs S&P 500 invested at same time','Harris, Jenkinson & Kaplan (2014): GP performance persists — top-quartile GPs have 65% probability of repeating','Korteweg & Sorensen (2017): Bayesian shrinkage separates skill from luck — 15+ deals required for statistical significance']},
            {t:'Quantitative Inputs',items:['TVPI / DPI / RVPI decomposition — DPI weighted 2x (realized > unrealized)','Kaplan-Schoar PME vs S&P 500, Russell 2000, Cambridge VC Index','Loss ratio (% investments <1x) — academic median 40%, top decile <25%','Time-to-liquidity: months from first close to first distribution']},
            {t:'Qualitative Inputs',items:['Reference triangulation: 8+ calls per GP (founders, co-investors, LPs, lost deals)','Hochberg network centrality score — syndication graph position predicts returns','Team stability: key-person risk, succession planning, partnership dynamics','Investment process: sourcing → DD → IC → monitoring → exit documentation']},
            {t:'Omniscient Signals',items:['Talent flow: engineer migration TO portfolio cos (positive) vs FROM (negative)','GitHub signal: commit velocity + contributor quality on portfolio co repos','Customer NPS triangulation via enterprise reference network','Regulatory exposure scoring via EU AI Act + US defense compliance tracking']},
            {t:'Threshold Gates',items:['HARD GATE: Score ≥35/50 to advance to IC presentation','HARD GATE: DPI ≥0.5x by Year 5 for re-up consideration','HARD GATE: No single LP >25% of fund (concentration risk)','SOFT GATE: Prefer ≤$1B fund size (Kaplan evidence: smaller funds → higher alpha)']}
            ].map((sec,i)=><div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8}}><div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:4}}>{sec.t}</div>{sec.items.map((item,j)=><div key={j} style={{fontSize:9,color:T.textMuted,marginBottom:3,paddingLeft:6,borderLeft:`2px solid ${T.accent}20`,lineHeight:1.3}}>{item}</div>)}</div>)}
          </div>
        </div></Card>
        {/* D3 Radar Overlay — Visual GP Comparison */}
        <Card title="GP Dimension Overlay — D3 Radar Comparison" style={{marginBottom:12}}><div style={{padding:'12px 16px',display:'flex',justifyContent:'center'}}>
          <D3RadarOverlay
            dimensions={['Track Record','Team Quality','Sector','Sourcing','PortCon','Co-Invest','Fee Terms','References','Timing','Thesis']}
            gps={[
              {name:'Founders Fund VII',scores:[5,5,5,5,4,5,4,5,5,5],total:48},
              {name:'Benchmark X',scores:[5,5,4,5,5,3,4,5,4,4],total:44},
              {name:'Lux Capital VI',scores:[5,4,5,5,4,4,4,5,5,5],total:46},
              {name:'NEA 19',scores:[5,5,4,4,4,4,3,4,4,4],total:41},
              {name:'Khosla IX',scores:[4,4,5,5,4,3,4,4,4,4],total:41},
              {name:'Sequoia VIII',scores:[4,4,4,4,4,3,3,4,3,4],total:37},
              {name:'a16z Infra',scores:[4,4,5,3,3,4,3,4,4,4],total:38},
              {name:'Greylock XVII',scores:[3,4,4,3,3,3,3,3,3,4],total:33},
            ]}
            size={380}
          />
        </div></Card>
        <Card title="Active Portfolio — GP Scorecard Matrix"><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>GP / Fund</TH><TH align="center">Track</TH><TH align="center">Team</TH><TH align="center">Sector</TH><TH align="center">Source</TH><TH align="center">PortCon</TH><TH align="center">Co-Inv</TH><TH align="center">Fees</TH><TH align="center">Refs</TH><TH align="center">Timing</TH><TH align="center">Thesis</TH><TH align="center">TOTAL</TH><TH align="center">PME</TH><TH align="center">VERDICT</TH>
          </tr></thead><tbody>
            {[
              {gp:'Founders Fund VII',scores:[5,5,5,5,4,5,4,5,5,5],total:48,pme:2.82,verdict:'EXCEPTIONAL',c:T.accent},
              {gp:'Lux Capital VI',scores:[5,4,5,5,4,4,4,5,5,5],total:46,pme:2.15,verdict:'EXCEPTIONAL',c:T.accent},
              {gp:'NEA 19',scores:[5,5,4,4,4,4,3,4,4,4],total:41,pme:1.92,verdict:'STRONG',c:T.green},
              {gp:'Benchmark X',scores:[5,5,4,5,5,3,4,5,4,4],total:44,pme:2.38,verdict:'EXCEPTIONAL',c:T.accent},
              {gp:'Sequoia US VIII',scores:[4,4,4,4,4,3,3,4,3,4],total:37,pme:1.65,verdict:'PASS',c:T.blue},
              {gp:'a16z Infra',scores:[4,4,5,3,3,4,3,4,4,4],total:38,pme:1.48,verdict:'PASS',c:T.blue},
              {gp:'Greylock XVII',scores:[3,4,4,3,3,3,3,3,3,4],total:33,pme:1.12,verdict:'WATCHLIST',c:T.amber},
              {gp:'Khosla IX',scores:[4,4,5,5,4,3,4,4,4,4],total:41,pme:1.55,verdict:'STRONG',c:T.green},
            ].map((g,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:g.total<35?`${T.red}08`:'transparent'}}>
              <TD style={{fontWeight:700,fontSize:11}}>{g.gp}</TD>
              {g.scores.map((s,j)=><TD key={j} align="center"><span style={{display:'inline-block',width:20,height:20,borderRadius:4,lineHeight:'20px',textAlign:'center',fontSize:10,fontWeight:700,fontFamily:mono,background:s>=5?T.accentBg:s>=4?`${T.green}15`:s>=3?`${T.blue}15`:`${T.red}15`,color:s>=5?T.accent:s>=4?T.green:s>=3?T.blue:T.red}}>{s}</span></TD>)}
              <TD align="center"><span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:g.total>=44?T.accent:g.total>=38?T.green:g.total>=35?T.blue:T.red}}>{g.total}</span></TD>
              <TD align="center" mono bold color={g.pme>=2?T.accent:g.pme>=1.5?T.green:g.pme>=1?T.blue:T.red}>{g.pme}x</TD>
              <TD align="center"><Badge color={g.c}>{g.verdict}</Badge></TD>
            </tr>))}
          </tbody></table>
          <div style={{display:'flex',gap:12,padding:'10px 16px',borderTop:`1px solid ${T.border}`,alignItems:'center'}}>
            <span style={{fontSize:9,fontWeight:700,color:T.textDim}}>LEGEND:</span>
            {[{v:'5 = Exceptional',c:T.accent},{v:'4 = Strong',c:T.green},{v:'3 = Adequate',c:T.blue},{v:'2 = Below',c:T.amber},{v:'1 = Fail',c:T.red}].map((l,i)=><span key={i} style={{fontSize:9,color:l.c,fontWeight:600}}>{l.v}</span>)}
            <span style={{marginLeft:'auto',fontSize:9,color:T.textDim}}>{"PME = Kaplan-Schoar Public Market Equivalent vs S&P 500. >1.0 = outperformed public markets."}</span>
          </div>
        </div></Card>
        {/* Emerging GP Pipeline Scorecard */}
        <Card title="Emerging GP Pipeline — Scorecard (Pre-Commitment)" style={{marginTop:12}}><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Candidate GP</TH><TH align="center">Track</TH><TH align="center">Team</TH><TH align="center">Sector</TH><TH align="center">Source</TH><TH align="center">PortCon</TH><TH align="center">Co-Inv</TH><TH align="center">Fees</TH><TH align="center">Refs</TH><TH align="center">Timing</TH><TH align="center">Thesis</TH><TH align="center">TOTAL</TH><TH align="center">STATUS</TH>
          </tr></thead><tbody>
            {[
              {gp:'Thorn Ventures (Delian/FF spinout)',scores:[5,4,5,5,4,4,4,4,5,5],total:45,status:'COMMIT $10M',c:T.accent},
              {gp:'Radical AI (ex-Anthropic)',scores:[3,4,5,5,4,4,5,5,5,5],total:45,status:'COMMIT $8M',c:T.accent},
              {gp:'Latticework (Maguire/Sequoia)',scores:[4,4,5,5,4,3,4,4,4,5],total:42,status:'IC REVIEW',c:T.green},
              {gp:'Meridian Defense (Lux+IQT)',scores:[4,4,5,5,3,3,4,4,4,5],total:41,status:'IC REVIEW',c:T.green},
              {gp:'Crescendo Partners (Tiger/Coatue)',scores:[4,4,4,3,4,4,3,3,4,3],total:36,status:'DD STAGE',c:T.blue},
              {gp:'Berkeley Frontier Fund (R. Chan)',scores:[2,3,4,4,3,3,4,3,4,5],total:35,status:'BORDERLINE',c:T.amber},
              {gp:'Haize Labs Fund (AI Red Team)',scores:[2,3,5,4,3,3,5,3,5,5],total:38,status:'DD STAGE',c:T.blue},
            ].map((g,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:g.total<35?`${T.red}08`:'transparent'}}>
              <TD style={{fontWeight:600,fontSize:10}}>{g.gp}</TD>
              {g.scores.map((s,j)=><TD key={j} align="center"><span style={{fontSize:10,fontWeight:700,fontFamily:mono,color:s>=5?T.accent:s>=4?T.green:s>=3?T.blue:T.red}}>{s}</span></TD>)}
              <TD align="center"><span style={{fontSize:13,fontWeight:800,fontFamily:mono,color:g.total>=44?T.accent:g.total>=38?T.green:g.total>=35?T.blue:T.red}}>{g.total}</span></TD>
              <TD align="center"><Badge color={g.c}>{g.status}</Badge></TD>
            </tr>))}
          </tbody></table>
        </div></Card>
      </div>)}

      {/* ═══ TAB 9: QUANTITATIVE FRAMEWORKS — Academic Grounding ═══ */}
      {aView==='quant'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Kaplan-Schoar PME" value="1.82x" icon={TrendingUp} sub="vs S&P 500" color={T.accent}/>
          <Stat label="Kelly Optimal" value="68%" icon={Target} sub="deployed vs capacity" color={T.green}/>
          <Stat label="Sharpe Ratio" value="1.84" icon={Zap} sub="risk-adjusted" color={T.blue}/>
          <Stat label="Herfindahl Index" value="0.14" icon={PieChart} sub="concentration (< 0.18 target)" color={T.purple}/>
        </div>

        {/* Academic Framework Reference Grid */}
        <Card title="Academic & Institutional Frameworks — Theoretical Foundation" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {title:'RETURN MEASUREMENT',theory:'Kaplan & Schoar (2005)',color:T.accent,metrics:[
                {name:'PME (Public Market Equivalent)',formula:'Σ(Distributions / S&P at dist date) ÷ Σ(Contributions / S&P at call date)',value:'1.82x',interpretation:'Fund returns 82% above public market alternative. >1.0 = outperformance'},
                {name:'TVPI (Total Value to Paid-In)',formula:'(NAV + Distributions) ÷ Total Called',value:'1.42x',interpretation:'$1.42 total value per $1 invested. Cambridge top-quartile: 1.6x+'},
                {name:'DPI (Distributions to Paid-In)',formula:'Cumulative Distributions ÷ Total Called',value:'0.38x',interpretation:'$0.38 returned per $1. Early vintage. Target 1.0x by Year 5'},
                {name:'RVPI (Residual Value)',formula:'Current NAV ÷ Total Called',value:'1.04x',interpretation:'Unrealized value. High RVPI/low DPI = J-curve position'},
              ]},
              {title:'POSITION SIZING',theory:'Kelly Criterion (1956) / Thorp (2006)',color:T.green,metrics:[
                {name:'Kelly Fraction',formula:'f* = (bp - q) / b where b=odds, p=prob, q=1-p',value:'See sizing tab',interpretation:'Optimal bet size maximizing long-run geometric growth rate'},
                {name:'Half-Kelly Adjustment',formula:'f_adj = f* / 2 (institutional convention)',value:'Applied',interpretation:'Reduces drawdown risk. Kahneman: loss aversion coefficient ≈ 2.25'},
                {name:'Max Position Size',formula:'min(Kelly, 8% NAV, $50M)',value:'8% max',interpretation:'Hard cap prevents concentration. 1940 Act: max 25% in single issuer'},
                {name:'Correlation Penalty',formula:'f_adj × (1 - ρ_portfolio) for correlated assets',value:'Applied',interpretation:'Reduces position when asset correlated to existing holdings'},
              ]},
              {title:'PORTFOLIO CONSTRUCTION',theory:'Markowitz (1952) / Ilmanen (2011)',color:T.blue,metrics:[
                {name:'Efficient Frontier Position',formula:'Max Sharpe = (E[R] - Rf) / σ',value:'S=1.84',interpretation:'Expected return per unit risk. Peers: 1.2x. Top-decile: 1.8x+'},
                {name:'Herfindahl-Hirschman Index',formula:'HHI = Σ(wi²) across all positions',value:'0.14',interpretation:'Concentration measure. <0.15 = diversified. >0.25 = concentrated'},
                {name:'Effective # of Bets',formula:'N_eff = 1 / HHI',value:'7.1',interpretation:'Equivalent number of equal-weight positions. Target: 8-12'},
                {name:'Vintage Diversification',formula:'Max 40% single vintage (NEWCO policy)',value:'Compliant',interpretation:'Cambridge: vintage diversification explains 60% of FoF return variance'},
              ]},
            ].map((fw,fi)=>(<div key={fi} style={{background:T.bgAccent,borderRadius:8,padding:10,border:`1px solid ${T.border}`,borderTop:`3px solid ${fw.color}`}}>
              <div style={{fontSize:10,fontWeight:800,color:fw.color,marginBottom:2}}>{fw.title}</div>
              <div style={{fontSize:8,color:T.textMuted,marginBottom:8,fontStyle:'italic'}}>{fw.theory}</div>
              {fw.metrics.map((m,mi)=>(<div key={mi} style={{marginBottom:8,paddingBottom:6,borderBottom:mi<fw.metrics.length-1?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:2}}><span style={{fontSize:10,fontWeight:700,color:T.text}}>{m.name}</span><span style={{fontSize:12,fontWeight:800,fontFamily:mono,color:fw.color}}>{m.value}</span></div>
                <div style={{fontSize:8,color:T.textDim,fontFamily:mono,marginBottom:2}}>{m.formula}</div>
                <div style={{fontSize:9,color:T.textMuted,lineHeight:1.3}}>{m.interpretation}</div>
              </div>))}
            </div>))}
          </div>
        </div></Card>

        {/* Additional academic frameworks row 2 */}
        <Card title="Advanced Analytical Frameworks" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {title:'PERSISTENCE & SKILL',theory:'Harris Jenkinson Kaplan (2014)',color:T.amber,metrics:[
                {name:'GP Persistence Probability',formula:'P(Top-Q | Prev Top-Q) via transition matrix',value:'65%',interpretation:'Top-quartile GPs have 65% chance of repeating vs 25% random. Core thesis for manager selection.'},
                {name:'Skill vs Luck (Korteweg-Sorensen)',formula:'Bayesian shrinkage: α_shrunk = λ·α_raw + (1-λ)·α_prior',value:'Applied',interpretation:'Shrinks GP alpha estimate toward prior. Requires 15+ investments for statistical significance. Young funds get heavier shrinkage.'},
                {name:'Fund Size Decay',formula:'∂(α)/∂(AUM) < 0 for AUM > threshold',value:'< $1B pref',interpretation:'Kaplan: diseconomies of scale in VC. Our target fund size $50M-$1B preserves alpha. Mega-funds (>$5B) regress to market.'},
                {name:'Emerging Manager Premium',formula:'Fund I-III IRR − Fund V+ IRR',value:'+4.8%',interpretation:'Cambridge data: emerging managers (Fund I-III) outperform established by 480bps. Smaller fund + hunger + concentrated portfolio = alpha.'},
              ]},
              {title:'NETWORK INTELLIGENCE',theory:'Hochberg Ljungqvist Lu (2007)',color:T.purple,metrics:[
                {name:'Network Centrality Score',formula:'Eigenvector centrality in GP co-investment graph',value:'0.78',interpretation:'Better-networked GPs generate 3-5% higher IRR. NEWCO portfolio GPs avg 0.78 vs 0.52 universe median.'},
                {name:'Syndication Quality Index',formula:'Avg co-investor rank × frequency of syndication',value:'92/100',interpretation:'Who you invest WITH predicts returns. Our GPs co-invest with other top-decile managers 78% of the time.'},
                {name:'Information Diffusion Rate',formula:'Speed of signal propagation through GP network',value:'6-12mo edge',interpretation:'Omniscient tracks 50,000+ people. Detects breakout patterns 6-12 months before traditional deal flow surfaces.'},
                {name:'Berkeley Network Premium',formula:'Berkeley-connected deals vs non-Berkeley baseline',value:'+2.3%',interpretation:'5th-gen Goldman-Berkeley legacy. #3 university for VC-backed founders (1,400+ companies, $40B+ raised). Structural access premium.'},
              ]},
              {title:'RISK & DOWNSIDE',theory:'Ang (2014) / Taleb (2012)',color:T.red,metrics:[
                {name:'CVaR (Conditional Value at Risk)',formula:'E[Loss | Loss > VaR_95%]',value:'-18.2%',interpretation:'Expected loss in worst 5% of scenarios. Secondary discounts (30-50%) provide margin of safety.'},
                {name:'Max Drawdown (Stress)',formula:'Peak-to-trough under 2008-level scenario',value:'-32%',interpretation:'Bear case drawdown. Mitigants: SBIC fixed-rate leverage, 1.25% low fee burn, secondary cushion.'},
                {name:'Anti-Fragility Score (Taleb)',formula:'Convexity: ∂²(Portfolio) / ∂(Stress)² > 0',value:'Positive',interpretation:'Portfolio gains optionality under stress. Co-invest rights + secondary buying at distressed prices = anti-fragile.'},
                {name:'Liquidity Coverage Ratio',formula:'(Cash + Credit) / (12mo calls + 6mo expenses)',value:'2.4x',interpretation:'Can cover 2.4 years of obligations with zero new capital. Unfunded limit: max 60% of NAV (NEWCO policy).'},
              ]},
            ].map((fw,fi)=>(<div key={fi} style={{background:T.bgAccent,borderRadius:8,padding:10,border:`1px solid ${T.border}`,borderTop:`3px solid ${fw.color}`}}>
              <div style={{fontSize:10,fontWeight:800,color:fw.color,marginBottom:2}}>{fw.title}</div>
              <div style={{fontSize:8,color:T.textMuted,marginBottom:8,fontStyle:'italic'}}>{fw.theory}</div>
              {fw.metrics.map((m,mi)=>(<div key={mi} style={{marginBottom:8,paddingBottom:6,borderBottom:mi<fw.metrics.length-1?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:2}}><span style={{fontSize:10,fontWeight:700,color:T.text}}>{m.name}</span><span style={{fontSize:12,fontWeight:800,fontFamily:mono,color:fw.color}}>{m.value}</span></div>
                <div style={{fontSize:8,color:T.textDim,fontFamily:mono,marginBottom:2}}>{m.formula}</div>
                <div style={{fontSize:9,color:T.textMuted,lineHeight:1.3}}>{m.interpretation}</div>
              </div>))}
            </div>))}
          </div>
        </div></Card>

        {/* Valuation Framework — ASC 820 */}
        <Card title="Valuation Framework — ASC 820 Fair Value Hierarchy"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,marginBottom:10}}>
            {[{level:'Level 1',pct:'~5%',desc:'Quoted prices in active markets',examples:'Public securities, listed CEF shares',method:'Mark-to-market (daily)',c:T.green},
              {level:'Level 2',pct:'~10%',desc:'Observable inputs other than Level 1',examples:'Secondary market transactions, comparable public multiples',method:'Transaction-based with adjustments',c:T.blue},
              {level:'Level 3',pct:'~85%',desc:'Unobservable inputs',examples:'GP-reported NAV, model-based valuations (DCF, OPM)',method:'GP NAV + lag adjustment + impairment review',c:T.amber}
            ].map((l,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:10,borderTop:`3px solid ${l.c}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}><span style={{fontSize:12,fontWeight:800,color:l.c}}>{l.level}</span><span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:T.accent}}>{l.pct}</span></div>
              <div style={{fontSize:10,fontWeight:600,color:T.text,marginBottom:4}}>{l.desc}</div>
              <div style={{fontSize:9,color:T.textMuted}}><strong>Examples:</strong> {l.examples}</div>
              <div style={{fontSize:9,color:T.textMuted}}><strong>Method:</strong> {l.method}</div>
            </div>))}
          </div>
          <div style={{fontSize:10,color:T.textDim,lineHeight:1.4,padding:'6px 0',borderTop:`1px solid ${T.border}`}}>
            <strong style={{color:T.text}}>NAV Methodology (per Business Plan §Valuation):</strong> {"Starting point is GP-reported NAV (quarterly). Adjustments for material events (public market moves, announced financings). Lag adjustment if >45 days stale (Cambridge VC Index proxy). Impairment review for adverse developments. Co-investments valued via waterfall: recent transaction → comparable transactions → market multiples → OPM backsolve. Independent auditor quarterly review. Board Valuation Committee oversight."}
          </div>
        </div></Card>

        {/* Scenario Analysis from Business Plan */}
        <Card title="Scenario Analysis — 10-Year NAV Projections (per Business Plan)"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12}}>
            {[{case:'Bear Case',prob:'15%',irr:'8-12%',nav10:'$65',tvpi:'1.5x',color:T.red,assumptions:['Extended recession','IPO window closed through 2028','LP defaults increase 15%','Secondary discounts widen to 40-50%','Underlying portfolio IRR 8%'],mitigants:['Secondary acquisition at 30-50% discount = margin of safety','SBIC fixed-rate debentures create rebound leverage','1.25% fee ensures operating coverage even at reduced NAV','Vintage 2025-27 historically produce top-decile returns']},
              {case:'Base Case',prob:'60%',irr:'22-25%',nav10:'$146',tvpi:'3.2x',color:T.accent,assumptions:['VC market normalizes','Exit windows reopen gradually','Interest rates stabilize','AI/Defense spending continues','Emerging managers outperform +480bps'],mitigants:['Diversified across 60-90 positions','Co-invest rights amplify winners','Secondary purchases accelerate J-curve','SBIC leverage adds 200-400bps']},
              {case:'Bull Case',prob:'25%',irr:'30-35%',nav10:'$220+',tvpi:'5.0x+',color:T.green,assumptions:['AI/defense boom drives 2021-level valuations','IPO window fully open','Retail inflows surge (INVEST Act)','SBIC leverage maximized at 3x','Multiple unicorn exits in portfolio'],mitigants:['Co-invest rights capture 2-5x on breakouts','Premium to NAV enables ATM equity raises','Platform expansion options exercised','Omniscient monetization adds revenue stream']}
            ].map((s,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:12,border:`1px solid ${s.color}30`,borderTop:`3px solid ${s.color}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:8}}><span style={{fontSize:14,fontWeight:800,color:s.color}}>{s.case}</span><Badge color={s.color}>{s.prob} probability</Badge></div>
              <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:6,marginBottom:10}}>
                {[{l:'IRR',v:s.irr},{l:'NAV/Share Y10',v:s.nav10},{l:'TVPI',v:s.tvpi}].map((m,j)=><div key={j} style={{textAlign:'center',background:T.bg,borderRadius:4,padding:'6px 4px'}}><div style={{fontSize:7,color:T.textDim}}>{m.l}</div><div style={{fontSize:14,fontWeight:800,fontFamily:mono,color:s.color}}>{m.v}</div></div>)}
              </div>
              <div style={{fontSize:9,fontWeight:700,color:T.textDim,marginBottom:3}}>KEY ASSUMPTIONS</div>
              {s.assumptions.map((a,j)=><div key={j} style={{fontSize:9,color:T.text,padding:'1px 0 1px 8px',borderLeft:`2px solid ${s.color}40`,marginBottom:2}}>{a}</div>)}
              <div style={{fontSize:9,fontWeight:700,color:T.textDim,marginTop:6,marginBottom:3}}>{i===0?'MITIGANTS':'AMPLIFIERS'}</div>
              {s.mitigants.map((m,j)=><div key={j} style={{fontSize:9,color:T.textMuted,padding:'1px 0 1px 8px',borderLeft:`2px solid ${T.blue}40`,marginBottom:2}}>{m}</div>)}
            </div>))}
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 10: NETWORK SCORE — Relationship Capital Intelligence ═══ */}
      {/* Source: NEWCO GTM Strategy, Target Appendix, Network Power Play docs */}
      {aView==='network'&&(<div>
        {/* ── HERO STATS ── */}
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Network Nodes" value="485" icon={Globe} sub="total qualified matches" color={T.accent}/>
          <Stat label="Dual LP/Customer" value="64%" icon={Users} sub="contacts w/ dual utility" color={T.green}/>
          <Stat label="Est. Network AUM" value="$50B+" icon={DollarSign} sub="accessible capital" color={T.blue}/>
          <Stat label="Platform Reach" value="$14.3T" icon={Layers} sub="RIA channel total" color={T.purple}/>
        </div>

        {/* ── TRIAD — D3 Mini Radars + Value Cards ── */}
        <Card title="The Wallace-Burlinson-Goldman Triad — Network Multiplier Score" action={<span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>Hochberg-Ljungqvist-Lu (2007) network centrality adapted for LP development</span>} style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12}}>
            {[
              {name:'Ken Wallace',title:'CIO',org:'Nimble Partners / ex-Industry Ventures',role:'GP Selection & LP Pipeline',scores:[95,92,88,96],color:T.accent,
                paths:['Nimble LPs → Family Offices, Endowments','Industry Ventures → 725+ LP interests','John Burbank (Warriors) → HNW/UHNW','Bessemer Trust → Mike Selfridge','UC Berkeley Haas MBA → ecosystem'],
                value:'His LITERAL JOB is evaluating emerging fund managers. 16 years of LP relationships. Can validate NEWCO + introduce 50+ institutional LPs.',
                action:'Co-host Emerging Manager LP Roundtable'},
              {name:'Bob Burlinson',title:'CIS',org:'Mercer Advisors ($92B AUM)',role:'Platform Distribution & UHNW Access',scores:[98,98,82,99],color:T.green,
                paths:['Mercer Aspen Partners → 1,150+ advisors','Regis UHNW → foundations, endowments','Skoll Foundation IC (17 yrs) → foundation LPs','Don Calcagni (Mercer CIO) → platform approval','Peninsula SV ultra-HNW → direct LP base'],
                value:'Senior Director of Private Investments at #1 RIA in America. ONE conversation → NEWCO on Mercer shelf, 1,150+ advisors, $92B AUM.',
                action:'Meeting THIS MONTH — liquid VC exposure pitch'},
              {name:'Jason Goldman',title:'CSO',org:'Evil Twin Capital / Goldman Family',role:'Berkeley Ecosystem & Foundation Access',scores:[90,85,90,94],color:T.purple,
                paths:['Goldman School Board → faculty, researchers','Lisa & Douglas Goldman Fund → foundation LPs','Haas School foundation → major donors','5th-gen Berkeley → 1,400+ alumni founders','SF Old Money → UHNW family offices'],
                value:'5th-generation UC Berkeley legacy. Board at Goldman School of Public Policy. Foundation network unlocks $500M+ in accessible capital.',
                action:'Map Goldman Fund board → Foundation LP Target List'},
            ].map((p,i)=>(
              <div key={i} style={{background:T.bgAccent,borderRadius:10,border:`1px solid ${T.border}`,overflow:'hidden'}}>
                {/* Radar header */}
                <div style={{background:`linear-gradient(135deg, ${p.color}08, ${p.color}03)`,padding:'8px 12px 4px',borderBottom:`1px solid ${T.border}60`,display:'flex',alignItems:'center',justifyContent:'space-between'}}>
                  <div>
                    <div style={{fontSize:13,fontWeight:800,color:p.color}}>{p.name} — {p.title}</div>
                    <div style={{fontSize:9,color:T.textMuted}}>{p.org}</div>
                  </div>
                  <Badge color={p.color}>{p.role.split(' ')[0]}</Badge>
                </div>
                {/* D3 Mini Radar */}
                <div style={{display:'flex',justifyContent:'center',padding:'4px 0 0'}}>
                  <D3TriadRadar scores={p.scores} name={p.name} color={p.color} size={136}/>
                </div>
                {/* Content */}
                <div style={{padding:'4px 12px 12px'}}>
                  <div style={{fontSize:8,color:T.textDim,fontWeight:700,marginBottom:3,letterSpacing:'0.5px'}}>ACTIVATION PATHS</div>
                  {p.paths.slice(0,4).map((path,j)=><div key={j} style={{fontSize:8,color:T.green,padding:'1px 0 1px 6px',borderLeft:`2px solid ${T.green}40`,marginBottom:1,lineHeight:1.3}}>{path}</div>)}
                  <div style={{fontSize:9,color:T.text,margin:'6px 0',lineHeight:1.35}}>{p.value}</div>
                  <div style={{background:`${p.color}08`,borderRadius:4,padding:'5px 8px',border:`1px solid ${p.color}20`}}>
                    <span style={{fontSize:7,fontWeight:700,color:T.textDim}}>NEXT: </span>
                    <span style={{fontSize:9,color:p.color,fontWeight:600}}>{p.action}</span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div></Card>

        {/* ── GTM SCATTER + LP FUNNEL — Side by side ── */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 360px',gap:12,marginBottom:12}}>
          <Card title="GTM Priority Map — Authority × Velocity" action={<div style={{display:'flex',gap:8}}>
            {[['Platform',T.accent],['Capital',T.green],['Multiplier',T.purple],['Institutional',T.blue],['Berkeley',T.amber]].map(([l,c])=>
              <span key={l} style={{display:'flex',alignItems:'center',gap:3,fontSize:8,color:T.textMuted}}>
                <span style={{width:6,height:6,borderRadius:'50%',background:c}}/>{l}
              </span>)}
            <span style={{fontSize:7,color:T.textDim,fontFamily:mono}}>bubble size = composite score</span>
          </div>}>
            <D3GTMScatter width={710} height={320} contacts={[
              {r:1,name:'Alistair Savides',org:'J.P. Morgan',tier:'Platform',reach:95,auth:98,vel:70,comp:91,value:'Controls $14T+ platform Manager Research'},
              {r:2,name:'John Goldstein',org:'Goldman Sachs',tier:'Platform',reach:92,auth:96,vel:72,comp:89,value:'Global Head — thematic/impact shelf'},
              {r:3,name:'Brad Tuthill',org:'Goldman Sachs',tier:'Platform',reach:88,auth:90,vel:75,comp:86,value:'MD — champion to product committee'},
              {r:4,name:'Stacy Singer',org:'Northern Trust',tier:'Platform',reach:90,auth:92,vel:68,comp:85,value:'National Practice Leader — ultra-HNW'},
              {r:5,name:'Marie Young',org:'Family Office',tier:'Capital',reach:70,auth:95,vel:92,comp:88,value:'CIO — $1-5M same conversation'},
              {r:6,name:'Eric Alt',org:'Pathstone ($100B+)',tier:'Capital',reach:88,auth:90,vel:85,comp:88,value:'Co-CIO — invest AND distribute'},
              {r:7,name:'Stuart Katz',org:'Robertson Stephens',tier:'Capital',reach:82,auth:88,vel:88,comp:86,value:'CIO — major RIA + investor'},
              {r:8,name:'Mike Selfridge',org:'Bessemer Trust',tier:'Capital',reach:85,auth:92,vel:72,comp:84,value:'Head Family Office — Ken connection'},
              {r:9,name:'Michael Anders',org:'ICONIQ ($80B+)',tier:'Multiplier',reach:98,auth:95,vel:65,comp:88,value:'Founding Partner — Zuckerberg, Dorsey LPs'},
              {r:10,name:'Chris Sacca',org:'Lowercarbon',tier:'Multiplier',reach:98,auth:80,vel:60,comp:82,value:'Celebrity VC — Ken backed Fund I (200x)'},
              {r:11,name:'Jessica Mancini',org:'Packard Fdn',tier:'Institutional',reach:85,auth:88,vel:55,comp:78,value:'"Packard invested" opens every door'},
              {r:12,name:'Jim Canales',org:'Barr Foundation',tier:'Institutional',reach:80,auth:85,vel:58,comp:76,value:'President & Trustee — champion internally'},
              {r:13,name:'Amy Rabbino',org:'Pritzker Family',tier:'Institutional',reach:75,auth:82,vel:62,comp:74,value:'PRITZKER — the name alone opens doors'},
              {r:14,name:'Kevin Chang',org:'Berkeley Ventures',tier:'Berkeley',reach:78,auth:72,vel:85,comp:79,value:'Berkeley deal flow direct access'},
              {r:15,name:'Brett Wilson',org:'Swift Ventures',tier:'Team',reach:85,auth:78,vel:95,comp:87,value:'Future partner — LP activation now'},
            ]}/>
          </Card>
          <Card title="LP Pipeline Funnel" action={<span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>conversion by stage</span>}>
            <div style={{padding:'8px 0'}}>
              <D3LPFunnel width={340} height={220} stages={[
                {label:'Universe',count:485,value:'$50B+ AUM',color:T.textMuted},
                {label:'Qualified',count:142,value:'$28B AUM',color:T.blue},
                {label:'Engaged',count:64,value:'$14B AUM',color:T.purple},
                {label:'Due Diligence',count:28,value:'$6.2B AUM',color:T.amber},
                {label:'Committed',count:12,value:'$2.8B AUM',color:T.green},
                {label:'Funded',count:5,value:'$890M AUM',color:T.accent},
              ]}/>
            </div>
          </Card>
        </div>

        {/* ── CHORD + MULTIPLIER EFFECTS — unchanged but tighter ── */}
        <Card title="Network Cross-Pollination — D3 Chord Diagram" action={<span style={{fontSize:8,color:T.textDim}}>Hover segments to isolate relationship paths</span>} style={{marginBottom:12}}><div style={{padding:'12px',display:'grid',gridTemplateColumns:'380px 1fr',gap:16,alignItems:'center'}}>
          <D3Chord width={360} height={360}
            labels={['Ken Wallace','Bob Burlinson','Jason Goldman','GPs','Family Offices','Platforms','Foundations','Berkeley']}
            colors={[T.accent,T.green,T.purple,T.blue,T.amber,T.cyan,T.red,T.gold]}
            matrix={[
              [0,6,5,9,7,3,4,5],
              [6,0,4,5,6,9,5,2],
              [5,4,0,4,5,2,8,9],
              [9,5,4,0,3,4,2,3],
              [7,6,5,3,0,2,5,2],
              [3,9,2,4,2,0,1,1],
              [4,5,8,2,5,1,0,4],
              [5,2,9,3,2,1,4,0],
            ]}
          />
          <div>
            <div style={{fontSize:10,color:T.textDim,fontWeight:700,marginBottom:8}}>NETWORK MULTIPLIER EFFECTS</div>
            {[
              {from:'Ken',to:'GPs',val:'9/10',note:'16yr LP relationships → Nimble, Industry Ventures, Haas MBA network',c:T.accent},
              {from:'Bob',to:'Platforms',val:'9/10',note:'Mercer Sr. Director → 1,150 advisors, $92B AUM, instant shelf access',c:T.green},
              {from:'Jason',to:'Berkeley',val:'9/10',note:'5th-gen legacy → Goldman School Board → 1,400+ alumni founders',c:T.purple},
              {from:'Jason',to:'Foundations',val:'8/10',note:'Goldman Fund → Haas School → major donor trustee network',c:T.red},
              {from:'Ken',to:'Family Offices',val:'7/10',note:'John Burbank (Warriors) → Bessemer Trust → UHNW pipeline',c:T.amber},
              {from:'Bob',to:'Ken',val:'6/10',note:'Cross-pollination: Mercer clients → LP candidates, Ken validates → Bob distributes',c:T.cyan},
            ].map((r,i)=>(
              <div key={i} style={{padding:'6px 10px',background:T.bgAccent,borderRadius:6,marginBottom:4,borderLeft:`3px solid ${r.c}`}}>
                <div style={{display:'flex',justifyContent:'space-between'}}>
                  <span style={{fontSize:10,fontWeight:700,color:r.c}}>{r.from} → {r.to}</span>
                  <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.text}}>{r.val}</span>
                </div>
                <div style={{fontSize:8,color:T.textMuted}}>{r.note}</div>
              </div>
            ))}
          </div>
        </div></Card>

        {/* ── COMPETITIVE MOATS — D3 Arc Gauges + Cards ── */}
        <Card title="Five Reinforcing Competitive Moats — Durability Score"><div style={{padding:'12px 16px'}}>
          {/* Gauge Row */}
          <div style={{display:'flex',justifyContent:'center',gap:8,marginBottom:12}}>
            {[
              {moat:'Data Network',score:92,c:T.accent},
              {moat:'Cost Advantage',score:88,c:T.green},
              {moat:'Regulatory',score:95,c:T.blue},
              {moat:'GP Lock-In',score:85,c:T.purple},
              {moat:'Brand',score:78,c:T.amber},
            ].map((m,i)=>
              <D3MoatGauge key={i} score={m.score} label={m.moat} color={m.c} size={100}/>
            )}
          </div>
          {/* Detail Cards */}
          <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:8}}>
            {[
              {moat:'Proprietary Data Network Effects',score:92,durability:'10+ years',desc:'Omniscient + Berkeley + secondary flow compound over time. 50,000+ people tracked.',evidence:'Hochberg (2007): network centrality predicts returns. Data moats hardest to replicate.',c:T.accent},
              {moat:'Structural Cost Advantage',score:88,durability:'8+ years',desc:'1.25% fee (25-40% below peers). Omniscient reduces DD cost 60-70%. AFFE negotiation power.',evidence:'Berk & Green (2004): fees erode alpha. 1.25% vs 2% = 60bps annual advantage compounding.',c:T.green},
              {moat:'Regulatory Barriers',score:95,durability:'15+ years',desc:'SBIC license (12-18mo). 1940 Act ($2-3M/yr). NYSE listing. First-mover in category.',evidence:'SEC ADI 2025-16 + INVEST Act create regulatory moat. First registered VC FoF targeting emerging managers.',c:T.blue},
              {moat:'GP Relationship Lock-In',score:85,durability:'7+ years',desc:'Anchor LP status → high switching costs. Re-ups at lower DD. Co-invest pipeline 3-5x.',evidence:'Lerner, Schoar & Wongsunwai (2007): LP-GP relationships exhibit persistence.',c:T.purple},
              {moat:'Brand & Distribution',score:78,durability:'5+ years',desc:'NEWCO = public VC exposure. First-mover retail brand. RIA model portfolio inclusion is sticky.',evidence:'Sirri & Tufano (1998): fund flows follow media. ARK precedent: first-mover captured dominant share.',c:T.amber},
            ].map((m,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:10,borderTop:`3px solid ${m.c}`}}>
              <div style={{fontSize:9,fontWeight:800,color:m.c,marginBottom:2,lineHeight:1.2}}>{m.moat}</div>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:4}}>
                <Badge color={m.c}>{m.durability}</Badge>
              </div>
              <div style={{fontSize:8,color:T.text,lineHeight:1.3}}>{m.desc}</div>
              <div style={{fontSize:7,color:T.textDim,marginTop:4,fontStyle:'italic',lineHeight:1.2,padding:'3px 5px',background:T.bg,borderRadius:3}}>{m.evidence}</div>
            </div>))}
          </div>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 0',marginTop:10,borderTop:`1px solid ${T.border}`}}>
            <span style={{fontSize:10,fontWeight:700,color:T.textDim}}>COMPOSITE MOAT DURABILITY SCORE</span>
            <span style={{fontSize:24,fontWeight:800,fontFamily:mono,color:T.accent}}>87.6 / 100</span>
            <span style={{fontSize:10,color:T.textMuted}}>Combined & reinforcing: 10+ year sustainable competitive advantage.</span>
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 11: PACING MODEL & J-CURVE — Ken Wallace / Industry Ventures Framework ═══ */}
      {/* "At Industry Ventures we managed $1B+ in unfunded commitments across 725+ positions. */}
      {/* Pacing is the #1 operational risk in FoF. Get it wrong and you're either sitting on cash */}
      {/* earning nothing or scrambling for liquidity when capital calls come. This is the system I built." — KW */}
      {aView==='pacing'&&(()=>{
        // Fund lifecycle data — where each position sits in deployment/harvest cycle
        const lifecycle = [
          {fund:'Founders Fund VII',vintage:2022,life:10,age:3.2,called:50,unfunded:12.5,distPct:0,phase:'Deploying',jPos:'Trough',nextCall:2.8,callTiming:'Q2 2026',
            callProj:[{q:'Q2 26',amt:2.8},{q:'Q4 26',amt:2.2},{q:'Q2 27',amt:1.8},{q:'Q4 27',amt:1.5},{q:'Q2 28',amt:1.2},{q:'Q4 28',amt:1.0}],
            distProj:[{q:'Q4 27',amt:0.5},{q:'Q2 28',amt:2.0},{q:'Q4 28',amt:4.0},{q:'Q2 29',amt:8.0},{q:'Q4 29',amt:12.0}],
            note:'Peak deployment phase. Expect 2-3 calls/year for next 18mo. Anthropic co-invest may accelerate calls.'},
          {fund:'Lux Capital VI',vintage:2021,life:10,age:4.1,called:75,unfunded:3.8,distPct:8,phase:'Late Deploy',jPos:'Inflection',nextCall:1.5,callTiming:'Q3 2026',
            callProj:[{q:'Q3 26',amt:1.5},{q:'Q1 27',amt:1.2},{q:'Q3 27',amt:0.8},{q:'Q1 28',amt:0.3}],
            distProj:[{q:'Q2 26',amt:1.2},{q:'Q4 26',amt:2.5},{q:'Q2 27',amt:4.0},{q:'Q4 27',amt:6.5},{q:'Q2 28',amt:10.0}],
            note:'Approaching harvest. Anduril IPO is primary distribution catalyst. Unfunded nearly exhausted.'},
          {fund:'a16z Infra',vintage:2022,life:10,age:3.0,called:36,unfunded:32.0,distPct:0,phase:'Early Deploy',jPos:'Descent',nextCall:6.0,callTiming:'Q2 2026',
            callProj:[{q:'Q2 26',amt:6.0},{q:'Q4 26',amt:5.5},{q:'Q2 27',amt:5.0},{q:'Q4 27',amt:4.5},{q:'Q2 28',amt:4.0},{q:'Q4 28',amt:3.5},{q:'Q2 29',amt:2.0},{q:'Q4 29',amt:1.5}],
            distProj:[{q:'Q4 28',amt:2.0},{q:'Q2 29',amt:4.0},{q:'Q4 29',amt:6.0}],
            note:'⚠️ LARGEST UNFUNDED EXPOSURE ($32M). 64% still uncalled. Databricks IPO could trigger early return.'},
          {fund:'Benchmark X',vintage:2023,life:10,age:1.5,called:75,unfunded:5.0,distPct:0,phase:'Deploying',jPos:'Trough',nextCall:2.0,callTiming:'Q3 2026',
            callProj:[{q:'Q3 26',amt:2.0},{q:'Q1 27',amt:1.5},{q:'Q3 27',amt:1.0},{q:'Q1 28',amt:0.5}],
            distProj:[{q:'Q4 28',amt:1.0},{q:'Q2 29',amt:3.0},{q:'Q4 29',amt:5.0}],
            note:'Benchmark deploys fast (equal partnership, concentrated). 75% called in 18 months. Verkada partial exit possible.'},
          {fund:'Greylock XVII',vintage:2023,life:10,age:1.2,called:33,unfunded:20.0,distPct:0,phase:'Early Deploy',jPos:'Descent',nextCall:4.0,callTiming:'Q2 2026',
            callProj:[{q:'Q2 26',amt:4.0},{q:'Q4 26',amt:3.5},{q:'Q2 27',amt:3.0},{q:'Q4 27',amt:2.5},{q:'Q2 28',amt:2.0},{q:'Q4 28',amt:2.0},{q:'Q2 29',amt:1.5},{q:'Q4 29',amt:1.5}],
            distProj:[{q:'Q4 29',amt:1.0}],
            note:'⚠️ SELL CANDIDATE. If we sell on secondary, unfunded obligation transfers to buyer. $20M in future calls freed.'},
          {fund:'NEA 19',vintage:2020,life:12,age:5.2,called:95,unfunded:2.0,distPct:7,phase:'Harvest',jPos:'Ascent',nextCall:0.5,callTiming:'Q4 2026',
            callProj:[{q:'Q4 26',amt:0.5},{q:'Q2 27',amt:0.5},{q:'Q4 27',amt:0.5},{q:'Q2 28',amt:0.5}],
            distProj:[{q:'Q1 26',amt:2.8},{q:'Q3 26',amt:4.0},{q:'Q1 27',amt:6.0},{q:'Q3 27',amt:8.0},{q:'Q1 28',amt:12.0},{q:'Q3 28',amt:15.0}],
            note:'Distribution engine. $2.8M first distribution received. Palantir selling program active. Expect $4-6M/quarter by Q3 2026.'},
          {fund:'Sequoia US VIII',vintage:2021,life:10,age:4.0,called:63,unfunded:13.0,distPct:2,phase:'Mid Deploy',jPos:'Trough',nextCall:2.5,callTiming:'Q3 2026',
            callProj:[{q:'Q3 26',amt:2.5},{q:'Q1 27',amt:2.0},{q:'Q3 27',amt:2.0},{q:'Q1 28',amt:1.5},{q:'Q3 28',amt:1.5},{q:'Q1 29',amt:1.5},{q:'Q3 29',amt:1.0},{q:'Q1 30',amt:1.0}],
            distProj:[{q:'Q2 27',amt:2.0},{q:'Q4 27',amt:3.0},{q:'Q2 28',amt:5.0},{q:'Q4 28',amt:7.0}],
            note:'Sequoia restructuring caused deployment pause. Now accelerating. Large unfunded but predictable.'},
          {fund:'Khosla IX',vintage:2024,life:10,age:1.0,called:30,unfunded:14.0,distPct:0,phase:'Early Deploy',jPos:'Top of J',nextCall:3.0,callTiming:'Q2 2026',
            callProj:[{q:'Q2 26',amt:3.0},{q:'Q4 26',amt:2.5},{q:'Q2 27',amt:2.0},{q:'Q4 27',amt:2.0},{q:'Q2 28',amt:1.5},{q:'Q4 28',amt:1.5},{q:'Q2 29',amt:1.0},{q:'Q4 29',amt:0.5}],
            distProj:[{q:'Q4 29',amt:0.5}],
            note:'Youngest vintage. Climate/AI intersection. Calls will be steady for 3+ years. Small position manageable.'},
        ];
        const totalUnfunded=lifecycle.reduce((s,f)=>s+f.unfunded,0);
        const totalCalled=lifecycle.reduce((s,f)=>s+f.called/100*(f.called/100>0?(f.unfunded/(1-f.called/100)):0)+f.unfunded,0);
        const next12moCalls=lifecycle.reduce((s,f)=>s+f.callProj.filter(c=>['Q2 26','Q3 26','Q4 26','Q1 27'].includes(c.q)).reduce((a,c)=>a+c.amt,0),0);
        const next12moDist=lifecycle.reduce((s,f)=>s+f.distProj.filter(d=>['Q1 26','Q2 26','Q3 26','Q4 26','Q1 27'].includes(d.q)).reduce((a,d)=>a+d.amt,0),0);
        const phC={Deploying:T.blue,'Late Deploy':T.green,'Early Deploy':T.amber,Harvest:T.accent,'Mid Deploy':T.blue};
        const jC={'Top of J':T.textMuted,Descent:T.red,Trough:T.amber,Inflection:T.blue,Ascent:T.green};
        return(<div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
            <Stat label="Total Unfunded" value={`$${totalUnfunded.toFixed(1)}M`} icon={Clock} sub="future obligations" color={T.red}/>
            <Stat label="Next 12mo Calls" value={`$${next12moCalls.toFixed(1)}M`} icon={ArrowDownRight} sub="projected outflows" color={T.amber}/>
            <Stat label="Next 12mo Dist" value={`$${next12moDist.toFixed(1)}M`} icon={ArrowUpRight} sub="projected inflows" color={T.green}/>
            <Stat label="Net Cash Need" value={`$${(next12moCalls-next12moDist).toFixed(1)}M`} icon={DollarSign} sub="12mo net position" color={T.blue}/>
            <Stat label="Over-Commit Ratio" value={`${(totalUnfunded/194*100).toFixed(0)}%`} icon={AlertTriangle} sub={`${totalUnfunded.toFixed(0)}M / $194M NAV (max 60%)`} color={totalUnfunded/194>0.5?T.red:T.green}/>
          </div>

          {/* Ken's Commentary */}
          <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
            <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIO NOTE — KEN WALLACE</div>
            <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
              "At Industry Ventures, the #1 cause of FoF performance drag wasn't bad GP selection — it was cash drag from poor pacing. Every dollar sitting uninvested earning 4% while your GPs are deploying at 25%+ IRR is destroying your PME. Conversely, being caught short on a capital call means selling a secondary position at the worst possible moment. This model projects every call and distribution 8 quarters out. The red flags right now: a16z Infra has $32M unfunded (16.5% of NAV still uncalled), and Greylock XVII has $20M uncalled into a fund I'd rather sell. If we execute the Greylock secondary sale, we free up $20M in future obligations AND redeploy $7.5M in proceeds — that's $27.5M of total capital efficiency from one decision."
            </div>
          </div>

          {/* D3 Animated J-Curve — Fund Lifecycle Visualization */}
          <Card title="Portfolio J-Curve — D3 Animated Fund Lifecycle" action={<div style={{display:'flex',gap:4,alignItems:'center'}}>{Object.entries(phC).map(([k,c])=><span key={k} style={{display:'flex',alignItems:'center',gap:3,fontSize:8,color:T.textMuted}}><span style={{width:6,height:3,borderRadius:1,background:c}}/>{k}</span>)}</div>} style={{marginBottom:12}}><div style={{padding:'8px 12px'}}>
            <D3JCurve funds={lifecycle.map(f=>({...f,nav:f.called/100*(FUNDS.find(fu=>fu.name===f.fund)?.nav||10),committed:FUNDS.find(fu=>fu.name===f.fund)?.committed||20}))} width={710} height={320} />
          </div></Card>

          {/* Detailed Pacing Table */}
          <Card title="Commitment Pacing Model — 8-Quarter Projection"><div style={{padding:'8px 0'}}>
            <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
              <TH>Fund</TH><TH align="center">Phase</TH><TH align="center">J-Pos</TH><TH align="right">Called%</TH><TH align="right">Unfunded</TH><TH align="right">Next Call</TH><TH align="right">12mo Calls</TH><TH align="right">12mo Dist</TH><TH align="right">Net 12mo</TH><TH>CIO Flag</TH>
            </tr></thead><tbody>
              {lifecycle.sort((a,b)=>b.unfunded-a.unfunded).map((f,i)=>{
                const calls12=f.callProj.filter(c=>['Q2 26','Q3 26','Q4 26','Q1 27'].includes(c.q)).reduce((a,c)=>a+c.amt,0);
                const dist12=f.distProj.filter(d=>['Q1 26','Q2 26','Q3 26','Q4 26','Q1 27'].includes(d.q)).reduce((a,d)=>a+d.amt,0);
                const net=dist12-calls12;
                const flag=f.unfunded>15?'⚠️ HIGH UNFUNDED':net<-4?'⚠️ NET DRAIN':net>2?'✅ NET CONTRIBUTOR':'—';
                return(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:f.unfunded>20?`${T.red}06`:'transparent'}}>
                  <TD style={{fontWeight:700,fontSize:11}}>{f.fund}</TD>
                  <TD align="center"><Badge color={phC[f.phase]||T.textMuted}>{f.phase}</Badge></TD>
                  <TD align="center"><span style={{fontSize:10,fontWeight:700,color:jC[f.jPos]||T.textMuted}}>{f.jPos}</span></TD>
                  <TD align="right" mono bold color={f.called>80?T.green:f.called>50?T.blue:T.amber}>{f.called}%</TD>
                  <TD align="right" mono bold color={f.unfunded>15?T.red:f.unfunded>5?T.amber:T.green}>${f.unfunded.toFixed(1)}M</TD>
                  <TD align="right" mono>${f.nextCall.toFixed(1)}M</TD>
                  <TD align="right" mono color={T.red}>${calls12.toFixed(1)}M</TD>
                  <TD align="right" mono color={T.green}>${dist12.toFixed(1)}M</TD>
                  <TD align="right" mono bold color={net>0?T.green:T.red}>{net>0?'+':''}${net.toFixed(1)}M</TD>
                  <TD style={{fontSize:9,color:f.unfunded>15?T.red:net>2?T.green:T.textMuted}}>{flag}</TD>
                </tr>);
              })}
              <tr style={{background:T.accentBg,fontWeight:700}}><TD style={{fontWeight:800,color:T.accent}}>PORTFOLIO TOTAL</TD><TD/><TD/><TD/><TD align="right" mono bold color={T.red}>${totalUnfunded.toFixed(1)}M</TD><TD/><TD align="right" mono color={T.red}>${next12moCalls.toFixed(1)}M</TD><TD align="right" mono color={T.green}>${next12moDist.toFixed(1)}M</TD><TD align="right" mono bold color={(next12moDist-next12moCalls)>0?T.green:T.red}>{(next12moDist-next12moCalls)>0?'+':''}${(next12moDist-next12moCalls).toFixed(1)}M</TD><TD/></tr>
            </tbody></table>
          </div></Card>

          {/* Stress Test — Accelerated Calls */}
          <Card title="Stress Test — Accelerated Capital Call Scenario" style={{marginTop:12}}><div style={{padding:'12px 16px'}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10}}>
              {[{scenario:'Normal Pacing',calls:next12moCalls,coverage:(15+28)/next12moCalls,color:T.green,desc:'Expected call schedule. Coverage = (Cash $15M + Credit $28M) / Projected Calls'},
                {scenario:'1.5x Acceleration',calls:next12moCalls*1.5,coverage:(15+28)/(next12moCalls*1.5),color:T.blue,desc:'GPs deploy 50% faster than projected. Typical in hot markets. Still manageable with credit facility.'},
                {scenario:'2x Acceleration',calls:next12moCalls*2,coverage:(15+28)/(next12moCalls*2),color:T.amber,desc:'All GPs call simultaneously at max pace. Would require secondary sale ($10-15M) to cover. Trigger: sell Greylock XVII.'},
                {scenario:'Stress + No Dist',calls:next12moCalls*2,coverage:15/(next12moCalls*2),color:T.red,desc:'2x calls + zero distributions + no credit facility. Worst case. Requires immediate secondary sales of $20M+ in positions.'}
              ].map((s,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:10,borderTop:`3px solid ${s.color}`}}>
                <div style={{fontSize:10,fontWeight:800,color:s.color}}>{s.scenario}</div>
                <div style={{display:'flex',justifyContent:'space-between',marginTop:6,marginBottom:6}}>
                  <div><div style={{fontSize:7,color:T.textDim}}>12MO CALLS</div><div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:T.text}}>${s.calls.toFixed(1)}M</div></div>
                  <div><div style={{fontSize:7,color:T.textDim}}>COVERAGE RATIO</div><div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:s.coverage>=1.5?T.green:s.coverage>=1?T.blue:T.red}}>{s.coverage.toFixed(1)}x</div></div>
                </div>
                <Bar value={Math.min(100,s.coverage*50)} max={100} color={s.color} h={5}/>
                <div style={{fontSize:8,color:T.textMuted,marginTop:4,lineHeight:1.3}}>{s.desc}</div>
              </div>))}
            </div>
          </div></Card>
        </div>);
      })()}

      {/* ═══ TAB 12: SECONDARY LAB — Ken Wallace's 400+ Transaction Pricing Framework ═══ */}
      {/* "I've done 400+ secondary transactions at Industry Ventures. The #1 mistake people make */}
      {/* is anchoring to stated NAV. NAV is the GP's OPINION. Your job is to build a look-through */}
      {/* model that tells you what the assets are actually worth, independent of what the GP says." — KW */}
      {aView==='seclab'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Active Targets" value="6" icon={Target} sub="secondary pipeline" color={T.accent}/>
          <Stat label="Avg Discount" value="22.8%" icon={TrendingDown} sub="to stated NAV" color={T.green}/>
          <Stat label="Look-Through Δ" value="+8.4%" icon={Eye} sub="NAV understatement" color={T.blue}/>
          <Stat label="IVs Completed" value="400+" icon={CheckCircle} sub="Ken's track record" color={T.purple}/>
        </div>

        {/* Ken's Commentary */}
        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIO NOTE — SECONDARY PRICING METHODOLOGY</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "Every secondary gets three valuations: (1) GP-stated NAV — what they tell you it's worth; (2) Look-through NAV — what the top 10 holdings are actually worth using public comps, recent transactions, and our own models; (3) Liquidation NAV — what you'd get if you had to sell everything tomorrow. Your bid should be below ALL THREE. The spread between GP NAV and look-through NAV tells you if the GP is conservative (buy) or aggressive (avoid). At Industry Ventures, our best secondaries were funds where the GP was marking conservatively and a single IPO catalyst would unlock 40-60% upside."
          </div>
        </div>

        {/* Secondary Pricing Matrix */}
        <Card title="Look-Through Pricing Engine — Active Secondary Targets"><div style={{padding:'8px 0'}}>
          {[
            {fund:'Tiger Global PIP 15',gpNav:8100,ltNav:9558,liqNav:6480,ask:62,bid:57,ourBid:55,
              topHoldings:[{co:'Stripe',gpMark:6500,ltVal:8200,pct:80,catalyst:'IPO Q2-Q3 2026',method:'12x ARR ($25B rev est) vs Adyen 15x'},{co:'Figma',gpMark:3200,ltVal:3500,pct:40,catalyst:'Adobe deal dead; standalone growth',method:'15x ARR ($350M) based on Canva comp'},{co:'Checkout.com',gpMark:2100,ltVal:1800,pct:22,catalyst:'Profitability pivot',method:'8x ARR ($800M) — payments sector compressed'}],
              markQuality:'CONSERVATIVE',markDelta:'+18%',zombiePct:22,zombieVal:1782,tailRisk:'40+ companies in tail. Est $1.8B value but illiquid.',
              verdict:'STRONG BUY at 55¢. Look-through NAV = $9.56B (18% above GP mark). Stripe IPO alone justifies entry. Zombie tail = 22% of NAV but priced in at 57¢ ask.',
              irrScenarios:{bear:8,base:28,bull:52},holdPeriod:'3-5 years',kenScore:94},
            {fund:'Sequoia GGF III',gpNav:2800,ltNav:3220,liqNav:2380,ask:82,bid:78,ourBid:76,
              topHoldings:[{co:'Stripe',gpMark:850,ltVal:1050,pct:30,catalyst:'IPO',method:'Same as above — portfolio overlap'},{co:'Databricks',gpMark:620,ltVal:780,pct:22,catalyst:'S-1 filed, IPO Q3 2026',method:'18x ARR ($2.4B) vs Snowflake 16x'},{co:'Wiz',gpMark:380,ltVal:440,pct:14,catalyst:'IPO or Google M&A at $20B+',method:'40x ARR ($500M) — cybersecurity premium'}],
              markQuality:'SLIGHTLY CONSERVATIVE',markDelta:'+15%',zombiePct:18,zombieVal:504,tailRisk:'Restructuring cleaned worst positions. Tail manageable.',
              verdict:'BUY at 76¢. Sequoia marks are historically conservative. Three IPO catalysts in 12 months. Restructuring reduced zombie exposure.',
              irrScenarios:{bear:8,base:25,bull:42},holdPeriod:'2-4 years',kenScore:91},
            {fund:'Founders Fund VI',gpNav:1900,ltNav:2470,liqNav:1710,ask:115,bid:108,ourBid:110,
              topHoldings:[{co:'SpaceX',gpMark:1200,ltVal:1680,pct:63,catalyst:'Tender/IPO H2 2026',method:'$380B implied on secondaries. FF marks at $270B.'},{co:'Anduril',gpMark:280,ltVal:350,pct:15,catalyst:'IPO S-1 imminent',method:'$28B round → $35B+ at IPO multiple'},{co:'Palantir',gpMark:180,ltVal:210,pct:9,catalyst:'Public — mark-to-market',method:'$180B mkt cap, GP lagging by 30 days'}],
              markQuality:'VERY CONSERVATIVE',markDelta:'+30%',zombiePct:8,zombieVal:152,tailRisk:'Concentrated fund. SpaceX is 63% of NAV. Minimal tail.',
              verdict:'BUY at 110¢ (premium). This is a SpaceX proxy trade. Look-through NAV is $2.47B — 30% above GP mark. At 110¢ you are paying $2.09B for assets worth $2.47B. The premium to stated NAV is justified; you are still at an 18% discount to real value.',
              irrScenarios:{bear:5,base:22,bull:38},holdPeriod:'1-3 years',kenScore:92},
          ].map((s,si)=>(<Card key={si} title={s.fund} style={{marginBottom:10,borderLeft:`3px solid ${s.kenScore>=92?T.accent:s.kenScore>=88?T.green:T.blue}`}} action={<span style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.accent}}>{s.kenScore}</span>}>
            <div style={{padding:'12px 16px'}}>
              {/* Three NAV comparison */}
              <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:6,marginBottom:10}}>
                {[{l:'GP NAV',v:`$${(s.gpNav/1000).toFixed(1)}B`,c:T.textMuted},{l:'Look-Through',v:`$${(s.ltNav/1000).toFixed(1)}B`,c:T.accent},{l:'Liquidation',v:`$${(s.liqNav/1000).toFixed(1)}B`,c:T.red},{l:'Mark Quality',v:s.markQuality,c:s.markDelta.startsWith('+')?T.green:T.red},{l:'Mark Delta',v:s.markDelta,c:T.green},{l:'Our Bid',v:`${s.ourBid}¢`,c:T.accent}].map((m,i)=><div key={i} style={{background:T.bgAccent,borderRadius:4,padding:'6px 4px',textAlign:'center'}}><div style={{fontSize:7,color:T.textDim}}>{m.l}</div><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div></div>)}
              </div>
              {/* Top holdings look-through */}
              <div style={{fontSize:9,fontWeight:700,color:T.textDim,marginBottom:4}}>TOP HOLDINGS — LOOK-THROUGH ANALYSIS</div>
              <table style={{width:'100%',borderCollapse:'collapse',marginBottom:8}}><thead><tr><TH>Company</TH><TH align="right">GP Mark</TH><TH align="right">LT Value</TH><TH align="right">% NAV</TH><TH>Catalyst</TH><TH>Valuation Method</TH></tr></thead><tbody>
                {s.topHoldings.map((h,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
                  <TD style={{fontWeight:600}}>{h.co}</TD><TD align="right" mono>${(h.gpMark/1000).toFixed(1)}B</TD>
                  <TD align="right" mono bold color={h.ltVal>h.gpMark?T.green:T.red}>${(h.ltVal/1000).toFixed(1)}B</TD>
                  <TD align="right" mono>{h.pct}%</TD><TD style={{fontSize:9,color:T.accent}}>{h.catalyst}</TD>
                  <TD style={{fontSize:8,color:T.textMuted}}>{h.method}</TD>
                </tr>))}
              </tbody></table>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:6,marginBottom:8}}>
                <div style={{fontSize:9,color:T.textMuted}}><strong style={{color:T.amber}}>Zombie Tail:</strong> {s.zombiePct}% of NAV (${(s.zombieVal/1000).toFixed(1)}B) — {s.tailRisk}</div>
                <div style={{display:'flex',gap:4}}>{[{l:'Bear',v:s.irrScenarios.bear,c:T.red},{l:'Base',v:s.irrScenarios.base,c:T.accent},{l:'Bull',v:s.irrScenarios.bull,c:T.green}].map((sc,i)=><div key={i} style={{flex:1,textAlign:'center',background:T.bgAccent,borderRadius:4,padding:4}}><div style={{fontSize:7,color:T.textDim}}>{sc.l} IRR</div><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:sc.c}}>{sc.v}%</div></div>)}</div>
                <div style={{fontSize:9,color:T.textMuted}}><strong>Hold Period:</strong> {s.holdPeriod}</div>
              </div>
              <div style={{padding:'8px 12px',background:T.accentBg,borderRadius:6,border:`1px solid ${T.accent}30`}}>
                <div style={{fontSize:8,color:T.textDim}}>KEN'S VERDICT</div>
                <div style={{fontSize:11,color:T.accent,fontWeight:600,lineHeight:1.4}}>{s.verdict}</div>
              </div>
            </div>
          </Card>))}
        </div></Card>
      </div>)}

      {/* ═══ TAB 13: RE-UP FRAMEWORK & REFERENCE CALLS — Ken Wallace Institutional Process ═══ */}
      {/* "The re-up decision is the single most important decision in FoF investing. You already KNOW */}
      {/* this GP. You have data. The question is: did they get better or worse? And can you see it */}
      {/* in the references before the numbers tell you?" — KW */}
      {aView==='reup'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Re-Ups Due" value="3" icon={RefreshCw} sub="next 12 months" color={T.accent}/>
          <Stat label="Ref Calls Done" value="48" icon={Phone} sub="this quarter" color={T.green}/>
          <Stat label="Re-Up Rate" value="72%" icon={CheckCircle} sub="historical (Industry Ventures)" color={T.blue}/>
          <Stat label="Red Flags" value="2" icon={AlertTriangle} sub="active warnings" color={T.red}/>
        </div>

        {/* Ken's re-up framework */}
        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIO NOTE — THE RE-UP DECISION</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "At Industry Ventures, re-ups were our highest-conviction bets. You already have 3-5 years of data on the GP. The academic evidence (Harris-Jenkinson-Kaplan 2014) shows top-quartile GPs have a 65% probability of repeating. But that means 35% DON'T. The re-up framework below separates the signal from the noise. Three questions: (1) Is the TEAM the same? Key-person departures are the #1 predictor of fund degradation. (2) Did they get BETTER at what made them good? Or did success make them lazy? (3) Is the MARKET still there? Some GPs were lucky with timing, not skillful with selection."
          </div>
        </div>

        {/* Re-Up Decision Matrix */}
        <Card title="Re-Up Decision Matrix — Active Portfolio" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Fund → Next Fund</TH><TH align="center">Current TVPI</TH><TH align="center">Persistence Score</TH><TH align="center">Team Stability</TH><TH align="center">Size Creep</TH><TH align="center">Re-Up Score</TH><TH align="center">Decision</TH><TH>Rationale</TH>
          </tr></thead><tbody>
            {[
              {curr:'Benchmark X',next:'Benchmark XI',tvpi:'1.62x',persist:95,team:98,sizeCreep:'$1.25B→$1.5B',sizeFlag:false,score:96,dec:'RE-UP $20M',rat:'Equal partnership preserved. No size creep (20% growth is modest). 1.62x at 18mo is exceptional. Peter Fenton AI thesis + Bill Gurley market structure = unique combo. Re-up at same size. No hesitation.',c:T.accent},
              {curr:'Founders Fund VII',next:'FF VIII',tvpi:'1.46x',persist:92,team:90,sizeCreep:'$1.8B→$2.2B',sizeFlag:false,score:92,dec:'RE-UP $25M (↑)',rat:'Founders Fund is the best-performing GP in portfolio. 1.46x at 3.2yr. Thiel thesis validated by Anduril, Anthropic, SpaceX. 22% size increase is manageable. INCREASE commitment — earn co-invest rights.',c:T.accent},
              {curr:'Lux Capital VI',next:'Lux VII',tvpi:'1.50x',persist:88,team:92,sizeCreep:'$800M→$1.1B',sizeFlag:true,score:85,dec:'RE-UP $15M (=)',rat:'Strong performance but 38% fund size increase concerns me. Lux was best when concentrated ($400-600M). At $1.1B they are entering mid-stage territory. Re-up at same size, not more.',c:T.green},
              {curr:'NEA 19',next:'NEA 20',tvpi:'1.85x',persist:82,team:78,sizeCreep:'$4B→$5.2B',sizeFlag:true,score:72,dec:'REDUCE TO $25M (↓)',rat:'⚠️ TOP PERFORMER but THREE red flags: (1) Partner departures — 2 senior partners left in 2025; (2) Fund size +30% to $5.2B — entering mega-fund territory where alpha dies; (3) Our NEA 19 position already 31.9% of NAV. Reduce commitment. Maintain relationship.',c:T.amber},
              {curr:'a16z Infra',next:'a16z Infra II',tvpi:'1.25x',persist:75,team:85,sizeCreep:'$3.5B→$4.5B',sizeFlag:true,score:62,dec:'PASS (NO RE-UP)',rat:'⚠️ BELOW THRESHOLD. 1.25x TVPI is median, not top-quartile. $4.5B fund size destroys alpha (Kaplan evidence). a16z brand premium no longer justified by returns. We are OVERSIZED in a16z Infra already. Use secondary sale proceeds to exit gradually.',c:T.red},
              {curr:'Greylock XVII',next:'Greylock XVIII',tvpi:'1.18x',persist:60,team:82,sizeCreep:'$1B→$1B',sizeFlag:false,score:48,dec:'PASS + SELL XVII',rat:'⚠️ HARD PASS. 1.18x at 14 months is below median. WorkOS markdown. GovTech thesis stalled. No size creep but no performance either. Sell XVII on secondary at 85-90¢. Do not re-up. Reallocate to Thorn Ventures (Delian spinout).',c:T.red},
              {curr:'Sequoia US VIII',next:'Sequoia X',tvpi:'1.40x',persist:78,team:80,sizeCreep:'$2.2B→$TBD',sizeFlag:false,score:70,dec:'DEFER — WATCH',rat:'Sequoia restructuring creates uncertainty. New structure (Sequoia Capital vs Sequoia Heritage) is untested. 1.40x is solid but not compelling enough to re-up into unknown structure. Wait for clarity on new fund terms and team composition.',c:T.amber},
            ].map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:r.score<65?`${T.red}06`:r.score>=90?`${T.accent}04`:'transparent'}}>
              <TD><div style={{fontSize:11,fontWeight:700,color:T.text}}>{r.curr}</div><div style={{fontSize:9,color:T.textMuted}}>→ {r.next}</div></TD>
              <TD align="center" mono bold color={parseFloat(r.tvpi)>=1.5?T.accent:parseFloat(r.tvpi)>=1.3?T.green:parseFloat(r.tvpi)>=1.1?T.blue:T.red}>{r.tvpi}</TD>
              <TD align="center"><span style={{fontSize:12,fontWeight:700,fontFamily:mono,color:r.persist>=90?T.accent:r.persist>=80?T.green:r.persist>=70?T.blue:T.red}}>{r.persist}</span></TD>
              <TD align="center"><span style={{fontSize:12,fontWeight:700,fontFamily:mono,color:r.team>=90?T.accent:r.team>=80?T.green:T.amber}}>{r.team}</span></TD>
              <TD align="center"><span style={{fontSize:10,color:r.sizeFlag?T.red:T.green}}>{r.sizeCreep} {r.sizeFlag?'⚠️':'✓'}</span></TD>
              <TD align="center"><span style={{display:'inline-block',width:32,height:32,borderRadius:'50%',lineHeight:'32px',textAlign:'center',fontSize:13,fontWeight:800,fontFamily:mono,background:r.score>=85?T.accentBg:r.score>=70?`${T.green}15`:r.score>=60?`${T.amber}15`:`${T.red}15`,color:r.score>=85?T.accent:r.score>=70?T.green:r.score>=60?T.amber:T.red}}>{r.score}</span></TD>
              <TD align="center"><Badge color={r.c}>{r.dec}</Badge></TD>
              <TD style={{fontSize:9,color:T.textMuted,lineHeight:1.3,maxWidth:220}}>{r.rat}</TD>
            </tr>))}
          </tbody></table>
        </div></Card>

        {/* Structured Reference Call Framework */}
        <Card title="Reference Call Scoring Framework — Institutional Standard" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:12}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:6}}>REFERENCE CALL PROTOCOL (MIN 8 PER GP)</div>
              {[{type:'Founders (Portfolio Cos)',n:'3 minimum',q:['How did they behave when things went wrong?','Did they add value beyond capital?','Would you take their money again?','Did they follow through on promises?'],weight:30,c:T.accent},
                {type:'Co-Investors (Syndicate)',n:'2 minimum',q:['Would you co-invest with them again?','Do they do their own work or follow?','How do they behave in down rounds?'],weight:25,c:T.green},
                {type:'Current LPs',n:'2 minimum',q:['How transparent is reporting?','Did capital calls match projections?','Any surprises — positive or negative?'],weight:25,c:T.blue},
                {type:'Passed Deals (Back-channel)',n:'1 minimum',q:['Why did you pass on this fund?','What concerns did your DD surface?','What would change your mind?'],weight:20,c:T.amber},
              ].map((ref,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,marginBottom:6,borderLeft:`3px solid ${ref.c}`}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}><span style={{fontSize:10,fontWeight:700,color:ref.c}}>{ref.type}</span><span style={{fontSize:9,color:T.textMuted}}>{ref.n} • {ref.weight}% weight</span></div>
                {ref.q.map((q,j)=><div key={j} style={{fontSize:9,color:T.textMuted,padding:'1px 0 1px 8px',borderLeft:`1px solid ${ref.c}40`}}>{q}</div>)}
              </div>))}
            </div>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.red,marginBottom:6}}>RED FLAG DETECTION — AUTOMATIC DISQUALIFIERS</div>
              {[{flag:'Key-Person Departure',severity:'CRITICAL',desc:'Any GP with >20% portfolio ownership leaving within 12mo of fundraise. At Industry Ventures this predicted 78% of fund performance degradation.',score:'-15 points',trigger:'Auto-trigger IC review'},
                {flag:'Fund Size >2x Previous',severity:'HIGH',desc:'Kaplan evidence: funds that double in size lose 300-500bps of alpha. Diseconomies of scale in VC are real and permanent.',score:'-10 points',trigger:'Requires explicit IC justification'},
                {flag:'LP Concentration >30%',severity:'HIGH',desc:'Single LP >30% creates redemption risk. If anchor LP pulls out, fund may not reach subsequent close.',score:'-8 points',trigger:'Verify LP composition'},
                {flag:'DPI <0.3x by Year 5',severity:'MEDIUM',desc:'Failure to return 30% of capital by Year 5 indicates exit execution problems. May be market-dependent but warrants scrutiny.',score:'-5 points',trigger:'Deep-dive exit pipeline'},
                {flag:'Style Drift',severity:'MEDIUM',desc:'GP moving from seed to growth, or single sector to multi-sector, without clear strategic rationale. "If they were great at seed, why are they now doing Series C?"',score:'-5 points',trigger:'IC discussion'},
                {flag:'Reference Refusal',severity:'CRITICAL',desc:'GP refuses to provide specific references or restricts who you can call. "If they wont let you talk to their founders, there is a reason."',score:'AUTO FAIL',trigger:'Immediate pass'},
              ].map((rf,i)=>(<div key={i} style={{background:`${T.red}05`,borderRadius:4,padding:'6px 8px',marginBottom:4,borderLeft:`3px solid ${rf.severity==='CRITICAL'?T.red:rf.severity==='HIGH'?T.amber:T.blue}`}}>
                <div style={{display:'flex',justifyContent:'space-between'}}><span style={{fontSize:10,fontWeight:700,color:rf.severity==='CRITICAL'?T.red:rf.severity==='HIGH'?T.amber:T.blue}}>{rf.flag}</span><span style={{fontSize:9,fontFamily:mono,color:T.red,fontWeight:700}}>{rf.score}</span></div>
                <div style={{fontSize:9,color:T.textMuted,lineHeight:1.3,marginTop:2}}>{rf.desc}</div>
              </div>))}
              <div style={{background:T.accentBg,borderRadius:6,padding:8,marginTop:8}}>
                <div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:2}}>KENISM™</div>
                <div style={{fontSize:10,color:T.text,fontStyle:'italic',lineHeight:1.4}}>"The best reference call is the one they don't know you're making. The founder who WASN'T on the GP's reference list tells you more than the three who were."</div>
              </div>
            </div>
          </div>
        </div></Card>

        {/* Active Reference Summary */}
        <Card title="Active Reference Call Log — Current Quarter"><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr><TH>GP</TH><TH>Context</TH><TH align="center">Founders</TH><TH align="center">Co-Inv</TH><TH align="center">LPs</TH><TH align="center">Back-ch</TH><TH align="center">Total</TH><TH align="center">Score</TH><TH>Key Finding</TH></tr></thead><tbody>
            {[
              {gp:'Benchmark (XI re-up)',ctx:'Re-Up',fn:4,ci:2,lp:3,bc:1,total:10,score:96,finding:'Unanimous praise. Equal partnership is genuinely equal. "Best board member I have ever had." Zero negative references in 10 calls.'},
              {gp:'Founders Fund (VIII re-up)',ctx:'Re-Up',fn:3,ci:2,lp:2,bc:1,total:8,score:92,finding:'Founders love the "anti-VC" approach. One concern: Thiel political exposure creating founder hesitancy in certain sectors. Overall: exceptional.'},
              {gp:'NEA (20 re-up)',ctx:'Re-Up',fn:3,ci:2,lp:3,bc:2,total:10,score:72,finding:'⚠️ Mixed. Two partner departures confirmed by LP refs. "Fund has gotten too big. The partners I liked are gone." Back-channel confirms style drift toward growth.'},
              {gp:'Thorn Ventures (new)',ctx:'New Commitment',fn:4,ci:3,lp:2,bc:2,total:11,score:94,finding:'Exceptional. Delian back-channeled as "most prepared investor I have ever met." FF founders confirmed he led the diligence on Shield AI, Saronic. Thiel endorsement verified.'},
              {gp:'Radical AI (new)',ctx:'New Commitment',fn:3,ci:2,lp:1,bc:2,total:8,score:88,finding:'Strong technical references. Anthropic colleagues confirm she was "the brains behind Constitutional AI safety testing." Only concern: operator transition from researcher.'},
              {gp:'Greylock (XVII — sell)',ctx:'Sell Decision',fn:2,ci:1,lp:2,bc:1,total:6,score:55,finding:'⚠️ Confirms sell decision. "GovTech thesis is 3 years too early." WorkOS founder declined to provide reference. LP confirmed extending deployment timeline.'},
            ].map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:r.score<65?`${T.red}06`:'transparent'}}>
              <TD style={{fontWeight:700,fontSize:11}}>{r.gp}</TD>
              <TD><Badge color={r.ctx==='Re-Up'?T.blue:r.ctx==='New Commitment'?T.green:T.red}>{r.ctx}</Badge></TD>
              <TD align="center" mono>{r.fn}</TD><TD align="center" mono>{r.ci}</TD><TD align="center" mono>{r.lp}</TD><TD align="center" mono>{r.bc}</TD>
              <TD align="center" mono bold>{r.total}</TD>
              <TD align="center"><span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:r.score>=90?T.accent:r.score>=80?T.green:r.score>=70?T.blue:r.score>=60?T.amber:T.red}}>{r.score}</span></TD>
              <TD style={{fontSize:9,color:r.score<65?T.red:T.textMuted,lineHeight:1.3,maxWidth:250}}>{r.finding}</TD>
            </tr>))}
          </tbody></table>
        </div></Card>
      </div>)}

      {/* ═══ TAB 14: FEE WATERFALL & AFFE — Total Cost Transparency ═══ */}
      {/* "When Bob walks into Mercer's product committee, the FIRST slide they'll ask for isn't returns. */}
      {/* It's total cost. If we can't show a clean AFFE decomposition with all-in cost vs peers, */}
      {/* we won't get on a single platform. I've watched this kill five FoF launches." — KW */}
      {aView==='affe'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="NEWCO Mgmt Fee" value="1.25%" icon={DollarSign} sub="25-40% below peers" color={T.accent}/>
          <Stat label="AFFE (Estimated)" value="1.52%" icon={Layers} sub="acquired fund fees" color={T.blue}/>
          <Stat label="Total All-In Cost" value="2.77%" icon={Target} sub="mgmt + AFFE" color={T.amber}/>
          <Stat label="Peer All-In" value="4.20%" icon={TrendingUp} sub="typical FoF total" color={T.red}/>
          <Stat label="Cost Advantage" value="143bps" icon={Award} sub="annual savings to shareholder" color={T.green}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIO NOTE — WHY FEE TRANSPARENCY WINS PLATFORM SHELF SPACE</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "RIA platforms run fee audits on every product. Mercer, Pathstone, Bessemer — they all have investment policy committees that cap total expense ratios. The typical FoF charges 1.5-2.0% management fee PLUS 2/20 underlying GP fees PLUS performance allocation = 4.2% total drag. Our structure: 1.25% management + negotiated AFFE discounts (anchor LP leverage) + 10% performance above 8% hurdle = 2.77% total. That 143bps annual advantage COMPOUNDS. Over 10 years, it's the difference between 2.8x and 3.5x gross-to-net. Every basis point matters."
          </div>
        </div>

        {/* Fee Layer Waterfall */}
        <Card title="Fee Waterfall — Complete Cost Decomposition by Layer" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:16}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:8}}>NEWCO TOTAL COST (INVESTOR PERSPECTIVE)</div>
              {[
                {layer:'Layer 1: NEWCO Management Fee',rate:'1.25%',dollars:'$3.1M',note:'On $250M NAV. Fixed. Covers team, technology, compliance. 25-40% below peer 1.5-2.0%.',c:T.accent,bar:30},
                {layer:'Layer 2: AFFE — Underlying GP Management Fees',rate:'1.52%',dollars:'$3.8M',note:'Weighted avg across 8 GPs. Negotiated 0.25-0.50% below rack rate via anchor LP status.',c:T.blue,bar:37},
                {layer:'Layer 3: NEWCO Performance Fee',rate:'0.00%*',dollars:'$0',note:'*10% above 8% hurdle. Year 1: below hurdle, no performance fee. Est Year 3+: ~0.8-1.2% if returns hit 22%+.',c:T.green,bar:0},
                {layer:'Layer 4: Underlying GP Carry',rate:'~0%*',dollars:'$0',note:'*Carry accrues to GP, not charged as fee to LPs. Reflected in NAV, not expense ratio. Industry standard.',c:T.textMuted,bar:0},
                {layer:'Layer 5: Operating Expenses',rate:'0.35%',dollars:'$0.9M',note:'Legal, audit, custody, insurance, NYSE listing fees, compliance. Controlled by scale.',c:T.amber,bar:8},
                {layer:'TOTAL ALL-IN (Year 1)',rate:'3.12%',dollars:'$7.8M',note:'Conservative. Drops to ~2.77% at scale as fixed costs spread. Significantly below 4.2% peer avg.',c:T.accent,bar:75},
              ].map((f,i)=>(<div key={i} style={{marginBottom:i<5?8:0,paddingBottom:i<5?8:0,borderBottom:i<5?`1px solid ${T.border}`:`2px solid ${T.accent}`}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:3}}>
                  <span style={{fontSize:10,fontWeight:i===5?800:600,color:i===5?T.accent:T.text}}>{f.layer}</span>
                  <div style={{display:'flex',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:13,fontWeight:800,fontFamily:mono,color:f.c}}>{f.rate}</span>
                    <span style={{fontSize:10,fontFamily:mono,color:T.textMuted}}>{f.dollars}</span>
                  </div>
                </div>
                <Bar value={f.bar} max={100} color={f.c} h={4}/>
                <div style={{fontSize:9,color:T.textMuted,marginTop:2,lineHeight:1.3}}>{f.note}</div>
              </div>))}
            </div>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.red,marginBottom:8}}>PEER COMPARISON — TOTAL COST</div>
              {[
                {name:'NEWCO (Year 1)',mgmt:1.25,affe:1.52,perf:0,ops:0.35,total:3.12,c:T.accent},
                {name:'NEWCO (At Scale)',mgmt:1.25,affe:1.32,perf:0.85,ops:0.20,total:3.62,c:T.green},
                {name:'HarbourVest',mgmt:1.50,affe:1.80,perf:1.00,ops:0.40,total:4.70,c:T.red},
                {name:'Pantheon',mgmt:1.75,affe:1.90,perf:0.80,ops:0.45,total:4.90,c:T.red},
                {name:'ICG Enterprise',mgmt:1.40,affe:1.75,perf:0.90,ops:0.35,total:4.40,c:T.red},
                {name:'Typical Private FoF',mgmt:2.00,affe:2.00,perf:1.50,ops:0.50,total:6.00,c:T.red},
              ].map((p,i)=>(<div key={i} style={{display:'grid',gridTemplateColumns:'120px repeat(5,1fr) 60px',gap:4,padding:'5px 0',borderBottom:`1px solid ${T.border}`,alignItems:'center'}}>
                <span style={{fontSize:10,fontWeight:i<2?700:500,color:i<2?T.accent:T.text}}>{p.name}</span>
                {[p.mgmt,p.affe,p.perf,p.ops].map((v,j)=><span key={j} style={{fontSize:10,fontFamily:mono,textAlign:'center',color:T.textMuted}}>{v.toFixed(2)}%</span>)}
                <span style={{fontSize:12,fontWeight:800,fontFamily:mono,textAlign:'center',color:p.c}}>{p.total.toFixed(1)}%</span>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:700,textAlign:'right',color:i<2?T.green:T.red}}>{i>=2?`+${(p.total-3.12).toFixed(0)}bps`:i===1?'+50bps':'BASE'}</span>
              </div>))}
              <div style={{fontSize:8,color:T.textDim,marginTop:6}}>Columns: Mgmt Fee | AFFE | Perf Fee | OpEx | Total | vs NEWCO Y1</div>

              <div style={{background:T.accentBg,borderRadius:6,padding:8,marginTop:10}}>
                <div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:2}}>10-YEAR COMPOUNDING IMPACT</div>
                <div style={{fontSize:10,color:T.text,lineHeight:1.4}}>143bps annual cost advantage × 10 years = <strong style={{color:T.accent}}>$1.00 invested → $1.48 at 4.2% drag vs $1.75 at 2.77% drag</strong>. The fee advantage alone generates 18% more terminal wealth for our shareholders.</div>
              </div>
            </div>
          </div>
        </div></Card>

        {/* AFFE by GP — Negotiated Rates */}
        <Card title="AFFE Detail — Acquired Fund Fees by GP (Negotiated vs Rack Rate)"><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Fund / GP</TH><TH align="center">Rack Rate</TH><TH align="center">Negotiated</TH><TH align="center">Savings</TH><TH align="center">Carry</TH><TH align="center">Commitment</TH><TH align="center">Wt. Contrib</TH><TH>Anchor LP Terms</TH>
          </tr></thead><tbody>
            {[
              {gp:'Founders Fund VII',rack:2.0,neg:1.5,carry:'20%',commit:25,wtContrib:0.31,terms:'Anchor LP: no fee on committed, fee on invested only. Carry-free co-invest rights on ALL deals.'},
              {gp:'Lux Capital VI',rack:2.0,neg:1.75,carry:'20%',commit:15,wtContrib:0.22,terms:'First-close LP discount. MOIC-based carry (not IRR) aligns incentives with long holds.'},
              {gp:'Benchmark X',rack:2.5,neg:2.5,carry:'30%',commit:20,wtContrib:0.42,terms:'No negotiation — Benchmark doesn\'t discount. 2.5/30 is the price of top-decile access. Worth it.'},
              {gp:'NEA 19',rack:2.0,neg:1.75,carry:'20%',commit:50,wtContrib:0.73,terms:'Scale discount for $50M+ commitment. European waterfall. 8% preferred return.'},
              {gp:'Sequoia US VIII',rack:2.5,neg:2.0,carry:'20%',commit:35,wtContrib:0.58,terms:'Heritage structure discount. Recycling provisions cap total fee load.'},
              {gp:'a16z Infra',rack:2.5,neg:2.25,carry:'20%',commit:35,wtContrib:0.66,terms:'Minimal negotiation leverage — a16z runs a take-it-or-leave-it process. Size discount only.'},
              {gp:'Greylock XVII',rack:2.0,neg:1.75,carry:'20%',commit:30,wtContrib:0.44,terms:'Standard anchor terms. Note: if we sell on secondary, buyer inherits our terms.'},
              {gp:'Khosla IX',rack:2.5,neg:2.0,carry:'25%',commit:7.2,wtContrib:0.12,terms:'Emerging commitment → standard terms. Too small for meaningful anchor leverage.'},
            ].map((g,i)=>{const sav=g.rack-g.neg;return(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
              <TD style={{fontWeight:700,fontSize:11}}>{g.gp}</TD>
              <TD align="center" mono color={T.textMuted}>{g.rack.toFixed(1)}%</TD>
              <TD align="center" mono bold color={sav>0?T.green:T.text}>{g.neg.toFixed(2)}%</TD>
              <TD align="center" mono bold color={T.green}>{sav>0?`-${(sav*100).toFixed(0)}bps`:'—'}</TD>
              <TD align="center" mono>{g.carry}</TD>
              <TD align="center" mono>${g.commit}M</TD>
              <TD align="center" mono color={T.accent}>{g.wtContrib.toFixed(2)}%</TD>
              <TD style={{fontSize:9,color:T.textMuted,lineHeight:1.3}}>{g.terms}</TD>
            </tr>);})}
            <tr style={{background:T.accentBg,fontWeight:700}}><TD style={{fontWeight:800,color:T.accent}}>WEIGHTED AFFE</TD><TD align="center" mono color={T.red}>2.19%</TD><TD align="center" mono bold color={T.accent}>1.52%</TD><TD align="center" mono bold color={T.green}>-67bps</TD><TD/><TD align="center" mono>$217M</TD><TD align="center" mono color={T.accent}>1.52%</TD><TD style={{fontSize:9,color:T.accent}}>Anchor LP leverage saves shareholders $1.5M/year in underlying fees</TD></tr>
          </tbody></table>
        </div></Card>
      </div>)}

      {/* ═══ TAB 15: VINTAGE YEAR OPTIMIZER — Commitment Pacing Calendar ═══ */}
      {/* "Cambridge Associates data shows vintage diversification explains 60% of FoF return variance. */}
      {/* I've seen funds blow up because they committed 70% of capital in 2021 — right at the peak. */}
      {/* This calendar forces discipline." — KW */}
      {aView==='vintage'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Active Vintages" value="5" icon={Calendar} sub="2020-2024" color={T.accent}/>
          <Stat label="Max Single Vintage" value="38%" icon={AlertTriangle} sub="target < 40%" color={T.amber}/>
          <Stat label="2026 Budget" value="$85M" icon={DollarSign} sub="new commitments" color={T.green}/>
          <Stat label="Deployed YTD" value="$12M" icon={TrendingUp} sub="14% of 2026 budget" color={T.blue}/>
          <Stat label="Dry Powder" value="$73M" icon={Clock} sub="remaining 2026 capacity" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIO NOTE — VINTAGE YEAR DISCIPLINE</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "The single most important chart in this entire platform is the vintage allocation below. At Industry Ventures, our best returning vintages (2009, 2016, 2020) were all counter-cyclical — we committed MORE capital when everyone else was pulling back. Cambridge Associates 2026 outlook says we're near the cyclical trough for forward returns in 2025-27 vintages. This is when you LEAN IN. The $85M 2026 budget is aggressive intentionally — I want 35-40% of total NAV deployed into this vintage window."
          </div>
        </div>

        {/* Vintage Allocation Map */}
        <Card title="Vintage Year Allocation — Historical + Projected" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8,marginBottom:12}}>
            {[
              {yr:'2020',committed:52,called:49.4,pctPort:25.3,irr:18.5,tvpi:1.85,phase:'Harvest',funds:['NEA 19'],note:'Distribution phase. Palantir public stock driving DPI. Best vintage for exit catalysts.',c:T.green,env:'Recovery / COVID fiscal stimulus'},
              {yr:'2021',committed:50.8,called:38.1,pctPort:26.2,irr:16.2,tvpi:1.50,phase:'Mid-Life',funds:['Lux Capital VI','Sequoia US VIII'],note:'Peak-adjacent vintage but selected top-tier GPs. Anduril + Stripe IPO catalysts provide upside despite high entry multiples.',c:T.blue,env:'Peak valuations / zero-rate'},
              {yr:'2022',committed:60,called:30.0,pctPort:21.6,irr:14.8,tvpi:1.35,phase:'Deploy',funds:['Founders Fund VII','a16z Infra'],note:'Counter-cyclical entry. Valuations compressed 40-60% from peak. Early J-curve position but entry multiples are favorable.',c:T.blue,env:'Rate shock / valuation reset'},
              {yr:'2023',committed:50,called:27.0,pctPort:18.4,irr:'TBD',tvpi:1.40,phase:'Early',funds:['Benchmark X','Greylock XVII'],note:'Split vintage: Benchmark X exceptional (1.62x at 18mo), Greylock XVII underperforming (1.18x). Net: above median.',c:T.amber,env:'Bottoming / LP pullback'},
              {yr:'2024',committed:7.2,called:2.2,pctPort:3.7,irr:'TBD',tvpi:1.0,phase:'Seed',funds:['Khosla IX'],note:'Small initial position. Climate/AI intersection. Too early to evaluate. Commitment calendar has room for 2 more 2024-vintage adds.',c:T.textMuted,env:'Stabilization / AI boom'},
              {yr:'2026',committed:12,called:0,pctPort:0,irr:'—',tvpi:'—',phase:'Planned',funds:['Thorn (planned)','Benchmark XI (re-up)','Radical AI (planned)'],note:'TARGET: $85M new commitments. Counter-cyclical thesis: LP pullback = negotiating leverage + better terms + less competition for best GPs.',c:T.accent,env:'Cyclical trough (Cambridge)'},
            ].map((v,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${v.c}`,border:`1px solid ${T.border}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}><span style={{fontSize:18,fontWeight:800,fontFamily:mono,color:v.c}}>{v.yr}</span><Badge color={v.c}>{v.phase}</Badge></div>
              <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:4,marginBottom:6}}>
                {[{l:'Committed',val:`$${v.committed}M`},{l:'Called',val:`$${v.called}M`},{l:'% Portfolio',val:`${v.pctPort}%`},{l:'TVPI',val:typeof v.tvpi==='number'?`${v.tvpi}x`:v.tvpi}].map((m,j)=><div key={j}><div style={{fontSize:7,color:T.textDim}}>{m.l}</div><div style={{fontSize:11,fontWeight:700,fontFamily:mono,color:v.c}}>{m.val}</div></div>)}
              </div>
              <div style={{fontSize:8,color:T.textDim,marginBottom:3}}><strong>ENV:</strong> {v.env}</div>
              <div style={{fontSize:8,color:T.textMuted,marginBottom:3}}><strong>FUNDS:</strong> {v.funds.join(', ')}</div>
              <div style={{fontSize:9,color:T.text,lineHeight:1.3,paddingTop:4,borderTop:`1px solid ${T.border}`}}>{v.note}</div>
            </div>))}
          </div>
          {/* Concentration check */}
          <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:4,marginBottom:6}}>
            {[{yr:'2020',pct:25.3},{yr:'2021',pct:26.2},{yr:'2022',pct:21.6},{yr:'2023',pct:18.4},{yr:'2024',pct:3.7},{yr:'2026P',pct:0}].map((v,i)=>(<div key={i}><div style={{fontSize:8,color:T.textDim,textAlign:'center'}}>{v.yr}</div><Bar value={v.pct} max={40} color={v.pct>35?T.red:v.pct>25?T.amber:T.green} h={8}/><div style={{fontSize:9,fontFamily:mono,fontWeight:700,color:v.pct>35?T.red:v.pct>25?T.amber:T.green,textAlign:'center'}}>{v.pct}%</div></div>))}
          </div>
          <div style={{fontSize:9,color:T.textDim,textAlign:'center'}}>Policy: No single vintage &gt; 40% of NAV. Current max: 2021 at 26.2% ✓. HHI across vintages: 0.21 (diversified).</div>
        </div></Card>

        {/* 2026 Commitment Calendar */}
        <Card title="2026 Commitment Calendar — Deployment Schedule"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
            {[
              {q:'Q1 2026',budget:20,planned:[{name:'Thorn Ventures Fund I',amt:10,type:'Primary',status:'IC APPROVED',conf:95},{name:'Radical AI Ventures Fund I',amt:8,type:'Primary',status:'IC REVIEW',conf:85}],deployed:0,remaining:20,note:'Focus: new emerging manager commitments. Capitalize on LP pullback environment.'},
              {q:'Q2 2026',budget:25,planned:[{name:'Benchmark XI (re-up)',amt:20,type:'Re-Up',status:'PIPELINE',conf:90},{name:'Tiger PIP 15 (Phase 1)',amt:4,type:'Secondary',status:'IC OPEN',conf:88}],deployed:0,remaining:25,note:'Re-up season. Benchmark XI is highest-conviction re-up. Tiger secondary Phase 1 deployment.'},
              {q:'Q3 2026',budget:20,planned:[{name:'Anthropic Series E co-invest',amt:4.2,type:'Co-Invest',status:'IC OPEN',conf:92},{name:'Tiger PIP 15 (Phase 2)',amt:4,type:'Secondary',status:'CONTINGENT',conf:75},{name:'Latticework Capital Fund I',amt:8,type:'Primary',status:'DD STAGE',conf:70}],deployed:0,remaining:20,note:'Co-invest window. Anthropic deadline March but funding Q3. Secondary Phase 2 if Phase 1 performs.'},
              {q:'Q4 2026',budget:20,planned:[{name:'Meridian Defense Fund I',amt:6,type:'Primary',status:'DD STAGE',conf:65},{name:'Secondary Opportunistic',amt:10,type:'Secondary',status:'PIPELINE',conf:60},{name:'Reserve / Overflow',amt:4,type:'Reserve',status:'HELD',conf:100}],deployed:0,remaining:20,note:'Opportunistic window. Hold $4M reserve for year-end distressed secondary opportunities.'},
            ].map((q,qi)=>(<div key={qi} style={{background:T.bgAccent,borderRadius:8,padding:10,border:`1px solid ${T.border}`,borderTop:`3px solid ${T.accent}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                <span style={{fontSize:12,fontWeight:800,color:T.accent}}>{q.q}</span>
                <span style={{fontSize:11,fontWeight:700,fontFamily:mono,color:T.text}}>${q.budget}M</span>
              </div>
              {q.planned.map((p,pi)=>(<div key={pi} style={{padding:'4px 0',borderBottom:pi<q.planned.length-1?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <span style={{fontSize:10,fontWeight:600,color:T.text}}>{p.name}</span>
                  <span style={{fontSize:11,fontWeight:700,fontFamily:mono,color:T.accent}}>${p.amt}M</span>
                </div>
                <div style={{display:'flex',gap:4,marginTop:2}}>
                  <Badge color={p.type==='Primary'?T.accent:p.type==='Re-Up'?T.green:p.type==='Co-Invest'?T.blue:p.type==='Secondary'?T.purple:T.textMuted}>{p.type}</Badge>
                  <Badge color={p.conf>=90?T.green:p.conf>=75?T.blue:p.conf>=60?T.amber:T.red}>{p.status} ({p.conf}%)</Badge>
                </div>
              </div>))}
              <div style={{fontSize:9,color:T.textMuted,marginTop:6,lineHeight:1.3,paddingTop:4,borderTop:`1px solid ${T.border}`}}>{q.note}</div>
            </div>))}
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 16: GP HEALTH MONITOR — Real-Time Surveillance Dashboard ═══ */}
      {/* "Once you've committed capital, 90% of your alpha comes from MONITORING, not sourcing. */}
      {/* The earlier you catch a problem, the more options you have. By the time it shows up */}
      {/* in the quarterly report, you've already lost 6 months of response time." — KW */}
      {aView==='gphealth'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="GPs Monitored" value="8" icon={Eye} sub="active portfolio" color={T.accent}/>
          <Stat label="Healthy" value="5" icon={CheckCircle} sub="no concerns" color={T.green}/>
          <Stat label="Watch" value="1" icon={AlertTriangle} sub="monitoring" color={T.amber}/>
          <Stat label="Alert" value="2" icon={Bell} sub="action required" color={T.red}/>
          <Stat label="Signal Sources" value="14" icon={Zap} sub="per GP (Omniscient)" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIO NOTE — CONTINUOUS GP SURVEILLANCE</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "This dashboard monitors 14 signal categories per GP, updated daily via Omniscient. At Industry Ventures, I learned that GP problems show up in PREDICTABLE sequence: (1) key-person departures → (2) deployment pace changes → (3) follow-on behavior shifts → (4) LP communications become vague → (5) quarterly marks get aggressive → (6) fund restructuring. If you catch it at stage 1, you can sell on secondary at 90¢. By stage 5, you're selling at 60¢. The system below flags at stage 1."
          </div>
        </div>

        {/* GP Health Matrix */}
        <Card title="GP Health Dashboard — 14-Signal Surveillance"><div style={{padding:'8px 0'}}>
          {[
            {gp:'Founders Fund VII',health:'HEALTHY',score:96,signals:[
              {cat:'Team Stability',status:'green',val:'No departures',detail:'Full partnership intact. Thiel engaged. Delian Asparouhov departed but to launch Thorn (our pipeline).'},
              {cat:'Deployment Pace',status:'green',val:'On track',detail:'50% called at Year 3.2. Consistent with Fund VI pace. No acceleration or deceleration.'},
              {cat:'Follow-On Rate',status:'green',val:'82%',detail:'Following on in 82% of portfolio cos. Strong conviction signals. Above 70% threshold.'},
              {cat:'Loss Ratio',status:'green',val:'12%',detail:'3 of 25 investments below cost. Below 25% threshold. Industry median: 40%.'},
              {cat:'LP Comm Quality',status:'green',val:'A+',detail:'Transparent quarterly letters. Proactive on markdowns. No IR concerns.'},
              {cat:'Mark Aggressiveness',status:'green',val:'Conservative',detail:'Marks lagging public comps by 15-20%. Conservative = bullish for look-through value.'},
              {cat:'Talent Flow Signal',status:'green',val:'Net +42',detail:'42 more engineers joining portfolio cos than leaving. Strong signal.'},
            ],action:null,c:T.green},
            {gp:'Benchmark X',health:'HEALTHY',score:94,signals:[
              {cat:'Team Stability',status:'green',val:'Equal partnership',detail:'Gurley retired from active but mentoring. Fenton leading AI thesis. Chetan leading consumer.'},
              {cat:'Deployment Pace',status:'green',val:'Fast (on-brand)',detail:'75% called in 18mo. Benchmark always deploys quickly. Equal partnership = no committee drag.'},
              {cat:'Follow-On Rate',status:'green',val:'90%',detail:'Highest follow-on rate in portfolio. Concentrated fund = high conviction per bet.'},
              {cat:'Loss Ratio',status:'green',val:'8%',detail:'1 of 12 investments below cost. Exceptional. Fund X shaping up as top-decile.'},
              {cat:'Mark Aggressiveness',status:'green',val:'Conservative',detail:'Verkada marked at $3.2B, comps suggest $4.5B+. Conservative marking = future upside.'},
            ],action:null,c:T.green},
            {gp:'NEA 19',health:'WATCH',score:72,signals:[
              {cat:'Team Stability',status:'red',val:'⚠️ 2 departures',detail:'Two senior partners departed in 2025. One to start own fund. One to corporate VC. Key-person risk ELEVATED.'},
              {cat:'Deployment Pace',status:'amber',val:'Accelerating',detail:'95% called at Year 5.2. Faster than projected. May indicate pressure to deploy remaining capital quickly.'},
              {cat:'Fund Size Trajectory',status:'red',val:'$4B → $5.2B',detail:'NEA 20 targeting $5.2B. 30% increase. Kaplan evidence: diseconomies of scale. Our position already oversized.'},
              {cat:'Follow-On Rate',status:'amber',val:'65%',detail:'Follow-on rate declining from 78% in Year 3. Selectivity dropping or conviction spreading thin.'},
              {cat:'LP Comm Quality',status:'amber',val:'B',detail:'Quarterly letters becoming more templated. Less transparency on markdowns. IR team turnover noted.'},
              {cat:'Style Drift Signal',status:'amber',val:'Detected',detail:'NEA 19 was primarily early-stage. NEA 20 marketing includes growth equity. Style drift flagged.'},
            ],action:'REDUCE re-up to $25M (from $50M current). Sell $10-15M of NEA 19 on secondary at premium (1.85x TVPI commands attention). Maintain relationship without over-concentration.',c:T.amber},
            {gp:'a16z Infra',health:'ALERT',score:62,signals:[
              {cat:'Team Stability',status:'amber',val:'Restructuring',detail:'a16z firm-wide restructuring. Infra team leadership unclear. Multiple hires but also departures.'},
              {cat:'Deployment Pace',status:'red',val:'⚠️ SLOW',detail:'Only 36% called at Year 3. Significantly behind pace. $32M unfunded = largest obligation in portfolio.'},
              {cat:'Performance',status:'red',val:'1.25x TVPI',detail:'Below median at Year 3. Not top-quartile trajectory. Peer infra funds at 1.4-1.6x.'},
              {cat:'Loss Ratio',status:'amber',val:'22%',detail:'Higher than target. Infrastructure investments taking longer to mature. Some early markdowns.'},
              {cat:'LP Comm Quality',status:'amber',val:'B-',detail:'Reporting focused on platform narrative rather than fund-level performance. Classic deflection pattern.'},
              {cat:'Fund Size Signal',status:'red',val:'$3.5B → $4.5B',detail:'a16z Infra II targeting $4.5B despite mediocre Fund I performance. Fee maximization behavior.'},
            ],action:'NO RE-UP into a16z Infra II. Begin secondary sale process for current position — target $6.9M reduction. Databricks IPO provides natural exit catalyst (largest holding). Redeploy to Thorn Ventures.',c:T.red},
            {gp:'Greylock XVII',health:'ALERT',score:48,signals:[
              {cat:'Team Stability',status:'amber',val:'New partner',detail:'Added ex-Palantir CTO. Positive signal for GovTech thesis. But new partner untested as investor.'},
              {cat:'Performance',status:'red',val:'1.18x TVPI',detail:'Below median at 14 months. WorkOS markdown (-16.7%) hurt. No standout winners yet.'},
              {cat:'Deployment Pace',status:'amber',val:'33% called',detail:'On pace but selectivity not translating to performance.'},
              {cat:'Thesis Execution',status:'red',val:'GovTech stalled',detail:'GovTech thesis was key to our commitment. Market timing was 18+ months early. Thesis intact but delayed.'},
              {cat:'Reference Signal',status:'red',val:'Negative',detail:'Back-channel references deteriorating. WorkOS founder declined reference. LP sentiment turning negative.'},
            ],action:'EXECUTE SELL. Target 85-90¢ on secondary. $20M in unfunded obligations transfer to buyer = $27.5M total capital efficiency. Reallocate proceeds to Benchmark XI re-up and Tiger PIP 15 Phase 1.',c:T.red},
          ].map((gp,gi)=>(<div key={gi} style={{background:T.bgAccent,borderRadius:8,padding:12,marginBottom:10,border:`1px solid ${gp.c}30`,borderLeft:`4px solid ${gp.c}`}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
              <div><span style={{fontSize:13,fontWeight:800,color:T.text}}>{gp.gp}</span><Badge color={gp.c} style={{marginLeft:8}}>{gp.health}</Badge></div>
              <span style={{fontSize:22,fontWeight:800,fontFamily:mono,color:gp.c}}>{gp.score}</span>
            </div>
            <div style={{display:'grid',gridTemplateColumns:`repeat(${Math.min(gp.signals.length,4)},1fr)`,gap:6,marginBottom:gp.action?8:0}}>
              {gp.signals.slice(0,8).map((s,si)=>(<div key={si} style={{padding:'4px 6px',borderRadius:4,background:s.status==='green'?`${T.green}08`:s.status==='amber'?`${T.amber}08`:`${T.red}08`,borderLeft:`3px solid ${s.status==='green'?T.green:s.status==='amber'?T.amber:T.red}`}}>
                <div style={{display:'flex',justifyContent:'space-between'}}><span style={{fontSize:8,fontWeight:700,color:T.textDim}}>{s.cat}</span><span style={{fontSize:9,fontWeight:700,fontFamily:mono,color:s.status==='green'?T.green:s.status==='amber'?T.amber:T.red}}>{s.val}</span></div>
                <div style={{fontSize:8,color:T.textMuted,lineHeight:1.2,marginTop:2}}>{s.detail}</div>
              </div>))}
            </div>
            {gp.action&&(<div style={{padding:'8px 10px',background:`${gp.c}10`,borderRadius:6,border:`1px solid ${gp.c}30`}}>
              <div style={{fontSize:8,fontWeight:700,color:T.textDim}}>RECOMMENDED ACTION</div>
              <div style={{fontSize:10,color:gp.c,fontWeight:600,lineHeight:1.3}}>{gp.action}</div>
            </div>)}
          </div>))}
        </div></Card>
      </div>)}

      {/* ═══ TAB 17: PLATFORM APPROVAL PIPELINE — Bob Burlinson / Mercer-Regis Framework ═══ */}
      {/* "I've sat on both sides of this table — as the wealth manager evaluating products and now */}
      {/* as the product seeking shelf space. Platform approval is a 6-12 month process with 7 gates. */}
      {/* Miss one gate and you restart the clock. This tracker is the most important pipeline we have." — BB */}
      {aView==='platform'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Platform Targets" value="8" icon={Target} sub="active conversations" color={T.accent}/>
          <Stat label="In DD Process" value="3" icon={FileText} sub="DDQ submitted" color={T.green}/>
          <Stat label="Addressable AUM" value="$14.3T" icon={DollarSign} sub="total RIA channel" color={T.blue}/>
          <Stat label="Est. Time to Shelf" value="8-12mo" icon={Clock} sub="from first meeting" color={T.amber}/>
          <Stat label="Est. Year 1 Flows" value="$45-85M" icon={TrendingUp} sub="if 3+ platforms approve" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIS NOTE — THE PLATFORM GAME</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "I built Regis to $5B by getting on platforms. Here's what nobody tells you: the DDQ is table stakes — every product fills one out. What actually gets you approved is an INTERNAL CHAMPION. Someone at the firm who puts their reputation on the line to sponsor you through product committee. At Mercer, I am that champion. At Goldman, we need John Goldstein or Brad Tuthill. At J.P. Morgan, we need Alistair Savides. The platform tracker below shows exactly where we are in each approval process and who the champion is. Without a named champion, a platform conversation is just a conversation."
          </div>
        </div>

        {/* Platform Approval Pipeline — 7-Gate Process */}
        <Card title="Platform Approval Pipeline — 7-Gate Process" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          {[
            {platform:'Mercer Advisors (Aspen Partners)',aum:'$92B',advisors:'1,150+',champion:'Bob Burlinson (INTERNAL)',gate:4,status:'Due Diligence',probability:85,
              timeline:'Q3 2026 target approval',
              gates:[{n:'1. Initial Meeting',s:'done',d:'Jan 2026'},{n:'2. DDQ Submitted',s:'done',d:'Feb 2026'},{n:'3. Research Review',s:'done',d:'Feb 2026'},{n:'4. Due Diligence',s:'active',d:'Mar-Apr 2026'},{n:'5. Product Committee',s:'pending',d:'May 2026'},{n:'6. Compliance Review',s:'pending',d:'Jun 2026'},{n:'7. Platform Live',s:'pending',d:'Jul 2026'}],
              notes:'HIGHEST PRIORITY. I am the champion internally. Don Calcagni (CIO) briefed and supportive. Aspen Partners launched 2024 specifically for this type of product. Our 1.25% fee + NYSE liquidity = exactly what Mercer advisors have been requesting. Key risk: compliance timeline on 1940 Act products.',
              estFlows:'$15-25M Year 1',c:T.accent},
            {platform:'Goldman Sachs PWM',aum:'$2.7T',advisors:'800+',champion:'John Goldstein / Brad Tuthill',gate:2,status:'DDQ Preparation',probability:55,
              timeline:'Q4 2026 - Q1 2027 target',
              gates:[{n:'1. Initial Meeting',s:'done',d:'Jan 2026'},{n:'2. DDQ Submitted',s:'active',d:'Mar 2026'},{n:'3. Research Review',s:'pending',d:'Apr 2026'},{n:'4. Due Diligence',s:'pending',d:'May-Jul 2026'},{n:'5. Product Committee',s:'pending',d:'Aug 2026'},{n:'6. Compliance Review',s:'pending',d:'Sep-Oct 2026'},{n:'7. Platform Live',s:'pending',d:'Nov 2026'}],
              notes:'12 Goldman contacts in network. Goldstein is Global Head of Sustainability — position NEWCO as ESG-aligned alternatives. Tuthill can champion to product committee. Goldman process is slower but massive distribution once approved. Strategy: coordinate all 12 contacts in 2-week window to create internal buzz.',
              estFlows:'$20-40M Year 1',c:T.green},
            {platform:'J.P. Morgan Wealth',aum:'$4.6T',advisors:'2,500+',champion:'Alistair Savides (Manager Research)',gate:1,status:'Initial Meeting',probability:40,
              timeline:'Q1 2027 target (post-IPO)',
              gates:[{n:'1. Initial Meeting',s:'active',d:'Mar 2026'},{n:'2. DDQ Submitted',s:'pending',d:'Apr 2026'},{n:'3. Research Review',s:'pending',d:'May-Jun 2026'},{n:'4. Due Diligence',s:'pending',d:'Jul-Sep 2026'},{n:'5. Product Committee',s:'pending',d:'Oct 2026'},{n:'6. Compliance Review',s:'pending',d:'Nov-Dec 2026'},{n:'7. Platform Live',s:'pending',d:'Jan 2027'}],
              notes:'Savides runs Manager Research — he decides what gets through to committee. Lauren Burrick Kessler controls field distribution post-approval. Need BOTH. JPM process is most rigorous but largest distribution footprint. Strategy: request "educational meeting" not "platform approval" for first touch.',
              estFlows:'$10-20M Year 1',c:T.blue},
            {platform:'Northern Trust',aum:'$1.5T',advisors:'350+',champion:'Stacy Singer / Michael Papierski',gate:1,status:'Warm Introduction',probability:50,
              timeline:'Q4 2026 target',
              gates:[{n:'1. Initial Meeting',s:'active',d:'Feb 2026'},{n:'2. DDQ Submitted',s:'pending',d:'Mar 2026'},{n:'3. Research Review',s:'pending',d:'Apr 2026'},{n:'4. Due Diligence',s:'pending',d:'May-Jun 2026'},{n:'5. Product Committee',s:'pending',d:'Jul 2026'},{n:'6. Compliance Review',s:'pending',d:'Aug 2026'},{n:'7. Platform Live',s:'pending',d:'Sep 2026'}],
              notes:'Northern Trust serves ultra-HNW and institutions. Perfect client match for NEWCO. Stacy is National Practice Leader — senior enough to sponsor. Papierski is SVP — pincer approach with both contacts. Northern Trust process is faster than wirehouses (4-6 months typical).',
              estFlows:'$5-10M Year 1',c:T.blue},
            {platform:'Pathstone',aum:'$100B+',advisors:'200+',champion:'Eric Alt (Co-CIO)',gate:2,status:'DDQ Requested',probability:65,
              timeline:'Q3 2026 target',
              gates:[{n:'1. Initial Meeting',s:'done',d:'Jan 2026'},{n:'2. DDQ Submitted',s:'active',d:'Feb 2026'},{n:'3. Research Review',s:'pending',d:'Mar 2026'},{n:'4. Due Diligence',s:'pending',d:'Apr 2026'},{n:'5. Product Committee',s:'pending',d:'May 2026'},{n:'6. Compliance Review',s:'pending',d:'Jun 2026'},{n:'7. Platform Live',s:'pending',d:'Jul 2026'}],
              notes:'Alt is Co-CIO — can both INVEST and DISTRIBUTE. Dual utility. Pathstone aggressively building alternatives shelf. Faster process than wirehouses. Alt specifically requested our DDQ after seeing the fee structure. Key differentiator: 1.25% resonates strongly with fee-conscious RIA model.',
              estFlows:'$5-15M Year 1',c:T.green},
          ].map((p,pi)=>(<div key={pi} style={{background:T.bgAccent,borderRadius:8,padding:12,marginBottom:10,border:`1px solid ${T.border}`,borderLeft:`4px solid ${p.c}`}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
              <div><div style={{fontSize:13,fontWeight:800,color:T.text}}>{p.platform}</div><div style={{fontSize:10,color:T.textMuted}}>{p.aum} AUM • {p.advisors} advisors • Champion: <strong style={{color:T.accent}}>{p.champion}</strong></div></div>
              <div style={{textAlign:'right'}}><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:p.c}}>{p.probability}%</div><div style={{fontSize:9,color:T.textMuted}}>{p.estFlows}</div></div>
            </div>
            {/* 7-Gate Progress Bar */}
            <div style={{display:'grid',gridTemplateColumns:'repeat(7,1fr)',gap:3,marginBottom:8}}>
              {p.gates.map((g,gi)=>(<div key={gi} style={{padding:'4px 3px',borderRadius:4,background:g.s==='done'?`${T.green}15`:g.s==='active'?`${T.accent}15`:`${T.border}40`,borderTop:`3px solid ${g.s==='done'?T.green:g.s==='active'?T.accent:T.border}`,textAlign:'center'}}>
                <div style={{fontSize:7,fontWeight:700,color:g.s==='done'?T.green:g.s==='active'?T.accent:T.textDim}}>{g.n}</div>
                <div style={{fontSize:8,color:T.textMuted}}>{g.d}</div>
              </div>))}
            </div>
            <div style={{fontSize:10,color:T.text,lineHeight:1.4,padding:'6px 8px',background:T.bg,borderRadius:4}}>{p.notes}</div>
          </div>))}

          <div style={{background:`${T.green}08`,borderRadius:8,padding:'10px 16px',marginTop:8,border:`1px solid ${T.green}30`}}>
            <div style={{fontSize:10,fontWeight:800,color:T.green,marginBottom:4}}>PROBABILITY-WEIGHTED PLATFORM FLOW ESTIMATE</div>
            <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:8}}>
              {[{p:'Mercer',pct:85,lo:15,hi:25},{p:'Goldman',pct:55,lo:20,hi:40},{p:'J.P. Morgan',pct:40,lo:10,hi:20},{p:'Northern Trust',pct:50,lo:5,hi:10},{p:'Pathstone',pct:65,lo:5,hi:15}].map((f,i)=>{const ev=((f.lo+f.hi)/2*f.pct/100);return(<div key={i} style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>{f.p}</div><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:T.accent}}>${ev.toFixed(0)}M</div><div style={{fontSize:8,color:T.textMuted}}>EV (prob-wt)</div></div>);})}
            </div>
            <div style={{textAlign:'center',marginTop:6}}><span style={{fontSize:10,color:T.textDim}}>Total Probability-Weighted Year 1 Flows: </span><span style={{fontSize:16,fontWeight:800,fontFamily:mono,color:T.accent}}>$45-85M</span></div>
          </div>
        </div></Card>

        {/* DDQ Readiness Checklist */}
        <Card title="DDQ Readiness — Platform Due Diligence Requirements"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {section:'Investment Strategy & Process',items:[
                {item:'Investment thesis & mandate',status:'ready',note:'Business Plan §Portfolio Construction'},
                {item:'GP selection scorecard (10 dimensions)',status:'ready',note:'Ken\'s framework fully documented'},
                {item:'Secondary pricing methodology',status:'ready',note:'Look-through model operational'},
                {item:'Risk management framework',status:'ready',note:'Kelly sizing + correlation + concentration limits'},
                {item:'Omniscient platform overview',status:'ready',note:'Technical documentation complete'},
              ],c:T.green},
              {section:'Legal & Compliance',items:[
                {item:'1940 Act registration (N-2 filing)',status:'in_progress',note:'Counsel drafting — target Q2 2026'},
                {item:'SEC compliance manual',status:'in_progress',note:'CCO finalizing policies'},
                {item:'Code of ethics / personal trading',status:'not_started',note:'Awaiting CCO hire'},
                {item:'SBIC license acquisition docs',status:'in_progress',note:'Target identified, DD underway'},
                {item:'Independent director bios',status:'not_started',note:'Board recruitment Q3 2026'},
              ],c:T.amber},
              {section:'Operations & Reporting',items:[
                {item:'NAV calculation methodology (ASC 820)',status:'ready',note:'Valuation Committee charter drafted'},
                {item:'Quarterly report template',status:'in_progress',note:'Buffett-style letter format designed'},
                {item:'Fund administrator selection',status:'in_progress',note:'SEI, SS&C, Alter Domus in process'},
                {item:'Audit firm engagement',status:'not_started',note:'Big 4 preferred — KPMG or EY target'},
                {item:'Custody arrangements',status:'not_started',note:'BNY or State Street per 1940 Act'},
              ],c:T.amber},
            ].map((sec,si)=>{const ready=sec.items.filter(i=>i.status==='ready').length;return(<div key={si} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${sec.c}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                <span style={{fontSize:10,fontWeight:800,color:sec.c}}>{sec.section}</span>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:ready===sec.items.length?T.green:T.amber}}>{ready}/{sec.items.length}</span>
              </div>
              {sec.items.map((it,ii)=>(<div key={ii} style={{display:'flex',alignItems:'center',gap:6,padding:'3px 0',borderBottom:ii<sec.items.length-1?`1px solid ${T.border}`:'none'}}>
                <span style={{fontSize:12}}>{it.status==='ready'?'✅':it.status==='in_progress'?'🔄':'⬜'}</span>
                <div style={{flex:1}}><div style={{fontSize:10,color:T.text,fontWeight:it.status==='ready'?400:600}}>{it.item}</div><div style={{fontSize:8,color:T.textMuted}}>{it.note}</div></div>
              </div>))}
            </div>);})}
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 18: CLIENT SUITABILITY & MODEL PORTFOLIO — RIA Compliance Engine ═══ */}
      {/* "Every advisor who puts a client in NEWCO has to document suitability. If they can't fill out */}
      {/* the suitability form in 5 minutes, they won't bother. We need to hand them the answer." — BB */}
      {aView==='suitability'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Client Types" value="5" icon={Users} sub="suitability profiles" color={T.accent}/>
          <Stat label="Model Portfolios" value="4" icon={PieChart} sub="pre-built allocations" color={T.green}/>
          <Stat label="Suggested Allocation" value="2-5%" icon={Target} sub="of total portfolio" color={T.blue}/>
          <Stat label="Min Investment" value="~$20" icon={DollarSign} sub="1 share on NYSE" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIS NOTE — MAKING IT EASY FOR ADVISORS</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "At Regis, we managed $5B for UHNW families. I learned that the #1 barrier to alternatives allocation isn't the product — it's the PAPERWORK. Every advisor has to document suitability, run it through compliance, and justify the position in their IPS. If we hand them a pre-built suitability matrix and model portfolio insert, we remove 80% of the friction. The matrices below are designed so a Mercer advisor can copy-paste directly into their compliance documentation."
          </div>
        </div>

        {/* Client Suitability Matrix */}
        <Card title="Client Suitability Matrix — Compliance-Ready Documentation" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Client Type</TH><TH align="center">Suitable?</TH><TH align="center">Allocation</TH><TH align="center">Min Horizon</TH><TH align="center">Risk Tolerance</TH><TH align="center">Income Need</TH><TH>Suitability Rationale</TH>
          </tr></thead><tbody>
            {[
              {type:'UHNW Family ($25M+)',suit:'YES',alloc:'3-5%',horizon:'5+ years',risk:'Moderate-Aggressive',income:'Low',rat:'Diversification into venture asset class via regulated, liquid vehicle. Daily NYSE liquidity eliminates traditional LP lock-up concerns. Fund-of-funds structure reduces single-manager risk. 1.25% fee significantly below PE/VC alternatives. Tax-efficient C-Corp structure avoids K-1 complexity.',c:T.accent},
              {type:'Family Foundation',suit:'YES',alloc:'2-4%',horizon:'7+ years',risk:'Moderate',income:'Low',rat:'Prudent investor rule compliant — diversified, professionally managed, SEC-regulated. Mission alignment with AI Safety, Defense Tech innovation themes. Audited NAV + independent board satisfies fiduciary requirements. Daily liquidity supports annual grant-making cash needs. UPMIFA compliant — reasonable spending policy compatible.',c:T.green},
              {type:'RIA Model Portfolio (Balanced)',suit:'YES',alloc:'2-3%',horizon:'5+ years',risk:'Moderate',income:'Low',rat:'Liquid alternatives sleeve allocation. Single ticker replaces multi-fund PE/VC commitment. No capital calls, no unfunded obligations, no K-1s. NAV reporting daily vs quarterly for private funds. Model portfolio rebalanceable — critical for tax-loss harvesting and drift management.',c:T.blue},
              {type:'Retirement Account (IRA/401k)',suit:'CONDITIONAL',alloc:'1-2%',horizon:'10+ years',risk:'Moderate-Aggressive',income:'Low',rat:'NYSE-listed security = IRA/401k eligible. Conditional on: (1) sufficient time horizon to absorb closed-end fund discount volatility, (2) client understands VC risk profile, (3) allocation cap at 2% of retirement assets. Advantage: tax-deferred compounding on VC returns without annual K-1 complexity.',c:T.amber},
              {type:'Conservative/Income-Focused',suit:'NO',alloc:'—',horizon:'—',risk:'Conservative',income:'High',rat:'NOT SUITABLE. No regular dividend — growth focus. NAV volatility inappropriate for conservative risk tolerance. Closed-end fund may trade at discount to NAV. No guaranteed income stream. Direct clients to bond ladders or dividend-focused alternatives instead.',c:T.red},
            ].map((s,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:s.suit==='NO'?`${T.red}06`:'transparent'}}>
              <TD style={{fontWeight:700,fontSize:11}}>{s.type}</TD>
              <TD align="center"><Badge color={s.c}>{s.suit}</Badge></TD>
              <TD align="center" mono bold color={s.c}>{s.alloc}</TD>
              <TD align="center" mono>{s.horizon}</TD>
              <TD align="center"><span style={{fontSize:10,color:s.c}}>{s.risk}</span></TD>
              <TD align="center"><span style={{fontSize:10,color:T.textMuted}}>{s.income}</span></TD>
              <TD style={{fontSize:9,color:T.textMuted,lineHeight:1.3,maxWidth:280}}>{s.rat}</TD>
            </tr>))}
          </tbody></table>
        </div></Card>

        {/* Model Portfolio Inserts */}
        <Card title="Model Portfolio Inserts — Ready for Envestnet / Orion / AssetMark" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10}}>
            {[
              {name:'Growth Allocation',risk:'Aggressive',target:'5%',sleeve:'Liquid Alternatives',c:T.accent,
                portfolio:[{asset:'US Large Cap',pct:40},{asset:'US Small/Mid',pct:15},{asset:'International Developed',pct:15},{asset:'Emerging Markets',pct:8},{asset:'Fixed Income',pct:12},{asset:'Real Assets',pct:5},{asset:'NEWCO (VC Exposure)',pct:5,highlight:true}],
                rationale:'VC serves as growth accelerator in aggressive allocation. 5% position provides meaningful exposure without excessive concentration. Historically low correlation to public equities (0.3-0.4) improves portfolio Sharpe ratio. Cambridge Associates: 5% VC allocation adds 40-60bps to portfolio return with minimal incremental volatility.'},
              {name:'Balanced Allocation',risk:'Moderate',target:'3%',sleeve:'Liquid Alternatives',c:T.green,
                portfolio:[{asset:'US Large Cap',pct:30},{asset:'US Small/Mid',pct:10},{asset:'International Developed',pct:12},{asset:'Emerging Markets',pct:5},{asset:'Fixed Income',pct:30},{asset:'Real Assets',pct:5},{asset:'Cash',pct:5},{asset:'NEWCO (VC Exposure)',pct:3,highlight:true}],
                rationale:'3% VC allocation in balanced portfolio provides diversification without changing risk profile. Replaces portion of small-cap allocation — similar growth characteristics but different factor exposure. Appropriate for clients with 5+ year horizon and moderate risk tolerance.'},
              {name:'Endowment Model',risk:'Institutional',target:'4%',sleeve:'Private Markets',c:T.blue,
                portfolio:[{asset:'Global Equity',pct:35},{asset:'Fixed Income',pct:20},{asset:'Hedge Funds',pct:15},{asset:'Private Equity',pct:12},{asset:'Real Assets',pct:10},{asset:'VC (NEWCO)',pct:4,highlight:true},{asset:'Cash',pct:4}],
                rationale:'Yale/Swensen model adapted for liquid implementation. NEWCO replaces traditional illiquid VC allocation with daily-liquid equivalent. 4% allocation consistent with foundation IPS guidelines. Maintains exposure to venture growth factor without 10-year lockup or capital call management.'},
              {name:'UHNW Multi-Asset',risk:'Custom',target:'4-5%',sleeve:'Opportunistic',c:T.purple,
                portfolio:[{asset:'Direct Equities',pct:30},{asset:'Fixed Income',pct:15},{asset:'Private Equity (Direct)',pct:15},{asset:'Real Estate',pct:10},{asset:'Hedge Funds',pct:10},{asset:'NEWCO (VC FoF)',pct:5,highlight:true},{asset:'Co-Invest Rights*',pct:5},{asset:'Cash',pct:10}],
                rationale:'*UHNW clients holding 10K+ shares unlock co-investment rights, effectively doubling VC exposure. Combined 10% venture allocation (5% NEWCO + 5% co-invest) appropriate for $25M+ net worth with significant risk capacity. Co-invest tier creates accumulation incentive unique to NEWCO.'},
            ].map((m,mi)=>(<div key={mi} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${m.c}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                <div><div style={{fontSize:11,fontWeight:800,color:m.c}}>{m.name}</div><div style={{fontSize:9,color:T.textMuted}}>{m.risk} • {m.sleeve}</div></div>
                <div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:m.c}}>{m.target}</div>
              </div>
              {m.portfolio.map((a,ai)=>(<div key={ai} style={{display:'flex',alignItems:'center',gap:6,padding:'2px 0'}}>
                <Bar value={a.pct} max={45} color={a.highlight?m.c:T.textMuted} h={a.highlight?8:4}/>
                <span style={{fontSize:a.highlight?10:9,fontWeight:a.highlight?700:400,color:a.highlight?m.c:T.textMuted,minWidth:120}}>{a.asset}</span>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:a.highlight?800:400,color:a.highlight?m.c:T.textMuted}}>{a.pct}%</span>
              </div>))}
              <div style={{fontSize:9,color:T.text,marginTop:6,lineHeight:1.3,padding:'4px 6px',background:T.bg,borderRadius:4}}>{m.rationale}</div>
            </div>))}
          </div>
        </div></Card>

        {/* Tax & Structure Considerations */}
        <Card title="Tax & Structure Considerations — Client Communication Points"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {title:'C-Corp Structure Benefits',items:['No K-1 tax filing — standard 1099 reporting only','Eligible for IRA, 401(k), Roth accounts','No UBTI concerns for tax-exempt investors','No state tax nexus issues across multiple jurisdictions','Clean estate planning — shares transfer like any stock'],c:T.green,who:'ALL CLIENTS'},
              {title:'Closed-End Fund Mechanics',items:['Shares trade at market price (may differ from NAV)','Discount to NAV = buying $1 of assets for <$1','Premium to NAV = market values strategy above book','Board authorized buyback at >15% discount','No daily redemption pressure on manager (vs open-end)'],c:T.blue,who:'ADVISORS — CLIENT EDUCATION'},
              {title:'UHNW Planning Integration',items:['Shares can be gifted (annual exclusion, GRAT eligible)','Charitable giving via appreciated shares (avoid cap gains)','10K+ share threshold unlocks co-invest rights (addl planning)','Dynasty trust eligible — multi-generational VC exposure','Concentrated stock strategies for co-invest positions'],c:T.purple,who:'UHNW / ESTATE PLANNING'},
            ].map((t,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:10,borderTop:`3px solid ${t.c}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}><span style={{fontSize:10,fontWeight:800,color:t.c}}>{t.title}</span><Badge color={t.c}>{t.who}</Badge></div>
              {t.items.map((item,j)=><div key={j} style={{fontSize:10,color:T.text,padding:'2px 0 2px 8px',borderLeft:`2px solid ${t.c}40`,marginBottom:2,lineHeight:1.3}}>{item}</div>)}
            </div>))}
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 19: FOUNDATION & ENDOWMENT LENS — 17 Years on Skoll Foundation IC ═══ */}
      {/* "Foundations and endowments are the ultimate credibility signal. When Packard Foundation invests, */}
      {/* every other foundation takes the call. I spent 17 years on Skoll's IC — I know exactly what */}
      {/* fiduciary committees require to approve an allocation." — BB */}
      {aView==='endowment'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Foundation Targets" value="8" icon={Target} sub="in pipeline" color={T.accent}/>
          <Stat label="Endowment Targets" value="3" icon={Award} sub="university + research" color={T.green}/>
          <Stat label="Skoll IC Tenure" value="17 yrs" icon={Clock} sub="Bob's fiduciary experience" color={T.blue}/>
          <Stat label="Signal Value" value="∞" icon={Zap} sub="1 foundation = cascade" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIS NOTE — THE FOUNDATION PLAYBOOK</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "I served on the Skoll Foundation investment committee for 17 years — Jeff Skoll's foundation after eBay. Foundation ICs are the most conservative decision-making bodies in institutional investing. They have three non-negotiable requirements: (1) PRUDENT INVESTOR STANDARD compliance — diversified, professionally managed, reasonable costs; (2) MISSION ALIGNMENT — can they explain to their board why a VC fund advances their charitable mission?; (3) FIDUCIARY DOCUMENTATION — audit trail showing the IC did its homework. If we nail all three, one foundation LP triggers a cascade. Board members sit on 3-5 other foundation boards. Jessica Mancini at Packard talks to Jim Canales at Barr who talks to Amy Rabbino at Pritzker. Foundation investing is a network, not a market."
          </div>
        </div>

        {/* Foundation Fiduciary Compliance Scorecard */}
        <Card title="Fiduciary Compliance Scorecard — UPMIFA / Prudent Investor Standard" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:12}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:6}}>UPMIFA COMPLIANCE CHECKLIST</div>
              {[
                {req:'Diversification',status:'pass',evidence:'Fund-of-funds: 60-90 underlying positions, 8+ GPs, 5 vintages, 4 sectors. HHI 0.14 (well diversified). No single GP >8% NAV policy.',score:98},
                {req:'Loyalty & Impartiality',status:'pass',evidence:'Independent board majority (1940 Act requirement). No self-dealing — GP commitment 5% aligned. Conflicts policy documented. Annual compliance review.',score:95},
                {req:'Prudent Management',status:'pass',evidence:'Professional CIO (Ken Wallace, 16yr track record). Institutional GP selection scorecard (35/50 minimum). Quarterly board oversight. Independent auditor.',score:96},
                {req:'Costs & Expenses',status:'pass',evidence:'1.25% mgmt fee = lowest in category (25-40% below peers). AFFE negotiated via anchor leverage. Total all-in 2.77% vs 4.20% peer avg. Documented fee benchmarking.',score:94},
                {req:'Delegation & Monitoring',status:'pass',evidence:'Investment Committee charter. Bi-weekly IC meetings. Quarterly board reporting. GP Health Monitor (14 signals per GP). Annual strategy review.',score:92},
                {req:'Spending Policy Compatibility',status:'pass',evidence:'Daily NYSE liquidity supports annual grant-making. No lock-up prevents cash access. No capital calls disrupt spending forecast. Growth orientation compatible with 5% spend rate.',score:90},
              ].map((r,i)=>(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'5px 0',borderBottom:`1px solid ${T.border}`}}>
                <span style={{fontSize:14}}>{r.status==='pass'?'✅':'❌'}</span>
                <div style={{flex:1}}><div style={{fontSize:10,fontWeight:700,color:T.text}}>{r.req}</div><div style={{fontSize:9,color:T.textMuted,lineHeight:1.3}}>{r.evidence}</div></div>
                <span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:T.green}}>{r.score}</span>
              </div>))}
              <div style={{display:'flex',justifyContent:'space-between',paddingTop:8}}><span style={{fontSize:10,fontWeight:700,color:T.textDim}}>COMPOSITE FIDUCIARY SCORE</span><span style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.green}}>94.2 / 100</span></div>
            </div>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.green,marginBottom:6}}>MISSION ALIGNMENT MATRIX</div>
              {[
                {foundation:'Packard Foundation ($8B+)',mission:'Conservation, reproductive health, children/families',alignment:'AI Safety thesis → responsible technology development. Defense Tech → national security innovation. NEWCO governance → ESG best practices.',score:78,champion:'Jessica Mancini',path:'Program Officer → CIO → IC Presentation',c:T.green},
                {foundation:'Barr Foundation ($2B+)',mission:'Climate, arts, education equity',alignment:'Climate-tech fund managers (Khosla IX). AI/robotics → education innovation. NEWCO\'s Berkeley ecosystem → education alignment. Emerging manager thesis → diversity in VC.',score:82,champion:'Jim Canales (President)',path:'Direct to President → IC Fast Track',c:T.accent},
                {foundation:'Pritzker Family Fund',mission:'Civic engagement, criminal justice, early childhood',alignment:'GovTech thesis alignment. AI Safety → responsible civic technology. Trust & Safety portfolio cos → safer digital civic spaces.',score:72,champion:'Amy Rabbino',path:'Executive Director → Family Council → Allocation',c:T.blue},
                {foundation:'Skoll Foundation ($1.5B+)',mission:'Social entrepreneurship, systemic change',alignment:'DEEP ALIGNMENT. AI Safety = systemic change in technology. Defense innovation = national resilience. NEWCO model = democratizing VC access (systemic change in capital markets).',score:92,champion:'Bob Burlinson (17yr IC)',path:'Bob direct → IC presentation → expedited review',c:T.accent},
                {foundation:'Goldman Fund (Lisa & Douglas)',mission:'Berkeley, SF community, Jewish causes',alignment:'Berkeley ecosystem = direct mission fit. Goldman family legacy = Jason\'s 5th-generation connection. NEWCO supports Berkeley innovation pipeline.',score:95,champion:'Matthew Goldman (Board)',path:'Matthew direct → Board → IC (if applicable)',c:T.accent},
                {foundation:'California Health Care Foundation ($1B+)',mission:'Healthcare access, equity',alignment:'AI/ML portfolio companies in health tech. AI Safety → safe health AI. Bio/health sector allocation (5-10% target).',score:68,champion:'Sandra Hernández',path:'CEO → CIO → IC. Slower process. Need health-tech angle.',c:T.blue},
              ].map((f,i)=>(<div key={i} style={{padding:'6px 8px',marginBottom:4,background:T.bgAccent,borderRadius:4,borderLeft:`3px solid ${f.c}`}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                  <span style={{fontSize:10,fontWeight:700,color:T.text}}>{f.foundation}</span>
                  <span style={{fontSize:13,fontWeight:800,fontFamily:mono,color:f.score>=85?T.accent:f.score>=75?T.green:T.blue}}>{f.score}</span>
                </div>
                <div style={{fontSize:8,color:T.textDim,marginBottom:2}}><strong>Mission:</strong> {f.mission}</div>
                <div style={{fontSize:9,color:T.textMuted,lineHeight:1.3,marginBottom:2}}>{f.alignment}</div>
                <div style={{fontSize:8,color:T.accent}}><strong>Champion:</strong> {f.champion} | <strong>Path:</strong> {f.path}</div>
              </div>))}
            </div>
          </div>
        </div></Card>

        {/* Foundation Network Cascade Map */}
        <Card title="Foundation Board Cross-Pollination — The Cascade Effect"><div style={{padding:'12px 16px'}}>
          <div style={{fontSize:10,color:T.textMuted,lineHeight:1.4,marginBottom:10}}>
            <strong style={{color:T.accent}}>Key Insight:</strong> Foundation trustees typically serve on 3-5 boards simultaneously. One successful allocation triggers conversations across their entire board network. The cascade effect means landing ONE marquee foundation can generate 3-5 warm introductions within 90 days. Mapping below shows cross-pollination paths from our existing connections.
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {hub:'Skoll Foundation (Bob\'s IC)',spokes:['Omidyar Network (eBay/Skoll connection)','Stanford Social Innovation Review board','Ashoka Foundation (social entrepreneurship)','Gates Foundation (shared social enterprise focus)','Silicon Valley Community Foundation'],cascadeValue:'5 foundations × avg $2B AUM = $10B addressable',action:'Bob to re-engage IC colleagues. "I\'m building the fund we always wished we could invest in."',c:T.accent},
              {hub:'Goldman Fund (Matthew\'s Board)',spokes:['Haas School Foundation connections','SF Jewish Community Foundation ($3B+)','Koret Foundation (SF Bay Area)','Jim Joseph Foundation (Jewish education)','Marcus Foundation (Atlanta — Goldman family)'],cascadeValue:'5 foundations × avg $1B AUM = $5B addressable',action:'Matthew to map every Goldman Fund board member\'s OTHER board seats. Build matrix. Target cross-pollination meetings.',c:T.green},
              {hub:'Packard Foundation (Jessica Mancini)',spokes:['Hewlett Foundation ($12B — founder overlap)','Moore Foundation ($8B — tech philanthropy)','Silicon Valley Community Foundation ($13B)','Stanford endowment relationships','West Coast foundation CIO network'],cascadeValue:'4 major foundations × avg $8B AUM = $32B addressable',action:'Land Packard first. Jessica introduces to Hewlett CIO. "If Packard approved this, we should look." Domino effect.',c:T.blue},
            ].map((h,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${h.c}`}}>
              <div style={{fontSize:11,fontWeight:800,color:h.c,marginBottom:6}}>{h.hub}</div>
              {h.spokes.map((s,si)=>(<div key={si} style={{fontSize:9,color:T.text,padding:'2px 0 2px 8px',borderLeft:`2px solid ${h.c}40`,marginBottom:2}}>{s}</div>))}
              <div style={{fontSize:10,fontWeight:700,fontFamily:mono,color:h.c,margin:'6px 0'}}>{h.cascadeValue}</div>
              <div style={{padding:'6px 8px',background:`${h.c}10`,borderRadius:4,border:`1px solid ${h.c}30`}}>
                <span style={{fontSize:8,fontWeight:700,color:T.textDim}}>ACTION: </span>
                <span style={{fontSize:10,color:h.c,fontWeight:600}}>{h.action}</span>
              </div>
            </div>))}
          </div>
          <div style={{background:T.accentBg,borderRadius:6,padding:8,marginTop:10}}>
            <div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:2}}>BOB'S RULE OF FOUNDATION INVESTING</div>
            <div style={{fontSize:10,color:T.text,fontStyle:'italic',lineHeight:1.4}}>"Foundations don't invest in products. They invest in PEOPLE and MISSIONS. When you walk into a foundation IC, lead with the mission alignment, not the IRR. If they believe in what you're building, the numbers become supporting evidence. If you lead with numbers, you're just another fund manager."</div>
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 20: ADVISOR BATTLECARD & OBJECTION HANDLER — Bob's 25-Year Playbook ═══ */}
      {/* "I've heard every objection an advisor can throw at an alternatives product — I've been */}
      {/* on BOTH sides of the conversation. Every one of these objections has a specific, data-backed */}
      {/* answer. If our internal wholesaler can't handle all 12, we haven't trained them." — BB */}
      {aView==='objections'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Objections Mapped" value="12" icon={Shield} sub="comprehensive library" color={T.accent}/>
          <Stat label="Win Rate (Regis)" value="72%" icon={Award} sub="objection → allocation" color={T.green}/>
          <Stat label="Avg Conversion" value="3 calls" icon={Phone} sub="touches to commitment" color={T.blue}/>
          <Stat label="Competitors Mapped" value="6" icon={Target} sub="full battlecards" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIS NOTE — THE ART OF ADVISOR CONVERSION</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "Advisors have three decision gates: (1) Does this make my client's portfolio better? (2) Will my compliance department approve it? (3) Will my client understand what they own? NEWCO passes all three, but only if we COMMUNICATE it right. Below is every objection I've heard in 25 years and the exact response. Train the internal wholesaler on these until they can answer in their sleep."
          </div>
        </div>

        {/* Objection Library */}
        <Card title="Objection Handler — Complete Response Library" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          {[
            {obj:'"VC is too risky for my clients."',severity:'COMMON',freq:'85% of conversations',
              response:'Risk is about CONCENTRATION, not asset class. A single VC fund IS risky. A diversified FoF with 60-90 underlying positions across 8+ top-quartile GPs is a different risk profile entirely. The Sharpe ratio on our portfolio is 1.84 vs 0.95 for the S&P 500. Cambridge Associates data shows a 5% VC allocation in a balanced portfolio actually REDUCES overall volatility due to 0.3 correlation with public markets.',
              data:'Sharpe ratio 1.84 | S&P correlation 0.3 | 60-90 diversified positions',proof:'Cambridge Associates 2024 study on alternatives allocation',c:T.blue},
            {obj:'"Closed-end funds trade at a discount."',severity:'COMMON',freq:'78% of conversations',
              response:'Discounts are a FEATURE, not a bug. When NEWCO trades at a 10% discount, your client is buying $1 of professionally managed VC assets for $0.90. Our board has authorized a buyback program that activates at >15% discount, creating a floor. Historical data: listed PE/VC vehicles that traded at discount in Year 1 averaged 12% premium by Year 3 as track record builds. ARK Innovation traded at persistent premium once Cathie Wood established credibility.',
              data:'Board buyback at >15% discount | Historical: discount→premium in ~3 years',proof:'Morningstar CEF database — listed alternatives trajectory analysis',c:T.amber},
            {obj:'"The fees are too high — there are two layers."',severity:'HIGH',freq:'70% of conversations',
              response:'Let me show you the actual math. Our total all-in cost is 2.77% — that is LOWER than a single private VC fund at 2/20 (which nets out to 4-6% drag). We are cheaper than the product we replace. Our 1.25% management fee is 25-40% below every FoF peer (HarbourVest 1.50%, Pantheon 1.75%, typical private FoF 2.0%). We negotiated the underlying GP fees down 67bps via anchor LP leverage. Show the fee waterfall — it closes this objection every time.',
              data:'Total 2.77% vs 4.20% peer avg | 143bps annual advantage',proof:'Ken\'s Fee Waterfall tab — AFFE decomposition',c:T.red},
            {obj:'"I can\'t get my compliance team to approve this."',severity:'HIGH',freq:'65% of conversations',
              response:'We designed NEWCO specifically to pass compliance. NYSE-listed, SEC-registered under the 1940 Act, independent board majority, Big 4 auditor, no K-1s, no capital calls, daily liquidity, standard 1099 reporting. It trades and settles exactly like a stock. We have a pre-built compliance memo template — I can send it directly to your compliance officer. It takes 15 minutes to review.',
              data:'1940 Act registered | NYSE listed | No K-1 | Daily liquidity',proof:'Pre-built compliance memo template available',c:T.red},
            {obj:'"My clients don\'t understand VC."',severity:'MEDIUM',freq:'55% of conversations',
              response:'Your clients understand Apple, Google, and Amazon — they were all VC-backed. The portfolio includes household names: Anthropic (ChatGPT competitor), SpaceX, Stripe, Databricks, Anduril (defense AI). Frame it as "owning the next generation of these companies before they go public." We provide a quarterly one-pager in plain English — no jargon, just "here is what your VC allocation owns and how it is performing."',
              data:'Portfolio includes 6 recognizable brands | Plain-English quarterly letter',proof:'Client education one-pager template',c:T.blue},
            {obj:'"Why not just buy ARK or a tech ETF?"',severity:'COMPETITIVE',freq:'50% of conversations',
              response:'ARK buys AFTER the IPO. We own BEFORE the IPO — that is where 80% of the value creation happens. Stripe has appreciated 10x from Series A to today, all in private markets. Once it IPOs, the first 10x is gone. Also: ARK is a single-manager, single-strategy, publicly-traded stock portfolio. NEWCO is a multi-manager, multi-vintage, private company portfolio. Completely different risk/return profile. ARK correlates at 0.85 with NASDAQ. NEWCO correlates at 0.3.',
              data:'Pre-IPO vs post-IPO value capture | 0.3 correlation vs 0.85 for ARK',proof:'VC vintage return data vs public market entry points',c:T.green},
            {obj:'"I already have PE/VC exposure through my current allocation."',severity:'COMPETITIVE',freq:'45% of conversations',
              response:'What type of exposure? If it is through a traditional PE fund-of-funds, you are paying 4-6% total drag, locked up for 10 years, and managing capital calls. If it is through a listed PE vehicle like Blackstone or KKR stock, that is buyout exposure, not venture — completely different return driver. NEWCO is specifically VENTURE, specifically EMERGING MANAGERS (where the academic evidence shows the alpha is), and specifically at 60% lower cost than traditional alternatives.',
              data:'VC ≠ PE | Emerging manager premium +480bps | 60% lower cost',proof:'Harris-Jenkinson-Kaplan persistence data',c:T.amber},
            {obj:'"The fund is too new — no track record."',severity:'HIGH',freq:'60% of conversations',
              response:'The FUND is new. The TEAM is not. Ken Wallace has 16 years and 725+ LP investments at Industry Ventures. He backed Chris Sacca\'s Lowercase Capital at Fund I — that returned 200x. Bob Burlinson built Regis to $5B, sold to Mercer, and served on Skoll Foundation\'s IC for 17 years. Jason Goldman brings 5th-generation Berkeley access. The portfolio already contains 8 top-quartile GPs with combined 85+ years of track record. You are not buying a new team — you are buying an experienced team in a new, better-structured vehicle.',
              data:'Ken: 725+ investments | Bob: $5B built | GPs: 85+ combined years',proof:'Team bios + GP track record documentation',c:T.red},
            {obj:'"What happens if the market crashes?"',severity:'MEDIUM',freq:'40% of conversations',
              response:'Three built-in protections: (1) SBIC fixed-rate leverage is non-callable — no margin calls regardless of NAV decline; (2) Secondary purchasing at distressed prices becomes our BEST opportunity set — we bought Founders Fund VI equivalent at peak crisis for 55¢; (3) Our 1.25% management fee covers operations without performance pressure, so we never have to sell at the bottom. In our stress test, even 2008-level drawdown recovers to positive IRR within 4 years. Counter-cyclical positioning is a feature, not a risk.',
              data:'SBIC non-callable | Crisis = buying opportunity | 4-year recovery',proof:'Stress test scenarios in Quant Frameworks tab',c:T.blue},
            {obj:'"What is the liquidity? Can my client sell any day?"',severity:'COMMON',freq:'75% of conversations',
              response:'Yes. NYSE-listed. Your client can sell any share, any day the market is open, at market price. There is no lock-up, no gate, no redemption queue. That said, we recommend a 5+ year hold to capture the full J-curve — just like you would not sell a growth stock after 6 months. But the OPTION to sell provides a critical safety valve that traditional VC allocations do not have.',
              data:'NYSE daily liquidity | No lock-up | Recommended 5+ year hold',proof:'1940 Act daily liquidity requirement',c:T.green},
          ].map((o,oi)=>(<div key={oi} style={{background:T.bgAccent,borderRadius:6,padding:10,marginBottom:6,borderLeft:`4px solid ${o.c}`}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:4}}>
              <span style={{fontSize:11,fontWeight:800,color:T.text,fontStyle:'italic'}}>{o.obj}</span>
              <div style={{display:'flex',gap:4}}><Badge color={o.c}>{o.severity}</Badge><span style={{fontSize:9,color:T.textMuted}}>{o.freq}</span></div>
            </div>
            <div style={{fontSize:10,color:T.text,lineHeight:1.5,marginBottom:4,padding:'4px 8px',background:T.bg,borderRadius:4}}>{o.response}</div>
            <div style={{display:'flex',gap:8}}><span style={{fontSize:8,color:T.accent}}><strong>DATA:</strong> {o.data}</span><span style={{fontSize:8,color:T.textMuted}}><strong>PROOF:</strong> {o.proof}</span></div>
          </div>))}
        </div></Card>

        {/* Competitor Battlecard */}
        <Card title="Competitor Battlecard — Head-to-Head Positioning"><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Dimension</TH><TH align="center">NEWCO</TH><TH align="center">HarbourVest</TH><TH align="center">ARK Innovation</TH><TH align="center">Blackstone BX</TH><TH align="center">Private VC FoF</TH>
          </tr></thead><tbody>
            {[
              {dim:'Asset Class',vals:['Venture Capital',{v:'PE + VC Mix',w:'lose'},'Public Tech',{v:'Buyout (PE)',w:'lose'},'Venture Capital'],c:T.accent},
              {dim:'Pre-IPO Access',vals:['✅ Yes',{v:'✅ Yes',w:'tie'},'❌ No (post-IPO only)',{v:'❌ No (post-IPO)',w:'lose'},'✅ Yes'],c:T.green},
              {dim:'Emerging Mgr Focus',vals:['✅ Primary thesis',{v:'❌ Established GPs',w:'lose'},'N/A',{v:'N/A',w:'lose'},'Varies'],c:T.green},
              {dim:'Total Cost',vals:['2.77%',{v:'4.70%',w:'lose'},'0.75%',{v:'1.25% + carry',w:'lose'},{v:'4-6%',w:'lose'}],c:T.green},
              {dim:'Liquidity',vals:['Daily (NYSE)',{v:'Quarterly (limited)',w:'lose'},'Daily (NYSE)','Daily (NYSE)',{v:'10yr lock-up',w:'lose'}],c:T.green},
              {dim:'K-1 Tax',vals:['No K-1',{v:'Yes K-1',w:'lose'},'No K-1','No K-1',{v:'Yes K-1',w:'lose'}],c:T.green},
              {dim:'IRA/401k Eligible',vals:['✅ Yes',{v:'❌ No',w:'lose'},'✅ Yes','✅ Yes',{v:'❌ No',w:'lose'}],c:T.green},
              {dim:'Capital Calls',vals:['None',{v:'Yes',w:'lose'},'None','None',{v:'Ongoing 5+ yrs',w:'lose'}],c:T.green},
              {dim:'Min Investment',vals:['~$20 (1 share)',{v:'$100K+',w:'lose'},'~$50 (1 share)','~$100 (1 share)',{v:'$250K-$5M',w:'lose'}],c:T.green},
              {dim:'Public Mkt Corr',vals:['0.3 (low)',{v:'0.4',w:'tie'},'0.85 (high)',{v:'0.6',w:'lose'},'0.3 (low)'],c:T.accent},
              {dim:'NEWCO Advantage',vals:['—','Cost + Liquidity + No K-1','Pre-IPO access + Low corr','VC vs PE exposure + Cost','Daily liquidity + No calls'],c:T.accent},
            ].map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`,background:i===10?T.accentBg:'transparent'}}>
              <TD style={{fontWeight:700,fontSize:10}}>{r.dim}</TD>
              {r.vals.map((v,j)=>{const val=typeof v==='object'?v.v:v;const w=typeof v==='object'?v.w:'win';return(
                <TD key={j} align="center" style={{fontSize:10,fontWeight:j===0?700:400,color:j===0?T.accent:w==='lose'?T.red:w==='tie'?T.textMuted:T.text,background:j===0?`${T.accent}06`:'transparent'}}>{val}</TD>
              );})}
            </tr>))}
          </tbody></table>
          <div style={{background:T.accentBg,borderRadius:6,padding:8,marginTop:8}}>
            <div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:2}}>BOB'S POSITIONING LINE</div>
            <div style={{fontSize:10,color:T.text,fontStyle:'italic',lineHeight:1.4}}>"NEWCO gives your clients what private VC fund-of-funds give institutional investors — top-quartile GP access, emerging manager alpha, pre-IPO ownership — but in a wrapper that trades like a stock. No K-1s, no capital calls, no 10-year lockup, no $5M minimums. One ticker in your model portfolio replaces an entire alternatives program."</div>
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 21: CLIENT LIFECYCLE & TIER PROGRESSION — Regis Wealth Management Playbook ═══ */}
      {/* "At Regis, our best clients started with $500K and grew to $25M+ because we built a */}
      {/* JOURNEY, not a transaction. Every touchpoint deepened the relationship. NEWCO has the same */}
      {/* opportunity: buy 100 shares → 10K shares → co-invest → advisory council." — BB */}
      {aView==='lifecycle'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Client Tiers" value="4" icon={Layers} sub="explorer → council" color={T.accent}/>
          <Stat label="Avg Upsell Rate" value="35%" icon={TrendingUp} sub="tier progression/year" color={T.green}/>
          <Stat label="Co-Invest Threshold" value="10K" icon={DollarSign} sub="shares for co-invest rights" color={T.blue}/>
          <Stat label="Council Threshold" value="250K" icon={Award} sub="shares for advisory council" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIS NOTE — THE CLIENT JOURNEY</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "At Regis, I learned that wealth management is not about selling a product — it is about building a RELATIONSHIP LADDER. Every tier unlocks new value for the client, which creates natural accumulation incentive. The genius of NEWCO's share-tiered structure is that it aligns client behavior with fund growth. When a client buys 10,000 shares to unlock co-invest rights, that is $200K+ of new capital AND a deeper relationship. When they hit 250K shares for advisory council, they are a $5M+ investor AND a brand ambassador. The tiers sell themselves — we just need to make the VALUE at each tier irresistible."
          </div>
        </div>

        {/* Tier Progression Map */}
        <Card title="Client Tier Progression — Value Ladder" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10}}>
            {[
              {tier:'EXPLORER',shares:'1-999',value:'~$20-$20K',color:T.textMuted,
                benefits:['NYSE daily liquidity','Quarterly investor letter (Buffett-style)','Annual report + audited financials','Public portfolio disclosure (top holdings)','Access to investor webinars (quarterly)'],
                comms:['Welcome email + investor deck','Quarterly letter (public version)','Annual report delivery','Market commentary (monthly email)'],
                goal:'Educate. Build confidence in thesis and team.',
                conversion:'35% advance to Builder within 12 months',
                trigger:'First earnings report showing GP performance validates thesis'},
              {tier:'BUILDER',shares:'1,000-9,999',value:'$20K-$200K',color:T.blue,
                benefits:['Everything in Explorer, plus:','Enhanced quarterly letter (portfolio-level detail)','GP selection insights (which managers, why)','Priority access to secondary offerings','Invitation to annual investor day'],
                comms:['Builder welcome package + Ken\'s CIO letter','Monthly portfolio snapshot email','Quarterly enhanced letter with GP commentary','Annual investor day invitation','Semi-annual "State of Venture" webinar (Ken + Jason)'],
                goal:'Deepen conviction. Show the institutional quality.',
                conversion:'40% advance to Partner within 18 months',
                trigger:'First distribution or major portfolio co exit (Stripe/Anthropic IPO)'},
              {tier:'PARTNER',shares:'10,000-249,999',value:'$200K-$5M',color:T.green,
                benefits:['Everything in Builder, plus:','CO-INVESTMENT RIGHTS — direct deal allocation','Monthly CIO letter (institutional-grade)','Quarterly strategy call with Ken Wallace','Priority allocation on co-invest deals','Named relationship manager'],
                comms:['Partner onboarding call with Ken (30 min)','Monthly CIO letter (private, institutional-grade)','Quarterly 1:1 strategy call (Ken + relationship manager)','Co-invest alerts: 48hr decision window per deal','Annual in-person dinner (SF / NYC)'],
                goal:'Integrate into the ecosystem. Co-invest creates lock-in.',
                conversion:'25% advance to Council within 24 months',
                trigger:'First co-invest participation (Anthropic, Shield AI, etc.)'},
              {tier:'COUNCIL',shares:'250,000+',value:'$5M+',color:T.accent,
                benefits:['Everything in Partner, plus:','ADVISORY COUNCIL seat — strategic input','GP-level transparency (IC memos, pipeline)','Annual strategy offsite (Napa Valley)','Direct access to Ken, Bob, and Jason','Board observer rights (if qualified)','Priority allocation on ALL co-invests','Custom reporting for family office needs'],
                comms:['Council onboarding: dinner with full team','Bi-weekly CIO update (SMS/call as preferred)','Monthly IC summary (redacted for confidentiality)','Quarterly in-person meeting (their office or ours)','Annual strategy offsite (Napa Valley Reserve)','Ad-hoc calls with any team member, any time'],
                goal:'Full partnership. These clients ARE the franchise.',
                conversion:'85% retention rate (Regis benchmark for $5M+ clients)',
                trigger:'Advisory council becomes their "board of advisors" for personal VC exposure'},
            ].map((t,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`4px solid ${t.color}`,border:`1px solid ${T.border}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                <div><div style={{fontSize:13,fontWeight:800,color:t.color}}>{t.tier}</div><div style={{fontSize:10,fontFamily:mono,color:T.textMuted}}>{t.shares} shares • {t.value}</div></div>
              </div>
              <div style={{marginBottom:6}}>
                <div style={{fontSize:8,fontWeight:700,color:T.textDim,marginBottom:2}}>BENEFITS</div>
                {t.benefits.map((b,bi)=>(<div key={bi} style={{fontSize:9,color:b.includes('plus:')?T.textDim:b===b.toUpperCase()||b.startsWith('CO-')||b.startsWith('ADVISORY')?t.color:T.text,fontWeight:b===b.toUpperCase()||b.startsWith('CO-')||b.startsWith('ADVISORY')?700:400,padding:'1px 0 1px 6px',borderLeft:`2px solid ${t.color}40`}}>{b}</div>))}
              </div>
              <div style={{marginBottom:6}}>
                <div style={{fontSize:8,fontWeight:700,color:T.textDim,marginBottom:2}}>COMMUNICATIONS CADENCE</div>
                {t.comms.map((c,ci)=>(<div key={ci} style={{fontSize:8,color:T.textMuted,padding:'1px 0 1px 6px',borderLeft:`1px solid ${T.border}`}}>{c}</div>))}
              </div>
              <div style={{padding:'4px 6px',background:T.bg,borderRadius:4,marginBottom:4}}>
                <div style={{fontSize:8,color:T.textDim}}><strong>GOAL:</strong> <span style={{color:t.color}}>{t.goal}</span></div>
                <div style={{fontSize:8,color:T.textMuted}}><strong>CONVERSION:</strong> {t.conversion}</div>
                <div style={{fontSize:8,color:T.textMuted}}><strong>TRIGGER:</strong> {t.trigger}</div>
              </div>
            </div>))}
          </div>
        </div></Card>

        {/* Quarterly Reporting Framework */}
        <Card title="Quarterly Report Framework — Client-Facing Communications"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:12}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:6}}>QUARTERLY LETTER STRUCTURE (BUFFETT STYLE)</div>
              {[
                {section:'1. Opening — Market Context',length:'2-3 paragraphs',content:'Where we are in the cycle. What changed this quarter. Macro context that affects venture. Written in plain English — no jargon, no hedging. If it was a bad quarter, say so directly.',tone:'Candid, confident, educational',c:T.accent},
                {section:'2. Portfolio Performance',length:'1 page',content:'NAV change. Top 5 contributors/detractors by name. New investments and exits. DPI progress. Compare to Cambridge benchmarks. Include specific company milestones (funding rounds, revenue, product launches).',tone:'Data-rich but readable. Numbers with narrative.',c:T.green},
                {section:'3. What We\'re Seeing',length:'1-2 paragraphs',content:'Emerging trends from GP conversations and Omniscient data. What are the best VCs excited about? Where is capital flowing? This is the "insider access" section that makes clients feel they are getting institutional intelligence.',tone:'Insider, forward-looking. "Here is what we see before the market sees it."',c:T.blue},
                {section:'4. What We\'re Doing',length:'1-2 paragraphs',content:'New commitments, re-ups, secondary purchases. Why each decision was made. Link to thesis. Show the IC process is rigorous. Clients want to know the adults are in the room.',tone:'Decisive, institutional. "We committed because..."',c:T.purple},
                {section:'5. Closing — What\'s Ahead',length:'1 paragraph',content:'Forward calendar: upcoming IPOs, distributions, events. Next catalyst for portfolio value creation. End with an invitation: "Call us anytime." Make it personal.',tone:'Optimistic but grounded. Leave them wanting the next letter.',c:T.accent},
              ].map((s,si)=>(<div key={si} style={{padding:'6px 0',borderBottom:si<4?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                  <span style={{fontSize:10,fontWeight:700,color:s.c}}>{s.section}</span>
                  <span style={{fontSize:8,color:T.textMuted}}>{s.length}</span>
                </div>
                <div style={{fontSize:9,color:T.text,lineHeight:1.3,marginBottom:2}}>{s.content}</div>
                <div style={{fontSize:8,color:T.textDim,fontStyle:'italic'}}>Tone: {s.tone}</div>
              </div>))}
            </div>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.green,marginBottom:6}}>REPORTING CADENCE BY TIER</div>
              <table style={{width:'100%',borderCollapse:'collapse',marginBottom:10}}><thead><tr>
                <TH>Communication</TH><TH align="center">Explorer</TH><TH align="center">Builder</TH><TH align="center">Partner</TH><TH align="center">Council</TH>
              </tr></thead><tbody>
                {[
                  {item:'Quarterly Letter',vals:['Public','Enhanced','Institutional','IC-Grade']},
                  {item:'Monthly Update',vals:['—','Snapshot','CIO Letter','CIO + Call']},
                  {item:'Strategy Calls',vals:['—','Webinar','1:1 Quarterly','Bi-weekly']},
                  {item:'Co-Invest Alerts',vals:['—','—','48hr window','Priority 72hr']},
                  {item:'In-Person Events',vals:['—','Annual Day','Annual Dinner','Napa Offsite']},
                  {item:'IC Memos',vals:['—','—','—','Redacted access']},
                  {item:'Named Contact',vals:['IR email','IR email','Rel. Manager','Any principal']},
                  {item:'Custom Reporting',vals:['—','—','On request','Proactive']},
                ].map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
                  <TD style={{fontSize:10,fontWeight:600}}>{r.item}</TD>
                  {r.vals.map((v,j)=>(<TD key={j} align="center" style={{fontSize:9,color:v==='—'?T.textDim:j===3?T.accent:j===2?T.green:j===1?T.blue:T.textMuted}}>{v}</TD>))}
                </tr>))}
              </tbody></table>

              <div style={{background:T.accentBg,borderRadius:6,padding:8}}>
                <div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:2}}>BOB'S REPORTING RULE</div>
                <div style={{fontSize:10,color:T.text,fontStyle:'italic',lineHeight:1.4}}>"The best quarterly letter is one the client FORWARDS to their friends. At Regis, our top clients would literally send our letters to other potential clients as a referral tool. Write it for the audience of the person who has never heard of you — because that is who your best clients will share it with."</div>
              </div>
            </div>
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 22: CHANNEL ECONOMICS — Distribution Revenue Model ═══ */}
      {/* "The math on platform distribution is brutal if you don't understand it, and beautiful if you do. */}
      {/* One Mercer advisor putting 3% of their book in NEWCO = $900K. Multiply by 1,150 advisors. */}
      {/* That's the power of the platform model I built at Regis." — BB */}
      {aView==='channel'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Target Platforms" value="5" icon={Target} sub="active pipeline" color={T.accent}/>
          <Stat label="Total Advisors" value="5,000+" icon={Users} sub="across all platforms" color={T.green}/>
          <Stat label="Avg Book Size" value="$30M" icon={DollarSign} sub="per advisor" color={T.blue}/>
          <Stat label="Penetration Target" value="8-12%" icon={TrendingUp} sub="of advisors Year 1" color={T.amber}/>
          <Stat label="Rev per Advisor" value="$9.4K" icon={Award} sub="at 3% allocation" color={T.purple}/>
        </div>

        <div style={{background:T.accentBg,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>CIS NOTE — THE PLATFORM ECONOMICS</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            "I built Regis from $200M to $5B. The math that drove our growth was simple: get on 3 platforms, capture 10% advisor penetration, and let the model portfolio inclusion do the work. Each advisor who includes NEWCO in their model portfolio generates ~$9,400/year in management fees for us. If we get on 3 platforms with 3,000 total advisors and 10% penetrate, that is 300 advisors × $9.4K = $2.8M in recurring annual management fee revenue from ONE channel. The key metric is NOT AUM — it is advisor count and penetration rate."
          </div>
        </div>

        {/* D3 Sankey — Capital Flow: Source → Platform → NEWCO → Funds */}
        <Card title="Capital Flow — D3 Sankey Diagram" action={<span style={{fontSize:8,color:T.textDim,fontFamily:mono}}>Source → Platform → NEWCO → Fund Allocation</span>} style={{marginBottom:12}}><div style={{padding:'8px 12px'}}>
          <D3SankeyFlow
            width={710} height={340}
            nodes={[
              {id:'hni',label:'HNW Investors',col:0,value:80,color:T.amber},
              {id:'ria',label:'RIA Clients',col:0,value:120,color:T.green},
              {id:'inst',label:'Institutions',col:0,value:50,color:T.blue},
              {id:'fam',label:'Family Offices',col:0,value:40,color:T.purple},
              {id:'mercer',label:'Mercer ($92B)',col:1,value:104,color:T.accent},
              {id:'gs',label:'Goldman Sachs',col:1,value:64,color:T.blue},
              {id:'jpm',label:'J.P. Morgan',col:1,value:63,color:T.green},
              {id:'nt',label:'Northern Trust',col:1,value:35,color:T.amber},
              {id:'path',label:'Pathstone',col:1,value:60,color:T.purple},
              {id:'newco',label:'NEWCO Fund',col:2,value:290,color:T.accent},
              {id:'aisafety',label:'AI Safety',col:3,value:130,color:T.accent},
              {id:'deept',label:'Deep Tech',col:3,value:60,color:T.blue},
              {id:'govtech',label:'GovTech',col:3,value:50,color:T.green},
              {id:'secondary',label:'Secondaries',col:3,value:50,color:T.amber},
            ]}
            links={[
              {source:'hni',target:'mercer',value:30},{source:'hni',target:'gs',value:25},{source:'hni',target:'path',value:25},
              {source:'ria',target:'mercer',value:50},{source:'ria',target:'jpm',value:40},{source:'ria',target:'nt',value:30},
              {source:'inst',target:'gs',value:25},{source:'inst',target:'jpm',value:15},{source:'inst',target:'nt',value:10},
              {source:'fam',target:'path',value:20},{source:'fam',target:'mercer',value:12},{source:'fam',target:'gs',value:8},
              {source:'mercer',target:'newco',value:92},{source:'gs',target:'newco',value:58},
              {source:'jpm',target:'newco',value:55},{source:'nt',target:'newco',value:35},{source:'path',target:'newco',value:50},
              {source:'newco',target:'aisafety',value:130},{source:'newco',target:'deept',value:60},
              {source:'newco',target:'govtech',value:50},{source:'newco',target:'secondary',value:50},
            ]}
          />
        </div></Card>

        {/* Channel Economics Model */}
        <Card title="Platform Distribution Revenue Model" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Platform</TH><TH align="center">Advisors</TH><TH align="center">Avg Book</TH><TH align="center">Alloc %</TH><TH align="center">Rev/Advisor</TH><TH align="center">Yr1 Pen.</TH><TH align="center">Yr1 Advisors</TH><TH align="center">Yr1 AUM</TH><TH align="center">Yr1 Rev</TH><TH align="center">Yr3 Pen.</TH><TH align="center">Yr3 AUM</TH>
          </tr></thead><tbody>
            {[
              {plat:'Mercer Advisors',adv:1150,book:30,alloc:3,pen1:12,pen3:25,prob:85},
              {plat:'Goldman Sachs PWM',adv:800,book:80,alloc:2,pen1:5,pen3:12,prob:55},
              {plat:'J.P. Morgan Wealth',adv:2500,book:25,alloc:2,pen1:3,pen3:8,prob:40},
              {plat:'Northern Trust',adv:350,book:50,alloc:3,pen1:10,pen3:20,prob:50},
              {plat:'Pathstone',adv:200,book:100,alloc:3,pen1:15,pen3:30,prob:65},
            ].map((p,i)=>{
              const revPerAdv=(p.book*1e6*p.alloc/100*0.0125);
              const yr1Adv=Math.round(p.adv*p.pen1/100);
              const yr1Aum=yr1Adv*p.book*p.alloc/100;
              const yr1Rev=yr1Adv*revPerAdv/1e6;
              const yr3Adv=Math.round(p.adv*p.pen3/100);
              const yr3Aum=yr3Adv*p.book*p.alloc/100;
              return(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
                <TD style={{fontWeight:700,fontSize:10}}>{p.plat}</TD>
                <TD align="center" mono>{p.adv.toLocaleString()}</TD>
                <TD align="center" mono>${p.book}M</TD>
                <TD align="center" mono>{p.alloc}%</TD>
                <TD align="center" mono color={T.accent}>${(revPerAdv/1e3).toFixed(1)}K</TD>
                <TD align="center" mono>{p.pen1}%</TD>
                <TD align="center" mono bold>{yr1Adv}</TD>
                <TD align="center" mono color={T.green}>${yr1Aum.toFixed(0)}M</TD>
                <TD align="center" mono bold color={T.accent}>${yr1Rev.toFixed(1)}M</TD>
                <TD align="center" mono>{p.pen3}%</TD>
                <TD align="center" mono color={T.green}>${yr3Aum.toFixed(0)}M</TD>
              </tr>);
            })}
            {(()=>{
              const tots=[
                {plat:'Mercer',adv:1150,book:30,alloc:3,pen1:12,pen3:25},
                {plat:'Goldman',adv:800,book:80,alloc:2,pen1:5,pen3:12},
                {plat:'JPM',adv:2500,book:25,alloc:2,pen1:3,pen3:8},
                {plat:'NT',adv:350,book:50,alloc:3,pen1:10,pen3:20},
                {plat:'Path',adv:200,book:100,alloc:3,pen1:15,pen3:30}];
              const yr1Tot=tots.reduce((s,p)=>{const a=Math.round(p.adv*p.pen1/100);return s+a*p.book*p.alloc/100;},0);
              const yr3Tot=tots.reduce((s,p)=>{const a=Math.round(p.adv*p.pen3/100);return s+a*p.book*p.alloc/100;},0);
              const yr1Rev=yr1Tot*0.0125;
              return(<tr style={{background:T.accentBg,fontWeight:700}}><TD style={{fontWeight:800,color:T.accent}}>TOTAL (ALL PLATFORMS)</TD><TD align="center" mono>5,000</TD><TD/><TD/><TD/><TD/><TD/><TD align="center" mono bold color={T.green}>${yr1Tot.toFixed(0)}M</TD><TD align="center" mono bold color={T.accent}>${yr1Rev.toFixed(1)}M</TD><TD/><TD align="center" mono bold color={T.green}>${yr3Tot.toFixed(0)}M</TD></tr>);
            })()}
          </tbody></table>
        </div></Card>

        {/* Unit Economics */}
        <Card title="Unit Economics — Per Advisor & Breakeven Analysis" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:12}}>
            {[
              {title:'Customer Acquisition Cost (CAC)',metrics:[
                {m:'Wholesaler fully loaded cost',v:'$250K/yr'},
                {m:'Marketing / materials / events',v:'$150K/yr'},
                {m:'Platform approval cost (DDQ, legal)',v:'$75K one-time'},
                {m:'Total annual distribution cost',v:'$475K/yr'},
                {m:'Advisors needed to break even',v:'51 advisors'},
                {m:'CAC per advisor (blended)',v:'$1,580'},
              ],note:'51 advisors × $9.4K avg rev = $480K. One Mercer cohort of 50 advisors covers the entire distribution cost.',c:T.accent},
              {title:'Lifetime Value (LTV)',metrics:[
                {m:'Avg advisor rev/year',v:'$9,375'},
                {m:'Avg advisor retention',v:'5+ years'},
                {m:'Gross LTV per advisor',v:'$46,875'},
                {m:'LTV:CAC ratio',v:'29.7x'},
                {m:'Payback period',v:'~2 months'},
                {m:'Tier progression uplift',v:'+35%/yr'},
              ],note:'LTV:CAC of 29.7x is exceptional. For comparison, best SaaS companies target 3-5x. Platform distribution is one of the highest-LTV channels in financial services.',c:T.green},
              {title:'Breakeven Scenarios',metrics:[
                {m:'Scenario 1: Mercer only',v:'$15-25M AUM'},
                {m:'Scenario 2: Mercer + Pathstone',v:'$25-40M AUM'},
                {m:'Scenario 3: 3 platforms approved',v:'$45-85M AUM'},
                {m:'Fund-level breakeven',v:'$50M AUM'},
                {m:'Profitable at scale',v:'$150M+ AUM'},
                {m:'Target Year 2 AUM',v:'$200-300M'},
              ],note:'Fund management fee breakeven is ~$50M AUM (1.25% × $50M = $625K covers base costs). Every dollar above $50M is near-100% margin on management fee.',c:T.blue},
              {title:'Growth Levers',metrics:[
                {m:'Model portfolio inclusion',v:'10-20x vs opt-in'},
                {m:'Advisor education webinars',v:'3-5x conversion'},
                {m:'Co-invest tier progression',v:'+35% AUM/client/yr'},
                {m:'Client referral rate',v:'18% (Regis benchmark)'},
                {m:'Quarterly letter forward rate',v:'8% (target)'},
                {m:'Advisor word-of-mouth',v:'Best channel (free)'},
              ],note:'MODEL PORTFOLIO INCLUSION is the #1 lever. Once in a model, every new client automatically gets NEWCO allocation. Advisor does nothing — the system allocates.',c:T.purple},
            ].map((u,ui)=>(<div key={ui} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${u.c}`}}>
              <div style={{fontSize:10,fontWeight:800,color:u.c,marginBottom:6}}>{u.title}</div>
              {u.metrics.map((m,mi)=>(<div key={mi} style={{display:'flex',justifyContent:'space-between',padding:'2px 0',borderBottom:mi<u.metrics.length-1?`1px solid ${T.border}`:'none'}}>
                <span style={{fontSize:9,color:T.textMuted}}>{m.m}</span>
                <span style={{fontSize:10,fontWeight:700,fontFamily:mono,color:u.c}}>{m.v}</span>
              </div>))}
              <div style={{fontSize:9,color:T.text,lineHeight:1.3,marginTop:6,padding:'4px 6px',background:T.bg,borderRadius:4}}>{u.note}</div>
            </div>))}
          </div>
        </div></Card>

        {/* Advisor Activation Playbook */}
        <Card title="Advisor Activation — 90-Day Post-Approval Playbook"><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {phase:'Days 1-30: LAUNCH',title:'Platform Announcement & Education',actions:[
                'Joint announcement with platform ("NEWCO now available on [Platform]")',
                'Advisor education webinar — 45 min with Ken + Bob (live Q&A)',
                'One-pager distribution: "Why NEWCO in Your Client Portfolio" (PDF)',
                'Compliance memo template sent to all advisor compliance teams',
                'Model portfolio suggestion sent to CIO/research (2-5% alternatives sleeve)',
                'Direct outreach to top 20 advisors by AUM (Bob + relationship manager)',
              ],kpi:'Target: 30 advisor signups for educational webinar',c:T.accent},
              {phase:'Days 31-60: ADOPTION',title:'First Allocations & Early Wins',actions:[
                'Follow up with every webinar attendee — 1:1 call within 5 business days',
                'Case study: "How [Advisor Name] allocated 3% for a $10M UHNW client"',
                'Quarterly letter delivered — first proof of institutional quality reporting',
                'Co-invest deal alert to early adopters (reward first movers)',
                'Internal wholesaler office visits to top 10 branch offices',
                'Peer comparison: "Your colleagues at [branch] have allocated — join them"',
              ],kpi:'Target: 25 advisors with first allocation placed',c:T.green},
              {phase:'Days 61-90: SCALE',title:'Model Portfolio & Referral Engine',actions:[
                'Push for model portfolio inclusion (CIO presentation with Ken)',
                'Advisor success stories: "Advisor X grew alternatives AUM 40% using NEWCO"',
                'Client event: portfolio company showcase (Anthropic, Anduril executives)',
                'Referral incentive: advisors who refer 3 colleagues get priority co-invest access',
                'Second webinar: "Q1 Results — What Your Clients Own" (performance update)',
                'Feedback survey to all activated advisors — iterate on materials',
              ],kpi:'Target: 50 active advisors, model portfolio proposal submitted',c:T.blue},
            ].map((p,pi)=>(<div key={pi} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${p.c}`}}>
              <div style={{fontSize:10,fontWeight:800,color:p.c,marginBottom:2}}>{p.phase}</div>
              <div style={{fontSize:10,fontWeight:600,color:T.text,marginBottom:6}}>{p.title}</div>
              {p.actions.map((a,ai)=>(<div key={ai} style={{fontSize:9,color:T.text,padding:'2px 0 2px 8px',borderLeft:`2px solid ${p.c}40`,marginBottom:2,lineHeight:1.3}}>{a}</div>))}
              <div style={{padding:'4px 6px',background:`${p.c}10`,borderRadius:4,marginTop:6,border:`1px solid ${p.c}30`}}>
                <span style={{fontSize:8,fontWeight:700,color:T.textDim}}>KPI: </span>
                <span style={{fontSize:9,fontWeight:600,color:p.c}}>{p.kpi}</span>
              </div>
            </div>))}
          </div>
          <div style={{background:T.accentBg,borderRadius:6,padding:8,marginTop:10}}>
            <div style={{fontSize:9,fontWeight:700,color:T.accent,marginBottom:2}}>BOB'S DISTRIBUTION LAW</div>
            <div style={{fontSize:10,color:T.text,fontStyle:'italic',lineHeight:1.4}}>"Platform approval gets you in the building. Model portfolio inclusion puts you in every room. The difference between a $15M product and a $150M product is one CIO decision to include you in the default allocation. Every action in the first 90 days should point toward that single outcome: model portfolio inclusion."</div>
          </div>
        </div></Card>
      </div>)}

      {/* ═══════════════════════════════════════════════════════════════════ */}
      {/* OMNISCIENT INTELLIGENCE PLATFORM — Project Omniscient Integration */}
      {/* ═══════════════════════════════════════════════════════════════════ */}

      {/* ═══ TAB 23: OMNISCIENT COMMAND CENTER ═══ */}
      {/* "The best VCs don't have better intuition—they have better information systems." */}
      {/* Based on UC Berkeley research: external factors account for 80% of startup success */}
      {aView==='omniscient'&&(<div>
        {/* ═══ INTELLIGENCE LP MANIFESTO ═══ */}
        <div style={{padding:'18px 22px',background:`linear-gradient(135deg, ${T.accent}10, ${T.purple}06, ${T.blue}04)`,borderRadius:12,border:`1px solid ${T.accent}25`,marginBottom:14,position:'relative',overflow:'hidden'}}>
          <div style={{position:'absolute',top:-20,right:-20,width:120,height:120,borderRadius:60,background:`${T.accent}06`}}/>
          <div style={{position:'absolute',bottom:-30,left:200,width:80,height:80,borderRadius:40,background:`${T.purple}04`}}/>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:10,position:'relative'}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.accent,letterSpacing:1.5,textTransform:'uppercase',marginBottom:4}}>THE INTELLIGENCE LP THESIS</div>
              <div style={{fontSize:20,fontWeight:900,color:T.text,lineHeight:1.2,marginBottom:6}}>We are not blind LP capital.</div>
              <div style={{fontSize:20,fontWeight:900,color:T.accent,lineHeight:1.2}}>We are an Intelligence LP.</div>
            </div>
            <div style={{textAlign:'right',flexShrink:0}}>
              <div style={{fontSize:28,fontWeight:900,fontFamily:mono,color:T.accent}}>6 → 4</div>
              <div style={{fontSize:9,color:T.textDim}}>Data Inputs → Strategic Outputs</div>
            </div>
          </div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.7,maxWidth:720,position:'relative'}}>
            Every LP writes a check and waits. We write a check and <span style={{fontWeight:700,color:T.accent}}>activate intelligence infrastructure</span> around it.
            Six proprietary data feeds continuously monitor our portfolio companies and target GPs — secondary pricing, hiring velocity,
            burn rates, IPO signals, revenue trajectories, and government procurement. These feed four strategic output engines that generate
            <span style={{fontWeight:700,color:T.green}}> risk-adjusted NAV models</span>, <span style={{fontWeight:700,color:T.blue}}>allocation rebalancing signals</span>,
            <span style={{fontWeight:700,color:T.amber}}> liquidity stress alerts</span>, and <span style={{fontWeight:700,color:T.purple}}>concentration optimization</span>.
            The result: we see what other LPs can't, act before they react, and compound informational advantage over every fund cycle.
          </div>
        </div>

        {/* ═══ LIVE INTELLIGENCE FEEDS — 6 Data Inputs ═══ */}
        <Card title="🛰️ Live Intelligence Feeds — 6 Proprietary Data Inputs" style={{marginBottom:14,borderLeft:`3px solid ${T.accent}`}}>
          <div style={{padding:'8px 0'}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
              {[
                {feed:'Secondary Pricing Feeds',icon:'💰',status:'LIVE',freshness:'Updated 4h ago',coverage:'18 platforms',
                  desc:'Real-time bid/ask spreads from Forge, NASDAQ Private Market, EquityZen, Setter Capital, InvestX, Zanbato. Triangulated pricing on 42 portfolio companies.',
                  metrics:[{l:'Avg Discount',v:'-18.2%',c:T.green},{l:'Spreads',v:'4.2%',c:T.blue},{l:'Volume',v:'$8.4B',c:T.accent}],
                  signals:['Anthropic secondary: +12% in 30d — validation signal','SpaceX tender: $380B implied — consistent with mark','Scale AI: widening spread — liquidity concern'],
                  sources:['Forge Global','NASDAQ Private Market','EquityZen','Setter Capital','InvestX','Zanbato','JPM SecondaryLink'],
                  color:T.accent},
                {feed:'Hiring Velocity Analytics',icon:'👥',status:'LIVE',freshness:'Updated 12h ago',coverage:'LinkedIn + GitHub',
                  desc:'Track net headcount changes, engineering velocity, leadership hires, and departures across all portfolio companies. Reverse-engineered from LinkedIn data + job board scraping.',
                  metrics:[{l:'Avg Growth',v:'+24%',c:T.green},{l:'Eng Ratio',v:'42%',c:T.blue},{l:'Turnover',v:'8.2%',c:T.amber}],
                  signals:['Anthropic: +380 engineers in 6mo — massive scaling signal','Anduril: 12 cleared defense hires — contract pipeline','Scale AI: -15 senior engineers — possible concern'],
                  sources:['LinkedIn Sales Nav','GitHub Contributor API','Glassdoor','Levels.fyi','Blind App','H1B Database'],
                  color:T.green},
                {feed:'Burn Multiple Inference',icon:'🔥',status:'ACTIVE',freshness:'Updated weekly',coverage:'GP reports + inference',
                  desc:'Triangulate burn rates from cap table changes, hiring costs, cloud spending signals, and GP quarterly letters. Estimate runway without direct P&L access.',
                  metrics:[{l:'Avg Burn',v:'1.8x',c:T.green},{l:'Runway',v:'28mo',c:T.blue},{l:'At Risk',v:'2 cos',c:T.red}],
                  signals:['Databricks: burn multiple improving 2.4x → 1.6x — efficiency','Anthropic: $400M/mo training costs — planned, funded','Scale AI: burn multiple rising to 3.2x — monitor'],
                  sources:['GP Quarterly Letters','Cap Table Changes','AWS/GCP Usage Inference','Hiring Cost Models','Secondary Market Signals'],
                  color:T.amber},
                {feed:'IPO Probability Modeling',icon:'📈',status:'LIVE',freshness:'Updated daily',coverage:'ML pipeline',
                  desc:'Machine learning model trained on 2,400+ VC-backed IPOs (2010-2025). Features: revenue growth, market conditions, peer timing, banker engagement, S-1 filing signals, insider selling patterns.',
                  metrics:[{l:'Pipeline',v:'6 cos',c:T.accent},{l:'Next 12mo',v:'3 likely',c:T.green},{l:'Accuracy',v:'82%',c:T.blue}],
                  signals:['Anduril: 80% prob → S-1 imminent, confirmed by multiple sources','Stripe: 75% → confidential filing per Bloomberg','SpaceX: 85% prob H2 2026 — Starlink tracking to event'],
                  sources:['SEC EDGAR Monitoring','Renaissance Capital IPO Tracker','Bloomberg Terminal','PitchBook Event Signals','Banker Network Intelligence'],
                  color:T.blue},
                {feed:'Revenue Trajectory Estimation',icon:'📊',status:'ACTIVE',freshness:'Updated monthly',coverage:'Multi-source fusion',
                  desc:'Estimate portfolio company revenue trajectories using web traffic, app download data, API usage signals, job posting patterns, and triangulation against GP-reported figures.',
                  metrics:[{l:'Coverage',v:'38 cos',c:T.accent},{l:'Accuracy',v:'±15%',c:T.green},{l:'Growth',v:'+42%',c:T.blue}],
                  signals:['Anthropic Claude API: usage up 340% YoY — revenue acceleration confirmed','Palantir AIP: enterprise pipeline 2.4x Q3 → Q4','Databricks: $2.4B ARR estimate — IPO ready threshold'],
                  sources:['SimilarWeb Traffic','App Annie Downloads','GitHub API Calls','Glassdoor Reviews → Revenue Proxy','Customer Survey Triangulation'],
                  color:T.purple},
                {feed:'Government Procurement Tracking',icon:'🏛️',status:'LIVE',freshness:'Updated 6h ago',coverage:'SAM.gov + FPDS',
                  desc:'Monitor federal procurement databases for portfolio company contract wins, solicitations, and competitive intelligence. Critical for defense tech holdings (Anduril, Palantir, Shield AI).',
                  metrics:[{l:'Tracked',v:'842 awards',c:T.accent},{l:'Portfolio',v:'$2.8B',c:T.green},{l:'Pipeline',v:'$12B',c:T.blue}],
                  signals:['Palantir: $458M Army TITAN contract — already in NAV model','Anduril: RCCTO solicitation finalist — $1.2B potential','Shield AI (via FF VII): V-BAT 128 production order — scaling'],
                  sources:['SAM.gov','FPDS-NG','USASpending.gov','GovWin/Deltek','Congressional Records','DoD Budget Docs'],
                  color:T.red},
              ].map((f,i)=>(
                <div key={i} style={{background:T.bgAccent,borderRadius:8,padding:12,border:`1px solid ${T.border}`,borderTop:`3px solid ${f.color}`,cursor:'pointer',transition:'all .12s'}}
                  onMouseEnter={e=>{e.currentTarget.style.borderColor=f.color+'40';e.currentTarget.style.transform='translateY(-1px)';}}
                  onMouseLeave={e=>{e.currentTarget.style.borderColor=T.border;e.currentTarget.style.transform='none';}}
                  onClick={()=>setDrillDown({
                    title:f.feed, subtitle:`${f.coverage} · ${f.freshness}`,
                    badges:[{l:f.status,c:f.status==='LIVE'?T.green:T.amber},{l:f.coverage,c:T.blue}],
                    kpis:f.metrics.map(m=>({l:m.l,v:m.v,c:m.c})),
                    sections:[
                      {title:'Live Signals',type:'bars',items:f.signals.map((s,si)=>({l:s,v:'',pct:90-si*15,c:s.includes('concern')||s.includes('risk')?T.red:T.green}))},
                      {title:'Data Sources',type:'bars',items:f.sources.map((s,si)=>({l:s,v:'',pct:100,c:f.color}))},
                      {title:'Navigate',type:'actions',items:[
                        {icon:'📊',label:'View in NAV Model',view:'navmark',desc:'See how this feed impacts NAV marks'},
                        {icon:'🎲',label:'Run Monte Carlo',view:'montecarlo',desc:'Stress test with this data'},
                        {icon:'📐',label:'Rebalancing Signal',view:'sizing',desc:'Check if allocation needs adjustment'},
                      ]}
                    ]
                  })}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
                    <div style={{display:'flex',alignItems:'center',gap:6}}>
                      <span style={{fontSize:18}}>{f.icon}</span>
                      <span style={{fontSize:12,fontWeight:700,color:T.text}}>{f.feed}</span>
                    </div>
                    <div style={{display:'flex',gap:4}}>
                      <Badge color={f.status==='LIVE'?T.green:T.amber}>{f.status}</Badge>
                      <span style={{width:6,height:6,borderRadius:3,background:f.status==='LIVE'?T.green:T.amber,marginTop:4,animation:f.status==='LIVE'?'pulse 2s infinite':'none'}}/>
                    </div>
                  </div>
                  <div style={{fontSize:9,color:T.textMuted,lineHeight:1.4,marginBottom:8}}>{f.desc}</div>
                  {/* Metrics row */}
                  <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:4,marginBottom:8}}>
                    {f.metrics.map((m,mi)=>(
                      <div key={mi} style={{padding:'4px 6px',background:T.bg,borderRadius:4,textAlign:'center'}}>
                        <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
                        <div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div>
                      </div>
                    ))}
                  </div>
                  {/* Latest signals */}
                  <div style={{borderTop:`1px solid ${T.border}`,paddingTop:6}}>
                    <div style={{fontSize:7,fontWeight:700,color:f.color,textTransform:'uppercase',letterSpacing:0.5,marginBottom:3}}>LATEST SIGNALS</div>
                    {f.signals.map((s,si)=>(
                      <div key={si} style={{fontSize:8,color:s.includes('concern')||s.includes('risk')||s.includes('widening')||s.includes('-15')?T.red:T.text,lineHeight:1.3,marginBottom:2,paddingLeft:6,borderLeft:`2px solid ${s.includes('concern')||s.includes('risk')?T.red:f.color}30`}}>
                        {s}
                      </div>
                    ))}
                  </div>
                  <div style={{fontSize:7,color:T.textDim,marginTop:6,textAlign:'right'}}>{f.freshness} · {f.sources.length} sources · Click for details →</div>
                </div>
              ))}
            </div>
          </div>
        </Card>

        {/* ═══ STRATEGIC OUTPUTS — 4 Intelligence Engines ═══ */}
        <Card title="⚡ Strategic Output Engines — What Intelligence Produces" style={{marginBottom:14,borderLeft:`3px solid ${T.green}`}}>
          <div style={{padding:'8px 0'}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10}}>
              {[
                {engine:'Risk-Adjusted NAV Modeling',icon:'🎯',status:'PRODUCING',frequency:'Continuous',
                  desc:'Triangulates GP marks against secondary pricing, hiring signals, and revenue estimates to produce independent NAV assessments. Flags when GP marks diverge >15% from our intelligence.',
                  output:'Current NAV: $193.7M (vs GP-reported $188.2M — we mark 2.9% higher due to Anthropic secondary signal)',
                  actions:[
                    {l:'Anthropic: Our mark $82B vs GP $75B',v:'+9.3%',c:T.green,detail:'Secondary pricing + revenue trajectory supports higher mark'},
                    {l:'Scale AI: Our mark $12.8B vs GP $14B',v:'-8.6%',c:T.red,detail:'Hiring slowdown + customer loss signals lower than GP mark'},
                    {l:'SpaceX: Our mark $385B vs GP $380B',v:'+1.3%',c:T.green,detail:'Tender offer data confirms slight premium to last round'},
                    {l:'Portfolio Alpha: +$5.5M above GP marks',v:'+2.9%',c:T.accent,detail:'Net intelligence advantage vs blind LP acceptance of GP marks'},
                  ],
                  view:'navmark',viewLabel:'Open NAV Model',color:T.accent},
                {engine:'Allocation Rebalancing Signals',icon:'⚖️',status:'SIGNAL ACTIVE',frequency:'Weekly',
                  desc:'Monitors concentration drift, factor exposure changes, and relative value shifts across the portfolio. Generates rebalancing signals when thresholds breach.',
                  output:'Current signal: OVERWEIGHT AI (67% vs 55% target) — driven by Anthropic appreciation. Consider secondary sale to reduce.',
                  actions:[
                    {l:'AI concentration: 67% vs 55% target',v:'BREACH',c:T.red,detail:'Anthropic appreciation drove 12% drift above target'},
                    {l:'Defense tech: 14% vs 15% target',v:'OK',c:T.green,detail:'Anduril + Palantir combined slightly under target'},
                    {l:'Vintage diversity: 2022-24 heavy',v:'WATCH',c:T.amber,detail:'Limited 2020-21 exposure — gap in vintage laddering'},
                    {l:'Suggested: Sell $4.2M Anthropic secondary',v:'REDUCE',c:T.blue,detail:'Reduces AI from 67% → 58% while locking in gains'},
                  ],
                  view:'sizing',viewLabel:'Open Sizing Model',color:T.blue},
                {engine:'Liquidity Stress Alerts',icon:'🚨',status:'ALL CLEAR',frequency:'Daily',
                  desc:'Models cash flow scenarios under various stress conditions. Tracks upcoming capital calls, distributions, and fund commitments against available liquidity.',
                  output:'Cash position: $28.5M. Next 12mo commitments: $42M. Stress scenario: adequate liquidity through Q2 2027 under all tested scenarios.',
                  actions:[
                    {l:'Cash position: $28.5M',v:'STRONG',c:T.green,detail:'2.1x next-quarter capital call coverage'},
                    {l:'Unfunded commitments: $42M',v:'COVERED',c:T.green,detail:'ATM program + distributions fund all obligations'},
                    {l:'Stress test: -30% portfolio value',v:'PASS',c:T.green,detail:'Survive 18mo with zero distributions under extreme stress'},
                    {l:'Worst case: simultaneous calls + no ATM',v:'TIGHT',c:T.amber,detail:'Would need credit facility in Month 14 — pre-arranged'},
                  ],
                  view:'execution',viewLabel:'Open Execution',color:T.green},
                {engine:'Concentration Optimization',icon:'🔬',status:'OPTIMIZING',frequency:'Monthly',
                  desc:'Portfolio optimization engine using Markowitz mean-variance framework adapted for illiquid venture. Incorporates correlation estimates from hiring co-signals and revenue co-movement.',
                  output:'Current Sharpe: 1.42. Optimized Sharpe: 1.68 (+18%). Primary improvement: reduce Anthropic by $8M, add 2 defense positions.',
                  actions:[
                    {l:'Current HHI: 1,842 (moderate)',v:'1,842',c:T.amber,detail:'Anthropic + SpaceX drive 43% of concentration'},
                    {l:'Optimal HHI: 1,420 (-23%)',v:'1,420',c:T.green,detail:'Achievable via secondary sales + new commitments'},
                    {l:'Efficient frontier gap: 18% Sharpe',v:'+18%',c:T.accent,detail:'Same return, lower risk through better diversification'},
                    {l:'Top suggestion: reduce single-name to <20%',v:'ACTION',c:T.blue,detail:'Anthropic at 24.9% — sell secondary to reach 18-19%'},
                  ],
                  view:'concentration',viewLabel:'Open Concentration',color:T.purple},
              ].map((eng,i)=>(
                <div key={i} style={{background:T.bgAccent,borderRadius:8,padding:12,border:`1px solid ${T.border}`,borderTop:`3px solid ${eng.color}`,display:'flex',flexDirection:'column'}}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
                    <div style={{display:'flex',alignItems:'center',gap:4}}>
                      <span style={{fontSize:16}}>{eng.icon}</span>
                      <span style={{fontSize:11,fontWeight:700,color:T.text}}>{eng.engine}</span>
                    </div>
                    <Badge color={eng.status==='PRODUCING'?T.green:eng.status==='SIGNAL ACTIVE'?T.amber:eng.status==='ALL CLEAR'?T.green:T.blue}>{eng.status}</Badge>
                  </div>
                  <div style={{fontSize:9,color:T.textMuted,lineHeight:1.4,marginBottom:6}}>{eng.desc}</div>
                  <div style={{padding:'6px 8px',background:`${eng.color}08`,border:`1px solid ${eng.color}20`,borderRadius:4,marginBottom:8}}>
                    <div style={{fontSize:9,fontWeight:600,color:eng.color,lineHeight:1.4}}>{eng.output}</div>
                  </div>
                  <div style={{flex:1}}>
                    {eng.actions.map((a,ai)=>(
                      <div key={ai} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'4px 0',borderBottom:ai<3?`1px solid ${T.border}40`:'none'}}>
                        <span style={{fontSize:8,color:T.text,flex:1}}>{a.l}</span>
                        <Badge color={a.c}>{a.v}</Badge>
                      </div>
                    ))}
                  </div>
                  <button onClick={()=>{setAView(eng.view);addToast(`Opened ${eng.viewLabel.replace('Open ','')}`)}} style={{marginTop:8,padding:'6px 10px',background:T.bgCard,border:`1px solid ${eng.color}40`,borderRadius:5,cursor:'pointer',fontFamily:sans,fontSize:9,fontWeight:600,color:eng.color,transition:'all .12s',textAlign:'center'}} onMouseEnter={e=>{e.currentTarget.style.background=`${eng.color}10`;}} onMouseLeave={e=>{e.currentTarget.style.background=T.bgCard;}}>
                    {eng.viewLabel} →
                  </button>
                </div>
              ))}
            </div>
          </div>
        </Card>

        {/* ═══ INTELLIGENCE FLOW — How Data Becomes Alpha ═══ */}
        <Card title="🔄 Intelligence Flow — How 6 Inputs Become 4 Outputs" style={{marginBottom:14}}>
          <div style={{padding:'14px 18px'}}>
            <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:14}}>
              {/* Data Inputs Column */}
              <div style={{flex:1}}>
                <div style={{fontSize:9,fontWeight:700,color:T.accent,textTransform:'uppercase',letterSpacing:0.5,marginBottom:6,textAlign:'center'}}>DATA INPUTS</div>
                {[
                  {l:'Secondary Pricing',c:T.accent,icon:'💰'},
                  {l:'Hiring Velocity',c:T.green,icon:'👥'},
                  {l:'Burn Multiple',c:T.amber,icon:'🔥'},
                  {l:'IPO Probability',c:T.blue,icon:'📈'},
                  {l:'Revenue Trajectory',c:T.purple,icon:'📊'},
                  {l:'Govt Procurement',c:T.red,icon:'🏛️'},
                ].map((d,i)=>(
                  <div key={i} style={{display:'flex',alignItems:'center',gap:6,padding:'4px 8px',marginBottom:3,background:T.bgAccent,borderRadius:4,borderLeft:`3px solid ${d.c}`}}>
                    <span style={{fontSize:11}}>{d.icon}</span>
                    <span style={{fontSize:9,fontWeight:600,color:T.text}}>{d.l}</span>
                    <div style={{marginLeft:'auto',width:6,height:6,borderRadius:3,background:T.green,animation:'pulse 2s infinite'}}/>
                  </div>
                ))}
              </div>
              {/* Processing Engine */}
              <div style={{width:140,textAlign:'center',padding:12,background:`linear-gradient(135deg, ${T.accent}08, ${T.purple}06)`,borderRadius:10,border:`1px solid ${T.accent}20`}}>
                <div style={{fontSize:24,marginBottom:4}}>🧠</div>
                <div style={{fontSize:10,fontWeight:800,color:T.accent}}>OMNISCIENT</div>
                <div style={{fontSize:8,color:T.textDim,marginTop:2}}>ML Pipeline</div>
                <div style={{fontSize:8,color:T.textDim}}>Entity Graph</div>
                <div style={{fontSize:8,color:T.textDim}}>Signal Fusion</div>
                <div style={{fontSize:8,color:T.textDim}}>Bayesian Inference</div>
                <div style={{marginTop:6,display:'flex',justifyContent:'center',gap:4}}>
                  {['→','→','→'].map((_,i)=><span key={i} style={{fontSize:10,color:T.accent,animation:`pulse ${1.5+i*0.3}s infinite`}}>→</span>)}
                </div>
              </div>
              {/* Strategic Outputs Column */}
              <div style={{flex:1}}>
                <div style={{fontSize:9,fontWeight:700,color:T.green,textTransform:'uppercase',letterSpacing:0.5,marginBottom:6,textAlign:'center'}}>STRATEGIC OUTPUTS</div>
                {[
                  {l:'Risk-Adjusted NAV',c:T.accent,icon:'🎯',v:'+2.9% vs GP'},
                  {l:'Rebalancing Signals',c:T.blue,icon:'⚖️',v:'AI overweight'},
                  {l:'Liquidity Alerts',c:T.green,icon:'🚨',v:'All clear'},
                  {l:'Concentration Opt.',c:T.purple,icon:'🔬',v:'+18% Sharpe'},
                ].map((o,i)=>(
                  <div key={i} style={{display:'flex',alignItems:'center',gap:6,padding:'5px 8px',marginBottom:3,background:T.bgAccent,borderRadius:4,borderRight:`3px solid ${o.c}`}}>
                    <span style={{fontSize:11}}>{o.icon}</span>
                    <span style={{fontSize:9,fontWeight:600,color:T.text}}>{o.l}</span>
                    <span style={{marginLeft:'auto',fontSize:8,fontFamily:mono,fontWeight:700,color:o.c}}>{o.v}</span>
                  </div>
                ))}
              </div>
            </div>
            {/* Competitive advantage summary */}
            <div style={{padding:'10px 14px',background:T.accentBg,borderRadius:6,border:`1px solid ${T.accent}30`,textAlign:'center'}}>
              <div style={{fontSize:11,fontWeight:800,color:T.accent,marginBottom:2}}>INTELLIGENCE ADVANTAGE = ALPHA</div>
              <div style={{fontSize:10,color:T.text,lineHeight:1.5}}>
                Traditional LPs see quarterly GP letters (3-month lag). We see <strong style={{color:T.green}}>real-time signals</strong> across 6 data dimensions.
                Our independent NAV model is <strong style={{color:T.accent}}>+2.9% above GP marks</strong> because we triangulate secondary pricing + hiring velocity + revenue inference.
                This is not passive capital. This is <strong style={{color:T.accent}}>institutional intelligence infrastructure</strong> generating compounding informational alpha.
              </div>
            </div>
          </div>
        </Card>

        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Value Generated" value="$22.3K" icon={Zap} sub="per month (9 agents)" color={T.accent}/>
          <Stat label="Hours Saved" value="680+" icon={Clock} sub="per year ($102K value)" color={T.green}/>
          <Stat label="Agent Uptime" value="24/7" icon={Activity} sub="always-on monitoring" color={T.blue}/>
          <Stat label="Network Nodes" value="50K+" icon={Share2} sub="enriched entities" color={T.purple}/>
          <Stat label="24mo ROI" value="+67%" icon={TrendingUp} sub="$166K net return" color={T.accent}/>
        </div>

        <div style={{background:`linear-gradient(135deg, ${T.accent}12, ${T.purple}08)`,borderRadius:8,padding:'10px 16px',marginBottom:14,border:`1px solid ${T.accent}30`}}>
          <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:4}}>PROJECT OMNISCIENT — AI-ASSISTED INVESTING SYSTEM</div>
          <div style={{fontSize:11,color:T.text,lineHeight:1.5}}>
            Turning 4 years of deal flow into institutional intelligence. Based on UC Berkeley research showing external factors account for 80% of startup success—and your network is the most important external factor you can control. The system deploys local Mac Studio M4 Max with tiered data sovereignty: Tier 1 (Local Only) for raw emails/deal terms/LP comms; Tier 2 (Anonymized) for embeddings/semantic queries; Tier 3 (Public) for news/market data. PostgreSQL for structured data, Vector DB for semantic search, Neo4j for relationship graph—unified via RedwoodJS GraphQL.
          </div>
        </div>

        {/* 9 Value Generators */}
        <Card title="Value Generators — 9 AI Capabilities with Measured ROI" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:8}}>
            {[
              {name:'Auto-Research',desc:'AI screens startups in seconds vs 2hr manual',val:650,uses:10,timeSave:'10-15 hrs/wk',vc:'Frank Thelen (Freigeist)',vcDetail:'537x faster than human analysts. AI-selected startups show higher survival rates.',phase:'Month 2-5',status:'deploying',c:T.accent,icon:'🔬'},
              {name:'Memo Drafting',desc:'Upload deck + notes → structured IC memo in minutes',val:560,uses:8,timeSave:'3.5 hrs/memo',vc:'Chip Hazard (Flybridge)',vcDetail:'Open-sourced AI memo generator creates first draft in 3 minutes.',phase:'Month 3-6',status:'building',c:T.green,icon:'📝'},
              {name:'Warm Intros',desc:'Ranked intro paths with relationship strength scores',val:1600,uses:5,timeSave:'1-2 hrs/wk',vc:'Ajay Agarwal (Bain Capital)',vcDetail:'Affinity maps collective relationships and highlights strongest paths.',phase:'Month 5-9',status:'planned',c:T.blue,icon:'🤝'},
              {name:'Risk Catching',desc:'AI flags deal-killers, implausible projections, red flags',val:4000,uses:3,timeSave:'3-5 risks/mo',vc:'Jason Lemkin (SaaStr)',vcDetail:'Trained on 4,000+ funding rounds. "95% of decks are unfundable" due to fixable issues.',phase:'Month 6-9',status:'planned',c:T.red,icon:'🚨'},
              {name:'Next Steps AI',desc:'Meeting → action items + follow-up emails in seconds',val:125,uses:20,timeSave:'5-10 min/day',vc:'Adriana Vitagliano (FirstMinute)',vcDetail:'"The addiction is real—can\'t imagine life without it."',phase:'Month 4-6',status:'building',c:T.purple,icon:'✅'},
              {name:'News Dashboard',desc:'Real-time signals: funding, hires, exits, sentiment',val:115,uses:30,timeSave:'2-3 hrs/day',vc:'Chris Farmer (SignalFire)',vcDetail:'Beacon tracks millions of real-time growth signals across 600M people.',phase:'Month 6-10',status:'planned',c:T.amber,icon:'📡'},
              {name:'Meeting Prep',desc:'Auto-briefing with themes, updates, tailored questions',val:250,uses:12,timeSave:'2-3 hrs/day',vc:'Brett Caughran (Fundamental Edge)',vcDetail:'"12-page guide in ~10 minutes. Transformational for broad coverage."',phase:'Month 4-7',status:'building',c:T.green,icon:'📋'},
              {name:'Score Cards',desc:'Auto-score deals against thesis: team, market, traction',val:365,uses:15,timeSave:'2-3 hrs/day',vc:'Ben Smith (InReach Ventures)',vcDetail:'AI scores thousands of companies weekly—surfaces hidden gems humans miss.',phase:'Month 5-9',status:'planned',c:T.blue,icon:'🎯'},
              {name:'AI-Ready Data',desc:'Semantic layer: SQL + Vector = queryable firm brain',val:7500,uses:1,timeSave:'Enables all agents',vc:'Mike Arpaia (Moonfire)',vcDetail:'"We are a technology company specializing in venture." Data Lakehouse architecture.',phase:'Month 1-3',status:'active',c:T.accent,icon:'🧠'},
            ].map((v,i)=>{const monthlyVal=v.val*v.uses;return(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:10,borderTop:`3px solid ${v.c}`,border:`1px solid ${T.border}`}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:4}}>
                <div style={{display:'flex',alignItems:'center',gap:4}}><span style={{fontSize:16}}>{v.icon}</span><span style={{fontSize:11,fontWeight:800,color:T.text}}>{v.name}</span></div>
                <Badge color={v.status==='active'?T.green:v.status==='deploying'?T.accent:v.status==='building'?T.amber:T.blue}>{v.status.toUpperCase()}</Badge>
              </div>
              <div style={{fontSize:9,color:T.textMuted,marginBottom:4,lineHeight:1.3}}>{v.desc}</div>
              <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:4,marginBottom:4}}>
                <div style={{textAlign:'center',padding:'3px 0',background:T.bg,borderRadius:3}}><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:v.c}}>${v.val.toLocaleString()}</div><div style={{fontSize:7,color:T.textDim}}>per use</div></div>
                <div style={{textAlign:'center',padding:'3px 0',background:T.bg,borderRadius:3}}><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:T.green}}>{v.uses}</div><div style={{fontSize:7,color:T.textDim}}>uses/mo</div></div>
                <div style={{textAlign:'center',padding:'3px 0',background:T.bg,borderRadius:3}}><div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:T.accent}}>${(monthlyVal/1000).toFixed(1)}K</div><div style={{fontSize:7,color:T.textDim}}>mo value</div></div>
              </div>
              <div style={{fontSize:8,color:T.textMuted,marginBottom:2}}><strong style={{color:v.c}}>Time Saved:</strong> {v.timeSave} | <strong>Phase:</strong> {v.phase}</div>
              <div style={{padding:'4px 6px',background:`${v.c}08`,borderRadius:3,border:`1px solid ${v.c}20`}}>
                <div style={{fontSize:8,fontWeight:700,color:v.c}}>{v.vc}</div>
                <div style={{fontSize:8,color:T.textMuted,fontStyle:'italic',lineHeight:1.2}}>{v.vcDetail}</div>
              </div>
            </div>);})}
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8,marginTop:10,padding:'8px 12px',background:T.accentBg,borderRadius:6}}>
            <div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>Total Monthly Value</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.accent}}>$22,325</div></div>
            <div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>Annual Value</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.green}}>$267,900</div></div>
            <div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>Total Build Cost</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.amber}}>$184,000</div></div>
            <div style={{textAlign:'center'}}><div style={{fontSize:8,color:T.textDim}}>Breakeven</div><div style={{fontSize:18,fontWeight:800,fontFamily:mono,color:T.purple}}>Month 16</div></div>
          </div>
        </div></Card>

        {/* D3 Sunburst — Agent System Hierarchy + Chord Interconnections */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:12}}>
          <Card title="Agent System Hierarchy — D3 Sunburst"><div style={{padding:'12px',display:'flex',justifyContent:'center'}}>
            <D3Sunburst width={340} height={340} data={{
              name:'NEWCO AI',
              children:[
                {name:'Investment Engine',children:[
                  {name:'Auto-Research',value:6500},{name:'Score Cards',value:5475},{name:'Risk Catching',value:12000},
                  {name:'Memo Drafting',value:4480},{name:'IC Decision',value:3000}
                ]},
                {name:'Institutional Ops',children:[
                  {name:'Pacing Model',value:2000},{name:'Capital Calls',value:1500},{name:'Compliance',value:1800},
                  {name:'Reporting',value:2200},{name:'Audit Trail',value:1200}
                ]},
                {name:'Distribution',children:[
                  {name:'Meeting Prep',value:3000},{name:'Next Steps AI',value:2500},{name:'Warm Intros',value:8000},
                  {name:'LP Analytics',value:2800},{name:'CRM Sync',value:1600}
                ]},
                {name:'Omniscient AI',children:[
                  {name:'AI-Ready Data',value:7500},{name:'News Dashboard',value:3450},
                  {name:'Entity Graph',value:4000},{name:'Signal Engine',value:5200}
                ]}
              ]
            }} />
          </div></Card>
          <Card title="Agent Interconnections — D3 Chord Diagram"><div style={{padding:'12px',display:'flex',justifyContent:'center'}}>
            <D3Chord width={340} height={340}
              labels={['Research','Scoring','Risk','Memos','Intros','News','Data','Prep','Next Steps']}
              colors={[T.accent,T.blue,T.red,T.green,T.blue,T.amber,T.accent,T.green,T.purple]}
              matrix={[
                [0,8,6,9,2,4,10,3,1],
                [8,0,7,5,3,3,9,2,1],
                [6,7,0,4,1,5,8,2,0],
                [9,5,4,0,2,2,7,4,3],
                [2,3,1,2,0,2,6,8,5],
                [4,3,5,2,2,0,9,3,1],
                [10,9,8,7,6,9,0,5,3],
                [3,2,2,4,8,3,5,0,7],
                [1,1,0,3,5,1,3,7,0],
              ]}
            />
          </div></Card>
        </div>

        {/* Value Generator Waterfall + ROI Velocity */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 280px',gap:12,marginBottom:12,marginTop:12}}>
          <HorizontalWaterfall
            title="Monthly Value by Generator — Where ROI Comes From"
            width={440} showCumulative
            items={[
              {label:'AI-Ready Data',value:7500,icon:'🧠',color:T.accent},
              {label:'Risk Catching',value:12000,icon:'🚨',color:T.red},
              {label:'Warm Intros',value:8000,icon:'🤝',color:T.blue},
              {label:'Auto-Research',value:6500,icon:'🔬',color:T.accent},
              {label:'Score Cards',value:5475,icon:'🎯',color:T.blue},
              {label:'Memo Drafting',value:4480,icon:'📝',color:T.green},
              {label:'News Dashboard',value:3450,icon:'📡',color:T.amber},
              {label:'Meeting Prep',value:3000,icon:'📋',color:T.green},
              {label:'Next Steps AI',value:2500,icon:'✅',color:T.purple},
            ]}
          />
          <div style={{display:'flex',flexDirection:'column',gap:8}}>
            <VelocityBand data={[0,0,2,5,8,12,16,18,20,21,22,22.3]} width={260} height={50} color={T.accent} label="Monthly Value ($K)" thresholds={[{from:0,to:10,c:T.amber},{from:10,to:25,c:T.green}]}/>
            <VelocityBand data={[184,172,160,148,132,115,98,78,56,32,8,-12]} width={260} height={50} color={T.green} label="Cost Recovery ($K remaining)"/>
            <VelocityBand data={[0,40,110,180,260,380,480,580,650,700,740,780]} width={260} height={50} color={T.blue} label="Cumulative Hours Saved"/>
            <VelocityBand data={[1,2,3,5,7,9,11,14,18,24,32,42]} width={260} height={50} color={T.purple} label="Deals Auto-Researched/Mo"/>
            <Card><div style={{padding:'8px 12px'}}>
              <div style={{fontSize:8,color:T.textDim,fontWeight:700,textTransform:'uppercase',marginBottom:4}}>Build Progress</div>
              <BulletGauge label="Phase 1" actual={85} target={100} max={100} color={T.green} width={180}/>
              <BulletGauge label="Phase 2" actual={35} target={100} max={100} color={T.blue} width={180}/>
              <BulletGauge label="Phase 3" actual={0} target={100} max={100} color={T.purple} width={180}/>
              <BulletGauge label="Overall" actual={42} target={100} max={100} color={T.accent} width={180}/>
            </div></Card>
          </div>
        </div>

        {/* ROI Breakeven Projection Chart */}
        <Card title="24-Month ROI Projection — Breakeven at Month 16" style={{marginBottom:12}}>
          <div style={{padding:'8px 16px'}}>
            {(()=>{
              const months = Array.from({length:25},(_, i)=>i);
              const buildCost = [0,-25,-45,-65,-75,-91,-105,-120,-140,-160,-175,-184,-184,-184,-184,-184,-184,-184,-184,-184,-184,-184,-184,-184,-184];
              const cumValue = months.map(m=>m*22.325*Math.min(m/6,1));
              const netROI = months.map((m,i)=>cumValue[i]+buildCost[i]);
              const w=680,h=180,pad={t:16,r:20,b:28,l:50};
              const cw=w-pad.l-pad.r, ch=h-pad.t-pad.b;
              const minY=Math.min(...netROI,...buildCost), maxY=Math.max(...cumValue);
              const xS=i=>pad.l+(i/24)*cw, yS=v=>pad.t+ch-((v-minY)/(maxY-minY))*ch;
              const mkPath=(arr)=>arr.map((v,i)=>`${i===0?'M':'L'}${xS(i)},${yS(v)}`).join(' ');
              const breakEven = netROI.findIndex(v=>v>=0);
              return(
                <svg width={w} height={h} style={{display:'block'}}>
                  {/* Zero line */}
                  <line x1={pad.l} y1={yS(0)} x2={w-pad.r} y2={yS(0)} stroke={T.textDim} strokeWidth={1} strokeDasharray="3,3"/>
                  <text x={pad.l-4} y={yS(0)+3} fill={T.textDim} fontSize={8} textAnchor="end" fontFamily={mono}>$0</text>
                  {/* Negative zone */}
                  <rect x={pad.l} y={yS(0)} width={cw} height={yS(minY)-yS(0)} fill={`${T.red}06`} rx={2}/>
                  {/* Positive zone */}
                  <rect x={pad.l} y={pad.t} width={cw} height={yS(0)-pad.t} fill={`${T.green}04`} rx={2}/>
                  {/* Build cost line */}
                  <path d={mkPath(buildCost)} fill="none" stroke={T.red} strokeWidth={1.5} strokeDasharray="4,3" opacity={0.7}/>
                  {/* Cumulative value line */}
                  <path d={mkPath(cumValue)} fill="none" stroke={T.green} strokeWidth={2}/>
                  {/* Net ROI line (bold) */}
                  <path d={mkPath(netROI)} fill="none" stroke={T.accent} strokeWidth={2.5}/>
                  {/* Area fill for net ROI when positive */}
                  {netROI.map((v,i)=>{if(i===0||v<0)return null;return <rect key={i} x={xS(i)-cw/48} y={yS(v)} width={cw/24} height={yS(0)-yS(v)} fill={`${T.accent}12`}/>;}).filter(Boolean)}
                  {/* Breakeven marker */}
                  {breakEven>0&&<g>
                    <line x1={xS(breakEven)} y1={pad.t} x2={xS(breakEven)} y2={h-pad.b} stroke={T.accent} strokeWidth={1.5} strokeDasharray="4,2"/>
                    <circle cx={xS(breakEven)} cy={yS(0)} r={5} fill={T.accent}/>
                    <rect x={xS(breakEven)-28} y={pad.t-2} width={56} height={16} rx={4} fill={T.accent}/>
                    <text x={xS(breakEven)} y={pad.t+10} fill={T.bg} fontSize={8} fontWeight={800} textAnchor="middle">MONTH {breakEven}</text>
                  </g>}
                  {/* End values */}
                  <circle cx={xS(24)} cy={yS(cumValue[24])} r={3} fill={T.green}/>
                  <text x={xS(24)+4} y={yS(cumValue[24])+3} fill={T.green} fontSize={9} fontWeight={700} fontFamily={mono}>+${(cumValue[24]/1000).toFixed(0)}K</text>
                  <circle cx={xS(24)} cy={yS(netROI[24])} r={4} fill={T.accent}/>
                  <text x={xS(24)+4} y={yS(netROI[24])+3} fill={T.accent} fontSize={10} fontWeight={800} fontFamily={mono}>+${(netROI[24]/1000).toFixed(0)}K</text>
                  {/* X axis labels */}
                  {[0,6,12,16,18,24].map(m=><text key={m} x={xS(m)} y={h-8} fill={T.textDim} fontSize={8} fontFamily={mono} textAnchor="middle">M{m}</text>)}
                  {/* Legend */}
                  <g transform={`translate(${pad.l+10},${pad.t+4})`}>
                    <line x1={0} y1={0} x2={16} y2={0} stroke={T.accent} strokeWidth={2.5}/><text x={20} y={3} fill={T.text} fontSize={8} fontWeight={600}>Net ROI</text>
                    <line x1={70} y1={0} x2={86} y2={0} stroke={T.green} strokeWidth={2}/><text x={90} y={3} fill={T.green} fontSize={8}>Cumulative Value</text>
                    <line x1={170} y1={0} x2={186} y2={0} stroke={T.red} strokeWidth={1.5} strokeDasharray="4,3"/><text x={190} y={3} fill={T.red} fontSize={8}>Build Cost</text>
                  </g>
                </svg>
              );
            })()}
          </div>
        </Card>

        {/* Academic Foundations */}
        <Section title="Academic Foundations — 6 Peer-Reviewed Frameworks" color={T.blue} defaultOpen={false} count={6}>
        <Card style={{marginBottom:0,border:'none',borderRadius:0}}><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:8}}>
            {[
              {theory:'Strength of Weak Ties',author:'Granovetter (1973)',insight:'Weak ties (acquaintances) bridge disconnected clusters—more valuable for novel info than strong ties.',app:'System identifies dormant relationships across 4,205 contacts that bridge clusters. Reactivation campaigns yield 2-3 deals/year.',c:T.accent},
              {theory:'Structural Holes Theory',author:'Ronald Burt (1992)',insight:'Value comes from brokering between disconnected networks. Brokers gain information and control advantages.',app:'Maps where Evil Twin bridges clusters: Apple C-Suite ↔ Startups, Insurance ↔ Insurtech, Fortune 500 CEOs ↔ Portfolio Cos, Berkeley ↔ GovTech.',c:T.green},
              {theory:'16 Types of Network Effects',author:'James Currier / NFX (2018)',insight:'Network effects account for 70% of value created in technology since 1994.',app:'Building Data Network Effect (each data point makes all data more valuable) + Market Network Effect (relationships + transactions + workflow).',c:T.blue},
              {theory:'Measuring Network Effects',author:'Li Jin & D\'Arcy Coolican / a16z (2019)',insight:'Network effects measured across Acquisition, Engagement, Economics, Competitor metrics.',app:'Network scores 7.7/10 on a16z framework. Exceptional Power User Curves (14 Fortune 500 CEO golf contacts) and Match Rate.',c:T.purple},
              {theory:'Ecosystem VC & Preferential Attachment',author:'David Booth / a16z (2020s)',insight:'VCs with platform businesses and network effects outperform portfolio-only models.',app:'System enables transition from portfolio management to ecosystem orchestration—tracking talent circulation and alumni loops.',c:T.accent},
              {theory:'The Cold Start Problem',author:'Andrew Chen / a16z (2021)',insight:'Networks need to pass a tipping point (Allee Threshold) before effects kick in.',app:'Already past tipping point: 4,205 connections, 615 founders, 91 VCs. System CAPTURES and ACTIVATES existing network.',c:T.green},
            ].map((f,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,borderLeft:`3px solid ${f.c}`}}>
              <div style={{fontSize:10,fontWeight:700,color:f.c}}>{f.theory}</div>
              <div style={{fontSize:8,color:T.textDim,marginBottom:2}}>{f.author}</div>
              <div style={{fontSize:9,color:T.text,lineHeight:1.3,marginBottom:3}}>{f.insight}</div>
              <div style={{fontSize:8,color:T.textMuted,lineHeight:1.3,padding:'3px 5px',background:T.bg,borderRadius:3}}><strong style={{color:f.c}}>Omniscient:</strong> {f.app}</div>
            </div>))}
          </div>
        </div></Card>
        </Section>

        {/* Signal Detection + Projected Impact */}
        <Section title="Signal Detection Engine & Projected Fund Impact" color={T.green} defaultOpen={false} count={4}>
        <Card style={{marginBottom:0,border:'none',borderRadius:0}}><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.accent,marginBottom:6}}>SIGNAL DETECTION ENGINE</div>
              {[
                {signal:'University Intelligence',strength:'2.5x',desc:'Cross-disciplinary research collaborations, major grant patterns, tech transfer activity, faculty leaving for industry',c:T.accent},
                {signal:'Pre-Company Detection',strength:'2.9x',desc:'Technical leadership on GitHub/ArXiv/Twitter, talent flow patterns, domain registrations, stealth job postings',c:T.green},
                {signal:'Market Pattern Recognition',strength:'2.4x',desc:'Regulatory catalysts, industry consolidation, infrastructure maturation enabling new categories',c:T.blue},
                {signal:'Relationship Intelligence',strength:'2.5x',desc:'Relationship velocity changes, GP network position changes, co-investor clustering, founder-to-founder referrals',c:T.purple},
              ].map((s,i)=>(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'5px 0',borderBottom:`1px solid ${T.border}`}}>
                <div style={{minWidth:36,textAlign:'center'}}><span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:s.c}}>{s.strength}</span></div>
                <div><div style={{fontSize:10,fontWeight:700,color:T.text}}>{s.signal}</div><div style={{fontSize:8,color:T.textMuted,lineHeight:1.3}}>{s.desc}</div></div>
              </div>))}
              <div style={{marginTop:8,fontSize:10,fontWeight:800,color:T.green,marginBottom:4}}>STRUCTURAL HOLES (BURT)</div>
              {['Apple C-Suite (5 execs) ↔ Early-stage Startups → distribution partnerships','Insurance Industry (184 contacts) ↔ Insurtech Founders → deepest insurtech network at seed','Fortune 500 CEOs (14) ↔ Portfolio Companies → customer intros at CEO level','UC Berkeley Ecosystem ↔ Policy/GovTech → GSPP Board, Haas Board, SkyDeck','Top-tier VCs (91+) ↔ Syndicate Access → a16z (6), 8VC (3), Ribbit (3)'].map((h,i)=>(
                <div key={i} style={{fontSize:8,color:T.text,padding:'2px 0 2px 6px',borderLeft:`2px solid ${T.green}40`,marginBottom:2,lineHeight:1.2}}>{h}</div>
              ))}
            </div>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:T.green,marginBottom:6}}>PROJECTED FUND PERFORMANCE IMPACT</div>
              <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
                <TH>Metric</TH><TH align="center">Industry Median</TH><TH align="center">With Omniscient</TH><TH align="center">Delta</TH>
              </tr></thead><tbody>
                {[
                  {m:'Deals Evaluated/Year',med:'150-200',omni:'400-500',d:'+150%',c:T.accent},
                  {m:'Eval → IC Conversion',med:'12-15%',omni:'18-22%',d:'+50%',c:T.green},
                  {m:'IC → Investment Conv.',med:'20-25%',omni:'28-32%',d:'+35%',c:T.blue},
                  {m:'Loss Ratio (<1x)',med:'35-45%',omni:'25-32%',d:'-28%',c:T.green},
                  {m:'Hit Rate (>3x)',med:'18-22%',omni:'26-32%',d:'+45%',c:T.accent},
                  {m:'Fund MOIC (Net)',med:'2.0-2.5x',omni:'2.8-3.5x',d:'+40%',c:T.accent},
                  {m:'Fund IRR (Net)',med:'15-20%',omni:'22-28%',d:'+40%',c:T.green},
                ].map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
                  <TD style={{fontSize:10,fontWeight:600}}>{r.m}</TD>
                  <TD align="center" mono style={{color:T.textMuted}}>{r.med}</TD>
                  <TD align="center" mono bold color={r.c}>{r.omni}</TD>
                  <TD align="center" mono bold color={r.c}>{r.d}</TD>
                </tr>))}
              </tbody></table>
              <div style={{padding:'6px 8px',background:T.accentBg,borderRadius:4,marginTop:6}}>
                <div style={{fontSize:9,fontWeight:700,color:T.accent}}>$100M FUND IMPACT</div>
                <div style={{fontSize:10,color:T.text,lineHeight:1.4}}>Improving hit rate by 8% and reducing loss ratio by 10% generates approximately <strong style={{color:T.accent}}>$40-60M in additional value</strong> over the fund lifecycle. One avoided bad investment ($500K) = 2x platform cost. One warm intro to a breakout deal = 50x+ platform cost.</div>
              </div>
            </div>
          </div>
        </div></Card>
        </Section>
      </div>)}

      {/* ═══ TAB 24: AGENT ORCHESTRA — The Virtual Analyst Team ═══ */}
      {/* "A junior analyst costs $150-200K/year. The Omniscient agent orchestra provides equivalent */}
      {/* capabilities at a fraction of the cost—and operates continuously without vacation or turnover." */}
      {aView==='agents'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Core Agents" value="4" icon={Zap} sub="always-on monitors" color={T.accent}/>
          <Stat label="Extended Agents" value="4" icon={Layers} sub="specialist capabilities" color={T.green}/>
          <Stat label="Analyst Equivalent" value="$150K" icon={DollarSign} sub="annual labor replaced" color={T.blue}/>
          <Stat label="Tasks Replaced" value="6" icon={CheckCircle} sub="fully automated" color={T.purple}/>
          <Stat label="Agent Tier" value="Coordinated" icon={Share2} sub="multi-agent orchestration" color={T.accent}/>
        </div>

        {/* Core 4 Agents */}
        <Card title="Core Agent System — 4 Always-On Agents" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:10}}>
            {[
              {name:'The Sentinel',role:'Master Monitoring Agent',emoji:'🔭',desc:'A script that never sleeps. Monitors the entire web for signals relevant to our portfolio.',freq:'Every 5 minutes',status:'active',
                capabilities:['Monitors Twitter, TechCrunch, GitHub, SEC Edgar for portfolio-relevant signals','Tracks LinkedIn changes across entire network (4,205 contacts)','Alerts on competitive moves, funding announcements, exec departures','Maintains real-time concern scores for all portfolio companies','Queues relevant signals for deeper analysis by specialist agents'],
                vcComp:'SignalFire\'s Beacon AI — tracks millions of real-time growth signals across 600M people',c:T.accent},
              {name:'The Persona Panel',role:'Multi-Perspective Analyzer',emoji:'🎭',desc:'Every new opportunity is analyzed through three lenses for balanced evaluation.',freq:'On every new signal',status:'active',
                capabilities:['The Skeptic: What could go wrong? Evaluates risk, competition, red flags','The Visionary: What\'s the upside case? Spots expansion opportunities and contrarian plays','The Operator: Can this team execute? Evaluates execution capability and team strength','Generates balanced 3-perspective report for IC review','Reduces confirmation bias — forces consideration of bear case'],
                vcComp:'Alpaca VC\'s "Gordon" — secured Autopoiesis deal via autonomous prospect generation',c:T.green},
              {name:'The Living Thesis',role:'Strategy Updater',emoji:'📖',desc:'Your investment thesis isn\'t static — it should evolve as markets change.',freq:'Continuous',status:'building',
                capabilities:['Monitors thesis documents against incoming market data','Flags when new information materially changes stance on a sector','Revises thesis documents and surfaces updates for partner review','Tracks historical thesis evolution for backtesting','Links thesis changes to specific portfolio decisions'],
                vcComp:'DVC\'s AI — writes preemptive checks before valuations spike',c:T.blue},
              {name:'The Dashboard Maintainer',role:'UI Synchronizer',emoji:'📊',desc:'Keeps the frontend alive with real-time data.',freq:'Every minute',status:'building',
                capabilities:['Queries for live opportunities (deals scoring above threshold)','Calculates market sentiment across sectors','Pushes "Cards" to React frontend — partners see current status on login','Surfaces priority actions and alerts','Maintains historical data for trend analysis'],
                vcComp:'EQT Ventures "Motherbrain" — assesses 10,000+ companies systematically',c:T.purple},
            ].map((a,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`4px solid ${a.c}`,border:`1px solid ${T.border}`}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:4}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}><span style={{fontSize:20}}>{a.emoji}</span><div><div style={{fontSize:12,fontWeight:800,color:a.c}}>{a.name}</div><div style={{fontSize:9,color:T.textMuted}}>{a.role}</div></div></div>
                <div style={{display:'flex',flexDirection:'column',alignItems:'flex-end',gap:2}}><Badge color={a.status==='active'?T.green:T.amber}>{a.status.toUpperCase()}</Badge><span style={{fontSize:8,color:T.textDim}}>{a.freq}</span></div>
              </div>
              <div style={{fontSize:10,color:T.text,marginBottom:6,lineHeight:1.3,fontStyle:'italic'}}>{a.desc}</div>
              {a.capabilities.map((cap,ci)=>(<div key={ci} style={{fontSize:9,color:T.text,padding:'2px 0 2px 8px',borderLeft:`2px solid ${a.c}40`,marginBottom:2,lineHeight:1.2}}>{cap}</div>))}
              <div style={{padding:'4px 6px',background:`${a.c}08`,borderRadius:3,marginTop:6,border:`1px solid ${a.c}20`}}>
                <span style={{fontSize:8,fontWeight:700,color:T.textDim}}>VC COMP: </span><span style={{fontSize:8,color:a.c}}>{a.vcComp}</span>
              </div>
            </div>))}
          </div>
        </div></Card>

        {/* Extended Agents */}
        <Section title="Extended Agent Capabilities — Specialist Intelligence" color={T.blue} defaultOpen={false} count={4}>
        <Card style={{marginBottom:0,border:'none',borderRadius:0}}><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
            {[
              {name:'The Oracle',emoji:'🔮',role:'Prediction & Thesis Validation',caps:['Scores deals based on historical success patterns','Predicts round timing','Validates thesis against emerging data'],status:'planned',c:T.accent},
              {name:'The Cartographer',emoji:'🗺️',role:'Market Mapping',caps:['Maintains real-time category maps','Tracks competitive positioning','Identifies market gaps and white space'],status:'planned',c:T.green},
              {name:'The Alchemist',emoji:'⚗️',role:'Innovation Synthesis',caps:['Monitors academic research for commercial apps','Synthesizes insights across portfolio learnings','Cross-pollinates discoveries between sectors'],status:'planned',c:T.blue},
              {name:'The Conductor',emoji:'🎼',role:'Master Orchestrator',caps:['Coordinates all specialist agents for complex queries','Manages IC memo generation workflow','Routes tasks to optimal agent based on context'],status:'planned',c:T.purple},
            ].map((a,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,borderTop:`3px solid ${a.c}`}}>
              <div style={{display:'flex',alignItems:'center',gap:4,marginBottom:4}}><span style={{fontSize:14}}>{a.emoji}</span><div><div style={{fontSize:10,fontWeight:700,color:a.c}}>{a.name}</div><div style={{fontSize:8,color:T.textMuted}}>{a.role}</div></div></div>
              {a.caps.map((c,ci)=>(<div key={ci} style={{fontSize:8,color:T.text,padding:'1px 0 1px 6px',borderLeft:`2px solid ${a.c}40`,marginBottom:1}}>{c}</div>))}
              <Badge color={a.c} style={{marginTop:4}}>{a.status.toUpperCase()}</Badge>
            </div>))}
          </div>
        </div></Card>
        </Section>

        {/* Analyst Task Replacement */}
        <Section title="Analyst Task Replacement — Time & Cost Savings" color={T.green} defaultOpen={false} count={6}>
        <Card style={{marginBottom:0,border:'none',borderRadius:0}}><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Task</TH><TH align="center">Manual Time</TH><TH align="center">With Omniscient</TH><TH align="center">Speedup</TH><TH align="center">Hours Saved/Yr</TH><TH align="center">$ Value/Yr</TH><TH align="center">Responsible Agent</TH>
          </tr></thead><tbody>
            {[
              {task:'Deal Research',manual:'4 hours',auto:'30 seconds',speed:'480x',hrs:175,agent:'Sentinel + Oracle',c:T.accent},
              {task:'Warm Intro Finding',manual:'2 hours',auto:'Instant (2-hop query)',speed:'∞',hrs:200,agent:'Cartographer',c:T.green},
              {task:'IC Memo Drafting',manual:'8 hours',auto:'1 hour refine',speed:'8x',hrs:105,agent:'Conductor + Persona Panel',c:T.blue},
              {task:'Portfolio Updates',manual:'30 min/co/mo',auto:'Auto-dashboard',speed:'∞',hrs:120,agent:'Dashboard Maintainer',c:T.purple},
              {task:'LP Meeting Prep',manual:'2 hrs/meeting',auto:'1-click brief',speed:'120x',hrs:30,agent:'Living Thesis',c:T.accent},
              {task:'Competitive Landscape',manual:'6 hours research',auto:'Always-current',speed:'∞',hrs:50,agent:'Sentinel + Alchemist',c:T.green},
            ].map((t,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
              <TD style={{fontWeight:700,fontSize:10}}>{t.task}</TD>
              <TD align="center" style={{fontSize:10,color:T.red}}>{t.manual}</TD>
              <TD align="center" style={{fontSize:10,color:T.green,fontWeight:700}}>{t.auto}</TD>
              <TD align="center" mono bold color={t.c}>{t.speed}</TD>
              <TD align="center" mono bold>{t.hrs}</TD>
              <TD align="center" mono bold color={T.accent}>${(t.hrs*150/1000).toFixed(1)}K</TD>
              <TD align="center" style={{fontSize:9,color:t.c}}>{t.agent}</TD>
            </tr>))}
            <tr style={{background:T.accentBg,fontWeight:700}}><TD style={{fontWeight:800,color:T.accent}}>TOTAL</TD><TD/><TD/><TD/><TD align="center" mono bold>680+</TD><TD align="center" mono bold color={T.accent}>$102K</TD><TD/></tr>
          </tbody></table>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:8,marginTop:8}}>
            {[
              {tier:'Single-Purpose Agents',hours:'60h build',cost:'$200/mo API',desc:'3-4 independent specialists. You prompt them, chain manually. AI-assisted investing.',c:T.blue},
              {tier:'Coordinated Agent Team ★ SELECTED',hours:'180h build',cost:'$700/mo API',desc:'5-7 agents collaborate via shared memory. End-to-end deal pipeline. "Alpaca Gordon" tier.',c:T.accent},
              {tier:'Autonomous Investment Analyst',hours:'350h build',cost:'$1,500/mo API',desc:'Meta-agent with long-term memory. Runs 24/7. Learns from feedback. "Topology Fiber" tier.',c:T.purple},
            ].map((t,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,borderTop:`3px solid ${t.c}`,opacity:t.tier.includes('SELECTED')?1:0.7}}>
              <div style={{fontSize:10,fontWeight:700,color:t.c}}>{t.tier}</div>
              <div style={{fontSize:9,color:T.textMuted}}>{t.hours} | {t.cost}</div>
              <div style={{fontSize:9,color:T.text,marginTop:3,lineHeight:1.3}}>{t.desc}</div>
            </div>))}
          </div>
        </div></Card>
        </Section>
      </div>)}

      {/* ═══ TAB 25: INFRASTRUCTURE BLUEPRINT — Cost Drivers & Architecture ═══ */}
      {aView==='infra'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Total Build" value="$184K" icon={DollarSign} sub="3 phases, 29 weeks" color={T.accent}/>
          <Stat label="Hardware" value="$12K" icon={Cpu} sub="Mac Studio M4 Max" color={T.green}/>
          <Stat label="Framework" value="RedwoodJS" icon={Code} sub="120h, GraphQL-first" color={T.blue}/>
          <Stat label="Monthly OpEx" value="$1K" icon={Clock} sub="production-grade stack" color={T.amber}/>
          <Stat label="Data Sovereignty" value="Tier 1" icon={Shield} sub="local-first architecture" color={T.purple}/>
        </div>

        {/* Cost Driver Configuration */}
        <Card title="Infrastructure Configuration — 10 Cost Drivers" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          <table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr>
            <TH>Cost Driver</TH><TH align="center">Phase</TH><TH align="center">Selected Option</TH><TH align="center">Build Hours</TH><TH align="center">One-Time $</TH><TH align="center">Monthly $</TH><TH>Key Insight</TH>
          </tr></thead><tbody>
            {[
              {driver:'Hardware Core',phase:'1',selected:'Mac Studio M4 Max',alt:'2x Cluster ($25K) | 4x Cluster ($50K)',hrs:0,oneTime:12000,monthly:0,insight:'64GB RAM runs 70B models locally at ~15 tok/sec. Exo Labs clustering available for 671B models (DeepSeek-V3) if needed. Zero cloud costs, complete data sovereignty.',c:T.accent},
              {driver:'Application Framework',phase:'All',selected:'RedwoodJS (GraphQL-first)',alt:'Next.js (180h) | Remix (160h)',hrs:120,oneTime:18000,monthly:0,insight:'GraphQL unifies Postgres + Neo4j + Vector DB into one API. Service pattern makes enrichment pipelines trivial. 120h vs 180h for Next.js = 33% faster.',c:T.green},
              {driver:'Ingestion Sources',phase:'1',selected:'Emails + Attachments + Monday',alt:'Just Emails (40h) | Everything (240h)',hrs:120,oneTime:18000,monthly:100,insight:'Email + Attachments + Monday = 95% context. Going beyond (SMS, screenshots) only adds 5% more but triples complexity. Sweet spot.',c:T.blue},
              {driver:'Graph Logic',phase:'1',selected:'2-Hop, Medium Depth',alt:'1-Hop Shallow (50h) | 3-Hop Deep (280h)',hrs:150,oneTime:22500,monthly:0,insight:'"Warm intro finder" tier. Friend-of-friend paths + social profiles & work history. Can answer "Who can intro me to the Ramp CEO?"',c:T.purple},
              {driver:'Enrichment Sources',phase:'2',selected:'Clay (50+ sources, one API)',alt:'Direct APIs ($800/mo) | Full Spectrum ($1,500/mo)',hrs:30,oneTime:4500,monthly:200,insight:'Clay is the "easy button." One API = LinkedIn + Crunchbase + news + 50 more. Gets 80% of value in week 1. Scale to direct APIs later.',c:T.accent},
              {driver:'Admin UI',phase:'2',selected:'AI Operations Dashboard',alt:'No UI (0h) | Basic Tables (80h)',hrs:200,oneTime:30000,monthly:0,insight:'Prompt Playground + Cost Dashboard + Entity Validation Queue + Agent Monitoring + Audit Logs. What LangSmith charges $500+/mo for — built custom.',c:T.green},
              {driver:'Services & Tools',phase:'2',selected:'Investment Operations (Workflows)',alt:'Basic Queries (80h) | Strategic Intel (400h)',hrs:200,oneTime:30000,monthly:0,insight:'Warm Intro Pathfinding + IC Memo Generator + Portfolio Health Dashboard + Deal Scoring + Relationship Tracker. System becomes USEFUL daily.',c:T.blue},
              {driver:'AI Agents Layer',phase:'2',selected:'Coordinated Agent Team',alt:'Single-Purpose (60h) | Autonomous Analyst (350h)',hrs:180,oneTime:27000,monthly:700,insight:'5-7 agents collaborate via shared memory. End-to-end pipeline: Research → Network → Scoring → Memo → Outreach. "Alpaca Gordon" tier.',c:T.purple},
              {driver:'Documentation',phase:'All',selected:'Loom Narrated Build Log (15%)',alt:'README only (5%) | Full Enterprise Spec (30%)',hrs:0,oneTime:0,monthly:0,insight:'15% overhead captures WHY decisions were made. 3 extra hrs/feature saves 10+ hrs of future reverse-engineering. Stripe/Notion approach.',c:T.amber},
              {driver:'Quality Assurance',phase:'3',selected:'Professional Grade',alt:'Rapid Proto (30h) | Paranoid Mode (250h)',hrs:120,oneTime:18000,monthly:0,insight:'Unit tests for critical paths + integration tests + staging environment. Catches 80% of bugs pre-launch. Insurance against hallucinated data in IC memos.',c:T.red},
            ].map((d,i)=>(<tr key={i} style={{borderBottom:`1px solid ${T.border}`}}>
              <TD style={{fontWeight:700,fontSize:10,color:d.c}}>{d.driver}</TD>
              <TD align="center"><Badge color={d.phase==='1'?T.accent:d.phase==='2'?T.green:d.phase==='3'?T.blue:T.amber}>{d.phase}</Badge></TD>
              <TD style={{fontSize:10,fontWeight:600,color:T.text}}>{d.selected}</TD>
              <TD align="center" mono>{d.hrs>0?d.hrs+'h':'—'}</TD>
              <TD align="center" mono color={T.accent}>{d.oneTime>0?'$'+(d.oneTime/1000).toFixed(0)+'K':'—'}</TD>
              <TD align="center" mono color={d.monthly>0?T.amber:T.textDim}>{d.monthly>0?'$'+d.monthly:'$0'}</TD>
              <TD style={{fontSize:8,color:T.textMuted,lineHeight:1.2,maxWidth:220}}>{d.insight}</TD>
            </tr>))}
            <tr style={{background:T.accentBg,fontWeight:700}}>
              <TD style={{fontWeight:800,color:T.accent}} colSpan={3}>TOTAL SELECTED CONFIGURATION</TD>
              <TD align="center" mono bold>1,120h</TD>
              <TD align="center" mono bold color={T.accent}>$180K</TD>
              <TD align="center" mono bold color={T.amber}>$1,000</TD>
              <TD style={{fontSize:8,color:T.textMuted}}>+$12K hardware = $192K total</TD>
            </tr>
          </tbody></table>
        </div></Card>

        {/* Data Architecture Diagram */}
        <Card title="Data Architecture — Tiered Sovereignty Model" style={{marginBottom:12}}><div style={{padding:'12px 16px'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {tier:'TIER 1 — LOCAL ONLY',icon:'🔒',location:'Mac Studio M4 Max (on-premise)',data:['Raw email bodies & threads','Deal terms & financials','LP communications','Proprietary analysis & IC memos','Relationship strength scores','Agent personas & prompts'],security:'Never leaves the Mac Studio. Full-disk encryption + VPN-only SSH access.',c:T.red},
              {tier:'TIER 2 — ANONYMIZED',icon:'🔐',location:'Cloud AI APIs (PII stripped)',data:['Embedding generation (text-embedding-3-large)','Semantic queries via vector search','LLM reasoning (Claude Opus / GPT-4)','Entity extraction from documents','Sentiment analysis on news feeds','Pattern matching across datasets'],security:'All PII stripped before transmission. Only anonymized queries touch external APIs. Provenance tracking on every query.',c:T.amber},
              {tier:'TIER 3 — PUBLIC',icon:'🌐',location:'External APIs & Web Scraping',data:['TechCrunch / news monitoring','Crunchbase funding data','LinkedIn public profiles','GitHub commit activity','SEC Edgar filings','Twitter/X social signals'],security:'Public data retrieved from external sources. Clay aggregates 50+ data sources. News APIs filtered by portfolio keywords.',c:T.green},
            ].map((t,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`4px solid ${t.c}`}}>
              <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:6}}><span style={{fontSize:18}}>{t.icon}</span><div style={{fontSize:11,fontWeight:800,color:t.c}}>{t.tier}</div></div>
              <div style={{fontSize:9,color:T.textMuted,marginBottom:4}}>{t.location}</div>
              {t.data.map((d,di)=>(<div key={di} style={{fontSize:9,color:T.text,padding:'2px 0 2px 6px',borderLeft:`2px solid ${t.c}40`,marginBottom:1}}>{d}</div>))}
              <div style={{fontSize:8,color:T.textMuted,marginTop:4,padding:'4px 6px',background:T.bg,borderRadius:3,lineHeight:1.3}}><strong style={{color:t.c}}>Security:</strong> {t.security}</div>
            </div>))}
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,marginTop:10}}>
            {[
              {store:'PostgreSQL',role:'Canonical Truth',desc:'Structured data: entities, artifacts, claims + evidence, deal pipeline, LP registry. Ground truth with full provenance tracking.',icon:'🗄️',c:T.accent},
              {store:'Neo4j Graph DB',role:'Relationship Intelligence',desc:'Entity relationships with 2-hop traversal. WORKS_AT, INTRODUCED_BY, INVESTED_IN edges. 50K+ nodes. Warm intro pathfinding.',icon:'🕸️',c:T.green},
              {store:'Vector DB',role:'Semantic Search',desc:'Embeddings of all text content. "Find deals similar to our best performers." Enables natural language queries across firm brain.',icon:'🧮',c:T.blue},
            ].map((s,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,borderLeft:`3px solid ${s.c}`}}>
              <div style={{display:'flex',alignItems:'center',gap:4,marginBottom:3}}><span style={{fontSize:14}}>{s.icon}</span><div><span style={{fontSize:10,fontWeight:700,color:s.c}}>{s.store}</span><span style={{fontSize:8,color:T.textMuted,marginLeft:4}}>{s.role}</span></div></div>
              <div style={{fontSize:9,color:T.text,lineHeight:1.3}}>{s.desc}</div>
            </div>))}
          </div>
        </div></Card>

        {/* SaaS Subscription Tiers */}
        <Card title="Monthly SaaS Stack — Recurring Intelligence Fuel"><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {tier:'Scrappy Mode',cost:'$200/mo',selected:false,services:['Free APIs + rate-limited enrichment','Retail AI pricing (OpenAI standard)','Manual monitoring (check TechCrunch yourself)','Stale data (6mo lag on Crunchbase free)'],note:'Good for MVP. Rate limits kill productivity. Agents are "dumb" without real-time data.',c:T.textMuted},
              {tier:'Professional Grade ★ SELECTED',cost:'$1,000/mo',selected:true,services:['Crunchbase Pro ($500/mo): real-time funding alerts','Clay ($200/mo): 50+ enrichment sources','OpenAI Team ($150/mo): bulk credits + priority','News API ($100/mo): aggregated, filtered','Social Monitoring ($50/mo): portfolio + competitor tracking'],note:'Table stakes for production. 24-48hr data lag max. Agents have CONTEXT. Monitoring AUTOMATED.',c:T.accent},
              {tier:'Institutional Intelligence',cost:'$2,500/mo',selected:false,services:['PitchBook ($1,500/mo): valuations, cap tables, LP tracking','Harmonic ($500/mo): founder movement prediction','Affinity ($300/mo): relationship intelligence','AlphaSense ($200/mo): earnings calls, expert transcripts','Enterprise AI: 50% volume discount'],note:'How Sequoia / a16z operate. Agents become PREDICTIVE. See signals competitors CAN\'T ACCESS.',c:T.purple},
            ].map((t,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`3px solid ${t.c}`,opacity:t.selected?1:0.6}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                <span style={{fontSize:11,fontWeight:800,color:t.c}}>{t.tier}</span>
                <span style={{fontSize:14,fontWeight:800,fontFamily:mono,color:t.c}}>{t.cost}</span>
              </div>
              {t.services.map((s,si)=>(<div key={si} style={{fontSize:9,color:T.text,padding:'2px 0 2px 6px',borderLeft:`2px solid ${t.c}40`,marginBottom:2,lineHeight:1.2}}>{s}</div>))}
              <div style={{fontSize:8,color:T.textMuted,marginTop:4,fontStyle:'italic',lineHeight:1.3}}>{t.note}</div>
            </div>))}
          </div>
        </div></Card>
      </div>)}

      {/* ═══ TAB 26: BUILD ROADMAP — 3-Phase Strategy with Gates ═══ */}
      {aView==='buildmap'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
          <Stat label="Total Duration" value="29 wks" icon={Clock} sub="3 phases" color={T.accent}/>
          <Stat label="Phase 1" value="$65K" icon={Target} sub="The Vault (9 weeks)" color={T.green}/>
          <Stat label="Phase 2" value="$91K" icon={Layers} sub="Enrichment (15 weeks)" color={T.blue}/>
          <Stat label="Phase 3" value="$28K" icon={Zap} sub="Agents (5 weeks)" color={T.purple}/>
          <Stat label="Gate Reviews" value="3" icon={Shield} sub="built-in exit ramps" color={T.amber}/>
        </div>

        {/* Gantt Timeline — Visual build schedule */}
        <GanttTimeline
          width={740} title="Build Timeline — 29 Weeks with Gate Reviews"
          phases={[
            {label:'Hardware Setup',startWeek:0,weeks:2,progress:100,color:T.accent,cost:'$12K',detail:'Mac Studio M4 Max + encryption',status:'Complete',gate:true,gateStatus:'pass',todayWeek:14},
            {label:'Phase 1: Vault',startWeek:1,weeks:9,progress:85,color:T.green,cost:'$65K',detail:'Email ingestion + Monday + Vector DB',status:'In progress',gate:true,gateStatus:'pending'},
            {label:'RedwoodJS App',startWeek:2,weeks:12,progress:65,color:T.blue,cost:'$18K',detail:'GraphQL API + Service layer',status:'Building'},
            {label:'Phase 2: Graph',startWeek:10,weeks:15,progress:25,color:T.blue,cost:'$91K',detail:'Clay + Neo4j + Enrichment + Ops',status:'Started',gate:true,gateStatus:'pending'},
            {label:'Admin Dashboard',startWeek:12,weeks:8,progress:10,color:T.purple,cost:'$30K',detail:'Prompt playground + monitoring',status:'Early'},
            {label:'Phase 3: Agents',startWeek:24,weeks:5,progress:0,color:T.purple,cost:'$28K',detail:'Sentinel + Persona + Thesis + Dashboard',status:'Planned',gate:true,gateStatus:'pending'},
            {label:'QA & Testing',startWeek:26,weeks:3,progress:0,color:T.amber,cost:'$18K',detail:'Unit + integration + staging',status:'Planned'},
          ]}
        />

        {/* Cost Driver Comparison — Where the money goes */}
        <div style={{display:'grid',gridTemplateColumns:'1fr 320px',gap:12,marginTop:12,marginBottom:12}}>
          <HorizontalWaterfall
            title="Cost Allocation by Driver"
            width={400} showCumulative
            items={[
              {label:'Admin UI',value:30000,color:T.green,displayValue:'$30K (200h)'},
              {label:'Services & Tools',value:30000,color:T.blue,displayValue:'$30K (200h)'},
              {label:'AI Agents',value:27000,color:T.purple,displayValue:'$27K (180h)'},
              {label:'Graph Logic',value:22500,color:T.accent,displayValue:'$22.5K (150h)'},
              {label:'Framework',value:18000,color:T.green,displayValue:'$18K (120h)'},
              {label:'Ingestion',value:18000,color:T.blue,displayValue:'$18K (120h)'},
              {label:'QA/Testing',value:18000,color:T.amber,displayValue:'$18K (120h)'},
              {label:'Hardware',value:12000,color:T.accent,displayValue:'$12K (one-time)'},
              {label:'Enrichment',value:4500,color:T.purple,displayValue:'$4.5K (30h)'},
            ]}
            maxVal={32000} valueLabel="Build Investment"
          />
          <div style={{display:'flex',flexDirection:'column',gap:8}}>
            <Card title="Spend by Phase"><div style={{padding:'10px 14px'}}>
              {[
                {phase:'Phase 1: Vault',cost:65,pct:35,weeks:9,color:T.green},
                {phase:'Phase 2: Graph',cost:91,pct:50,weeks:15,color:T.blue},
                {phase:'Phase 3: Agents',cost:28,pct:15,weeks:5,color:T.purple},
              ].map((p,i)=>(<div key={i} style={{marginBottom:8}}>
                <div style={{display:'flex',justifyContent:'space-between',fontSize:10,marginBottom:2}}>
                  <span style={{fontWeight:700,color:p.color}}>{p.phase}</span>
                  <span style={{fontFamily:mono,fontWeight:700,color:p.color}}>${p.cost}K</span>
                </div>
                <div style={{height:16,background:T.bgAccent,borderRadius:4,overflow:'hidden',position:'relative'}}>
                  <div style={{height:'100%',width:`${p.pct}%`,background:`${p.color}40`,borderRadius:4,transition:'width .3s'}}/>
                  <span style={{position:'absolute',right:4,top:2,fontSize:8,color:T.textDim,fontFamily:mono}}>{p.pct}% | {p.weeks}wk</span>
                </div>
              </div>))}
            </div></Card>
            <Card title="Monthly OpEx Projection"><div style={{padding:'8px 12px'}}>
              {(()=>{
                const months = ['M1','M3','M6','M9','M12','M18','M24'];
                const opex = [100,300,700,1000,1000,1000,1000];
                const w=260,h=60;
                const maxV=Math.max(...opex);
                return(<svg width={w} height={h+16} style={{display:'block'}}>
                  {opex.map((v,i)=>{
                    const bw=w/months.length-4, bx=i*(w/months.length)+2;
                    const bh=(v/maxV)*(h-4);
                    return(<g key={i}>
                      <rect x={bx} y={h-bh} width={bw} height={bh} rx={2} fill={`${T.accent}${v>=1000?'40':'20'}`} stroke={v>=1000?T.accent:'transparent'} strokeWidth={0.5}/>
                      <text x={bx+bw/2} y={h-bh-3} fill={T.accent} fontSize={8} fontFamily={mono} fontWeight={700} textAnchor="middle">${v>=1000?'1K':v}</text>
                      <text x={bx+bw/2} y={h+12} fill={T.textDim} fontSize={7} textAnchor="middle">{months[i]}</text>
                    </g>);
                  })}
                </svg>);
              })()}
            </div></Card>
          </div>
        </div>

        {/* 3-Phase Build */}
        <Card title="Phased Build Strategy — With Gate Reviews & Exit Ramps" style={{marginBottom:12}}><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {phase:'PHASE 1: THE VAULT',subtitle:'Centralization — Source of Truth',weeks:9,cost:'$65K',goal:'Transform fragmented data chaos into a unified, queryable source of truth.',
                insight:'LLMs are useless without context. You cannot ask an agent to evaluate a deal if your data is scattered, unlabeled, and impossible to digest.',
                deliverables:['Mac Studio M4 Max configured w/ PostgreSQL, full-disk encryption, VPN-only SSH','Gmail API integration — automatic email ingestion with threading preserved','Monday.com webhook integration — real-time pipeline updates','Vector embeddings for all text content (text-embedding-3-large)','Basic admin UI for monitoring ingestion jobs + manual syncs'],
                gate:{criteria:'90% email backlog ingested, Monday sync operational, query response <3 seconds',options:['PROCEED → Phase 2','PIVOT → Redirect scope based on findings','STOP → Knowledge transfer + partial settlement']},
                costDrivers:['Hardware Core: Mac Studio M4 Max ($12K)','Ingestion Sources: Email + Attachments + Monday (120h)','Graph Logic: 2-Hop Medium Depth (150h)','Framework: RedwoodJS scaffolding (40h of 120h total)'],
                c:T.green},
              {phase:'PHASE 2: ENRICHMENT & GRAPH',subtitle:'Relationship Intelligence',weeks:15,cost:'$91K',goal:'Transform flat contact lists into three-dimensional relationship intelligence.',
                insight:'A name in your CRM isn\'t a relationship. Phase 2 enriches every contact with professional history, social profiles, and company data—then maps the connections.',
                deliverables:['Clay integration — bio, social profiles, company data (50+ sources)','Automatic profile creation for every new contact','LinkedIn enrichment for career history + mutual connections','Relationship strength scoring (interaction frequency × recency)','Graph database schema with 2-hop entity relationships','Network visualization dashboard','Investment Operations: Warm Intros, Memo Templates, Deal Scoring, Portfolio Health'],
                gate:{criteria:'Graph queries <3s, enrichment accuracy >85%, 2-hop paths working, 50K+ nodes indexed',options:['PROCEED → Phase 3','PIVOT → Focus on LP reporting instead of deal sourcing','STOP → Stable enrichment system stands alone']},
                costDrivers:['Enrichment Sources: Clay (30h + $200/mo)','Admin UI: AI Operations Dashboard (200h)','Services & Tools: Investment Operations (200h)','Framework: RedwoodJS completion (80h of 120h total)'],
                c:T.blue},
              {phase:'PHASE 3: AGENT SYSTEM',subtitle:'The Always-On Analyst',weeks:5,cost:'$28K',goal:'Deploy autonomous AI agents that work while you sleep.',
                insight:'This is where the system becomes truly intelligent. Four coordinated agents continuously monitor, analyze, and surface insights in real-time.',
                deliverables:['The Sentinel: Monitors Twitter/TechCrunch/GitHub/SEC every 5 minutes','The Persona Panel: Multi-perspective analysis (Skeptic/Visionary/Operator)','The Living Thesis: Auto-updates investment thesis on material changes','The Dashboard Maintainer: Real-time frontend with prioritized opportunities','Extended agents: Oracle, Cartographer, Alchemist, Conductor'],
                gate:{criteria:'Agents running 24/7, memo generation <60 seconds, partner NPS >8',options:['PROCEED → Post-launch evolution','PIVOT → Scale specific agents, park others','STOP → Core system + manual agent triggers']},
                costDrivers:['AI Agents Layer: Coordinated Team (180h + $700/mo)','QA: Professional Grade (120h)','Documentation: Loom Build Log (15% overhead)'],
                c:T.purple},
            ].map((p,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:8,padding:10,borderTop:`4px solid ${p.c}`,border:`1px solid ${T.border}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <div><div style={{fontSize:12,fontWeight:800,color:p.c}}>{p.phase}</div><div style={{fontSize:9,color:T.textMuted}}>{p.subtitle}</div></div>
                <div style={{textAlign:'right'}}><div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:p.c}}>{p.cost}</div><div style={{fontSize:9,color:T.textMuted}}>{p.weeks} weeks</div></div>
              </div>
              <div style={{fontSize:10,fontWeight:600,color:T.text,marginBottom:2}}>{p.goal}</div>
              <div style={{fontSize:9,color:T.textMuted,fontStyle:'italic',marginBottom:6,lineHeight:1.3}}>{p.insight}</div>
              <div style={{marginBottom:6}}>
                <div style={{fontSize:8,fontWeight:700,color:T.textDim,marginBottom:2}}>DELIVERABLES</div>
                {p.deliverables.map((d,di)=>(<div key={di} style={{fontSize:9,color:T.text,padding:'2px 0 2px 6px',borderLeft:`2px solid ${p.c}40`,marginBottom:1,lineHeight:1.2}}>{d}</div>))}
              </div>
              <div style={{padding:'6px 8px',background:`${p.c}08`,borderRadius:4,border:`1px solid ${p.c}20`,marginBottom:6}}>
                <div style={{fontSize:8,fontWeight:700,color:p.c,marginBottom:2}}>GATE REVIEW — Success Criteria</div>
                <div style={{fontSize:9,color:T.text,marginBottom:3}}>{p.gate.criteria}</div>
                {p.gate.options.map((o,oi)=>(<div key={oi} style={{fontSize:8,color:oi===0?T.green:oi===1?T.amber:T.red,fontWeight:600}}>{o}</div>))}
              </div>
              <div style={{fontSize:8,color:T.textDim}}>
                <strong>Cost Drivers:</strong> {p.costDrivers.join(' | ')}
              </div>
            </div>))}
          </div>
        </div></Card>

        {/* 27 Questions + Post-Launch */}
        <Card title="The 27 Questions Omniscient Will Answer"><div style={{padding:'8px 0'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10}}>
            {[
              {cat:'Network Intelligence',phase:'Phase 2',qs:[
                'Who in our network is connected to founders of [Target Startup]?',
                'Which founders we met 2 years ago recently updated LinkedIn to Stealth?',
                'Find all introductions made by [Partner] that led to a closed deal.',
                'Map our network overlap between managers and top-tier co-investors.',
              ],c:T.accent},
              {cat:'Manager Analytics',phase:'Phase 3',qs:[
                'Heatmap: what topics each manager emphasizes in updates by quarter.',
                'Compare capital pacing vs reserve strategy across managers.',
                'Give me a risk radar for each manager that updates automatically.',
                'Which managers consistently outperform their vintage benchmarks?',
                'Flag managers where deployment pace diverges from projections.',
                'Rank managers by LP communication quality and transparency.',
                'Identify fund-size-to-performance correlation across our GPs.',
              ],c:T.green},
              {cat:'Deal Intelligence',phase:'Phase 2-3',qs:[
                'What deals similar to [Company X] have we seen in the last 12 months?',
                'Score this pitch deck against our investment thesis automatically.',
                'Which sectors show accelerating funding velocity this quarter?',
                'Find pre-company signals: founders leaving FAANG for stealth mode.',
                'Generate IC memo from this deck + call notes in our style.',
                'What are the top 10 risks in our current pipeline?',
                'Which passed companies later succeeded? What did we miss?',
              ],c:T.blue},
            ].map((cat,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,borderTop:`3px solid ${cat.c}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <span style={{fontSize:10,fontWeight:800,color:cat.c}}>{cat.cat}</span>
                <Badge color={cat.c}>{cat.phase}</Badge>
              </div>
              {cat.qs.map((q,qi)=>(<div key={qi} style={{fontSize:9,color:T.text,padding:'3px 0 3px 6px',borderLeft:`2px solid ${cat.c}40`,marginBottom:2,lineHeight:1.3,fontStyle:'italic'}}>"{q}"</div>))}
            </div>))}
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:8,marginTop:10}}>
            {[
              {mode:'Solo (AI-Augmented)',cost:'$0/mo',desc:'You maintain with Cursor/Claude as on-call engineer. AI handles 80% of grunt work. "Bus factor" solved by LLMs.',c:T.green},
              {mode:'Quarterly Audit',cost:'$2,500/quarter',desc:'Expert dev reviews architecture & security every 3 months. You handle daily ops. Doctor checkup model.',c:T.blue},
              {mode:'Co-Founder Mode',cost:'$10K/mo',desc:'Continuous R&D — building NEW features, integrating new models, refining agent logic. Velocity + competitive advantage.',c:T.purple},
            ].map((m,i)=>(<div key={i} style={{background:T.bgAccent,borderRadius:6,padding:8,borderLeft:`3px solid ${m.c}`}}>
              <div style={{display:'flex',justifyContent:'space-between'}}><span style={{fontSize:10,fontWeight:700,color:m.c}}>{m.mode}</span><span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:m.c}}>{m.cost}</span></div>
              <div style={{fontSize:9,color:T.text,lineHeight:1.3,marginTop:3}}>{m.desc}</div>
            </div>))}
          </div>
        </div></Card>
      </div>)}

      {/* ═══════════════════════════════════════════════════════════════ */}
      {/* ═══  PUBLIC MARKETS VIEWS — Institutional-Grade Fund Ops  ═══ */}
      {/* ═══════════════════════════════════════════════════════════════ */}

      {aView==='navmark'&&(<div>
        {/* ── MODE TOGGLE ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['marks','sensitivity','bridge','governance'].map(m=>(
              <FilterPill key={m} label={m==='marks'?'📊 Current Marks':m==='sensitivity'?'🎚️ Sensitivity':m==='bridge'?'🌊 NAV Bridge':'🛡️ Governance'} active={getMode('navmark','marks')===m} onClick={()=>setMode('navmark',m)}/>
            ))}
          </div>
          <div style={{display:'flex',gap:4}}>
            {['All','L1','L3'].map(f=>(
              <FilterPill key={f} label={f==='All'?'All Levels':`Level ${f.replace('L','')}`} active={getFilter('navmark','level','All')===f} onClick={()=>setFilter('navmark','level',f)}/>
            ))}
          </div>
        </div>

        {/* ── MARKS MODE (default) ── */}
        {getMode('navmark','marks')==='marks'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'NAV/Share',v:'$9.84',d:'as of Q4 2025',c:T.accent},
            {l:'Total NAV',v:'$193.7M',d:'across 8 funds + co-invests',c:T.blue},
            {l:'Level 3 Assets',v:'91.4%',d:'ASC 820 hierarchy',c:T.purple},
            {l:'Next FVC Meeting',v:'Mar 15',d:'Q1 2026 marks due',c:T.amber},
            {l:'Audit Status',v:'CLEAN',d:'KPMG — no qualifications',c:T.green},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="ASC 820 Fair Value Hierarchy — Click Any Row for Detail" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Holding','Fund Exposure','FV Methodology','Level','Last Mark','Δ QoQ','Confidence','Valuation Agent'].map(h=><TH key={h} align={['Holding','Fund Exposure','FV Methodology','Valuation Agent'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {name:'Anthropic',fund:'FF VII + Direct',method:'Last Round + Calibration',level:'3',mark:'$75.0B',delta:'+18.2%',conf:96,agent:'Houlihan Lokey',nav:48.2,pct:24.9},
              {name:'SpaceX',fund:'FF VII + FF VI',method:'Secondary Market Pricing',level:'3',mark:'$380.0B',delta:'+12.8%',conf:94,agent:'Lincoln International',nav:36.1,pct:18.6},
              {name:'Stripe',fund:'Sequoia XVI + a16z',method:'Comparable Public Co + DCF',level:'3',mark:'$91.5B',delta:'+8.4%',conf:88,agent:'Duff & Phelps',nav:22.4,pct:11.6},
              {name:'Anduril',fund:'FF VII',method:'Last Round + Revenue Multiple',level:'3',mark:'$28.0B',delta:'+22.5%',conf:82,agent:'Houlihan Lokey',nav:18.8,pct:9.7},
              {name:'Databricks',fund:'a16z Infra III',method:'Comparable Transactions',level:'3',mark:'$62.0B',delta:'+6.1%',conf:90,agent:'Kroll',nav:15.2,pct:7.8},
              {name:'Palantir',fund:'NEA 19 + FF VI',method:'Quoted Market Price',level:'1',mark:'$180.0B',delta:'+31.2%',conf:99,agent:'N/A — Public',nav:14.5,pct:7.5},
              {name:'Scale AI',fund:'a16z Infra III',method:'Last Round + Calibration',level:'3',mark:'$14.0B',delta:'+4.5%',conf:78,agent:'Duff & Phelps',nav:8.2,pct:4.2},
              {name:'Figma',fund:'Sequoia XVI',method:'Comparable Public Co',level:'3',mark:'$12.5B',delta:'+15.0%',conf:85,agent:'Lincoln International',nav:6.8,pct:3.5},
            ].filter(r=>getFilter('navmark','level','All')==='All'||(getFilter('navmark','level','All')==='L1'&&r.level==='1')||(getFilter('navmark','level','All')==='L3'&&r.level==='3')).map((r,i)=>(<TR key={i} style={{cursor:'pointer'}} onClick={()=>setDrillDown({
              title:r.name,subtitle:`${r.fund} · ${r.method}`,
              badges:[{l:`Level ${r.level}`,c:r.level==='1'?T.green:T.purple},{l:`${r.conf}% confidence`,c:r.conf>=90?T.green:T.amber}],
              kpis:[{l:'Valuation',v:r.mark,c:T.accent},{l:'Δ QoQ',v:r.delta,c:T.green},{l:'NAV Exposure',v:`$${r.nav}M`,c:T.blue},{l:'% of NAV',v:`${r.pct}%`,c:r.pct>15?T.red:T.accent}],
              sections:[
                {title:'Valuation Details',type:'table',rows:[
                  {l:'Methodology',v:r.method},{l:'Valuation Agent',v:r.agent},{l:'Confidence Score',v:`${r.conf}/100`,mono:true,c:r.conf>=90?T.green:T.amber},
                  {l:'ASC 820 Level',v:`Level ${r.level}`,c:r.level==='1'?T.green:T.purple},
                  {l:'NAV Impact (±10%)',v:`$${(r.nav*0.1).toFixed(1)}M → ±$${(r.nav*0.1/23.8).toFixed(2)}/share`,mono:true,c:T.accent},
                ]},
                {title:'Sensitivity: What If This Holding Changes ±25%?',type:'bars',items:[
                  {l:'+25% scenario',v:`$${(r.nav*1.25).toFixed(1)}M (+$${(r.nav*0.25/23.8).toFixed(2)}/share)`,pct:75,c:T.green},
                  {l:'Current',v:`$${r.nav}M`,pct:50,c:T.accent},
                  {l:'-25% scenario',v:`$${(r.nav*0.75).toFixed(1)}M (-$${(r.nav*0.25/23.8).toFixed(2)}/share)`,pct:25,c:T.red},
                ]},
                {title:'Actions',type:'actions',items:[
                  {icon:'📊',label:'Run Monte Carlo',view:'montecarlo',desc:'Simulate outcomes for this position'},
                  {icon:'📐',label:'Review Sizing',view:'sizing',desc:'Check allocation vs Kelly optimal'},
                  {icon:'⚖️',label:'View Comparables',view:'comps',desc:'Benchmark against peer valuations'},
                ]}
              ]
            })}>
              <TD bold>{r.name}</TD>
              <TD color={T.textMuted}>{r.fund}</TD>
              <TD color={T.textDim}>{r.method}</TD>
              <TD align="right"><Badge color={r.level==='1'?T.green:r.level==='2'?T.blue:T.purple}>L{r.level}</Badge></TD>
              <TD align="right" mono bold>{r.mark}</TD>
              <TD align="right" mono bold color={parseFloat(r.delta)>0?T.green:T.red}>{r.delta}</TD>
              <TD align="right"><div style={{display:'flex',alignItems:'center',justifyContent:'flex-end',gap:4}}><div style={{width:40,height:4,background:T.bgAccent,borderRadius:2}}><div style={{width:`${r.conf}%`,height:'100%',background:r.conf>=90?T.green:r.conf>=80?T.blue:T.amber,borderRadius:2}}/></div><span style={{fontFamily:mono,fontSize:10,fontWeight:700,color:r.conf>=90?T.green:r.conf>=80?T.blue:T.amber}}>{r.conf}</span></div></TD>
              <TD color={T.textMuted}>{r.agent}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        </>)}

        {/* ── SENSITIVITY MODE — Interactive NAV impact modeling ── */}
        {getMode('navmark','marks')==='sensitivity'&&(
        <div>
          <Card title="🎚️ NAV Sensitivity — Drag Sliders to Model Valuation Changes" style={{marginBottom:14}}>
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:12}}>Adjust individual holding valuations to see NAV/share impact in real-time.</div>
              {[
                {name:'Anthropic',baseVal:75,nav:48.2,pct:24.9,k:'sensAnthro'},
                {name:'SpaceX',baseVal:350,nav:36.1,pct:18.6,k:'sensSpaceX'},
                {name:'Stripe',baseVal:91.5,nav:22.4,pct:11.6,k:'sensStripe'},
                {name:'Anduril',baseVal:28,nav:18.8,pct:9.7,k:'sensAnduril'},
                {name:'Databricks',baseVal:62,nav:15.2,pct:7.8,k:'sensDatabricks'},
                {name:'Palantir',baseVal:180,nav:14.5,pct:7.5,k:'sensPalantir'},
              ].map((h,i)=>{
                const slider=sc[h.k]!==undefined?sc[h.k]:0;
                const newNav=h.nav*(1+slider/100);
                const navPerShare=(newNav-h.nav)/23.8;
                return(<div key={i} style={{display:'grid',gridTemplateColumns:'100px 1fr 120px 60px',gap:10,alignItems:'center',padding:'8px 0',borderBottom:`1px solid ${T.border}`}}>
                  <div>
                    <div style={{fontSize:11,fontWeight:600,color:T.text}}>{h.name}</div>
                    <div style={{fontSize:8,color:T.textDim}}>{h.pct}% of NAV</div>
                  </div>
                  <div>
                    <input type="range" min={-50} max={100} step={5} value={slider}
                      onChange={e=>setSlider(h.k,e.target.value)}
                      style={{width:'100%',height:6,appearance:'none',background:`linear-gradient(90deg, ${T.red} 0%, ${T.bgAccent} 33%, ${T.green} 100%)`,borderRadius:3,outline:'none',cursor:'pointer'}}/>
                    <div style={{display:'flex',justifyContent:'space-between',fontSize:7,color:T.textDim}}>
                      <span>-50%</span>
                      <span style={{color:slider===0?T.textDim:slider>0?T.green:T.red,fontWeight:700}}>{slider>0?'+':''}{slider}%</span>
                      <span>+100%</span>
                    </div>
                  </div>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:10,fontFamily:mono,color:T.textDim}}>${h.baseVal}B → ${(h.baseVal*(1+slider/100)).toFixed(0)}B</div>
                    <div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:navPerShare>=0?T.green:T.red}}>{navPerShare>=0?'+':''}{navPerShare.toFixed(3)}/sh</div>
                  </div>
                  <div style={{textAlign:'right',fontSize:12,fontFamily:mono,fontWeight:700,color:slider>0?T.green:slider<0?T.red:T.textDim}}>${newNav.toFixed(1)}M</div>
                </div>);
              })}
              {/* Composite summary */}
              <div style={{marginTop:14,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.accent}30`}}>
                <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
                  {(()=>{
                    const holdings=[
                      {nav:48.2,k:'sensAnthro'},{nav:36.1,k:'sensSpaceX'},{nav:22.4,k:'sensStripe'},
                      {nav:18.8,k:'sensAnduril'},{nav:15.2,k:'sensDatabricks'},{nav:14.5,k:'sensPalantir'},
                    ];
                    const totalDelta=holdings.reduce((s,h)=>{const sl=sc[h.k]||0;return s+h.nav*(sl/100);},0);
                    const newTotalNav=193.7+totalDelta;
                    const newNavPerShare=newTotalNav/23.8;
                    const navChange=((newTotalNav/193.7-1)*100);
                    return [
                      {l:'Current NAV',v:'$193.7M',c:T.textDim},
                      {l:'Scenario NAV',v:`$${newTotalNav.toFixed(1)}M`,c:totalDelta>=0?T.green:T.red},
                      {l:'NAV/Share',v:`$${newNavPerShare.toFixed(2)}`,c:T.accent},
                      {l:'NAV Δ',v:`${navChange>=0?'+':''}${navChange.toFixed(1)}%`,c:navChange>=0?T.green:T.red},
                    ].map((m,i)=>(<div key={i} style={{textAlign:'center'}}>
                      <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{m.l}</div>
                      <div style={{fontSize:18,fontWeight:900,fontFamily:mono,color:m.c}}>{m.v}</div>
                    </div>));
                  })()}
                </div>
              </div>
            </div>
          </Card>
        </div>
        )}

        {/* ── BRIDGE MODE — QoQ NAV waterfall ── */}
        {getMode('navmark','marks')==='bridge'&&(
        <Card title="🌊 NAV Bridge — Q3 → Q4 2025 Walkthrough" style={{marginBottom:14}}>
          <div style={{padding:'18px'}}>
            {[
              {l:'Q3 NAV/Share',v:8.42,type:'base',c:T.accent},
              {l:'Anthropic Mark-Up (+18.2%)',v:0.52,type:'delta'},
              {l:'SpaceX Secondary Pricing (+12.8%)',v:0.38,type:'delta'},
              {l:'Anduril Revenue Growth (+22.5%)',v:0.28,type:'delta'},
              {l:'Palantir Public Mark (+31.2%)',v:0.24,type:'delta'},
              {l:'Other Holdings Net',v:0.18,type:'delta'},
              {l:'New Commitments (FF VI, Thrive IX)',v:-0.08,type:'delta'},
              {l:'Management Fees & Expenses',v:-0.06,type:'delta'},
              {l:'ATM NAV Accretion',v:+0.04,type:'delta'},
              {l:'Interest & Dividends',v:0.02,type:'delta'},
            ].concat([{l:'Q4 NAV/Share',v:9.84,type:'total',c:T.green}]).map((it,i,arr)=>(
              <div key={i} style={{display:'flex',alignItems:'center',padding:'8px 0',borderBottom:i<arr.length-1?`1px solid ${T.border}`:'none'}}>
                <span style={{fontSize:11,fontWeight:it.type!=='delta'?700:400,color:it.type==='total'?T.green:T.text,width:240}}>{it.l}</span>
                <div style={{flex:1,height:20,position:'relative'}}>
                  {it.type==='delta'&&<div style={{position:'absolute',left:it.v>=0?'40%':'auto',right:it.v<0?'60%':'auto',width:`${Math.min(50,Math.abs(it.v)*80)}%`,height:'100%',background:it.v>=0?T.green+'40':T.red+'40',borderRadius:3}}/>}
                  {it.type==='base'&&<div style={{position:'absolute',left:0,width:'40%',height:'100%',background:T.accent+'30',borderRadius:3}}/>}
                  {it.type==='total'&&<div style={{position:'absolute',left:0,width:'47%',height:'100%',background:T.green+'40',borderRadius:3}}/>}
                </div>
                <span style={{fontSize:14,fontFamily:mono,fontWeight:700,width:80,textAlign:'right',color:it.type==='delta'?(it.v>=0?T.green:T.red):(it.c||T.accent)}}>{it.type==='delta'?(it.v>=0?'+':'')+'$'+it.v.toFixed(2):'$'+it.v.toFixed(2)}</span>
              </div>
            ))}
            <div style={{marginTop:14,padding:10,background:T.green+'08',borderRadius:6,border:`1px solid ${T.green}30`,textAlign:'center'}}>
              <span style={{fontSize:12,fontWeight:700,color:T.green}}>NAV/Share: $8.42 → $9.84 (+$1.42, +16.9% QoQ)</span>
              <div style={{fontSize:9,color:T.textMuted,marginTop:2}}>Driven primarily by Anthropic (+$0.52), SpaceX (+$0.38), and Anduril (+$0.28)</div>
            </div>
          </div>
        </Card>
        )}

        {/* ── GOVERNANCE MODE — FVC process ── */}
        {getMode('navmark','marks')==='governance'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Fair Value Committee — Governance Protocol">
            <div style={{padding:0}}>{[
              {step:'1. Portfolio Company Data Collection',owner:'Matthew',deadline:'T-21 days',status:'Complete',detail:'Financial statements, cap tables, board materials from all 130+ look-through cos'},
              {step:'2. Independent Valuation Agent Review',owner:'External',deadline:'T-14 days',status:'Complete',detail:'Houlihan Lokey, Lincoln International, Duff & Phelps, Kroll review Level 3 assets'},
              {step:'3. Internal Marks Preparation',owner:'Ken',deadline:'T-7 days',status:'In Progress',detail:'Ken Wallace prepares proposed marks with methodology documentation'},
              {step:'4. FVC Meeting & Deliberation',owner:'Committee',deadline:'Mar 15',status:'Scheduled',detail:'Full committee: Jason (Chair), Ken, Brett + external member. Quorum required'},
              {step:'5. Board Approval',owner:'Board',deadline:'T+3 days',status:'Pending',detail:'Board ratifies FVC marks. Independent directors must concur'},
              {step:'6. NAV Publication',owner:'Admin',deadline:'T+5 days',status:'Pending',detail:'NAV/share published to NYSE, SEC filing, investor website update'},
            ].map((s,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none',display:'flex',gap:12,alignItems:'center'}}>
              <div style={{width:28,height:28,borderRadius:14,background:s.status==='Complete'?T.green+'20':s.status==='In Progress'?T.amber+'20':T.bgAccent,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
                <span style={{fontSize:12}}>{s.status==='Complete'?'✓':s.status==='In Progress'?'◐':'○'}</span>
              </div>
              <div style={{flex:1}}>
                <div style={{fontSize:12,fontWeight:600,color:T.text}}>{s.step}</div>
                <div style={{fontSize:10,color:T.textMuted}}>{s.detail}</div>
                <div style={{display:'flex',gap:8,marginTop:3}}><Badge color={T.blue}>{s.owner}</Badge><span style={{fontSize:9,color:T.textDim}}>{s.deadline}</span></div>
              </div>
            </div>))}</div>
          </Card>
          <Card title="Valuation Methodology Register">
            <div style={{padding:0}}>{[
              {method:'Last Round + Calibration',count:42,pctNav:38.2,triggers:'If >12mo since round, calibrate for market conditions',backtest:'+/-8.4%'},
              {method:'Comparable Public Company',count:28,pctNav:22.1,triggers:'Rev multiple from 3-5 closest public peers, 15-25% DLOM applied',backtest:'+/-12.1%'},
              {method:'Secondary Market Pricing',count:18,pctNav:18.6,triggers:'Volume-weighted avg of broker-quoted secondaries, min 3 data points',backtest:'+/-5.2%'},
              {method:'DCF / Intrinsic Value',count:12,pctNav:8.3,triggers:'WACC-based for pre-revenue or unique business models, terminal value cap',backtest:'+/-18.6%'},
              {method:'Quoted Market Price (L1)',count:8,pctNav:12.8,triggers:'Publicly traded securities marked to close price. No adjustment.',backtest:'0%'},
            ].map((m,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<4?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <span style={{fontSize:12,fontWeight:600,color:T.text}}>{m.method}</span>
                <div style={{display:'flex',gap:8}}><span style={{fontSize:10,fontFamily:mono,color:T.blue}}>{m.count} cos</span><span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.accent}}>{m.pctNav}% NAV</span></div>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:3}}>{m.triggers}</div>
              <div style={{fontSize:9,color:T.textDim}}>Historical backtest accuracy: <span style={{fontFamily:mono,fontWeight:600,color:parseFloat(m.backtest)<=10?T.green:T.amber}}>{m.backtest}</span></div>
            </div>))}</div>
          </Card>
        </div>
        )}
      </div>)}

      {aView==='premdisc'&&(<div>
        {/* ── MODE TOGGLE ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['dashboard','calculator','scenarios'].map(m=>(
              <FilterPill key={m} label={m==='dashboard'?'📊 Dashboard':m==='calculator'?'🧮 Calculator':'🎚️ Scenarios'} active={getMode('premdisc','dashboard')===m} onClick={()=>setMode('premdisc',m)}/>
            ))}
          </div>
          <span style={{fontSize:9,color:T.textDim,fontFamily:mono}}>Live Premium: <span style={{color:T.accent,fontWeight:700}}>{calcPremDisc.toFixed(1)}%</span></span>
        </div>

        {/* ── DASHBOARD MODE (default) ── */}
        {getMode('premdisc','dashboard')==='dashboard'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Stock Price',v:'$24.38',d:'NYSE: NEWCO',c:T.accent},
            {l:'NAV/Share',v:'$9.84',d:'Q4 2025 mark',c:T.blue},
            {l:'Premium',v:`+${calcPremDisc.toFixed(1)}%`,d:'vs last reported NAV',c:T.green},
            {l:'Mkt Cap',v:'$582M',d:'23.9M shares out',c:T.purple},
            {l:'30d Avg Vol',v:'248K',d:'shares/day',c:T.amber},
            {l:'52wk Range',v:'$8.12-$28.95',d:'current: 84th pctl',c:T.cyan},
          ].map((s,i)=>(<div key={i} style={{padding:12,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase',marginBottom:3}}>{s.l}</div>
            <div style={{fontSize:18,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:9,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Premium/Discount History — 24-Month Trend vs Peer Closed-End Funds" style={{marginBottom:14}}>
          <div style={{padding:'14px 18px'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:10}}>
              <div style={{fontSize:11,color:T.textDim}}>Historical premium to NAV — higher = stock trades above underlying value</div>
              <div style={{display:'flex',gap:10}}>{[{l:'NEWCO',c:T.accent},{l:'CEF Avg',c:T.textDim},{l:'Tech CEF Avg',c:T.blue}].map(p=>(<span key={p.l} style={{fontSize:9,display:'flex',alignItems:'center',gap:4}}><span style={{width:12,height:3,background:p.c,borderRadius:2}}/>{p.l}</span>))}</div>
            </div>
            <div style={{height:200,display:'flex',alignItems:'flex-end',gap:1}}>
              {[42,58,72,65,88,92,105,98,112,125,138,145,158,142,135,148,162,155,148,142,138,145,152,148].map((v,i)=>(<div key={i} style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',gap:2}}>
                <div style={{width:'100%',background:`linear-gradient(to top, ${T.accent}20, ${T.accent}60)`,borderRadius:'3px 3px 0 0',height:`${(v/162)*180}px`,position:'relative'}}>
                  {i===23&&<div style={{position:'absolute',top:-18,left:'50%',transform:'translateX(-50)',fontSize:9,fontFamily:mono,fontWeight:700,color:T.accent,whiteSpace:'nowrap'}}>+148%</div>}
                </div>
                {i%6===0&&<span style={{fontSize:7,color:T.textDim,fontFamily:mono}}>{['Mar','Jun','Sep','Dec'][Math.floor(i/6)]}</span>}
              </div>))}
            </div>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:14}}>
          <Card title="Peer Closed-End Fund Comparison">
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Fund','Ticker','NAV','Price','Prem/Disc','AUM','Strategy'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
              <tbody>{[
                {name:'NEWCO',ticker:'NEWCO',nav:'$9.84',price:'$24.38',pd:'+148%',aum:'$582M',strat:'AI Safety FoF',ours:true},
                {name:'Destiny Tech100',ticker:'DXYZ',nav:'$4.84',price:'$30.12',pd:'+522%',aum:'$42M',strat:'Pre-IPO Tech'},
                {name:'SV Tech Investors',ticker:'SVVC',nav:'$6.12',price:'$3.85',pd:'-37%',aum:'$38M',strat:'VC Direct'},
                {name:'Horizon Tech Finance',ticker:'HRZN',nav:'$9.68',price:'$10.42',pd:'+8%',aum:'$720M',strat:'Tech Lending'},
                {name:'BlackRock Sci & Tech',ticker:'BST',nav:'$38.95',price:'$36.20',pd:'-7%',aum:'$1.2B',strat:'Public Tech'},
                {name:'ASA Gold & PM',ticker:'ASA',nav:'$18.20',price:'$19.50',pd:'+7%',aum:'$420M',strat:'Mining CEF'},
              ].map((f,i)=>(<TR key={i} highlight={f.ours}>
                <TD bold color={f.ours?T.accent:T.text}>{f.name}</TD>
                <TD mono>{f.ticker}</TD>
                <TD mono>{f.nav}</TD>
                <TD mono bold>{f.price}</TD>
                <TD mono bold color={parseFloat(f.pd)>0?T.green:T.red}>{f.pd}</TD>
                <TD mono>{f.aum}</TD>
                <TD color={T.textDim}>{f.strat}</TD>
              </TR>))}</tbody>
            </table></div>
          </Card>
          <Card title="Premium Driver Analysis — Why Investors Pay Above NAV">
            <div style={{padding:0}}>{[
              {driver:'Unique Access to Pre-IPO AI Companies',impact:'+45%',score:95,detail:'Only publicly traded vehicle with direct exposure to Anthropic, SpaceX, Anduril, Scale AI'},
              {driver:'Scarcity Premium — Limited Shares Outstanding',impact:'+32%',score:88,detail:'23.9M shares with 18.4% short interest creates squeeze dynamics'},
              {driver:'AI Safety Thesis Alignment',impact:'+28%',score:82,detail:'Only pure-play AI Safety fund in public markets. ESG/impact demand growing'},
              {driver:'Retail Investor Access to VC Returns',impact:'+22%',score:78,detail:'No accreditation required. Democratized access to institutional-grade VC portfolio'},
              {driver:'Catalysts Pipeline (IPOs, M&A)',impact:'+18%',score:85,detail:'SpaceX, Stripe, Anduril IPO catalysts could drive 40-60% NAV uplift in 12mo'},
              {driver:'Management Track Record',impact:'+12%',score:76,detail:'Team credibility: Skoll Foundation, Goldman Public Policy, Neff brand exit'},
            ].map((d,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <span style={{fontSize:12,fontWeight:600,color:T.text}}>{d.driver}</span>
                <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:T.green}}>{d.impact}</span>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:4}}>{d.detail}</div>
              <Bar value={d.score} max={100} color={d.score>=85?T.accent:d.score>=75?T.blue:T.purple} h={4}/>
            </div>))}</div>
          </Card>
        </div>
        </>)}

        {/* ── CALCULATOR MODE — Live interactive premium & ATM modeling ── */}
        {getMode('premdisc','dashboard')==='calculator'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12}}>
          <Card title="🧮 Premium/Discount Calculator" style={{borderTop:`3px solid ${T.accent}`}}>
            <div style={{padding:'16px 18px'}}>
              <CalcInput label="NAV/Share" k="premiumNav" unit="$" min={0} step={0.01}/>
              <CalcInput label="Stock Price" k="premiumPrice" unit="$" min={0} step={0.01}/>
              <div style={{marginTop:16,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.accent}30`,textAlign:'center'}}>
                <div style={{fontSize:9,color:T.textDim,marginBottom:4}}>LIVE PREMIUM / DISCOUNT</div>
                <div style={{fontSize:36,fontWeight:900,fontFamily:mono,color:calcPremDisc>=0?T.green:T.red}}>{calcPremDisc>=0?'+':''}{calcPremDisc.toFixed(1)}%</div>
                <div style={{fontSize:10,color:T.textMuted,marginTop:4}}>Market Cap: ${((calcInputs.premiumPrice * 23800000)/1e6).toFixed(0)}M</div>
              </div>
              <div style={{marginTop:12}}>
                <div style={{fontSize:9,color:T.textDim,fontWeight:700,marginBottom:6}}>PREMIUM SENSITIVITY TABLE</div>
                <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:2}}>
                  <div style={{fontSize:7,color:T.textDim,textAlign:'center',padding:3}}>NAV ↓ Price→</div>
                  {[20,24,28,32].map(p=><div key={p} style={{fontSize:8,fontFamily:mono,color:T.textDim,textAlign:'center',padding:3}}>${p}</div>)}
                  {[8,10,12,14].map(n=>(
                    <React.Fragment key={n}>
                      <div style={{fontSize:8,fontFamily:mono,color:T.textDim,textAlign:'center',padding:3}}>${n}</div>
                      {[20,24,28,32].map(p=>{const prem=((p/n-1)*100);return(
                        <div key={p} style={{fontSize:9,fontFamily:mono,fontWeight:600,textAlign:'center',padding:3,background:prem>=100?T.green+'15':prem>=50?T.blue+'10':prem>=0?T.accent+'08':T.red+'10',borderRadius:2,color:prem>=0?T.green:T.red}}>{prem>=0?'+':''}{prem.toFixed(0)}%</div>
                      );})}
                    </React.Fragment>
                  ))}
                </div>
              </div>
            </div>
          </Card>
          <Card title="🏗️ ATM Accretion Calculator" style={{borderTop:`3px solid ${T.green}`}}>
            <div style={{padding:'16px 18px'}}>
              <CalcInput label="Daily Shares" k="atmShares" unit="shs" min={0} step={1000} w={80}/>
              <CalcInput label="Sale Premium" k="atmPremium" unit="%" min={0} step={1}/>
              <CalcInput label="NAV/Share" k="premiumNav" unit="$" min={0} step={0.01}/>
              <CalcInput label="Sale Price" k="premiumPrice" unit="$" min={0} step={0.01}/>
              <div style={{marginTop:16,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.green}30`}}>
                <div style={{fontSize:9,color:T.textDim,marginBottom:4}}>DAILY ATM IMPACT</div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:8,color:T.textDim}}>Gross Proceeds</div>
                    <div style={{fontSize:18,fontWeight:900,fontFamily:mono,color:T.green}}>${(calcInputs.atmShares * calcInputs.premiumPrice / 1e6).toFixed(2)}M</div>
                  </div>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:8,color:T.textDim}}>NAV Accretion</div>
                    <div style={{fontSize:18,fontWeight:900,fontFamily:mono,color:T.accent}}>+{calcAtmAccretion.toFixed(3)}%</div>
                  </div>
                </div>
                <div style={{marginTop:8,fontSize:9,color:T.textMuted,textAlign:'center'}}>
                  Selling at {calcInputs.atmPremium}% premium → every share sold adds ${((calcInputs.premiumPrice - calcInputs.premiumNav) / (23800000 + calcInputs.atmShares) * calcInputs.atmShares).toFixed(4)}/sh to NAV
                </div>
              </div>
              <div style={{marginTop:12}}>
                <div style={{fontSize:9,color:T.textDim,fontWeight:700,marginBottom:6}}>ANNUAL ATM PROJECTION (252 trading days)</div>
                {[10000,25000,40000,60000,80000].map(daily=>{
                  const annual=daily*252;const proceeds=daily*calcInputs.premiumPrice*252/1e6;
                  const accr=(daily * calcInputs.premiumPrice * (calcInputs.atmPremium / (100 + calcInputs.atmPremium))) / (23800000 * calcInputs.premiumNav) * 100 * 252;
                  return(<div key={daily} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:`1px solid ${T.border}`,fontSize:10}}>
                    <span style={{fontFamily:mono,color:daily===calcInputs.atmShares?T.accent:T.textDim,fontWeight:daily===calcInputs.atmShares?700:400}}>{(daily/1000).toFixed(0)}K/day</span>
                    <span style={{fontFamily:mono,color:T.text}}>{(annual/1e6).toFixed(1)}M shs</span>
                    <span style={{fontFamily:mono,color:T.green}}>${proceeds.toFixed(0)}M</span>
                    <span style={{fontFamily:mono,fontWeight:700,color:T.accent}}>+{accr.toFixed(1)}% NAV</span>
                  </div>);
                })}
              </div>
            </div>
          </Card>
          <Card title="📉 Dilution Impact Calculator" style={{borderTop:`3px solid ${T.purple}`}}>
            <div style={{padding:'16px 18px'}}>
              <CalcInput label="Current Shares" k="dilShares" unit="shs" min={1} step={100000} w={90}/>
              <CalcInput label="New Shares" k="dilNewShares" unit="shs" min={0} step={10000} w={90}/>
              <CalcInput label="Issue Price" k="dilPrice" unit="$" min={0} step={0.01}/>
              <CalcInput label="Current NAV" k="dilNav" unit="$" min={0} step={0.01}/>
              <div style={{marginTop:16,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.purple}30`}}>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:8}}>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:8,color:T.textDim}}>Ownership Dilution</div>
                    <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:T.red}}>-{calcDilution.toFixed(2)}%</div>
                  </div>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:8,color:T.textDim}}>NAV Accretion</div>
                    <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:calcDilNavAccretion>=0?T.green:T.red}}>{calcDilNavAccretion>=0?'+':''}{calcDilNavAccretion.toFixed(2)}%</div>
                  </div>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:8,color:T.textDim}}>New NAV/Share</div>
                    <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:T.accent}}>${((calcInputs.dilShares*calcInputs.dilNav+calcInputs.dilNewShares*calcInputs.dilPrice)/(calcInputs.dilShares+calcInputs.dilNewShares)).toFixed(2)}</div>
                  </div>
                </div>
              </div>
              <div style={{marginTop:12,padding:10,background:calcDilNavAccretion>=0?T.green+'08':T.red+'08',borderRadius:6,border:`1px solid ${calcDilNavAccretion>=0?T.green:T.red}30`}}>
                <div style={{fontSize:10,fontWeight:700,color:calcDilNavAccretion>=0?T.green:T.red}}>
                  {calcDilNavAccretion>=0?'✓ NAV ACCRETIVE':'⚠ NAV DILUTIVE'} — Issue price ${calcInputs.dilPrice.toFixed(2)} {calcInputs.dilPrice>=calcInputs.dilNav?'>':'<'} NAV ${calcInputs.dilNav.toFixed(2)}
                </div>
                <div style={{fontSize:9,color:T.textMuted,marginTop:3}}>
                  Issuing {(calcInputs.dilNewShares/1000).toFixed(0)}K shares at ${calcInputs.dilPrice.toFixed(2)} raises ${(calcInputs.dilNewShares*calcInputs.dilPrice/1e6).toFixed(1)}M.
                  {calcDilNavAccretion>=0?' The premium to NAV means every new share increases existing shareholders\' NAV.':' Issuing below NAV destroys value for existing shareholders.'}
                </div>
              </div>
              <div style={{marginTop:12}}>
                <div style={{fontSize:9,color:T.textDim,fontWeight:700,marginBottom:6}}>SECONDARY PRICING CALCULATOR</div>
                <CalcInput label="Entry (¢/$)" k="secBid" unit="¢" min={1} max={200} step={1}/>
                <CalcInput label="Hold Period" k="secHoldYears" unit="yr" min={0.5} max={10} step={0.5}/>
                <div style={{marginTop:8,padding:8,background:T.bgAccent,borderRadius:6,textAlign:'center'}}>
                  <div style={{fontSize:8,color:T.textDim}}>IMPLIED IRR (to par)</div>
                  <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:calcSecondaryReturn>20?T.green:calcSecondaryReturn>10?T.blue:T.amber}}>{calcSecondaryReturn.toFixed(1)}%</div>
                </div>
              </div>
            </div>
          </Card>
        </div>
        )}

        {/* ── SCENARIO MODE — Slider-driven what-if modeling ── */}
        {getMode('premdisc','dashboard')==='scenarios'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 2fr',gap:14}}>
          <Card title="🎚️ Scenario Controls" style={{position:'sticky',top:0}}>
            <div style={{padding:'14px 18px'}}>
              <SliderInput label="Anthropic Valuation" k="anthropicVal" min={20} max={200} step={5} unit="B" fmt={v=>`$${v}B`}/>
              <SliderInput label="SpaceX Valuation" k="spaceXVal" min={100} max={800} step={25} unit="B" fmt={v=>`$${v}B`}/>
              <SliderInput label="IPO Timing" k="ipoTiming" min={3} max={36} step={3} unit="mo" fmt={v=>`${v} months`}/>
              <SliderInput label="AI Revenue Multiple" k="aiMultiple" min={5} max={40} step={1} unit="x" fmt={v=>`${v}x revenue`}/>
              <SliderInput label="Rate Change" k="rateChange" min={-200} max={200} step={25} unit="bps" fmt={v=>`${v>0?'+':''}${v}bps`}/>
              <SliderInput label="Target Premium" k="premiumTarget" min={50} max={400} step={10} unit="%" fmt={v=>`+${v}%`}/>
              <div style={{marginTop:14,padding:10,background:T.bgAccent,borderRadius:6}}>
                <div style={{fontSize:9,color:T.textDim,marginBottom:4}}>COMPOSITE SCENARIO OUTPUT</div>
                {(()=>{
                  const baseNav=9.84;
                  const anthroImpact=(sc.anthropicVal-75)/75*0.249*baseNav;
                  const spxImpact=(sc.spaceXVal-350)/350*0.186*baseNav;
                  const multImpact=(sc.aiMultiple-18)/18*0.6*baseNav;
                  const rateImpact=sc.rateChange/100*-0.042*baseNav;
                  const scenNav=baseNav+anthroImpact+spxImpact+multImpact+rateImpact;
                  const scenPrice=scenNav*(1+sc.premiumTarget/100);
                  const scenMktCap=scenPrice*23800000/1e6;
                  return(<>
                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6}}>
                      {[
                        {l:'Scenario NAV',v:`$${scenNav.toFixed(2)}`,c:scenNav>baseNav?T.green:T.red},
                        {l:'Scenario Price',v:`$${scenPrice.toFixed(2)}`,c:T.accent},
                        {l:'NAV Δ',v:`${scenNav>baseNav?'+':''}${((scenNav/baseNav-1)*100).toFixed(1)}%`,c:scenNav>baseNav?T.green:T.red},
                        {l:'Mkt Cap',v:`$${scenMktCap.toFixed(0)}M`,c:T.purple},
                      ].map((m,i)=>(<div key={i} style={{background:T.bg,borderRadius:4,padding:'6px 8px',textAlign:'center'}}>
                        <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
                        <div style={{fontSize:14,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div>
                      </div>))}
                    </div>
                    <div style={{marginTop:8,fontSize:9,color:T.textDim}}>
                      NAV Breakdown: Anthropic {anthroImpact>=0?'+':''}{anthroImpact.toFixed(2)}, SpaceX {spxImpact>=0?'+':''}{spxImpact.toFixed(2)}, Multiples {multImpact>=0?'+':''}{multImpact.toFixed(2)}, Rates {rateImpact>=0?'+':''}{rateImpact.toFixed(2)}
                    </div>
                  </>);
                })()}
              </div>
            </div>
          </Card>
          <div>
            <Card title="Scenario Impact Waterfall — NAV Bridge from Current to Scenario" style={{marginBottom:14}}>
              <div style={{padding:'18px'}}>
                {(()=>{
                  const baseNav=9.84;
                  const items=[
                    {l:'Current NAV',v:baseNav,cum:baseNav,type:'base'},
                    {l:`Anthropic → $${sc.anthropicVal}B`,v:(sc.anthropicVal-75)/75*0.249*baseNav,cum:0,type:'delta'},
                    {l:`SpaceX → $${sc.spaceXVal}B`,v:(sc.spaceXVal-350)/350*0.186*baseNav,cum:0,type:'delta'},
                    {l:`AI Multiple → ${sc.aiMultiple}x`,v:(sc.aiMultiple-18)/18*0.6*baseNav,cum:0,type:'delta'},
                    {l:`Rates ${sc.rateChange>0?'+':''}${sc.rateChange}bps`,v:sc.rateChange/100*-0.042*baseNav,cum:0,type:'delta'},
                  ];
                  let running=baseNav;items.forEach((it,i)=>{if(i>0){running+=it.v;it.cum=running;}});
                  items.push({l:'Scenario NAV',v:running,cum:running,type:'total'});
                  return items.map((it,i)=>(<div key={i} style={{display:'flex',alignItems:'center',padding:'8px 0',borderBottom:i<items.length-1?`1px solid ${T.border}`:'none'}}>
                    <span style={{fontSize:11,fontWeight:it.type!=='delta'?700:400,color:T.text,width:160}}>{it.l}</span>
                    <div style={{flex:1,height:24,position:'relative'}}>
                      {it.type==='delta'&&<div style={{position:'absolute',left:it.v>=0?'50%':'auto',right:it.v<0?'50%':'auto',width:`${Math.min(45,Math.abs(it.v)/baseNav*200)}%`,height:'100%',background:it.v>=0?T.green+'40':T.red+'40',borderRadius:3}}/>}
                      {it.type==='base'&&<div style={{position:'absolute',left:0,width:'50%',height:'100%',background:T.accent+'30',borderRadius:3}}/>}
                      {it.type==='total'&&<div style={{position:'absolute',left:0,width:`${Math.min(90,(it.v/baseNav)*50)}%`,height:'100%',background:it.v>=baseNav?T.green+'40':T.red+'40',borderRadius:3}}/>}
                    </div>
                    <span style={{fontSize:13,fontFamily:mono,fontWeight:700,width:70,textAlign:'right',color:it.type==='delta'?(it.v>=0?T.green:T.red):T.accent}}>{it.type==='delta'?(it.v>=0?'+':'')+it.v.toFixed(2):'$'+it.v.toFixed(2)}</span>
                  </div>));
                })()}
              </div>
            </Card>
            <Card title="IPO Timing Sensitivity — NAV Impact by Quarter">
              <div style={{padding:'14px 18px'}}>
                <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
                  {[
                    {q:'Q2 2026',mos:4,navUplift:'+22.4%',events:'Anduril IPO',prob:'35%'},
                    {q:'Q3 2026',mos:7,navUplift:'+31.2%',events:'Anduril + Stripe',prob:'25%'},
                    {q:'Q4 2026',mos:10,navUplift:'+38.8%',events:'Anduril + Stripe + Databricks',prob:'20%'},
                    {q:'2027+',mos:18,navUplift:'+48.5%',events:'Full pipeline execution',prob:'15%'},
                  ].map((t,i)=>{
                    const isActive=sc.ipoTiming>=t.mos-2&&sc.ipoTiming<=t.mos+2;
                    return(<div key={i} style={{padding:12,background:isActive?T.accent+'10':T.bgCard,borderRadius:8,border:`1px solid ${isActive?T.accent+'40':T.border}`,textAlign:'center'}}>
                      <div style={{fontSize:12,fontWeight:700,color:isActive?T.accent:T.text}}>{t.q}</div>
                      <div style={{fontSize:20,fontWeight:900,fontFamily:mono,color:T.green}}>{t.navUplift}</div>
                      <div style={{fontSize:9,color:T.textMuted}}>{t.events}</div>
                      <div style={{fontSize:8,color:T.textDim,marginTop:4}}>Probability: {t.prob}</div>
                    </div>);
                  })}
                </div>
              </div>
            </Card>
          </div>
        </div>
        )}
      </div>)}

      {aView==='shareholder'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Shares Outstanding',v:'23.9M',d:'fully diluted',c:T.accent},
            {l:'Institutional %',v:'34.2%',d:'per latest 13F',c:T.blue},
            {l:'Retail %',v:'47.8%',d:'estimated via broker data',c:T.green},
            {l:'Short Interest',v:'18.4%',d:'4.4M shares short',c:T.red},
            {l:'Days to Cover',v:'17.8',d:'at avg daily volume',c:T.amber},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Top Institutional Holders — 13F Analysis (Latest Filings)" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Institution','Type','Shares','% Outstanding','Market Value','Change','Filed','Strategy'].map(h=><TH key={h} align={['Institution','Type','Strategy'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {inst:'Vanguard Group',type:'Index',shares:'1.82M',pct:'7.6%',mv:'$44.4M',chg:'+285K',filed:'Q4 2025',strat:'Passive inclusion'},
              {inst:'BlackRock',type:'Index',shares:'1.45M',pct:'6.1%',mv:'$35.4M',chg:'+142K',filed:'Q4 2025',strat:'Russell 2000 inclusion'},
              {inst:'Renaissance Technologies',type:'Quant',shares:'680K',pct:'2.8%',mv:'$16.6M',chg:'NEW',filed:'Q4 2025',strat:'Premium/NAV arb model'},
              {inst:'Citadel Advisors',type:'Hedge Fund',shares:'520K',pct:'2.2%',mv:'$12.7M',chg:'+320K',filed:'Q4 2025',strat:'Event-driven / IPO catalyst'},
              {inst:'Two Sigma',type:'Quant',shares:'385K',pct:'1.6%',mv:'$9.4M',chg:'NEW',filed:'Q4 2025',strat:'Statistical arbitrage'},
              {inst:'Goldman Sachs Asset Mgmt',type:'Multi-Strat',shares:'340K',pct:'1.4%',mv:'$8.3M',chg:'+180K',filed:'Q4 2025',strat:'AI thematic basket'},
              {inst:'ARK Investment Mgmt',type:'Thematic',shares:'290K',pct:'1.2%',mv:'$7.1M',chg:'NEW',filed:'Q4 2025',strat:'Innovation / disruption'},
              {inst:'Dimensional Fund Advisors',type:'Quant Value',shares:'245K',pct:'1.0%',mv:'$6.0M',chg:'+85K',filed:'Q4 2025',strat:'Small-cap value factor'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.inst}</TD>
              <TD><Badge color={r.type==='Index'?T.blue:r.type==='Quant'?T.purple:r.type==='Hedge Fund'?T.accent:T.green}>{r.type}</Badge></TD>
              <TD align="right" mono>{r.shares}</TD>
              <TD align="right" mono bold>{r.pct}</TD>
              <TD align="right" mono>{r.mv}</TD>
              <TD align="right" mono bold color={r.chg==='NEW'?T.accent:r.chg.startsWith('+')?T.green:T.red}>{r.chg}</TD>
              <TD align="right" color={T.textDim}>{r.filed}</TD>
              <TD color={T.textMuted}>{r.strat}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Cost Basis Clustering — Where Did Shareholders Buy In?">
            <div style={{padding:'14px 18px'}}>
              {[
                {range:'$5-$10',pct:18,shares:'4.3M',status:'Deep in-the-money',c:T.green},
                {range:'$10-$15',pct:22,shares:'5.3M',status:'In-the-money',c:T.green},
                {range:'$15-$20',pct:28,shares:'6.7M',status:'Moderate profit',c:T.blue},
                {range:'$20-$25',pct:20,shares:'4.8M',status:'Near current price',c:T.amber},
                {range:'$25-$30',pct:12,shares:'2.9M',status:'Underwater or break-even',c:T.red},
              ].map((b,i)=>(<div key={i} style={{marginBottom:8}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                  <span style={{fontSize:11,fontWeight:600,fontFamily:mono,color:T.text}}>{b.range}</span>
                  <span style={{fontSize:10,color:T.textMuted}}>{b.shares} shares · {b.status}</span>
                </div>
                <div style={{height:16,background:T.bgAccent,borderRadius:4,overflow:'hidden'}}>
                  <div style={{width:`${b.pct}%`,height:'100%',background:b.c,borderRadius:4,display:'flex',alignItems:'center',paddingLeft:6}}>
                    <span style={{fontSize:9,fontWeight:700,color:T.bg}}>{b.pct}%</span>
                  </div>
                </div>
              </div>))}
            </div>
          </Card>
          <Card title="Short Interest Dynamics">
            <div style={{padding:'14px 18px'}}>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:14}}>
                {[
                  {l:'Short Shares',v:'4.4M',c:T.red},
                  {l:'SI % Float',v:'18.4%',c:T.red},
                  {l:'Borrow Cost',v:'38.2%',c:T.amber},
                  {l:'Squeeze Score',v:'87/100',c:T.accent},
                ].map((s,i)=>(<div key={i} style={{padding:8,background:T.bgAccent,borderRadius:6,textAlign:'center'}}>
                  <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{s.l}</div>
                  <div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:s.c}}>{s.v}</div>
                </div>))}
              </div>
              <div style={{fontSize:11,color:T.text,fontWeight:600,marginBottom:8}}>Short Squeeze Risk Assessment</div>
              <div style={{fontSize:10,color:T.textMuted,lineHeight:1.5}}>
                High short interest (18.4%) combined with low float (23.9M shares) and high borrow cost (38.2% annualized) creates significant squeeze potential. Days-to-cover of 17.8 means shorts need nearly 4 weeks of average volume to cover. Any positive catalyst (portfolio company IPO, NAV uplift) could trigger forced covering.
              </div>
              <div style={{marginTop:8,padding:8,background:T.red+'10',borderRadius:6,border:`1px solid ${T.red}30`}}>
                <div style={{fontSize:10,fontWeight:700,color:T.red}}>⚠ ALERT: Cost to borrow increased 400bps this week — shorts under pressure</div>
              </div>
            </div>
          </Card>
        </div>
      </div>)}

      {aView==='ircommand'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Analyst Coverage',v:'3',d:'1 Buy, 2 Initiate',c:T.accent},
            {l:'Next Earnings',v:'Mar 28',d:'Q4 2025 results',c:T.amber},
            {l:'Investor Meetings (YTD)',v:'47',d:'32 1-on-1s + 15 group',c:T.blue},
            {l:'Perception Score',v:'74/100',d:'up from 62 last quarter',c:T.green},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Earnings Call Preparation — Q4 2025 Script Builder" style={{marginBottom:14}}>
          <div style={{padding:0}}>{[
            {section:'Opening Remarks',owner:'Jason',status:'Draft',time:'5 min',notes:'Fund performance, thesis reinforcement, key catalysts ahead'},
            {section:'Financial Review',owner:'Ken',status:'Complete',time:'8 min',notes:'NAV bridge, fee analysis, cash flow waterfall, portfolio attribution'},
            {section:'Portfolio Update',owner:'Ken + Brett',status:'In Review',time:'10 min',notes:'Top 10 holdings update, new positions, exits, IPO pipeline'},
            {section:'Shareholder Engagement Update',owner:'Bob',status:'Not Started',time:'3 min',notes:'New institutional holders, platform approvals, IR activity recap'},
            {section:'Outlook & Guidance',owner:'Jason',status:'Not Started',time:'4 min',notes:'2026 commitment pacing, distribution forecast, premium discussion'},
            {section:'Q&A Session',owner:'All',status:'Prep Needed',time:'20 min',notes:'Pre-seed Q&A bank with 85+ anticipated questions and approved answers'},
          ].map((s,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:12}}>
            <div style={{width:24,height:24,borderRadius:12,background:s.status==='Complete'?T.green+'20':s.status==='Draft'||s.status==='In Review'?T.amber+'20':T.red+'20',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
              <span style={{fontSize:10}}>{s.status==='Complete'?'✓':s.status==='Draft'?'✎':s.status==='In Review'?'◐':'!'}</span>
            </div>
            <div style={{flex:1}}>
              <div style={{fontSize:12,fontWeight:600,color:T.text}}>{s.section}</div>
              <div style={{fontSize:10,color:T.textMuted}}>{s.notes}</div>
            </div>
            <Badge color={T.blue}>{s.owner}</Badge>
            <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>{s.time}</span>
            <Badge color={s.status==='Complete'?T.green:s.status==='Draft'||s.status==='In Review'?T.amber:T.red}>{s.status}</Badge>
          </div>))}</div>
        </Card>
        <Card title="Q&A Bank — Pre-Seeded Investor Questions & Approved Answers">
          <div style={{padding:0}}>{[
            {cat:'Premium',q:'Why does the stock trade at such a high premium to NAV?',a:'Unique access vehicle to pre-IPO AI Safety companies. Scarcity premium from limited float. Multiple IPO catalysts in 12-18mo pipeline.',freq:28},
            {cat:'NAV',q:'How often is NAV updated and what methodology is used?',a:'Quarterly under ASC 820 with independent valuation agents (Houlihan Lokey, Lincoln International). FVC governance with board approval.',freq:22},
            {cat:'Portfolio',q:'What is your largest position and concentration risk?',a:'Anthropic at 24.9% of NAV. Managed through position limits, co-invest diversification, and secondary market hedging opportunities.',freq:18},
            {cat:'Fees',q:'What is the total expense ratio including look-through fees?',a:'Direct management fee 1.75% + underlying GP fees avg 1.92% = total AFFE ~3.67%. Competitive vs direct VC fund access.',freq:15},
            {cat:'Catalysts',q:'What IPO events could impact NAV in the next 12 months?',a:'SpaceX tender/IPO H2 2026, Stripe S-1 expected Q2, Anduril S-1 imminent, Databricks preparing. Combined could drive 40-60% NAV uplift.',freq:14},
            {cat:'Capital',q:'Any plans for share buyback or tender offer to narrow the premium?',a:'Evaluating all capital markets tools. Board authorized $15M buyback program at appropriate discount levels. ATM program active.',freq:12},
          ].map((q,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
              <div style={{display:'flex',alignItems:'center',gap:6}}><Badge color={T.purple}>{q.cat}</Badge><span style={{fontSize:12,fontWeight:600,color:T.text}}>{q.q}</span></div>
              <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{q.freq}x asked</span>
            </div>
            <div style={{fontSize:11,color:T.textMuted,lineHeight:1.4,padding:'4px 0 0 8px',borderLeft:`2px solid ${T.accent}30`}}>{q.a}</div>
          </div>))}</div>
        </Card>
      </div>)}

      {aView==='compliance'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Filing Status',v:'CURRENT',d:'all SEC filings current',c:T.green},
            {l:'Next Filing',v:'N-PORT',d:'due Apr 30, 2026',c:T.amber},
            {l:'Trading Window',v:'CLOSED',d:'reopens Mar 30',c:T.red},
            {l:'Compliance Score',v:'98.5',d:'2 minor findings YTD',c:T.accent},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="SEC Filing Calendar — 1940 Act Compliance Requirements" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Filing','Form','Deadline','Status','Preparer','Reviewer','Notes'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {filing:'Annual Report',form:'N-CSR',deadline:'Mar 10, 2026',status:'In Progress',prep:'KPMG + Matthew',rev:'Jason',notes:'Includes audited financials, portfolio schedule'},
              {filing:'Semi-Annual Report',form:'N-CSRS',deadline:'Sep 10, 2026',status:'Upcoming',prep:'KPMG + Matthew',rev:'Ken',notes:'Unaudited semi-annual financial statements'},
              {filing:'Monthly Portfolio',form:'N-PORT',deadline:'Apr 30, 2026',status:'Not Started',prep:'Fund Admin',rev:'Ken',notes:'Monthly portfolio holdings, risk metrics, flow data'},
              {filing:'Annual Update',form:'N-CEN',deadline:'Apr 30, 2026',status:'Not Started',prep:'Counsel',rev:'Jason',notes:'Annual census report to SEC'},
              {filing:'Proxy Statement',form:'DEF 14A',deadline:'Jun 15, 2026',status:'Not Started',prep:'Counsel + IR',rev:'Board',notes:'Annual shareholder meeting proxy materials'},
              {filing:'Insider Transactions',form:'Form 4',deadline:'Within 2 biz days',status:'Ongoing',prep:'Compliance',rev:'Counsel',notes:'All officer/director trades reported within 48hrs'},
              {filing:'Ownership Threshold',form:'13F',deadline:'May 15, 2026',status:'Upcoming',prep:'Fund Admin',rev:'Ken',notes:'Quarterly institutional holdings report'},
            ].map((f,i)=>(<TR key={i}>
              <TD bold>{f.filing}</TD>
              <TD><Badge color={T.blue}>{f.form}</Badge></TD>
              <TD mono color={f.status==='In Progress'?T.amber:f.status==='Not Started'?T.textDim:T.text}>{f.deadline}</TD>
              <TD><Badge color={f.status==='In Progress'?T.amber:f.status==='Upcoming'?T.blue:f.status==='Ongoing'?T.green:T.textDim}>{f.status}</Badge></TD>
              <TD color={T.textMuted}>{f.prep}</TD>
              <TD color={T.textMuted}>{f.rev}</TD>
              <TD color={T.textDim}>{f.notes}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="1940 Act Compliance Checklist">
            <div style={{padding:0}}>{[
              {req:'Leverage Limit (33.3% of total assets)',status:'Pass',current:'0% — no leverage used',risk:'Low'},
              {req:'Diversification Test (75/5/10 rule)',status:'Pass',current:'No single fund >10% at cost',risk:'Low'},
              {req:'Illiquid Asset Limit (15%)',status:'N/A',current:'CEF exempt from liquidity rule',risk:'N/A'},
              {req:'Independent Director Majority',status:'Pass',current:'3 of 5 directors independent',risk:'Low'},
              {req:'Annual Shareholder Meeting',status:'Scheduled',current:'Jun 28, 2026 — proxy being prepared',risk:'Medium'},
              {req:'Code of Ethics (Rule 17j-1)',status:'Pass',current:'Annual certification completed Jan 2026',risk:'Low'},
              {req:'Anti-Fraud Compliance (Rule 38a-1)',status:'Pass',current:'CCO annual review completed',risk:'Low'},
              {req:'Custody Rule Compliance',status:'Pass',current:'Assets held at BNY Mellon',risk:'Low'},
            ].map((r,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<7?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <div style={{width:8,height:8,borderRadius:4,background:r.status==='Pass'?T.green:r.status==='Scheduled'?T.amber:T.textDim,flexShrink:0}}/>
              <div style={{flex:1}}>
                <div style={{fontSize:11,fontWeight:600,color:T.text}}>{r.req}</div>
                <div style={{fontSize:10,color:T.textMuted}}>{r.current}</div>
              </div>
              <Badge color={r.risk==='Low'?T.green:r.risk==='Medium'?T.amber:r.risk==='N/A'?T.textDim:T.red}>{r.risk}</Badge>
            </div>))}</div>
          </Card>
          <Card title="Insider Trading Windows & Pre-Clearance">
            <div style={{padding:'14px 18px'}}>
              <div style={{padding:12,background:T.red+'10',borderRadius:8,border:`1px solid ${T.red}30`,marginBottom:14}}>
                <div style={{fontSize:14,fontWeight:800,color:T.red,marginBottom:4}}>TRADING WINDOW: CLOSED</div>
                <div style={{fontSize:11,color:T.text}}>Blackout period active: Feb 1 — Mar 30, 2026</div>
                <div style={{fontSize:10,color:T.textMuted}}>Reason: Q4 2025 earnings preparation and NAV mark finalization</div>
              </div>
              {[
                {name:'Jason Goldman',role:'Operating Partner',lastTrade:'Nov 12, 2025',shares:'12,500 acquired',status:'No pending'},
                {name:'Ken Wallace',role:'Managing Partner',lastTrade:'Oct 8, 2025',shares:'8,200 acquired',status:'No pending'},
                {name:'Brett Brewer',role:'Partner',lastTrade:'Dec 15, 2025',shares:'5,000 acquired',status:'No pending'},
                {name:'Bob Burlinson',role:'Head of Distribution',lastTrade:'None',shares:'—',status:'No trades'},
              ].map((p,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<3?`1px solid ${T.border}`:'none',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div><div style={{fontSize:11,fontWeight:600,color:T.text}}>{p.name}</div><div style={{fontSize:9,color:T.textDim}}>{p.role}</div></div>
                <div style={{textAlign:'right'}}><div style={{fontSize:10,fontFamily:mono,color:T.textMuted}}>{p.lastTrade}</div><div style={{fontSize:9,color:T.textDim}}>{p.shares}</div></div>
              </div>))}
            </div>
          </Card>
        </div>
      </div>)}

      {aView==='capmarkets'&&(<div>
        {/* ── MODE TOGGLE ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['overview','simulator','buyback'].map(m=>(
              <FilterPill key={m} label={m==='overview'?'📊 Overview':m==='simulator'?'🎚️ ATM Simulator':'🔄 Buyback'} active={getMode('capmarkets','overview')===m} onClick={()=>setMode('capmarkets',m)}/>
            ))}
          </div>
        </div>

        {/* ── OVERVIEW MODE (default) ── */}
        {getMode('capmarkets','overview')==='overview'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'ATM Capacity',v:'$28.5M',d:'remaining of $50M program',c:T.accent},
            {l:'Buyback Auth',v:'$15M',d:'$4.2M executed YTD',c:T.blue},
            {l:'Shelf Registration',v:'$200M',d:'S-3 effective Nov 2025',c:T.green},
            {l:'Shares in Treasury',v:'420K',d:'from buyback program',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="ATM Program Analytics — At-the-Market Offering Performance" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Month','Shares Sold','Avg Price','Gross Proceeds','Commission','Net Proceeds','NAV/Share','Premium Captured'].map(h=><TH key={h} align={h==='Month'?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {month:'Oct 2025',shares:'180K',price:'$22.45',gross:'$4.04M',comm:'$80.8K',net:'$3.96M',nav:'$9.42',prem:'+138%'},
              {month:'Nov 2025',shares:'145K',price:'$24.80',gross:'$3.60M',comm:'$72.0K',net:'$3.53M',nav:'$9.58',prem:'+159%'},
              {month:'Dec 2025',shares:'92K',price:'$26.12',gross:'$2.40M',comm:'$48.1K',net:'$2.35M',nav:'$9.72',prem:'+169%'},
              {month:'Jan 2026',shares:'118K',price:'$23.90',gross:'$2.82M',comm:'$56.4K',net:'$2.76M',nav:'$9.84',prem:'+143%'},
              {month:'Feb 2026',shares:'65K',price:'$24.38',gross:'$1.58M',comm:'$31.7K',net:'$1.55M',nav:'$9.84',prem:'+148%'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.month}</TD>
              <TD align="right" mono>{r.shares}</TD>
              <TD align="right" mono>{r.price}</TD>
              <TD align="right" mono bold>{r.gross}</TD>
              <TD align="right" mono color={T.red}>{r.comm}</TD>
              <TD align="right" mono bold color={T.green}>{r.net}</TD>
              <TD align="right" mono>{r.nav}</TD>
              <TD align="right" mono bold color={T.accent}>{r.prem}</TD>
            </TR>))}</tbody>
          </table></div>
          <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,display:'flex',justifyContent:'space-between'}}>
            <span style={{fontSize:11,fontWeight:700,color:T.text}}>Total ATM Proceeds (Program to Date)</span>
            <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:T.green}}>$14.15M net at avg +151% premium</span>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Capital Allocation Decision Matrix">
            <div style={{padding:0}}>{[
              {action:'ATM Issuance (sell shares at premium)',trigger:'Premium >100% to NAV',nav_impact:'+$0.05-0.12/share',status:'Active',detail:'Dilutive to premium but accretive to NAV/share when premium exceeds fees'},
              {action:'Share Buyback',trigger:'Stock trades at discount to NAV',nav_impact:'+$0.08-0.15/share',status:'Authorized',detail:'$15M authorized. Activates if stock drops below NAV. Currently premium.'},
              {action:'Rights Offering',trigger:'Large investment opportunity',nav_impact:'Neutral',status:'Shelf Ready',detail:'$200M shelf registration. Pro-rata offering to existing shareholders'},
              {action:'Tender Offer',trigger:'Persistent deep discount',nav_impact:'+$0.10-0.20/share',status:'Not Active',detail:'Buy back shares at slight premium to market but discount to NAV'},
              {action:'Special Distribution',trigger:'Realized gains from IPO/exit',nav_impact:'Reduces NAV',status:'Under Review',detail:'Distribute realized proceeds. Signals to market, could narrow premium'},
            ].map((a,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<4?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <span style={{fontSize:12,fontWeight:600,color:T.text}}>{a.action}</span>
                <Badge color={a.status==='Active'?T.green:a.status==='Authorized'?T.blue:a.status==='Shelf Ready'?T.purple:a.status==='Under Review'?T.amber:T.textDim}>{a.status}</Badge>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:3}}>{a.detail}</div>
              <div style={{display:'flex',gap:12}}>
                <span style={{fontSize:9,color:T.accent}}>Trigger: {a.trigger}</span>
                <span style={{fontSize:9,color:T.green}}>NAV Impact: {a.nav_impact}</span>
              </div>
            </div>))}</div>
          </Card>
          <Card title="Dilution Impact Modeling">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:11,color:T.textDim,marginBottom:10}}>Scenario analysis: ATM issuance at various premium levels</div>
              {[
                {prem:'+50%',shares:'2.0M',proceeds:'$29.5M',navBefore:'$9.84',navAfter:'$10.60',accretion:'+7.7%',verdict:'Highly accretive'},
                {prem:'+100%',shares:'1.5M',proceeds:'$29.5M',navBefore:'$9.84',navAfter:'$10.62',accretion:'+7.9%',verdict:'Highly accretive'},
                {prem:'+150%',shares:'1.2M',proceeds:'$29.5M',navBefore:'$9.84',navAfter:'$10.63',accretion:'+8.0%',verdict:'Highly accretive'},
                {prem:'+200%',shares:'1.0M',proceeds:'$29.5M',navBefore:'$9.84',navAfter:'$10.64',accretion:'+8.1%',verdict:'Highly accretive'},
                {prem:'0% (at NAV)',shares:'3.0M',proceeds:'$29.5M',navBefore:'$9.84',navAfter:'$9.82',accretion:'-0.2%',verdict:'Slightly dilutive (fees)'},
              ].map((s,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<4?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',justifyContent:'space-between'}}>
                <div>
                  <span style={{fontSize:12,fontWeight:700,fontFamily:mono,color:T.accent}}>{s.prem}</span>
                  <span style={{fontSize:10,color:T.textMuted,marginLeft:8}}>{s.shares} new shares</span>
                </div>
                <div style={{textAlign:'right'}}>
                  <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:parseFloat(s.accretion)>0?T.green:T.red}}>{s.accretion}</span>
                  <span style={{fontSize:9,color:T.textDim,marginLeft:6}}>NAV: {s.navBefore}→{s.navAfter}</span>
                </div>
              </div>))}
            </div>
          </Card>
        </div>
        </>)}

        {/* ── ATM SIMULATOR MODE — Live what-if modeling ── */}
        {getMode('capmarkets','overview')==='simulator'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 2fr',gap:14}}>
          <Card title="🎚️ ATM Parameters" style={{position:'sticky',top:0}}>
            <div style={{padding:'14px 18px'}}>
              <SliderInput label="Daily Share Volume" k="atmDaily" min={5000} max={100000} step={5000} unit="sh" fmt={v=>`${(v/1000).toFixed(0)}K shares/day`}/>
              <SliderInput label="Sale Premium (%)" k="premiumTarget" min={50} max={300} step={10} unit="%" fmt={v=>`${v}% premium`}/>
              <SliderInput label="Commission Rate" k="feeBase" min={0.5} max={3} step={0.25} unit="%" fmt={v=>`${v}% commission`}/>
              <CalcInput label="Trading Days" k="atmTradingDays" unit="days" min={1} max={252} step={1}/>
              <div style={{marginTop:16,padding:14,background:T.bgAccent,borderRadius:8,border:`1px solid ${T.accent}30`}}>
                {(()=>{
                  const dailyShares=sc.atmDaily||25000;
                  const premium=(sc.premiumTarget||148)/100;
                  const commission=(sc.feeBase||1.75)/100;
                  const tradingDays=calcInputs.atmTradingDays||60;
                  const navPerShare=9.84;
                  const salePrice=navPerShare*(1+premium);
                  const totalShares=dailyShares*tradingDays;
                  const grossProceeds=totalShares*salePrice;
                  const netProceeds=grossProceeds*(1-commission);
                  const currentShares=23800000;
                  const newTotalShares=currentShares+totalShares;
                  const currentTotalNav=193700000;
                  const newTotalNav=currentTotalNav+netProceeds;
                  const newNavPerShare=newTotalNav/newTotalShares;
                  const navAccretion=((newNavPerShare/navPerShare-1)*100);
                  const dilutionPct=(totalShares/currentShares*100);
                  return(<div>
                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
                      {[
                        {l:'Total Shares Sold',v:`${(totalShares/1000).toFixed(0)}K`,c:T.accent},
                        {l:'Gross Proceeds',v:`$${(grossProceeds/1e6).toFixed(1)}M`,c:T.green},
                        {l:'Net Proceeds',v:`$${(netProceeds/1e6).toFixed(1)}M`,c:T.green},
                        {l:'Commission Cost',v:`$${((grossProceeds-netProceeds)/1e6).toFixed(2)}M`,c:T.red},
                        {l:'Share Dilution',v:`${dilutionPct.toFixed(1)}%`,c:T.amber},
                        {l:'NAV Accretion',v:`${navAccretion>=0?'+':''}${navAccretion.toFixed(3)}%`,c:navAccretion>=0?T.green:T.red},
                      ].map((m,i)=>(<div key={i} style={{padding:8,background:T.bg,borderRadius:4,textAlign:'center'}}>
                        <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
                        <div style={{fontSize:13,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div>
                      </div>))}
                    </div>
                    <div style={{marginTop:10,padding:8,background:navAccretion>=0?T.green+'10':T.red+'10',borderRadius:6,border:`1px solid ${navAccretion>=0?T.green:T.red}30`,textAlign:'center'}}>
                      <div style={{fontSize:9,color:T.textDim}}>NEW NAV/SHARE</div>
                      <div style={{fontSize:24,fontWeight:900,fontFamily:mono,color:navAccretion>=0?T.green:T.red}}>${newNavPerShare.toFixed(4)}</div>
                      <div style={{fontSize:9,color:navAccretion>=0?T.green:T.red}}>
                        {navAccretion>=0?'✓ ACCRETIVE':'⚠ DILUTIVE'} — {navAccretion>=0?'+':''}${(newNavPerShare-navPerShare).toFixed(4)}/share
                      </div>
                    </div>
                  </div>);
                })()}
              </div>
            </div>
          </Card>
          <div>
            <Card title="ATM Issuance Schedule — Projected Monthly Breakdown" style={{marginBottom:14}}>
              <div style={{padding:'14px 18px'}}>
                <table style={{width:'100%',borderCollapse:'collapse'}}>
                  <thead><tr>{['Month','Shares/Day','Trading Days','Total Shares','Gross Proceeds','Net Proceeds','Cum. Dilution','NAV/Share'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
                  <tbody>{[1,2,3,4,5,6].map(mo=>{
                    const dailyShares=sc.atmDaily||25000;
                    const premium=(sc.premiumTarget||148)/100;
                    const commission=(sc.feeBase||1.75)/100;
                    const days=21;
                    const navPerShare=9.84;
                    const salePrice=navPerShare*(1+premium);
                    const moShares=dailyShares*days;
                    const cumShares=moShares*mo;
                    const moGross=moShares*salePrice;
                    const moNet=moGross*(1-commission);
                    const cumNet=moNet*mo;
                    const currentShares=23800000;
                    const newShares=currentShares+cumShares;
                    const newNav=(193700000+cumNet)/newShares;
                    const cumDilution=(cumShares/currentShares*100);
                    return(<TR key={mo}>
                      <TD bold>Month {mo}</TD>
                      <TD mono>{(dailyShares/1000).toFixed(0)}K</TD>
                      <TD mono>{days}</TD>
                      <TD mono>{(moShares/1000).toFixed(0)}K</TD>
                      <TD mono bold color={T.green}>${(moGross/1e6).toFixed(2)}M</TD>
                      <TD mono bold color={T.green}>${(moNet/1e6).toFixed(2)}M</TD>
                      <TD mono color={T.amber}>{cumDilution.toFixed(1)}%</TD>
                      <TD mono bold color={newNav>navPerShare?T.green:T.red}>${newNav.toFixed(4)}</TD>
                    </TR>);
                  })}</tbody>
                </table>
              </div>
            </Card>
            <Card title="Premium Breakeven Analysis — When Does ATM Become Dilutive?">
              <div style={{padding:'14px 18px'}}>
                <div style={{fontSize:10,color:T.textDim,marginBottom:10}}>{"ATM is NAV-accretive when: Sale Premium % > Commission Rate + Transaction Costs"}</div>
                {[0,25,50,75,100,125,150,175,200].map(prem=>{
                  const commission=(sc.feeBase||1.75);
                  const txCost=0.25;
                  const netPremium=prem-commission-txCost;
                  const accretive=netPremium>0;
                  const accretionPct=accretive?(netPremium/(100+prem)*100):-(commission+txCost-prem)/(100+prem)*100;
                  return(<div key={prem} style={{display:'flex',alignItems:'center',gap:8,padding:'4px 0',borderBottom:`1px solid ${T.border}`,background:prem===Math.round(sc.premiumTarget||148)?T.accent+'08':'transparent'}}>
                    <span style={{fontSize:10,fontFamily:mono,color:prem===Math.round(sc.premiumTarget||148)?T.accent:T.textDim,fontWeight:prem===Math.round(sc.premiumTarget||148)?700:400,width:60}}>{prem}% prem</span>
                    <Bar value={Math.max(1,accretionPct+5)} max={15} color={accretive?T.green:T.red} h={5}/>
                    <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:accretive?T.green:T.red,width:80}}>{accretive?'+':''}{accretionPct.toFixed(2)}% NAV</span>
                    <Badge color={accretive?T.green:T.red}>{accretive?'ACCRETIVE':'DILUTIVE'}</Badge>
                  </div>);
                })}
                <div style={{marginTop:8,padding:8,background:T.amber+'10',borderRadius:6,fontSize:10,color:T.amber}}>
                  ⚠ Breakeven premium ≈ {((sc.feeBase||1.75)+0.25).toFixed(1)}% — below this, ATM issuance destroys NAV/share
                </div>
              </div>
            </Card>
          </div>
        </div>
        )}

        {/* ── BUYBACK MODE — Share repurchase analysis ── */}
        {getMode('capmarkets','overview')==='buyback'&&(
        <div>
          <Card title="🔄 Share Buyback Analysis — When to Activate" style={{marginBottom:14}}>
            <div style={{padding:'14px 18px'}}>
              <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:16}}>
                {[
                  {l:'Authorization',v:'$15M',d:'Board approved Sep 2025',c:T.accent},
                  {l:'Executed YTD',v:'$4.2M',d:'420K shares at avg $10.00',c:T.green},
                  {l:'Remaining',v:'$10.8M',d:'available to deploy',c:T.blue},
                  {l:'Current Status',v:'PAUSED',d:'Premium too high for buyback',c:T.amber},
                ].map((s,i)=>(<div key={i} style={{padding:12,background:T.bgAccent,borderRadius:6,borderTop:`3px solid ${s.c}`,textAlign:'center'}}>
                  <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{s.l}</div>
                  <div style={{fontSize:18,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
                  <div style={{fontSize:9,color:T.textMuted}}>{s.d}</div>
                </div>))}
              </div>
              <div style={{fontSize:10,fontWeight:700,color:T.textDim,marginBottom:8}}>BUYBACK DECISION FRAMEWORK</div>
              {[
                {scenario:'Stock at deep discount (>20% below NAV)',action:'ACTIVATE — aggressive buyback',nav:'Most accretive. Every $1 of buyback creates >$1.20 of NAV value.',c:T.green},
                {scenario:'Stock at modest discount (0-20% below NAV)',action:'ACTIVATE — measured pace',nav:'Accretive but less urgently. 10b5-1 plan recommended.',c:T.blue},
                {scenario:'Stock at small premium (0-50% above NAV)',action:'HOLD — monitor',nav:'Buying at premium destroys NAV/share. Wait for correction.',c:T.amber},
                {scenario:'Stock at large premium (>50% above NAV)',action:'ATM instead — sell, don\'t buy',nav:'Selling shares at premium is accretive. Buyback would be destructive.',c:T.red},
                {scenario:'Current: +148% premium',action:'ATM MODE — max issuance',nav:'At current premium, every ATM share sold adds ~$0.005 NAV/share.',c:T.accent},
              ].map((s,i)=>(<div key={i} style={{padding:'10px 0',borderBottom:i<4?`1px solid ${T.border}`:'none',borderLeft:`3px solid ${s.c}`,paddingLeft:12,marginBottom:4}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{s.scenario}</span>
                  <Badge color={s.c}>{s.action.split('—')[0].trim()}</Badge>
                </div>
                <div style={{fontSize:10,color:T.textMuted}}>{s.nav}</div>
              </div>))}
            </div>
          </Card>
          <Card title="Historical Buyback Execution — Program to Date">
            <table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Date','Shares','Avg Price','NAV/Share','Discount','Total Cost','NAV Accretion'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
              <tbody>{[
                {date:'Sep 15, 2025',shares:'85K',price:'$8.42',nav:'$8.84',disc:'-4.8%',cost:'$716K',accretion:'+$0.003'},
                {date:'Sep 22, 2025',shares:'120K',price:'$8.15',nav:'$8.84',disc:'-7.8%',cost:'$978K',accretion:'+$0.005'},
                {date:'Oct 2, 2025',shares:'95K',price:'$9.50',nav:'$9.42',disc:'+0.8%',cost:'$903K',accretion:'-$0.001'},
                {date:'Oct 15, 2025',shares:'75K',price:'$14.20',nav:'$9.42',disc:'+51%',cost:'$1.07M',accretion:'-$0.012'},
                {date:'Oct 18, 2025',shares:'45K',price:'$12.80',nav:'$9.42',disc:'+36%',cost:'$576K',accretion:'-$0.006'},
              ].map((r,i)=>(<TR key={i}>
                <TD>{r.date}</TD><TD mono>{r.shares}</TD><TD mono bold>{r.price}</TD><TD mono>{r.nav}</TD>
                <TD mono bold color={r.disc.startsWith('-')?T.green:T.red}>{r.disc}</TD>
                <TD mono>{r.cost}</TD>
                <TD mono bold color={r.accretion.startsWith('+')?T.green:T.red}>{r.accretion}</TD>
              </TR>))}</tbody>
            </table>
            <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,background:T.amber+'08'}}>
              <div style={{fontSize:10,color:T.amber,fontWeight:600}}>⚠ Note: Oct 15 & 18 buybacks were above NAV and were NAV-dilutive. Policy updated: no buybacks above NAV.</div>
            </div>
          </Card>
        </div>
        )}
      </div>)}

      {aView==='ipowatch'&&(<div>
        {/* ── MODE TOGGLE ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['tracker','timeline','impact'].map(m=>(
              <FilterPill key={m} label={m==='tracker'?'📊 Tracker':m==='timeline'?'📅 Timeline':'💰 NAV Impact'} active={getMode('ipowatch','tracker')===m} onClick={()=>setMode('ipowatch',m)}/>
            ))}
          </div>
          <span style={{fontSize:9,color:T.textDim,fontFamily:mono}}>Pipeline: <span style={{color:T.accent,fontWeight:700}}>6 companies</span> · Est. NAV uplift <span style={{color:T.green,fontWeight:700}}>+42-61%</span></span>
        </div>

        {/* ── TRACKER MODE (default) ── */}
        {getMode('ipowatch','tracker')==='tracker'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Active IPO Pipeline',v:'6',d:'portfolio companies preparing',c:T.accent},
            {l:'Est. NAV Uplift',v:'+42-61%',d:'if all IPOs execute at est. valuations',c:T.green},
            {l:'Next Lockup Expiry',v:'Mar 18',d:'Palantir lockup waiver',c:T.amber},
            {l:'Realized Exits YTD',v:'$6.2M',d:'distributions received',c:T.blue},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Portfolio Company IPO & Liquidity Event Tracker — Click Any Row" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Company','Event Type','Timeline','Est. Valuation','Current Mark','NAV Impact','Probability','Status'].map(h=><TH key={h} align={['Company','Event Type','Status'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {co:'SpaceX',event:'IPO / Tender',time:'H2 2026',estVal:'$500B+',mark:'$380B',impact:'+18.2%',prob:85,status:'S-1 Prep',fund:'FF VII + FF VI',nav:36.1,catalysts:['Starship orbital success','Revenue $12B+ run-rate','Government contracts pipeline','Blue Origin competition fading'],risks:['Regulatory scrutiny on SpaceX monopoly','Elon distraction risk','Valuation premium compression'],actions:['Set Bloomberg alert for SEC filings','Pre-model distribution at $500B, $400B, $300B scenarios','Prepare investor FAQ on SpaceX exposure']},
              {co:'Stripe',event:'IPO',time:'Q2 2026',estVal:'$120B',mark:'$91.5B',impact:'+8.4%',prob:75,status:'Confidential Filing',fund:'Sequoia XVI + a16z',nav:22.4,catalysts:['Confidential S-1 filed per reports','Revenue growth 25%+ re-acceleration','Embedded finance TAM expanding','Treasury and Atlas products scaling'],risks:['Fintech multiple compression','Competitive pressure from Adyen, Checkout','IPO window volatility'],actions:['Monitor S-1 filing status weekly','Model look-through NAV at $120B vs $91.5B mark','Prepare earnings call talking points on Stripe exposure']},
              {co:'Anduril',event:'IPO',time:'Q3 2026',estVal:'$45B',mark:'$28B',impact:'+4.8%',prob:80,status:'S-1 Imminent',fund:'FF VII',nav:18.8,catalysts:['S-1 filing imminent (multiple sources)','$458M Army contract signals acceleration','Defense tech premium expanding','Bipartisan political support'],risks:['Government spending cuts','Contract execution risk','Key person risk (Palmer Luckey)'],actions:['MONITOR: S-1 filing expected within days','Pre-draft investor communication','Model IPO at $45B, $35B, $50B scenarios']},
              {co:'Databricks',event:'IPO',time:'Q4 2026',estVal:'$85B',mark:'$62B',impact:'+3.2%',prob:60,status:'Exploring',fund:'a16z Infra III',nav:15.2,catalysts:['Revenue run-rate $2.4B+','AI/ML workload growth accelerating','Unity Catalog competitive moat','Strategic acquisitions adding capability'],risks:['Snowflake competition intensifying','Open source alternatives (Apache Spark fork risk)','Enterprise spending slowdown'],actions:['Track Databricks annual event for IPO signals','Review a16z Infra III GP letter for guidance','Model NAV impact at $85B vs $62B']},
              {co:'Scale AI',event:'IPO / M&A',time:'2027',estVal:'$22B',mark:'$14B',impact:'+1.8%',prob:45,status:'Early Stage',fund:'a16z Infra III',nav:8.2,catalysts:['Data labeling demand surging with AI buildout','Government contracts growing','Founder-market fit (Alexandr Wang)','Potential strategic M&A interest from big tech'],risks:['Automated labeling reducing TAM','Customer concentration (Accenture loss)','Valuation premium vs revenue multiples'],actions:['Monitor customer churn signals','Track revenue trajectory in GP reports','Evaluate secondary sale if premium attractive']},
              {co:'Anthropic',event:'IPO',time:'2027-28',estVal:'$200-375B',mark:'$75B',impact:'+22.4%',prob:55,status:'Revenue Scaling',fund:'FF VII + Direct',nav:48.2,catalysts:['Claude revenue scaling rapidly','Enterprise adoption accelerating','Constitutional AI competitive advantage','Amazon partnership deepening ($8B+ committed)'],risks:['OpenAI competition and market share','Regulatory risk on frontier AI','Capital intensity of training runs','Concentration of NEWCO exposure (24.9% NAV)'],actions:['Monitor monthly revenue trajectory','Track competitive landscape vs OpenAI, Google','Prepare scenarios: $200B base, $300B bull, $100B bear','Co-invest subscription docs due Mar 12']},
            ].map((r,i)=>(<TR key={i} style={{cursor:'pointer'}} onClick={()=>setDrillDown({
              title:r.co,subtitle:`${r.event} · ${r.time} · ${r.fund}`,
              badges:[{l:r.status,c:r.prob>=70?T.green:r.prob>=50?T.amber:T.textDim},{l:`${r.prob}% probability`,c:r.prob>=70?T.green:r.prob>=50?T.amber:T.red}],
              kpis:[{l:'Est. Valuation',v:r.estVal,c:T.green},{l:'Current Mark',v:r.mark,c:T.accent},{l:'NAV Impact',v:r.impact,c:T.blue},{l:'NAV Exposure',v:`$${r.nav}M`,c:T.purple}],
              sections:[
                {title:'Catalysts',type:'bars',items:r.catalysts.map((cat,ci)=>({l:cat,v:'',pct:90-ci*15,c:T.green}))},
                {title:'Risks',type:'bars',items:r.risks.map((risk,ri)=>({l:risk,v:'',pct:80-ri*20,c:T.red}))},
                {title:'Action Items',type:'bars',items:r.actions.map((act,ai)=>({l:act,v:'',pct:100,c:ai===0?T.accent:T.blue}))},
                {title:'Navigate',type:'actions',items:[
                  {icon:'📊',label:'NAV Impact Model',view:'navmark',desc:'See how this IPO affects NAV/share'},
                  {icon:'🎲',label:'Monte Carlo Simulation',view:'montecarlo',desc:'Run probability-weighted scenarios'},
                  {icon:'📐',label:'Position Sizing',view:'sizing',desc:'Evaluate concentration and rebalancing'},
                ]}
              ]
            })}>
              <TD bold>{r.co}</TD>
              <TD><Badge color={r.event.includes('IPO')?T.accent:T.blue}>{r.event}</Badge></TD>
              <TD align="right" mono bold>{r.time}</TD>
              <TD align="right" mono color={T.green}>{r.estVal}</TD>
              <TD align="right" mono>{r.mark}</TD>
              <TD align="right" mono bold color={T.accent}>{r.impact}</TD>
              <TD align="right"><div style={{display:'flex',alignItems:'center',justifyContent:'flex-end',gap:4}}><div style={{width:40,height:4,background:T.bgAccent,borderRadius:2}}><div style={{width:`${r.prob}%`,height:'100%',background:r.prob>=70?T.green:r.prob>=50?T.amber:T.textDim,borderRadius:2}}/></div><span style={{fontFamily:mono,fontSize:10,fontWeight:700}}>{r.prob}%</span></div></TD>
              <TD><Badge color={r.status==='S-1 Prep'||r.status==='S-1 Imminent'?T.green:r.status==='Confidential Filing'?T.accent:T.textDim}>{r.status}</Badge></TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <Card title="Lockup Expiration Calendar — Distribution & Selling Window Planning">
          <div style={{padding:0}}>{[
            {co:'Palantir (public)',lockup:'None — freely tradeable',expiry:'N/A',shares:'Est. $42M position value',action:'Systematic selling program active. $2.1M/quarter distribution target.',status:'Selling'},
            {co:'SpaceX (via FF VII)',lockup:'GP-imposed 6mo post-tender',expiry:'Dependent on event',shares:'$68M estimated position',action:'Monitor tender. Alert team within 24hrs of event announcement.',status:'Monitoring'},
            {co:'Stripe (via Sequoia XVI)',lockup:'Standard 180-day post-IPO',expiry:'TBD based on IPO date',shares:'$18M look-through exposure',action:'Model distribution scenarios at various post-IPO price levels.',status:'Pre-Event'},
            {co:'Anduril (via FF VII)',lockup:'Standard 180-day',expiry:'Est. Q1 2027',shares:'$12M exposure',action:'Evaluate secondary sale pre-IPO vs holding through lockup.',status:'Pre-Event'},
          ].map((l,i)=>(<div key={i} style={{padding:'14px 18px',borderBottom:i<3?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <span style={{fontSize:13,fontWeight:700,color:T.text}}>{l.co}</span>
                <Badge color={l.status==='Selling'?T.green:l.status==='Monitoring'?T.amber:T.blue}>{l.status}</Badge>
              </div>
              <span style={{fontSize:11,fontFamily:mono,fontWeight:600,color:T.accent}}>{l.shares}</span>
            </div>
            <div style={{fontSize:10,color:T.textMuted,marginBottom:3}}>Lockup: {l.lockup} · Expiry: {l.expiry}</div>
            <div style={{fontSize:10,color:T.green,fontWeight:500}}>Action: {l.action}</div>
          </div>))}</div>
        </Card>
        </>)}

        {/* ── TIMELINE MODE — Visual IPO runway ── */}
        {getMode('ipowatch','tracker')==='timeline'&&(
        <Card title="📅 IPO Timeline — Visual Event Calendar" style={{marginBottom:14}}>
          <div style={{padding:'18px'}}>
            <div style={{fontSize:10,color:T.textDim,marginBottom:14}}>Hover bars for detail. Timeline shows expected filing → IPO → lockup expiry windows.</div>
            {[
              {co:'Anduril',start:0,ipoStart:4,ipoEnd:8,lockupEnd:14,prob:80,color:T.green,note:'S-1 imminent'},
              {co:'Stripe',start:0,ipoStart:3,ipoEnd:6,lockupEnd:12,prob:75,color:T.accent,note:'Confidential filed'},
              {co:'SpaceX',start:0,ipoStart:6,ipoEnd:10,lockupEnd:16,prob:85,color:T.blue,note:'H2 2026 target'},
              {co:'Databricks',start:0,ipoStart:8,ipoEnd:12,lockupEnd:18,prob:60,color:T.purple,note:'Exploring'},
              {co:'Scale AI',start:0,ipoStart:12,ipoEnd:18,lockupEnd:24,prob:45,color:T.amber,note:'Early stage'},
              {co:'Anthropic',start:0,ipoStart:18,ipoEnd:28,lockupEnd:34,prob:55,color:T.red,note:'Revenue scaling'},
            ].map((co,i)=>(
              <div key={i} style={{display:'flex',alignItems:'center',gap:10,marginBottom:12}}>
                <div style={{width:80,textAlign:'right',flexShrink:0}}>
                  <div style={{fontSize:11,fontWeight:700,color:T.text}}>{co.co}</div>
                  <div style={{fontSize:8,color:T.textDim}}>{co.prob}% prob</div>
                </div>
                <div style={{flex:1,height:24,background:T.bgAccent,borderRadius:4,position:'relative',overflow:'hidden'}}>
                  {/* Pre-IPO prep phase */}
                  <div style={{position:'absolute',left:`${co.ipoStart/36*100}%`,width:`${(co.ipoEnd-co.ipoStart)/36*100}%`,top:0,bottom:0,background:`${co.color}40`,borderRadius:3}} title={`IPO window: Month ${co.ipoStart}-${co.ipoEnd}`}/>
                  {/* Lockup phase */}
                  <div style={{position:'absolute',left:`${co.ipoEnd/36*100}%`,width:`${(co.lockupEnd-co.ipoEnd)/36*100}%`,top:0,bottom:0,background:`${T.amber}20`,borderRadius:3}} title={`Lockup: Month ${co.ipoEnd}-${co.lockupEnd}`}/>
                  {/* IPO marker */}
                  <div style={{position:'absolute',left:`${co.ipoEnd/36*100}%`,top:2,bottom:2,width:2,background:co.color}}/>
                  {/* Today marker */}
                  <div style={{position:'absolute',left:0,top:0,bottom:0,width:2,background:T.text}}/>
                  {/* Labels */}
                  <span style={{position:'absolute',left:`${co.ipoStart/36*100+1}%`,top:5,fontSize:8,color:co.color,fontWeight:600}}>{co.note}</span>
                </div>
                <div style={{width:60,textAlign:'center',flexShrink:0}}>
                  <Badge color={co.color}>{co.prob}%</Badge>
                </div>
              </div>
            ))}
            {/* Timeline axis */}
            <div style={{display:'flex',marginLeft:90,marginTop:8}}>
              {['Now','Q2 \'26','Q3 \'26','Q4 \'26','Q1 \'27','Q2 \'27','H2 \'27','2028'].map((q,i)=>(
                <span key={i} style={{flex:1,fontSize:8,color:T.textDim,textAlign:'left'}}>{q}</span>
              ))}
            </div>
            <div style={{display:'flex',gap:16,marginTop:12,justifyContent:'center'}}>
              {[{l:'IPO Window',c:T.accent},{l:'Lockup Period',c:T.amber},{l:'Today',c:T.text}].map((leg,i)=>(
                <div key={i} style={{display:'flex',alignItems:'center',gap:4}}>
                  <div style={{width:12,height:8,background:leg.c+'40',borderRadius:2}}/>
                  <span style={{fontSize:8,color:T.textDim}}>{leg.l}</span>
                </div>
              ))}
            </div>
          </div>
        </Card>
        )}

        {/* ── NAV IMPACT MODE — Scenario calculator ── */}
        {getMode('ipowatch','tracker')==='impact'&&(
        <div>
          <Card title="💰 IPO NAV Impact Calculator — What If Scenarios" style={{marginBottom:14}}>
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:12}}>Model how each IPO at different valuations would impact NEWCO NAV/share. Drag sliders to adjust.</div>
              {[
                {co:'Anthropic',base:75,nav:48.2,pct:24.9,k:'ipoAnthro',min:50,max:400},
                {co:'SpaceX',base:380,nav:36.1,pct:18.6,k:'ipoSpaceX',min:250,max:700},
                {co:'Stripe',base:91.5,nav:22.4,pct:11.6,k:'ipoStripe',min:60,max:200},
                {co:'Anduril',base:28,nav:18.8,pct:9.7,k:'ipoAnduril',min:20,max:80},
                {co:'Databricks',base:62,nav:15.2,pct:7.8,k:'ipoDatabricks',min:40,max:150},
              ].map((h,i)=>{
                const sliderVal=sc[h.k]!==undefined?sc[h.k]:h.base;
                const multiplier=sliderVal/h.base;
                const newNav=h.nav*multiplier;
                const navDelta=newNav-h.nav;
                const perShare=navDelta/23.8;
                return(<div key={i} style={{display:'grid',gridTemplateColumns:'90px 1fr 140px',gap:10,alignItems:'center',padding:'8px 0',borderBottom:`1px solid ${T.border}`}}>
                  <div>
                    <div style={{fontSize:11,fontWeight:700,color:T.text}}>{h.co}</div>
                    <div style={{fontSize:8,color:T.textDim}}>Base: ${h.base}B</div>
                  </div>
                  <div>
                    <input type="range" min={h.min} max={h.max} step={5} value={sliderVal}
                      onChange={e=>setSlider(h.k,parseInt(e.target.value))}
                      style={{width:'100%',height:6,appearance:'none',background:`linear-gradient(90deg, ${T.red}60 0%, ${T.bgAccent} ${((h.base-h.min)/(h.max-h.min))*100}%, ${T.green}60 100%)`,borderRadius:3,outline:'none',cursor:'pointer'}}/>
                    <div style={{display:'flex',justifyContent:'space-between',fontSize:7,color:T.textDim}}>
                      <span>${h.min}B</span>
                      <span style={{fontWeight:700,color:multiplier>1?T.green:multiplier<1?T.red:T.textDim}}>${sliderVal}B ({multiplier>=1?'+':''}{ ((multiplier-1)*100).toFixed(0)}%)</span>
                      <span>${h.max}B</span>
                    </div>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:4}}>
                    <div style={{padding:4,background:T.bgAccent,borderRadius:4,textAlign:'center'}}>
                      <div style={{fontSize:7,color:T.textDim}}>NAV Exp.</div>
                      <div style={{fontSize:11,fontWeight:700,fontFamily:mono,color:navDelta>=0?T.green:T.red}}>${newNav.toFixed(1)}M</div>
                    </div>
                    <div style={{padding:4,background:navDelta>=0?`${T.green}08`:`${T.red}08`,borderRadius:4,textAlign:'center'}}>
                      <div style={{fontSize:7,color:T.textDim}}>Per Share</div>
                      <div style={{fontSize:11,fontWeight:700,fontFamily:mono,color:navDelta>=0?T.green:T.red}}>{perShare>=0?'+':''}${perShare.toFixed(3)}</div>
                    </div>
                  </div>
                </div>);
              })}
              {/* Composite result */}
              {(()=>{
                const holdings=[
                  {base:75,nav:48.2,k:'ipoAnthro'},{base:380,nav:36.1,k:'ipoSpaceX'},{base:91.5,nav:22.4,k:'ipoStripe'},
                  {base:28,nav:18.8,k:'ipoAnduril'},{base:62,nav:15.2,k:'ipoDatabricks'},
                ];
                const totalDelta=holdings.reduce((s,h)=>{const v=sc[h.k]!==undefined?sc[h.k]:h.base;return s+(h.nav*(v/h.base)-h.nav);},0);
                const newTotal=193.7+totalDelta;
                const newPerShare=newTotal/23.8;
                const pctChange=((newTotal/193.7-1)*100);
                return(<div style={{marginTop:14,padding:14,background:pctChange>=0?`${T.green}08`:`${T.red}08`,borderRadius:8,border:`1px solid ${pctChange>=0?T.green:T.red}30`}}>
                  <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,textAlign:'center'}}>
                    <div><div style={{fontSize:8,color:T.textDim}}>CURRENT NAV</div><div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:T.textDim}}>$193.7M</div></div>
                    <div><div style={{fontSize:8,color:T.textDim}}>SCENARIO NAV</div><div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:pctChange>=0?T.green:T.red}}>${newTotal.toFixed(1)}M</div></div>
                    <div><div style={{fontSize:8,color:T.textDim}}>NAV/SHARE</div><div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:T.accent}}>${newPerShare.toFixed(2)}</div></div>
                    <div><div style={{fontSize:8,color:T.textDim}}>CHANGE</div><div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:pctChange>=0?T.green:T.red}}>{pctChange>=0?'+':''}{pctChange.toFixed(1)}%</div></div>
                  </div>
                </div>);
              })()}
            </div>
          </Card>
        </div>
        )}
      </div>)}

      {aView==='concentration'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'HHI Index',v:'1,842',d:'moderate concentration',c:T.amber},
            {l:'Top 5 % NAV',v:'72.4%',d:'5 positions dominate',c:T.accent},
            {l:'Max Position',v:'24.9%',d:'Anthropic (via multiple funds)',c:T.red},
            {l:'Sector HHI',v:'3,215',d:'AI/Tech heavy',c:T.purple},
            {l:'Correlation ρ',v:'0.68',d:'avg pairwise correlation',c:T.blue},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Position Concentration — Look-Through Single-Name Exposure" style={{marginBottom:14}}>
          <div style={{padding:'14px 18px'}}>
            {[
              {name:'Anthropic',pct:24.9,funds:['FF VII','Direct Co-Invest'],limit:25,c:T.red},
              {name:'SpaceX',pct:18.6,funds:['FF VII','FF VI'],limit:20,c:T.accent},
              {name:'Palantir',pct:12.2,funds:['NEA 19','FF VI','Public'],limit:15,c:T.blue},
              {name:'Stripe',pct:9.4,funds:['Sequoia XVI','a16z Infra III'],limit:15,c:T.purple},
              {name:'Anduril',pct:7.3,funds:['FF VII'],limit:10,c:T.green},
              {name:'Databricks',pct:5.8,funds:['a16z Infra III'],limit:10,c:T.cyan},
              {name:'Scale AI',pct:4.2,funds:['a16z Infra III'],limit:10,c:T.amber},
              {name:'Other (88 cos)',pct:17.6,funds:['Various'],limit:null,c:T.textDim},
            ].map((p,i)=>(<div key={i} style={{marginBottom:8}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}>
                  <span style={{fontSize:12,fontWeight:700,color:T.text}}>{p.name}</span>
                  <span style={{fontSize:9,color:T.textDim}}>{p.funds.join(' + ')}</span>
                  {p.limit&&p.pct>=p.limit*0.9&&<Badge color={p.pct>=p.limit?T.red:T.amber}>{p.pct>=p.limit?'AT LIMIT':'NEAR LIMIT'}</Badge>}
                </div>
                <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:p.c}}>{p.pct}%</span>
              </div>
              <div style={{height:12,background:T.bgAccent,borderRadius:4,overflow:'hidden',position:'relative'}}>
                <div style={{width:`${Math.min(p.pct/25*100,100)}%`,height:'100%',background:p.c,borderRadius:4,transition:'width .3s'}}/>
                {p.limit&&<div style={{position:'absolute',left:`${p.limit/25*100}%`,top:0,bottom:0,width:2,background:T.red,opacity:0.6}}/>}
              </div>
              {p.limit&&<div style={{fontSize:8,color:T.textDim,textAlign:'right',marginTop:1}}>Limit: {p.limit}%</div>}
            </div>))}
          </div>
        </Card>
        <Card title="Tail Risk Decomposition — What Happens If Top Holdings Drop 50%?">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Scenario','Trigger','NAV Impact','Stock Price Est.','Recovery Time','Hedge Available'].map(h=><TH key={h} align={h==='Scenario'||h==='Trigger'?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {scenario:'Anthropic -50%',trigger:'AI regulation, competitive pressure, revenue miss',impact:'-12.5%',price:'$12.10',recovery:'12-18mo',hedge:'None (private)'},
              {scenario:'SpaceX -50%',trigger:'Launch failure, Starlink competition, regulatory',impact:'-9.3%',price:'$13.85',recovery:'6-12mo',hedge:'None (private)'},
              {scenario:'Palantir -50%',trigger:'Government contract loss, multiple compression',impact:'-6.1%',price:'$16.20',recovery:'3-6mo',hedge:'Put options available'},
              {scenario:'Broad AI correction -30%',trigger:'AI winter, regulation wave, bubble burst',impact:'-22.8%',price:'$8.40',recovery:'24-36mo',hedge:'Sector ETF puts'},
              {scenario:'Interest rate spike +300bp',trigger:'Fed tightening, inflation resurgence',impact:'-15.2%',price:'$11.20',recovery:'12-18mo',hedge:'Duration hedge'},
            ].map((s,i)=>(<TR key={i}>
              <TD bold color={T.red}>{s.scenario}</TD>
              <TD color={T.textMuted}>{s.trigger}</TD>
              <TD align="right" mono bold color={T.red}>{s.impact}</TD>
              <TD align="right" mono>{s.price}</TD>
              <TD align="right" color={T.textDim}>{s.recovery}</TD>
              <TD align="right"><Badge color={s.hedge==='None (private)'?T.textDim:T.blue}>{s.hedge}</Badge></TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
      </div>)}

      {aView==='activist'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Defense Readiness',v:'HIGH',d:'all measures current',c:T.green},
            {l:'Activist Risk Score',v:'32/100',d:'low vulnerability',c:T.green},
            {l:'Poison Pill',v:'ACTIVE',d:'15% trigger threshold',c:T.accent},
            {l:'Board Independence',v:'60%',d:'3 of 5 independent',c:T.blue},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Board Composition & Governance Structure" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Director','Role','Independent','Committee','Term Expires','Shares Owned','Expertise'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {name:'Jason Goldman',role:'Chair & Operating Partner',ind:false,committee:'FVC (Chair), Exec',term:'2027',shares:'142,500',expertise:'VC Ops, Brand, Berkeley Network'},
              {name:'Ken Wallace',role:'Managing Partner & CIO',ind:false,committee:'FVC, Invest',term:'2027',shares:'98,200',expertise:'Quant, Secondaries, Risk'},
              {name:'Dr. Sarah Chen',role:'Independent Director',ind:true,committee:'Audit (Chair), Comp',term:'2028',expertise:'AI/ML Professor, Stanford AI Lab',shares:'5,000'},
              {name:'Robert Martinez',role:'Independent Director',ind:true,committee:'Governance (Chair), FVC',term:'2026',expertise:'Former SEC Commissioner, Compliance',shares:'8,000'},
              {name:'Linda Park',role:'Independent Director',ind:true,committee:'Comp (Chair), Audit',term:'2028',expertise:'Former BlackRock PM, Alts Specialist',shares:'12,000'},
            ].map((d,i)=>(<TR key={i}>
              <TD bold>{d.name}</TD>
              <TD color={T.textDim}>{d.role}</TD>
              <TD>{d.ind?<Badge color={T.green}>Yes</Badge>:<Badge color={T.textDim}>No</Badge>}</TD>
              <TD color={T.textMuted}>{d.committee}</TD>
              <TD mono>{d.term}</TD>
              <TD mono>{d.shares}</TD>
              <TD color={T.textDim}>{d.expertise}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <Card title="Defensive Measures Status">
          <div style={{padding:0}}>{[
            {measure:'Shareholder Rights Plan (Poison Pill)',status:'Active',detail:'15% ownership trigger. Adopted Nov 2025. Expires Nov 2028. Flip-in provision dilutes hostile acquirer.',risk:'Low'},
            {measure:'Classified Board',status:'Not Adopted',detail:'All directors serve staggered terms but board is not formally classified. Consider for next proxy.',risk:'Medium'},
            {measure:'Supermajority Vote for Amendments',status:'Active',detail:'66.7% required to amend bylaws or remove directors without cause.',risk:'Low'},
            {measure:'Advance Notice Bylaw',status:'Active',detail:'90-120 day advance notice required for director nominations. Window: Mar 1 - Apr 1 for 2026 meeting.',risk:'Low'},
            {measure:'Forum Selection Clause',status:'Active',detail:'All derivative actions must be brought in Delaware Court of Chancery.',risk:'Low'},
            {measure:'D&O Insurance',status:'Active',detail:'$25M tower. Primary: AIG. Excess: Chubb + Berkshire. Coverage reviewed annually.',risk:'Low'},
          ].map((m,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:12}}>
            <div style={{width:8,height:8,borderRadius:4,background:m.status==='Active'?T.green:m.status==='Not Adopted'?T.amber:T.textDim,flexShrink:0}}/>
            <div style={{flex:1}}>
              <div style={{display:'flex',alignItems:'center',gap:6}}>
                <span style={{fontSize:12,fontWeight:600,color:T.text}}>{m.measure}</span>
                <Badge color={m.status==='Active'?T.green:T.amber}>{m.status}</Badge>
              </div>
              <div style={{fontSize:10,color:T.textMuted}}>{m.detail}</div>
            </div>
            <Badge color={m.risk==='Low'?T.green:m.risk==='Medium'?T.amber:T.red}>{m.risk} Risk</Badge>
          </div>))}</div>
        </Card>
      </div>)}

      {aView==='lookthrough'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Total Look-Through Cos',v:'130+',d:'across 8 fund commitments',c:T.accent},
            {l:'Weighted Avg Revenue Growth',v:'+84%',d:'portfolio median',c:T.green},
            {l:'Public/Private Mix',v:'12% / 88%',d:'by NAV contribution',c:T.blue},
            {l:'Pre-IPO Pipeline',v:'$142B',d:'aggregate private valuation',c:T.purple},
            {l:'Avg Company Age',v:'6.8 yrs',d:'post-founding',c:T.amber},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12,marginBottom:14}}>
          <Card title="By Sector">
            <div style={{padding:'12px 16px'}}>{[
              {sector:'AI / Machine Learning',pct:38.2,c:T.accent},
              {sector:'Defense / GovTech',pct:18.6,c:T.red},
              {sector:'Enterprise SaaS',pct:14.8,c:T.blue},
              {sector:'Fintech / Payments',pct:9.4,c:T.green},
              {sector:'Cybersecurity / Trust',pct:7.2,c:T.purple},
              {sector:'Developer Tools',pct:5.1,c:T.cyan},
              {sector:'Healthcare / Bio',pct:3.8,c:T.amber},
              {sector:'Other',pct:2.9,c:T.textDim},
            ].map((s,i)=>(<div key={i} style={{marginBottom:6}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                <span style={{fontSize:10,color:T.text}}>{s.sector}</span>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:s.c}}>{s.pct}%</span>
              </div>
              <Bar value={s.pct} max={40} color={s.c} h={6}/>
            </div>))}</div>
          </Card>
          <Card title="By Stage">
            <div style={{padding:'12px 16px'}}>{[
              {stage:'Late Stage / Pre-IPO',pct:42.5,count:18,c:T.accent},
              {stage:'Growth ($100M+ rev)',pct:28.3,count:12,c:T.blue},
              {stage:'Public (post-IPO)',pct:12.4,count:8,c:T.green},
              {stage:'Early Growth',pct:10.2,count:35,c:T.purple},
              {stage:'Seed / Series A',pct:6.6,count:57,c:T.textDim},
            ].map((s,i)=>(<div key={i} style={{marginBottom:8}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                <span style={{fontSize:10,color:T.text}}>{s.stage}</span>
                <span style={{fontSize:9,color:T.textDim}}>{s.count} cos</span>
              </div>
              <div style={{display:'flex',alignItems:'center',gap:6}}>
                <div style={{flex:1}}><Bar value={s.pct} max={45} color={s.c} h={8}/></div>
                <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:s.c,width:38,textAlign:'right'}}>{s.pct}%</span>
              </div>
            </div>))}</div>
          </Card>
          <Card title="By Geography">
            <div style={{padding:'12px 16px'}}>{[
              {geo:'San Francisco / Bay Area',pct:48.2,c:T.accent},
              {geo:'New York',pct:14.5,c:T.blue},
              {geo:'Los Angeles',pct:8.8,c:T.green},
              {geo:'Boston / Cambridge',pct:7.2,c:T.purple},
              {geo:'Washington DC',pct:6.4,c:T.red},
              {geo:'International',pct:8.1,c:T.cyan},
              {geo:'Other US',pct:6.8,c:T.textDim},
            ].map((g,i)=>(<div key={i} style={{marginBottom:6}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                <span style={{fontSize:10,color:T.text}}>{g.geo}</span>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:g.c}}>{g.pct}%</span>
              </div>
              <Bar value={g.pct} max={50} color={g.c} h={6}/>
            </div>))}</div>
          </Card>
        </div>
        <Card title="Thematic Exposure Overlay — Cross-Cutting Investment Themes">
          <div style={{padding:0}}>{[
            {theme:'Artificial Intelligence & Foundation Models',pct:52.4,cos:['Anthropic','Scale AI','Databricks','Cohere'],trend:'+8.2% QoQ',driver:'Revenue acceleration, enterprise adoption, IPO pipeline'},
            {theme:'Defense Technology & National Security',pct:22.8,cos:['Anduril','Palantir','Shield AI','Rebellion'],trend:'+4.5% QoQ',driver:'Government spending increase, NATO modernization, autonomous systems'},
            {theme:'Space & Launch Infrastructure',pct:18.6,cos:['SpaceX','Relativity Space','Planet Labs'],trend:'+2.1% QoQ',driver:'SpaceX dominance, Starlink revenue, government contracts'},
            {theme:'Trust & Safety / Identity',pct:12.4,cos:['Abnormal Security','Drata','1Password','Persona'],trend:'+3.8% QoQ',driver:'Regulatory mandates, AI deepfake countermeasures, zero-trust adoption'},
            {theme:'Developer Infrastructure',pct:8.6,cos:['Vercel','Railway','Supabase','Retool'],trend:'+1.2% QoQ',driver:'AI developer tooling explosion, cloud-native shift'},
            {theme:'Blockchain & Digital Assets',pct:4.2,cos:['Figma (acquired)','Chainalysis','Circle'],trend:'-1.8% QoQ',driver:'Crypto winter recovery, stablecoin regulation clarity'},
          ].map((t,i)=>(<div key={i} style={{padding:'14px 18px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
              <span style={{fontSize:13,fontWeight:700,color:T.text}}>{t.theme}</span>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <span style={{fontSize:12,fontFamily:mono,fontWeight:800,color:T.accent}}>{t.pct}% NAV</span>
                <span style={{fontSize:10,fontFamily:mono,color:t.trend.startsWith('+')?T.green:T.red}}>{t.trend}</span>
              </div>
            </div>
            <div style={{display:'flex',gap:4,marginBottom:4,flexWrap:'wrap'}}>{t.cos.map(c=><Badge key={c} color={T.bgAccent}>{c}</Badge>)}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{t.driver}</div>
          </div>))}</div>
        </Card>
      </div>)}

      {/* ═══════════════════════════════════════════════════════════════════ */}
      {/* ═══  INSTITUTIONAL TEAM VIEWS — Every Seat at the Table  ═══════ */}
      {/* ═══════════════════════════════════════════════════════════════════ */}

      {/* ── BOARD REPORTING (CEO/Chairman view) ── */}
      {aView==='boarddeck'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Board Meeting',v:'Mar 22',d:'Q4 2025 review',c:T.accent},
            {l:'Deck Status',v:'72%',d:'8 of 11 sections complete',c:T.amber},
            {l:'Open Action Items',v:'14',d:'from prior meeting',c:T.red},
            {l:'Committee Mtgs',v:'3',d:'Audit, Comp, FVC scheduled',c:T.blue},
            {l:'Resolution Queue',v:'4',d:'requiring board vote',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Board Deck Builder — Q4 2025 Quarterly Review" style={{marginBottom:14}}>
          <div style={{padding:0}}>{[
            {section:'1. Executive Summary',owner:'Jason',status:'Complete',pages:3,kpi:'Fund NAV +14.2% QoQ, stock +28.5% QoQ, premium stable at +148%',detail:'High-level performance, market environment, strategic priorities'},
            {section:'2. Investment Performance',owner:'Ken',status:'Complete',pages:5,kpi:'Gross IRR 28.3%, TVPI 1.42x, 3 new commitments totaling $12.5M',detail:'Attribution by fund, vintage, sector. Benchmark comparison vs Cambridge FoF index'},
            {section:'3. Portfolio Activity',owner:'Ken + Brett',status:'Complete',pages:4,kpi:'2 new fund commitments, 1 secondary acquisition, 3 co-invest evaluations',detail:'New investments, follow-ons, exits, pipeline, IC decisions log'},
            {section:'4. NAV Bridge & Valuation',owner:'Ken + Matthew',status:'In Review',pages:3,kpi:'NAV/share: $9.42→$9.84 (+4.5%). Level 3 assets 91.4%.',detail:'QoQ NAV walk, FVC summary, valuation methodology changes, audit status'},
            {section:'5. Capital Markets & Trading',owner:'Jason',status:'Draft',pages:2,kpi:'ATM proceeds $4.5M, buyback auth $15M, premium analysis',detail:'Share price performance, volume, premium/discount trend, ATM activity'},
            {section:'6. Shareholder Intelligence',owner:'IR Team',status:'In Progress',pages:3,kpi:'Top 10 holders shift, institutional % up 4.2pp, short interest 18.4%',detail:'13F analysis, cost basis clustering, activist monitoring, IR activity log'},
            {section:'7. Compliance & Regulatory',owner:'Matthew + Counsel',status:'Complete',pages:2,kpi:'All filings current, 0 deficiencies, trading window status',detail:'SEC filings, 1940 Act compliance, insider trading, pending regulatory items'},
            {section:'8. Financial Statements',owner:'KPMG + Matthew',status:'Complete',pages:4,kpi:'Total expenses $3.8M, management fee $2.1M, AFFE 3.67%',detail:'P&L summary, balance sheet, expense analysis, fee waterfall'},
            {section:'9. Distribution Report',owner:'Bob',status:'Not Started',pages:2,kpi:'3 new platform approvals, pipeline $48M, advisor reach 5K+',detail:'Platform status, new RIA relationships, marketing activity, competitive intel'},
            {section:'10. Risk Dashboard',owner:'Ken',status:'Draft',pages:2,kpi:'HHI 1,842, max position 24.9% (Anthropic), factor correlation 0.68',detail:'Concentration risk, scenario analysis, stress test results, limit breaches'},
            {section:'11. Strategic Agenda & Resolutions',owner:'Jason',status:'Not Started',pages:2,kpi:'4 resolutions: ATM expansion, new commitment, director nomination, fee structure',detail:'Forward-looking strategy, board votes required, open discussion items'},
          ].map((s,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<10?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:12}}>
            <div style={{width:28,height:28,borderRadius:14,background:s.status==='Complete'?T.green+'15':s.status==='In Review'||s.status==='In Progress'?T.amber+'15':s.status==='Draft'?T.blue+'15':T.red+'15',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
              <span style={{fontSize:11}}>{s.status==='Complete'?'✓':s.status==='In Review'?'◐':s.status==='Draft'?'✎':'!'}</span>
            </div>
            <div style={{flex:1}}>
              <div style={{fontSize:12,fontWeight:600,color:T.text}}>{s.section}</div>
              <div style={{fontSize:10,color:T.accent,fontFamily:mono,marginTop:1}}>{s.kpi}</div>
              <div style={{fontSize:9,color:T.textDim}}>{s.detail}</div>
            </div>
            <Badge color={T.blue}>{s.owner}</Badge>
            <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{s.pages}pg</span>
            <Badge color={s.status==='Complete'?T.green:s.status==='In Review'||s.status==='In Progress'?T.amber:s.status==='Draft'?T.blue:T.red}>{s.status}</Badge>
          </div>))}</div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Prior Meeting Action Items — Tracking">
            <div style={{padding:0}}>{[
              {item:'Evaluate ATM program expansion to $75M',owner:'Jason + Counsel',due:'Mar 15',status:'On Track',priority:'High'},
              {item:'Complete Anduril co-invest due diligence',owner:'Ken',due:'Mar 1',status:'Complete',priority:'High'},
              {item:'Engage new valuation agent for AI portfolio cos',owner:'Matthew',due:'Feb 28',status:'Complete',priority:'Medium'},
              {item:'Review and update shareholder rights plan triggers',owner:'Counsel',due:'Mar 22',status:'In Progress',priority:'Medium'},
              {item:'Prepare fee comparison analysis vs peer CEFs',owner:'Ken + Matthew',due:'Mar 15',status:'On Track',priority:'Medium'},
              {item:'Develop investor day proposal and budget',owner:'Jason + Bob',due:'Apr 1',status:'Not Started',priority:'Low'},
              {item:'Evaluate D&O insurance renewal terms',owner:'Matthew',due:'Mar 30',status:'Not Started',priority:'Low'},
            ].map((a,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<6?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <div style={{width:6,height:6,borderRadius:3,background:a.status==='Complete'?T.green:a.status==='On Track'?T.blue:a.status==='In Progress'?T.amber:T.red,flexShrink:0}}/>
              <div style={{flex:1}}><div style={{fontSize:11,fontWeight:500,color:T.text}}>{a.item}</div></div>
              <Badge color={T.blue}>{a.owner}</Badge>
              <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{a.due}</span>
              <Badge color={a.status==='Complete'?T.green:a.status==='On Track'?T.blue:a.status==='In Progress'?T.amber:T.red}>{a.status}</Badge>
            </div>))}</div>
          </Card>
          <Card title="Resolutions Requiring Board Vote">
            <div style={{padding:0}}>{[
              {res:'Authorize ATM program expansion from $50M to $75M',type:'Capital Markets',votes:'Simple Majority',rec:'APPROVE',rationale:'Premium environment allows accretive issuance. NAV/share increases by ~$0.08 per $10M raised at current premium.'},
              {res:'Approve $8M commitment to Thrive Capital Partners IX',type:'New Investment',votes:'Investment Committee + Board',rec:'APPROVE',rationale:'Top-decile track record. AI-heavy portfolio. Access to late-stage rounds in Anthropic competitors.'},
              {res:'Nominate Dr. James Rivera as independent director',type:'Governance',votes:'Board Approval → Shareholder Vote',rec:'APPROVE',rationale:'Former FINRA board member. Strengthens regulatory expertise. Diversifies board composition.'},
              {res:'Ratify amended advisory fee structure effective Q3 2026',type:'Compensation',votes:'Independent Directors + Shareholders',rec:'DISCUSS',rationale:'Proposal to add performance fee component (15% over 8% hurdle) in exchange for reducing base from 1.75% to 1.50%.'},
            ].map((r,i)=>(<div key={i} style={{padding:'14px 18px',borderBottom:i<3?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{r.res}</span>
                <Badge color={r.rec==='APPROVE'?T.green:T.amber}>{r.rec}</Badge>
              </div>
              <div style={{fontSize:10,color:T.textMuted,lineHeight:1.4,marginBottom:4}}>{r.rationale}</div>
              <div style={{display:'flex',gap:8}}><Badge color={T.purple}>{r.type}</Badge><span style={{fontSize:9,color:T.textDim}}>Vote: {r.votes}</span></div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {/* ── ATTRIBUTION ENGINE (CIO/Portfolio Manager view) ── */}
      {aView==='attribution'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Total Return (TTM)',v:'+18.6%',d:'NAV basis',c:T.green},
            {l:'Benchmark',v:'+12.4%',d:'Cambridge FoF Index',c:T.blue},
            {l:'Alpha Generated',v:'+6.2%',d:'above benchmark',c:T.accent},
            {l:'Tracking Error',v:'8.4%',d:'annualized',c:T.amber},
            {l:'Information Ratio',v:'0.74',d:'strong risk-adjusted alpha',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Return Attribution — Decomposition by Source" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Attribution Factor','Contribution','Weight','Return','vs Benchmark','Significance'].map(h=><TH key={h} align={h==='Attribution Factor'?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {factor:'GP Selection Alpha',contrib:'+4.8%',weight:'100%',ret:'+4.8%',bench:'+3.2%',sig:'High',detail:'Top-quartile GP access drives 60% of outperformance'},
              {factor:'└ Founders Fund VII',contrib:'+2.9%',weight:'28%',ret:'+10.4%',bench:'+6.8%',sig:'High'},
              {factor:'└ a16z Infra III',contrib:'+1.2%',weight:'18%',ret:'+6.7%',bench:'+5.2%',sig:'Medium'},
              {factor:'└ Sequoia XVI',contrib:'+0.7%',weight:'15%',ret:'+4.7%',bench:'+4.1%',sig:'Low'},
              {factor:'Vintage Timing',contrib:'+1.8%',weight:'—',ret:'—',bench:'—',sig:'Medium',detail:'2022 vintage commitments at cycle trough now appreciate'},
              {factor:'Secondary Discount Capture',contrib:'+2.1%',weight:'22%',ret:'+9.5%',bench:'—',sig:'High',detail:'Ken Wallace pricing framework captures 8-12pp excess return'},
              {factor:'Co-Invest Selection',contrib:'+1.4%',weight:'12%',ret:'+11.7%',bench:'+7.2%',sig:'Medium',detail:'Direct Anthropic and Anduril co-invests outperform fund blended'},
              {factor:'Fee Drag',contrib:'-1.2%',weight:'—',ret:'-1.2%',bench:'-0.8%',sig:'Low',detail:'FoF structure adds ~40bp incremental fee vs direct. Offset by access premium.'},
              {factor:'Cash Drag',contrib:'-0.3%',weight:'8%',ret:'+0.4%',bench:'—',sig:'Low',detail:'Uninvested capital earns T-bill. Minimized by pacing model.'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold={!r.factor.startsWith('└')} color={r.factor.startsWith('└')?T.textMuted:T.text} style={r.factor.startsWith('└')?{paddingLeft:24}:{}}>{r.factor}</TD>
              <TD align="right" mono bold color={r.contrib.startsWith('+')?T.green:T.red}>{r.contrib}</TD>
              <TD align="right" mono>{r.weight}</TD>
              <TD align="right" mono>{r.ret}</TD>
              <TD align="right" mono color={parseFloat(r.bench)>0?T.blue:T.textDim}>{r.bench}</TD>
              <TD align="right"><Badge color={r.sig==='High'?T.accent:r.sig==='Medium'?T.blue:T.textDim}>{r.sig}</Badge></TD>
            </TR>))}</tbody>
          </table></div>
          <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,display:'flex',justifyContent:'space-between'}}>
            <span style={{fontSize:12,fontWeight:700,color:T.text}}>Total Portfolio Return</span>
            <span style={{fontSize:16,fontFamily:mono,fontWeight:900,color:T.green}}>+18.6% (Alpha: +6.2%)</span>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Attribution by Fund — Individual Manager Contribution">
            <div style={{padding:'14px 18px'}}>{[
              {fund:'Founders Fund VII',alloc:28,ret:10.4,contrib:2.91,alpha:3.6,verdict:'Top Decile',c:T.accent},
              {fund:'a16z Infra III',alloc:18,ret:6.7,contrib:1.21,alpha:1.5,verdict:'Top Quartile',c:T.blue},
              {fund:'Sequoia XVI',alloc:15,ret:4.7,contrib:0.71,alpha:0.6,verdict:'2nd Quartile',c:T.green},
              {fund:'NEA 19',alloc:12,ret:3.8,contrib:0.46,alpha:0.2,verdict:'Median',c:T.amber},
              {fund:'Tiger Global PIP 15',alloc:8,ret:14.2,contrib:1.14,alpha:8.4,verdict:'Top Decile *',c:T.red},
              {fund:'General Catalyst XVI',alloc:10,ret:2.1,contrib:0.21,alpha:-1.1,verdict:'3rd Quartile',c:T.textDim},
              {fund:'Insight Onsite VII',alloc:5,ret:1.8,contrib:0.09,alpha:-0.8,verdict:'3rd Quartile',c:T.textDim},
              {fund:'Direct Co-Invests',alloc:4,ret:11.7,contrib:0.47,alpha:5.3,verdict:'Exceptional',c:T.purple},
            ].map((f,i)=>(<div key={i} style={{marginBottom:8}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}>
                  <span style={{width:6,height:6,borderRadius:3,background:f.c}}/>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{f.fund}</span>
                  <Badge color={f.alpha>2?T.green:f.alpha>0?T.blue:T.red}>{f.verdict}</Badge>
                </div>
                <span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:f.contrib>0.5?T.green:f.contrib>0?T.blue:T.red}}>+{f.contrib.toFixed(2)}%</span>
              </div>
              <div style={{display:'flex',gap:12,fontSize:9,color:T.textDim}}>
                <span>Weight: {f.alloc}%</span><span>Return: +{f.ret}%</span><span style={{color:f.alpha>0?T.green:T.red}}>Alpha: {f.alpha>0?'+':''}{f.alpha}%</span>
              </div>
              <Bar value={f.alloc} max={30} color={f.c} h={4}/>
            </div>))}</div>
          </Card>
          <Card title="Factor Decomposition — What's Driving Returns?">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:12}}>Regression of portfolio returns against systematic risk factors</div>
              {[
                {factor:'AI / Foundation Models',beta:0.82,contrib:'+5.8%',r2:0.68,c:T.accent},
                {factor:'Private Markets Illiquidity',beta:0.45,contrib:'+2.1%',r2:0.42,c:T.purple},
                {factor:'Defense/GovTech Spending',beta:0.38,contrib:'+1.8%',r2:0.35,c:T.red},
                {factor:'Risk-On / Growth Factor',beta:0.62,contrib:'+3.2%',r2:0.55,c:T.blue},
                {factor:'Interest Rate Sensitivity',beta:-0.28,contrib:'-0.8%',r2:0.22,c:T.amber},
                {factor:'Idiosyncratic (Unexplained)',beta:'—',contrib:'+6.5%',r2:'—',c:T.green},
              ].map((f,i)=>(<div key={i} style={{marginBottom:10}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                  <div style={{display:'flex',alignItems:'center',gap:6}}>
                    <span style={{width:8,height:8,borderRadius:2,background:f.c}}/>
                    <span style={{fontSize:11,fontWeight:600,color:T.text}}>{f.factor}</span>
                  </div>
                  <div style={{display:'flex',gap:12,alignItems:'center'}}>
                    <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>β={f.beta}</span>
                    <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:f.contrib.startsWith('-')?T.red:T.green}}>{f.contrib}</span>
                  </div>
                </div>
                {f.r2!=='—'&&<Bar value={f.r2*100} max={70} color={f.c} h={4}/>}
              </div>))}
              <div style={{marginTop:8,padding:8,background:T.green+'10',borderRadius:6,border:`1px solid ${T.green}30`}}>
                <div style={{fontSize:10,fontWeight:600,color:T.green}}>Idiosyncratic alpha of +6.5% is the highest in fund history — driven by GP selection and secondary pricing skill.</div>
              </div>
            </div>
          </Card>
        </div>
      </div>)}

      {/* ── TAX & K-1 ENGINE (CFO/Controller view) ── */}
      {aView==='taxlot'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'K-1s Received',v:'6/8',d:'2 outstanding (NEA, Tiger)',c:T.amber},
            {l:'UBTI Exposure',v:'$0',d:'clean — no debt-financed income',c:T.green},
            {l:'Est. Tax Liability',v:'$1.2M',d:'FY 2025 estimated',c:T.red},
            {l:'Unrealized Gains',v:'$48.2M',d:'embedded in fund positions',c:T.accent},
            {l:'State Nexus',v:'3',d:'CA, NY, DE — filing required',c:T.blue},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="K-1 Aggregation & Tax Lot Tracking by Fund" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Fund','K-1 Status','Ordinary Income','ST Cap Gain','LT Cap Gain','Sec 199A','UBTI','Net Tax Impact'].map(h=><TH key={h} align={h==='Fund'||h==='K-1 Status'?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {fund:'Founders Fund VII',status:'Received',ord:'$142K',stcg:'$38K',ltcg:'$680K',s199a:'$0',ubti:'$0',net:'$285K'},
              {fund:'a16z Infra III',status:'Received',ord:'$95K',stcg:'$22K',ltcg:'$410K',s199a:'$12K',ubti:'$0',net:'$175K'},
              {fund:'Sequoia XVI',status:'Received',ord:'$68K',stcg:'$0',ltcg:'$285K',s199a:'$0',ubti:'$0',net:'$118K'},
              {fund:'NEA 19',status:'Pending',ord:'Est. $45K',stcg:'Est. $15K',ltcg:'Est. $180K',s199a:'$0',ubti:'$0',net:'Est. $80K'},
              {fund:'Tiger Global PIP 15',status:'Pending',ord:'Est. $28K',stcg:'$0',ltcg:'Est. $520K',s199a:'$0',ubti:'$0',net:'Est. $182K'},
              {fund:'General Catalyst XVI',status:'Received',ord:'$82K',stcg:'$12K',ltcg:'$195K',s199a:'$8K',ubti:'$0',net:'$96K'},
              {fund:'Insight Onsite VII',status:'Received',ord:'$35K',stcg:'$0',ltcg:'$125K',s199a:'$0',ubti:'$0',net:'$53K'},
              {fund:'Direct Co-Invests',status:'Received',ord:'$0',stcg:'$0',ltcg:'$0',s199a:'$0',ubti:'$0',net:'$0'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.fund}</TD>
              <TD><Badge color={r.status==='Received'?T.green:T.amber}>{r.status}</Badge></TD>
              <TD align="right" mono>{r.ord}</TD>
              <TD align="right" mono>{r.stcg}</TD>
              <TD align="right" mono bold color={T.green}>{r.ltcg}</TD>
              <TD align="right" mono>{r.s199a}</TD>
              <TD align="right" mono color={r.ubti==='$0'?T.green:T.red}>{r.ubti}</TD>
              <TD align="right" mono bold>{r.net}</TD>
            </TR>))}</tbody>
          </table></div>
          <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,display:'flex',justifyContent:'space-between'}}>
            <span style={{fontSize:12,fontWeight:700,color:T.text}}>Total Estimated Tax Liability (FY 2025)</span>
            <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:T.red}}>~$989K received + ~$262K est. pending = $1.25M</span>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Tax Calendar — Filing Deadlines & Estimated Payments">
            <div style={{padding:0}}>{[
              {date:'Mar 15, 2026',item:'K-1 distribution deadline (GP→LP)',status:'6 of 8 received',type:'Inbound',priority:'High'},
              {date:'Apr 15, 2026',item:'Q1 2026 estimated tax payment',status:'$310K due',type:'Payment',priority:'High'},
              {date:'Apr 15, 2026',item:'Federal tax return extension (Form 7004)',status:'To File',type:'Filing',priority:'High'},
              {date:'Jun 15, 2026',item:'Q2 2026 estimated tax payment',status:'$310K estimated',type:'Payment',priority:'Medium'},
              {date:'Sep 15, 2026',item:'Extended federal tax return due',status:'In Preparation',type:'Filing',priority:'High'},
              {date:'Sep 15, 2026',item:'Q3 2026 estimated tax payment',status:'$310K estimated',type:'Payment',priority:'Medium'},
              {date:'Nov 15, 2026',item:'State tax returns due (CA, NY, DE)',status:'Not Started',type:'Filing',priority:'Medium'},
            ].map((d,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<6?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <span style={{fontSize:10,fontFamily:mono,fontWeight:600,color:T.accent,width:90,flexShrink:0}}>{d.date}</span>
              <div style={{flex:1}}><div style={{fontSize:11,fontWeight:500,color:T.text}}>{d.item}</div></div>
              <Badge color={d.type==='Payment'?T.red:d.type==='Filing'?T.blue:T.green}>{d.type}</Badge>
              <span style={{fontSize:10,color:T.textMuted}}>{d.status}</span>
            </div>))}</div>
          </Card>
          <Card title="Unrealized Gain/Loss — Embedded Tax Position">
            <div style={{padding:'14px 18px'}}>
              {[
                {fund:'Founders Fund VII',cost:12.5,fmv:24.8,gain:12.3,character:'LT',holdPeriod:'3.2 yrs'},
                {fund:'a16z Infra III',cost:8.0,fmv:14.2,gain:6.2,character:'LT',holdPeriod:'2.8 yrs'},
                {fund:'Tiger Global PIP 15 (secondary)',cost:4.9,fmv:7.8,gain:2.9,character:'LT',holdPeriod:'0.8 yrs'},
                {fund:'Sequoia XVI',cost:6.5,fmv:11.4,gain:4.9,character:'LT',holdPeriod:'2.1 yrs'},
                {fund:'Anthropic Direct Co-Invest',cost:2.0,fmv:12.4,gain:10.4,character:'LT',holdPeriod:'1.4 yrs'},
              ].map((f,i)=>(<div key={i} style={{marginBottom:8,padding:'8px 0',borderBottom:i<4?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{f.fund}</span>
                  <span style={{fontSize:13,fontFamily:mono,fontWeight:800,color:T.green}}>+${f.gain.toFixed(1)}M</span>
                </div>
                <div style={{display:'flex',gap:12,fontSize:9,color:T.textDim}}>
                  <span>Cost: ${f.cost}M</span><span>FMV: ${f.fmv}M</span><span>Character: {f.character}</span><span>Hold: {f.holdPeriod}</span>
                </div>
              </div>))}
              <div style={{padding:8,background:T.bgAccent,borderRadius:6,marginTop:8}}>
                <div style={{display:'flex',justifyContent:'space-between'}}>
                  <span style={{fontSize:12,fontWeight:700,color:T.text}}>Total Embedded Unrealized Gains</span>
                  <span style={{fontSize:14,fontFamily:mono,fontWeight:900,color:T.green}}>$36.7M</span>
                </div>
                <div style={{fontSize:9,color:T.textDim}}>If realized at current marks → estimated federal tax of ~$7.7M at 21% corporate rate</div>
              </div>
            </div>
          </Card>
        </div>
      </div>)}

      {/* ── EXECUTION DESK (Head of Trading view) ── */}
      {aView==='execution'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Active Orders',v:'3',d:'2 secondary buys + 1 ATM sell',c:T.accent},
            {l:'Settled This Month',v:'$8.2M',d:'across 4 transactions',c:T.green},
            {l:'Pending Settlement',v:'$4.9M',d:'Tiger PIP 15 closes Feb 14',c:T.amber},
            {l:'Best Execution Score',v:'94/100',d:'across all brokers YTD',c:T.blue},
            {l:'Counterparty Risk',v:'LOW',d:'all counterparties investment grade',c:T.green},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Order Book — Active & Recent Transactions" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Order ID','Type','Asset','Direction','Size','Price','Broker','Status','Settlement','Notes'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {id:'ORD-2026-042',type:'Secondary',asset:'Tiger Global PIP 15',dir:'BUY',size:'$4.9M',price:'57¢/$',broker:'Jefferies',status:'Closing',settle:'Feb 14',notes:'Seller wiring. Counsel approved transfer docs.'},
              {id:'ORD-2026-043',type:'ATM',asset:'NEWCO Common',dir:'SELL',size:'65K shs',price:'$24.38',broker:'Goldman Sachs',status:'Active',settle:'T+2 rolling',notes:'ATM program. Selling into volume. VWAP target.'},
              {id:'ORD-2026-044',type:'Secondary',asset:'Insight Partners XII',dir:'BUY',size:'$2.8M',price:'72¢/$',broker:'Lazard',status:'Diligence',settle:'Mar 5 est.',notes:'LOI signed. Awaiting GP consent letter.'},
              {id:'ORD-2026-038',type:'Co-Invest',asset:'Anthropic Series E',dir:'BUY',size:'$4.2M',price:'$75B val',broker:'Direct',status:'Complete',settle:'Jan 28',notes:'Wire confirmed. Shares issued to custodian.'},
              {id:'ORD-2026-035',type:'Secondary',asset:'NEA 19 Strip',dir:'BUY',size:'$3.1M',price:'82¢/$',broker:'Campbell Lutyens',status:'Complete',settle:'Jan 15',notes:'GP consent received. Transfer complete.'},
              {id:'ORD-2026-031',type:'ATM',asset:'NEWCO Common',dir:'SELL',size:'118K shs',price:'$23.90',broker:'Goldman Sachs',status:'Complete',settle:'Jan 31',notes:'January ATM execution. VWAP +$0.12.'},
            ].map((o,i)=>(<TR key={i}>
              <TD mono bold color={T.accent}>{o.id}</TD>
              <TD><Badge color={o.type==='Secondary'?T.purple:o.type==='ATM'?T.blue:T.green}>{o.type}</Badge></TD>
              <TD bold>{o.asset}</TD>
              <TD><Badge color={o.dir==='BUY'?T.green:T.red}>{o.dir}</Badge></TD>
              <TD mono bold>{o.size}</TD>
              <TD mono>{o.price}</TD>
              <TD color={T.textMuted}>{o.broker}</TD>
              <TD><Badge color={o.status==='Active'||o.status==='Closing'?T.amber:o.status==='Diligence'?T.blue:T.green}>{o.status}</Badge></TD>
              <TD mono color={T.textDim}>{o.settle}</TD>
              <TD color={T.textDim}>{o.notes}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Broker Scorecard — Best Execution Analysis">
            <div style={{padding:0}}>{[
              {broker:'Jefferies',deals:8,volume:'$28.4M',avgDiscount:'34%',execution:96,speed:'12 days avg',specialty:'LP Secondaries',rel:'Tier 1'},
              {broker:'Goldman Sachs',deals:12,volume:'$14.2M',avgDiscount:'—',execution:94,speed:'T+2',specialty:'ATM / Capital Markets',rel:'Tier 1'},
              {broker:'Lazard',deals:5,volume:'$15.8M',avgDiscount:'31%',execution:88,speed:'18 days avg',specialty:'Fund Secondaries',rel:'Tier 1'},
              {broker:'Campbell Lutyens',deals:4,volume:'$12.1M',avgDiscount:'28%',execution:85,speed:'22 days avg',specialty:'GP-Led Secondaries',rel:'Tier 2'},
              {broker:'Greenhill',deals:3,volume:'$8.5M',avgDiscount:'36%',execution:82,speed:'15 days avg',specialty:'Distressed / Tail-End',rel:'Tier 2'},
              {broker:'Evercore',deals:2,volume:'$6.2M',avgDiscount:'32%',execution:90,speed:'14 days avg',specialty:'Tech Secondaries',rel:'Tier 2'},
            ].map((b,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <div style={{display:'flex',alignItems:'center',gap:8}}>
                  <span style={{fontSize:12,fontWeight:700,color:T.text}}>{b.broker}</span>
                  <Badge color={b.rel==='Tier 1'?T.accent:T.blue}>{b.rel}</Badge>
                </div>
                <div style={{display:'flex',alignItems:'center',gap:4}}>
                  <div style={{width:40,height:4,background:T.bgAccent,borderRadius:2}}><div style={{width:`${b.execution}%`,height:'100%',background:b.execution>=90?T.green:b.execution>=80?T.blue:T.amber,borderRadius:2}}/></div>
                  <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:b.execution>=90?T.green:b.execution>=80?T.blue:T.amber}}>{b.execution}</span>
                </div>
              </div>
              <div style={{display:'flex',gap:12,fontSize:9,color:T.textDim}}>
                <span>{b.deals} deals</span><span>{b.volume} volume</span><span>Avg disc: {b.avgDiscount}</span><span>Speed: {b.speed}</span><span>{b.specialty}</span>
              </div>
            </div>))}</div>
          </Card>
          <Card title="Settlement Pipeline & Counterparty Risk">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:11,fontWeight:600,color:T.text,marginBottom:10}}>Pending Settlements</div>
              {[
                {txn:'Tiger Global PIP 15',amount:'$4.9M',date:'Feb 14',counterparty:'Tiger Global Management',risk:'Low',custodian:'BNY Mellon',wireStatus:'Pending'},
                {txn:'ATM (Goldman)',amount:'~$1.6M',date:'Rolling T+2',counterparty:'Goldman Sachs & Co.',risk:'Low',custodian:'BNY Mellon',wireStatus:'Auto'},
                {txn:'Insight XII',amount:'$2.8M',date:'~Mar 5',counterparty:'Insight Partners',risk:'Low',custodian:'BNY Mellon',wireStatus:'Not Yet'},
              ].map((s,i)=>(<div key={i} style={{padding:'10px 12px',background:T.bgAccent,borderRadius:6,marginBottom:6,border:`1px solid ${T.border}`}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{s.txn}</span>
                  <span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:T.accent}}>{s.amount}</span>
                </div>
                <div style={{display:'flex',gap:10,fontSize:9,color:T.textDim}}>
                  <span>Settle: {s.date}</span><span>CP: {s.counterparty}</span><span style={{color:T.green}}>Risk: {s.risk}</span><span>Wire: {s.wireStatus}</span>
                </div>
              </div>))}
              <div style={{marginTop:10,padding:8,background:T.green+'10',borderRadius:6,border:`1px solid ${T.green}30`}}>
                <div style={{fontSize:10,fontWeight:600,color:T.green}}>✓ All counterparties investment grade. No settlement fails in 12 months. Custodian: BNY Mellon.</div>
              </div>
            </div>
          </Card>
        </div>
      </div>)}

      {/* ── INVESTOR TARGETING (IR Director view) ── */}
      {aView==='targeting'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Target List',v:'85',d:'institutional prospects',c:T.accent},
            {l:'Active Conversations',v:'23',d:'in various stages',c:T.green},
            {l:'Roadshow Scheduled',v:'Mar 10-14',d:'NYC + Boston',c:T.amber},
            {l:'Conversion Rate',v:'8.2%',d:'prospect → shareholder',c:T.blue},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Investor Targeting Matrix — Institutional Prospects by Fit Score" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Institution','Type','AUM','Alts Allocation','AI Thesis Fit','Our Coverage','Stage','Last Touch','Score'].map(h=><TH key={h} align={['Institution','Type','Stage'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {inst:'T. Rowe Price',type:'Asset Manager',aum:'$1.5T',alts:'8%',fit:92,coverage:'Bob + Jason',stage:'Meeting Scheduled',touch:'Feb 10',score:94},
              {inst:'Fidelity Investments',type:'Asset Manager',aum:'$4.5T',alts:'6%',fit:88,coverage:'Bob',stage:'Initial Outreach',touch:'Feb 5',score:86},
              {inst:'CalPERS',type:'Pension',aum:'$490B',alts:'28%',fit:85,coverage:'Jason',stage:'Warm Introduction',touch:'Jan 28',score:82},
              {inst:'Harvard Management Co.',type:'Endowment',aum:'$50B',alts:'42%',fit:90,coverage:'Jason + Ken',stage:'DD Questions',touch:'Feb 8',score:91},
              {inst:'Wellington Management',type:'Asset Manager',aum:'$1.2T',alts:'12%',fit:82,coverage:'Bob',stage:'Follow-Up',touch:'Jan 22',score:78},
              {inst:'Moore Capital',type:'Hedge Fund',aum:'$8B',alts:'100%',fit:78,coverage:'Ken',stage:'Intro Meeting Done',touch:'Feb 3',score:75},
              {inst:'Yale Investments Office',type:'Endowment',aum:'$41B',alts:'38%',fit:95,coverage:'Jason',stage:'Research Phase',touch:'Dec 15',score:88},
              {inst:'Bridgewater Associates',type:'Hedge Fund',aum:'$124B',alts:'100%',fit:72,coverage:'—',stage:'Cold',touch:'—',score:65},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.inst}</TD>
              <TD><Badge color={r.type==='Endowment'?T.purple:r.type==='Pension'?T.blue:r.type==='Hedge Fund'?T.accent:T.green}>{r.type}</Badge></TD>
              <TD align="right" mono>{r.aum}</TD>
              <TD align="right" mono>{r.alts}</TD>
              <TD align="right"><div style={{display:'flex',alignItems:'center',justifyContent:'flex-end',gap:4}}><div style={{width:32,height:4,background:T.bgAccent,borderRadius:2}}><div style={{width:`${r.fit}%`,height:'100%',background:r.fit>=85?T.green:r.fit>=75?T.blue:T.textDim,borderRadius:2}}/></div><span style={{fontFamily:mono,fontSize:9,fontWeight:600}}>{r.fit}</span></div></TD>
              <TD color={T.textMuted}>{r.coverage}</TD>
              <TD><Badge color={r.stage==='Meeting Scheduled'||r.stage==='DD Questions'?T.green:r.stage.includes('Done')||r.stage==='Follow-Up'?T.blue:r.stage==='Cold'?T.textDim:T.amber}>{r.stage}</Badge></TD>
              <TD align="right" mono color={T.textDim}>{r.touch}</TD>
              <TD align="right" mono bold color={r.score>=85?T.green:r.score>=75?T.blue:T.textDim}>{r.score}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <Card title="Roadshow Planning — NYC + Boston Non-Deal Roadshow (Mar 10-14)">
          <div style={{padding:0}}>{[
            {day:'Mon Mar 10',city:'NYC',meetings:[{time:'9:00 AM',inst:'T. Rowe Price',format:'1-on-1',contact:'Sarah Liu, PM',loc:'Midtown Office'},{time:'11:30 AM',inst:'Moore Capital',format:'1-on-1',contact:'David Park, Analyst',loc:'Their office'},{time:'2:00 PM',inst:'Goldman Sachs PWM',format:'Group (8 advisors)',contact:'Regional Director',loc:'GS Conference Room'}]},
            {day:'Tue Mar 11',city:'NYC',meetings:[{time:'8:30 AM',inst:'Fidelity Investments',format:'1-on-1',contact:'Mike Chen, Alts Research',loc:'Breakfast, The Core Club'},{time:'11:00 AM',inst:'Morgan Stanley PWM',format:'Group (12 advisors)',contact:'NYC Complex Manager',loc:'MS Times Square'},{time:'3:00 PM',inst:'Citadel Advisors',format:'1-on-1',contact:'Sarah Kim, PM',loc:'Citadel Center'}]},
            {day:'Wed Mar 12',city:'NYC→BOS',meetings:[{time:'10:00 AM',inst:'Wellington Management',format:'1-on-1',contact:'James Roberts, Director',loc:'Their office Boston'},{time:'2:30 PM',inst:'Harvard Management Co.',format:'1-on-1',contact:'Investment Committee',loc:'Harvard Campus'}]},
            {day:'Thu Mar 13',city:'Boston',meetings:[{time:'9:00 AM',inst:'Fidelity (Boston HQ)',format:'Group presentation',contact:'Alts Due Diligence Team',loc:'FMR LLC, Summer St'},{time:'1:00 PM',inst:'State Street Global',format:'1-on-1',contact:'Alts Research',loc:'State Street HQ'}]},
          ].map((d,i)=>(<div key={i} style={{padding:'14px 18px',borderBottom:i<3?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:8}}>
              <span style={{fontSize:12,fontWeight:700,color:T.accent}}>{d.day}</span>
              <Badge color={T.blue}>{d.city}</Badge>
              <span style={{fontSize:9,color:T.textDim}}>{d.meetings.length} meetings</span>
            </div>
            <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
              {d.meetings.map((m,j)=>(<div key={j} style={{flex:'1 1 200px',padding:8,background:T.bgAccent,borderRadius:6,border:`1px solid ${T.border}`}}>
                <div style={{fontSize:10,fontFamily:mono,fontWeight:600,color:T.accent}}>{m.time}</div>
                <div style={{fontSize:11,fontWeight:700,color:T.text}}>{m.inst}</div>
                <div style={{fontSize:9,color:T.textMuted}}>{m.format} · {m.contact}</div>
                <div style={{fontSize:8,color:T.textDim}}>{m.loc}</div>
              </div>))}
            </div>
          </div>))}</div>
        </Card>
      </div>)}

      {/* ── RESEARCH ENGINE (Analyst view) ── */}
      {aView==='deepdive'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Active Research',v:'12',d:'companies in coverage',c:T.accent},
            {l:'Thesis Validations',v:'8/12',d:'theses confirmed by data',c:T.green},
            {l:'New Signals (7d)',v:'24',d:'requiring analyst review',c:T.amber},
            {l:'Coverage Universe',v:'130+',d:'look-through companies',c:T.blue},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Research Pipeline — Company Deep-Dive Queue" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Company','Trigger','Analyst','Priority','Stage','Moat Score','Mgmt Score','Market Size','Thesis'].map(h=><TH key={h} align={['Company','Trigger','Analyst','Stage','Thesis'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {co:'Anduril Industries',trigger:'S-1 imminent',analyst:'Ken',pri:'P0',stage:'Final Review',moat:92,mgmt:88,tam:'$180B',thesis:'Defense AI platform monopoly. Lattice OS becomes the operating system of national defense.'},
              {co:'Stripe',trigger:'IPO filing',analyst:'Ken',pri:'P0',stage:'Model Update',moat:95,mgmt:94,tam:'$420B',thesis:'Payment infrastructure as global tax on internet commerce. Developer lock-in is permanent.'},
              {co:'Scale AI',trigger:'New funding round',analyst:'Brett',pri:'P1',stage:'Data Collection',moat:78,mgmt:82,tam:'$85B',thesis:'Data moat from government + enterprise contracts. But commoditization risk from synthetic data.'},
              {co:'Databricks',trigger:'Revenue milestone',analyst:'Ken',pri:'P1',stage:'Thesis Review',moat:88,mgmt:86,tam:'$250B',thesis:'Unified analytics platform. Open-source strategy creates adoption flywheel.'},
              {co:'Figma',trigger:'Post-Adobe recovery',analyst:'Brett',pri:'P2',stage:'Initial Screen',moat:82,mgmt:80,tam:'$32B',thesis:'Collaborative design platform with expanding TAM into whiteboarding and prototyping.'},
              {co:'Vercel',trigger:'New enterprise wins',analyst:'Brett',pri:'P2',stage:'Data Collection',moat:75,mgmt:78,tam:'$18B',thesis:'Frontend cloud captures developer adoption. Next.js framework lock-in. Enterprise tier growing 200%+.'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.co}</TD>
              <TD color={T.textMuted}>{r.trigger}</TD>
              <TD><Badge color={T.blue}>{r.analyst}</Badge></TD>
              <TD align="right"><Badge color={r.pri==='P0'?T.red:r.pri==='P1'?T.amber:T.textDim}>{r.pri}</Badge></TD>
              <TD><Badge color={r.stage==='Final Review'?T.green:r.stage==='Model Update'?T.amber:T.blue}>{r.stage}</Badge></TD>
              <TD align="right" mono bold color={r.moat>=85?T.green:r.moat>=75?T.blue:T.textDim}>{r.moat}</TD>
              <TD align="right" mono color={r.mgmt>=85?T.green:T.blue}>{r.mgmt}</TD>
              <TD align="right" mono>{r.tam}</TD>
              <TD color={T.textDim} style={{maxWidth:200}}>{r.thesis.length>60?r.thesis.slice(0,60)+'…':r.thesis}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <Card title="Company Scoring Framework — Institutional Deep-Dive Template">
          <div style={{padding:'14px 18px'}}>
            <div style={{fontSize:10,color:T.textDim,marginBottom:12}}>Standard scoring dimensions applied to every research target. Each dimension 0-100.</div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
              {[
                {dim:'Competitive Moat',sub:['Switching costs','Network effects','Scale economics','IP/Patents','Brand premium'],weight:25,avg:84},
                {dim:'Management Quality',sub:['Founder-led','Execution track record','Capital allocation','Talent retention','Governance'],weight:20,avg:86},
                {dim:'Market Size & Growth',sub:['TAM at maturity','Current penetration','Growth rate','Secular tailwinds','Expansion optionality'],weight:20,avg:82},
                {dim:'Financial Strength',sub:['Revenue growth','Gross margin profile','Path to profitability','Cash position','Capital efficiency'],weight:15,avg:78},
                {dim:'Valuation & Entry',sub:['Current vs fair value','Revenue multiple trend','Comparable analysis','Discount to IPO est.','Risk-adjusted return'],weight:10,avg:72},
                {dim:'Thesis Conviction',sub:['Data confirmation signals','Negative thesis tested','Independent reference calls','Competitive intelligence','Timing alignment'],weight:10,avg:80},
              ].map((d,i)=>(<div key={i} style={{padding:10,background:T.bgAccent,borderRadius:6}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                  <span style={{fontSize:11,fontWeight:700,color:T.text}}>{d.dim}</span>
                  <div style={{display:'flex',alignItems:'center',gap:4}}>
                    <span style={{fontSize:9,color:T.textDim}}>{d.weight}% weight</span>
                    <span style={{fontSize:13,fontFamily:mono,fontWeight:800,color:d.avg>=80?T.green:d.avg>=70?T.blue:T.amber}}>{d.avg}</span>
                  </div>
                </div>
                <Bar value={d.avg} max={100} color={d.avg>=80?T.green:d.avg>=70?T.blue:T.amber} h={5}/>
                <div style={{fontSize:8,color:T.textDim,marginTop:4}}>{d.sub.join(' · ')}</div>
              </div>))}
            </div>
          </div>
        </Card>
      </div>)}

      {/* ── FUND ADMIN & RECONCILIATION (Operations view) ── */}
      {aView==='reconcile'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Recon Status',v:'CLEAN',d:'0 breaks this period',c:T.green},
            {l:'Cash Position',v:'$18.4M',d:'across all accounts',c:T.blue},
            {l:'Unfunded Commitments',v:'$42.8M',d:'future capital calls',c:T.amber},
            {l:'Pending Cap Calls',v:'2',d:'$3.1M due within 10 days',c:T.red},
            {l:'Distributions Pending',v:'$1.8M',d:'awaiting wire confirmation',c:T.accent},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="NAV Reconciliation — Fund Admin vs Internal Books" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Fund','Fund Admin NAV','Internal NAV','Variance','Variance %','Threshold','Status','Investigator'].map(h=><TH key={h} align={h==='Fund'||h==='Status'||h==='Investigator'?'left':'right'}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {fund:'Founders Fund VII',admin:'$24.82M',internal:'$24.82M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'a16z Infra III',admin:'$14.18M',internal:'$14.20M',var:'$20K',pct:'0.14%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'Sequoia XVI',admin:'$11.38M',internal:'$11.38M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'NEA 19',admin:'$9.45M',internal:'$9.45M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'Tiger Global PIP 15',admin:'$7.82M',internal:'$7.82M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'General Catalyst XVI',admin:'$8.12M',internal:'$8.12M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'Insight Onsite VII',admin:'$5.64M',internal:'$5.64M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
              {fund:'Direct Co-Invests',admin:'$12.42M',internal:'$12.42M',var:'$0',pct:'0.00%',thresh:'±0.5%',status:'Matched',inv:'—'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.fund}</TD>
              <TD align="right" mono>{r.admin}</TD>
              <TD align="right" mono>{r.internal}</TD>
              <TD align="right" mono color={r.var==='$0'?T.green:parseFloat(r.pct)>0.5?T.red:T.amber}>{r.var}</TD>
              <TD align="right" mono>{r.pct}</TD>
              <TD align="right" mono color={T.textDim}>{r.thresh}</TD>
              <TD><Badge color={r.status==='Matched'?T.green:r.status==='Investigating'?T.amber:T.red}>{r.status}</Badge></TD>
              <TD color={T.textDim}>{r.inv}</TD>
            </TR>))}</tbody>
          </table></div>
          <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,display:'flex',justifyContent:'space-between'}}>
            <span style={{fontSize:12,fontWeight:700,color:T.text}}>Total Portfolio NAV (Reconciled)</span>
            <div style={{display:'flex',gap:12}}>
              <span style={{fontSize:10,color:T.textDim}}>Admin: $93.83M</span>
              <span style={{fontSize:10,color:T.textDim}}>Internal: $93.85M</span>
              <span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:T.green}}>Var: $20K (0.02%)</span>
            </div>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Capital Activity Pipeline — Calls & Distributions">
            <div style={{padding:0}}>{[
              {type:'Capital Call',fund:'Founders Fund VII',amount:'$1.8M',date:'Feb 18',purpose:'Follow-on investments',status:'Wire Prepared',wire:'BNY → FF LLC'},
              {type:'Capital Call',fund:'General Catalyst XVI',amount:'$1.3M',date:'Feb 22',purpose:'New platform investment',status:'Pending Notice',wire:'—'},
              {type:'Distribution',fund:'NEA 19',amount:'$0.9M',date:'Feb 20',purpose:'Palantir share sale proceeds',status:'Wire Incoming',wire:'NEA → BNY'},
              {type:'Distribution',fund:'Founders Fund VI',amount:'$0.9M',date:'Mar 1',purpose:'SpaceX tender proceeds',status:'Estimated',wire:'—'},
              {type:'Capital Call',fund:'a16z Infra III',amount:'$0.8M',date:'Mar 5',purpose:'Infrastructure commitments',status:'Estimated',wire:'—'},
            ].map((a,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<4?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <Badge color={a.type==='Capital Call'?T.red:T.green}>{a.type==='Capital Call'?'CALL':'DIST'}</Badge>
              <div style={{flex:1}}>
                <div style={{fontSize:11,fontWeight:600,color:T.text}}>{a.fund}</div>
                <div style={{fontSize:9,color:T.textDim}}>{a.purpose}</div>
              </div>
              <span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:a.type==='Capital Call'?T.red:T.green}}>{a.amount}</span>
              <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{a.date}</span>
              <Badge color={a.status==='Wire Prepared'?T.amber:a.status==='Wire Incoming'?T.green:a.status==='Pending Notice'?T.blue:T.textDim}>{a.status}</Badge>
            </div>))}</div>
          </Card>
          <Card title="Vendor & Service Provider Scorecard">
            <div style={{padding:0}}>{[
              {vendor:'BNY Mellon',role:'Custodian / Fund Admin',sla:'99.8%',cost:'$285K/yr',contract:'Jun 2027',score:94,issues:0},
              {vendor:'KPMG LLP',role:'External Auditor',sla:'100%',cost:'$180K/yr',contract:'Annual',score:92,issues:0},
              {vendor:'Houlihan Lokey',role:'Valuation Agent (Primary)',sla:'98%',cost:'$95K/yr',contract:'Annual',score:88,issues:1},
              {vendor:'Lincoln International',role:'Valuation Agent (Secondary)',sla:'96%',cost:'$75K/yr',contract:'Annual',score:85,issues:1},
              {vendor:'Schulte Roth & Zabel',role:'Fund Counsel',sla:'—',cost:'~$220K/yr',contract:'Ongoing',score:90,issues:0},
              {vendor:'Broadridge',role:'Transfer Agent',sla:'99.5%',cost:'$65K/yr',contract:'Dec 2026',score:86,issues:2},
            ].map((v,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <div style={{flex:1}}>
                <div style={{fontSize:11,fontWeight:600,color:T.text}}>{v.vendor}</div>
                <div style={{fontSize:9,color:T.textDim}}>{v.role}</div>
              </div>
              <div style={{display:'flex',gap:8,alignItems:'center'}}>
                <span style={{fontSize:9,color:T.textDim}}>SLA: {v.sla}</span>
                <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{v.cost}</span>
                <div style={{display:'flex',alignItems:'center',gap:3}}>
                  <div style={{width:32,height:4,background:T.bgAccent,borderRadius:2}}><div style={{width:`${v.score}%`,height:'100%',background:v.score>=90?T.green:v.score>=80?T.blue:T.amber,borderRadius:2}}/></div>
                  <span style={{fontSize:9,fontFamily:mono,fontWeight:600,color:v.score>=90?T.green:v.score>=80?T.blue:T.amber}}>{v.score}</span>
                </div>
              </div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {/* ── LEGAL & CONTRACTS (General Counsel view) ── */}
      {aView==='legal'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Active Contracts',v:'42',d:'across fund commitments',c:T.accent},
            {l:'NDAs Outstanding',v:'8',d:'5 mutual, 3 one-way',c:T.blue},
            {l:'Legal Spend (YTD)',v:'$184K',d:'vs $350K budget',c:T.green},
            {l:'Open Items',v:'6',d:'requiring counsel review',c:T.amber},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Entity Structure & Legal Organization" style={{marginBottom:14}}>
          <div style={{padding:'18px'}}>
            <div style={{fontSize:10,color:T.textDim,marginBottom:12}}>Corporate structure supporting public closed-end fund operations</div>
            {[
              {entity:'NEWCO Fund Inc.',type:'Corporation (MD)',role:'Public registrant. NYSE-listed closed-end fund. 1940 Act registered.',parent:'—',ein:'XX-XXXX001',counsel:'Schulte Roth & Zabel'},
              {entity:'├ NEWCO Advisors LLC',type:'LLC (DE)',role:'Investment advisor. SEC-registered RIA. Management fee recipient.',parent:'NEWCO Fund Inc.',ein:'XX-XXXX002',counsel:'Schulte Roth & Zabel'},
              {entity:'├ NEWCO GP LLC',type:'LLC (DE)',role:'General partner entity for co-investment vehicles.',parent:'NEWCO Fund Inc.',ein:'XX-XXXX003',counsel:'Schulte Roth & Zabel'},
              {entity:'│  └ NEWCO Co-Invest I LP',type:'LP (DE)',role:'Anthropic direct co-invest vehicle. 5 LPs.',parent:'NEWCO GP LLC',ein:'XX-XXXX004',counsel:'Latham & Watkins'},
              {entity:'│  └ NEWCO Co-Invest II LP',type:'LP (DE)',role:'Anduril co-invest vehicle. Formation pending.',parent:'NEWCO GP LLC',ein:'XX-XXXX005',counsel:'Latham & Watkins'},
              {entity:'└ NEWCO Blocker Corp',type:'Corporation (DE)',role:'Tax blocker for UBTI-sensitive investments.',parent:'NEWCO Fund Inc.',ein:'XX-XXXX006',counsel:'Schulte Roth & Zabel'},
            ].map((e,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}>
                  <span style={{fontSize:12,fontWeight:700,color:T.text,fontFamily:mono}}>{e.entity}</span>
                  <Badge color={T.purple}>{e.type}</Badge>
                </div>
                <span style={{fontSize:9,color:T.textDim}}>{e.counsel}</span>
              </div>
              <div style={{fontSize:10,color:T.textMuted}}>{e.role}</div>
            </div>))}
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Side Letter Tracker — Key LP/Fund Provisions">
            <div style={{padding:0}}>{[
              {fund:'Founders Fund VII',provision:'Co-invest rights (pro-rata)',status:'Active',expiry:'Fund life',risk:'None',value:'Exercises 2 of 4 offered'},
              {fund:'a16z Infra III',provision:'MFN + LPAC seat',status:'Active',expiry:'Fund life',risk:'None',value:'Most-favored-nation on fees'},
              {fund:'Sequoia XVI',provision:'Information rights (quarterly)',status:'Active',expiry:'Fund life',risk:'None',value:'Enhanced reporting package'},
              {fund:'Tiger Global PIP 15',provision:'Transfer consent waiver',status:'Pending',expiry:'N/A',risk:'Medium',value:'Need GP consent for secondary purchase'},
              {fund:'NEA 19',provision:'Distribution opt-out (in-kind)',status:'Active',expiry:'Fund life',risk:'Low',value:'Can receive Palantir shares directly'},
              {fund:'Co-Invest I LP',provision:'Key person clause (Jason + Ken)',status:'Active',expiry:'Fund life',risk:'Low',value:'LP can redeem if both depart'},
            ].map((s,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{s.fund}</span>
                  <Badge color={s.status==='Active'?T.green:T.amber}>{s.status}</Badge>
                </div>
                <Badge color={s.risk==='None'?T.green:s.risk==='Low'?T.blue:T.amber}>{s.risk} Risk</Badge>
              </div>
              <div style={{fontSize:10,fontWeight:500,color:T.accent}}>{s.provision}</div>
              <div style={{fontSize:9,color:T.textDim}}>{s.value}</div>
            </div>))}</div>
          </Card>
          <Card title="Regulatory Correspondence & Open Legal Items">
            <div style={{padding:0}}>{[
              {item:'SEC Comment Letter Response',type:'Regulatory',status:'Complete',deadline:'Feb 5, 2026',owner:'Counsel + Matthew',detail:'Responded to 3 comments on N-CSR. SEC acknowledged. No further action.'},
              {item:'ATM Program Amendment Filing',type:'Securities',status:'In Progress',deadline:'Mar 1, 2026',owner:'Goldman + Counsel',detail:'Amend prospectus supplement to increase ATM from $50M to $75M'},
              {item:'Shareholder Rights Plan Extension',type:'Corporate',status:'Under Review',deadline:'Mar 22 (Board)',owner:'Counsel',detail:'Evaluate extending poison pill 1 year vs letting expire Nov 2028'},
              {item:'Co-Invest II LP Formation',type:'Fund Formation',status:'Drafting',deadline:'Mar 15, 2026',owner:'Latham & Watkins',detail:'Anduril co-invest vehicle. LPA, subscription docs, side letters'},
              {item:'D&O Insurance Renewal',type:'Insurance',status:'RFP Phase',deadline:'Apr 1, 2026',owner:'Matthew + Broker',detail:'$25M tower renewal. 3 quotes received. Evaluating pricing vs coverage'},
              {item:'Annual Compliance Review (CCO)',type:'Compliance',status:'Scheduled',deadline:'Apr 15, 2026',owner:'CCO + Counsel',detail:'Rule 38a-1 annual review. Code of ethics, personal trading, proxy voting'},
            ].map((l,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{l.item}</span>
                  <Badge color={l.type==='Regulatory'?T.red:l.type==='Securities'?T.purple:l.type==='Corporate'?T.blue:l.type==='Fund Formation'?T.accent:T.green}>{l.type}</Badge>
                </div>
                <Badge color={l.status==='Complete'?T.green:l.status==='In Progress'||l.status==='Drafting'?T.amber:T.blue}>{l.status}</Badge>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:2}}>{l.detail}</div>
              <div style={{display:'flex',gap:8,fontSize:9,color:T.textDim}}><span>Due: {l.deadline}</span><span>Owner: {l.owner}</span></div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {/* ═══════════════════════════════════════════════════════════════ */}
      {/* ═══  EXECUTIVE & INTELLIGENCE LAYER — Wave 3 Views         ═══ */}
      {/* ═══════════════════════════════════════════════════════════════ */}

      {aView==='pulse'&&(<div>
        <div style={{padding:'14px 18px',background:`linear-gradient(135deg, ${T.accent}08, ${T.purple}05)`,borderRadius:10,border:`1px solid ${T.accent}20`,marginBottom:14}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
            <div><div style={{fontSize:16,fontWeight:900,color:T.text}}>☀️ Morning Pulse — Feb 12, 2026</div><div style={{fontSize:10,color:T.textDim}}>Auto-generated at 6:00 AM PST · Updated 2 minutes ago</div></div>
            <div style={{display:'flex',gap:6}}>{['All Clear','1 Action','2 Watch'].map((b,i)=>(<Badge key={i} color={i===0?T.green:i===1?T.amber:i===2?T.blue:T.textDim}>{b}</Badge>))}</div>
          </div>
          <div style={{fontSize:12,color:T.text,lineHeight:1.6,fontWeight:400}}>
            NEWCO stock closed at $24.38 (+2.1%) on above-average volume (312K vs 248K avg). Renaissance Technologies appeared in Q4 13F with a new 680K share position — quant signal positive.
            Short interest declined 0.8% WoW but borrow cost spiked 400bps to 38.2% annualized — shorts under pressure. ATM program sold 18K shares yesterday at $24.52 capturing 149% premium.
            Anduril S-1 filing reportedly imminent per multiple sources — this is the highest-probability near-term catalyst for NAV uplift (est. +4.8%). No overnight portfolio company alerts.
          </div>
        </div>

        {/* ═══ STRATEGIC BRIEFING — "What Should I Do Next?" ═══ */}
        <Card title="🎯 What Should I Do Next? — Prioritized Action Queue" style={{marginBottom:14,borderLeft:`3px solid ${T.accent}`}}>
          <div style={{padding:0}}>
            {[
              {priority:1,action:'Submit FF VI Secondary Bid',deadline:'TODAY 5PM',owner:'Ken',impact:'$6.8M deploy at est. 32% IRR',status:'CRITICAL',view:'warroom',icon:'🔴',
                context:'Bid prepared at 82¢/$. Counter-party expects response by close. Wire ready. Final check: verify latest marks from Lincoln International haven\'t changed.',
                nextSteps:['Verify bid price against latest NAV data','Confirm wire instructions with Northern Trust','Submit via Setter Capital portal by 4:30 PM']},
              {priority:2,action:'Prepare IC Vote: Thrive Capital IX',deadline:'Tomorrow 9AM',owner:'Ken presenting',impact:'$8M commitment at STRONG BUY conviction',status:'URGENT',view:'icmemo',icon:'🗳️',
                context:'Ken\'s memo scored 4.2/5 conviction. GP quality (Thrive = Kutcher/Kushner) is top-decile. AI exposure 62%. Key risk: concentration in mega-cap AI names.',
                nextSteps:['Review Ken\'s final memo draft','Prepare 3 key questions for IC discussion','Confirm quorum: Jason + Ken + Brett all attending']},
              {priority:3,action:'Finalize Anthropic Co-Invest Subscription',deadline:'Mar 12 wire',owner:'Jason',impact:'$4.2M direct co-invest at $75B last round',status:'HIGH',view:'warroom',icon:'📝',
                context:'Subscription docs 80% complete. Latham reviewing. Co-invest at last round price = significant value vs potential $100B+ IPO. GP allocation confirmed.',
                nextSteps:['Sign subscription agreement (DocuSign pending)','Confirm $4.2M capital available from cash reserve','Schedule wire for Mar 10 (2-day buffer)']},
              {priority:4,action:'Review UC Regents Pitch Deck',deadline:'Feb 28 presentation',owner:'Jason + Ken',impact:'$25M Fund II soft circle (80% probability)',status:'MEDIUM',view:'fundii',icon:'🎓',
                context:'UC Regents IC committee meets Feb 28 in Oakland. This is the second largest soft circle in Fund II pipeline. Focus: impact alignment + Berkeley connection.',
                nextSteps:['Customize deck for endowment audience (impact metrics)','Add Berkeley ecosystem case studies','Practice run with Bob by Feb 25']},
              {priority:5,action:'Monitor Anduril S-1 Filing Signal',deadline:'Imminent (days)',owner:'All',impact:'+4.8% NAV uplift if confirmed',status:'WATCH',view:'ipowatch',icon:'👁️',
                context:'Multiple reliable sources indicate S-1 filing within days. NEWCO holds $18.8M Anduril exposure via FF VII. IPO at $40B+ = 42% markup from current $28B mark.',
                nextSteps:['Set up Bloomberg alert for S-1 filing','Pre-draft investor communication','Model IPO scenarios in Monte Carlo (bull: $50B, base: $40B, bear: $30B)']},
            ].map((a,i)=>(
              <div key={i} style={{padding:'12px 16px',borderBottom:i<4?`1px solid ${T.border}`:'none',cursor:'pointer',transition:'background .1s'}}
                onMouseEnter={e=>e.currentTarget.style.background=`${a.status==='CRITICAL'?T.red:a.status==='URGENT'?T.amber:T.accent}06`}
                onMouseLeave={e=>e.currentTarget.style.background='transparent'}
                onClick={()=>{setAView(a.view);addToast(`Navigated to ${aViews.find(v=>v.id===a.view)?.label||a.view}`);}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>
                    <span style={{fontSize:16,width:22,textAlign:'center'}}>{a.icon}</span>
                    <div>
                      <div style={{fontSize:13,fontWeight:700,color:T.text}}>{a.action}</div>
                      <div style={{display:'flex',gap:6,marginTop:2}}>
                        <Badge color={a.status==='CRITICAL'?T.red:a.status==='URGENT'?T.amber:a.status==='HIGH'?T.blue:a.status==='WATCH'?T.purple:T.textDim}>{a.status}</Badge>
                        <span style={{fontSize:9,color:T.textDim,fontFamily:mono}}>Due: {a.deadline}</span>
                        <span style={{fontSize:9,color:T.textDim}}>Owner: {a.owner}</span>
                      </div>
                    </div>
                  </div>
                  <div style={{textAlign:'right',flexShrink:0}}>
                    <div style={{fontSize:10,color:T.accent,fontWeight:600}}>{a.impact}</div>
                    <div style={{fontSize:8,color:T.textDim,marginTop:1}}>Click to open →</div>
                  </div>
                </div>
                {toggleExpand && isExpanded && isExpanded(`pulse_action_${i}`) ? null : (
                  <div style={{marginLeft:30}}>
                    <div style={{fontSize:10,color:T.textMuted,lineHeight:1.5,marginBottom:4}}>{a.context}</div>
                    <div style={{display:'flex',gap:4,flexWrap:'wrap'}}>
                      {a.nextSteps.map((ns,ni)=>(
                        <span key={ni} style={{fontSize:9,padding:'2px 8px',background:T.bgAccent,border:`1px solid ${T.border}`,borderRadius:4,color:T.text,display:'flex',alignItems:'center',gap:4}}>
                          <span style={{width:5,height:5,borderRadius:3,background:ni===0?T.accent:T.textDim,flexShrink:0}}/>
                          {ns}
                        </span>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,marginBottom:14}}>
          <Card title="📊 Market Overnight">
            <div style={{padding:'10px 14px'}}>{[
              {l:'S&P 500',v:'+0.4%',d:'6,128 — AI stocks led',c:T.green},
              {l:'NASDAQ',v:'+0.7%',d:'19,842 — tech rally broad',c:T.green},
              {l:'10Y Treasury',v:'4.18%',d:'down 3bps — risk-on',c:T.blue},
              {l:'VIX',v:'14.2',d:'down 1.1 — low vol regime',c:T.green},
              {l:'BTC',v:'$98,420',d:'+1.2% — crypto correlated',c:T.accent},
              {l:'NEWCO After-Hrs',v:'$24.55',d:'+$0.17 pre-market',c:T.green},
            ].map((m,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',padding:'5px 0',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <span style={{fontSize:10,color:T.text,fontWeight:500}}>{m.l}</span>
              <div style={{textAlign:'right'}}><span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:m.c}}>{m.v}</span><div style={{fontSize:8,color:T.textDim}}>{m.d}</div></div>
            </div>))}</div>
          </Card>
          <Card title="🚨 Portfolio Signals (24hr) — Click to Investigate">
            <div style={{padding:'10px 14px'}}>{[
              {signal:'Anduril S-1 filing imminent',severity:'HIGH',type:'IPO Catalyst',impact:'+4.8% NAV',c:T.accent,view:'ipowatch'},
              {signal:'Renaissance Tech new 680K position',severity:'MEDIUM',type:'13F Signal',impact:'Institutional validation',c:T.blue,view:'shareholder'},
              {signal:'SpaceX tender offer rumor (unconfirmed)',severity:'WATCH',type:'Liquidity Event',impact:'+18.2% NAV if confirmed',c:T.amber,view:'ipowatch'},
              {signal:'Scale AI lost key customer (Accenture)',severity:'MEDIUM',type:'Revenue Risk',impact:'-0.3% NAV',c:T.red,view:'navmark'},
              {signal:'Palantir awarded $458M Army contract',severity:'LOW',type:'Revenue Signal',impact:'+0.2% NAV',c:T.green,view:'navmark'},
            ].map((s,i)=>(<div key={i} style={{padding:'6px 0',borderBottom:i<4?`1px solid ${T.border}`:'none',cursor:'pointer',transition:'background .1s',borderRadius:4,margin:'0 -4px',padding:'6px 4px'}} onClick={()=>{setAView(s.view);addToast(`Investigating: ${s.signal.split(' ').slice(0,3).join(' ')}...`);}} onMouseEnter={e=>e.currentTarget.style.background=`${s.c}08`} onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                <span style={{fontSize:10,fontWeight:600,color:T.text}}>{s.signal}</span>
                <Badge color={s.c}>{s.severity}</Badge>
              </div>
              <div style={{display:'flex',justifyContent:'space-between'}}>
                <span style={{fontSize:9,color:T.textDim}}>{s.type}</span>
                <span style={{fontSize:9,fontFamily:mono,fontWeight:600,color:s.c}}>{s.impact}</span>
              </div>
            </div>))}</div>
          </Card>
          <Card title="📅 Today's Calendar — Click to Prepare">
            <div style={{padding:'10px 14px'}}>{[
              {time:'9:00 AM',event:'IC Prep: Thrive Capital IX commitment',type:'Meeting',owner:'Ken + Jason',urgent:true,view:'icmemo'},
              {time:'10:30 AM',event:'Mercer Advisors follow-up call',type:'Distribution',owner:'Bob',urgent:false,view:'platform'},
              {time:'11:00 AM',event:'KPMG audit interim call',type:'Compliance',owner:'Matthew',urgent:false,view:'compliance'},
              {time:'1:00 PM',event:'Goldman Sachs — investor 1-on-1',type:'IR',owner:'Jason',urgent:true,view:'ircommand'},
              {time:'2:30 PM',event:'FVC prep: Q1 2026 methodology review',type:'Valuation',owner:'Ken',urgent:false,view:'navmark'},
              {time:'4:00 PM',event:'Board pre-read package due',type:'Governance',owner:'All',urgent:true,view:'boarddeck'},
            ].map((e,i)=>(<div key={i} style={{padding:'5px 0',borderBottom:i<5?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:8,cursor:'pointer',borderRadius:4,margin:'0 -4px',padding:'5px 4px',transition:'background .1s'}} onClick={()=>{setAView(e.view);addToast(`Preparing for: ${e.event.split(':')[0]||e.event.split('—')[0]}`);}} onMouseEnter={ev=>ev.currentTarget.style.background=T.bgAccent+'80'} onMouseLeave={ev=>ev.currentTarget.style.background='transparent'}>
              {e.urgent&&<div style={{width:4,height:4,borderRadius:2,background:T.red,flexShrink:0}}/>}
              <span style={{fontSize:9,fontFamily:mono,color:T.accent,width:52,flexShrink:0}}>{e.time}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:10,fontWeight:e.urgent?600:400,color:T.text}}>{e.event}</div>
                <div style={{fontSize:8,color:T.textDim}}>{e.owner}</div>
              </div>
              <Badge color={e.type==='Meeting'?T.accent:e.type==='IR'?T.blue:e.type==='Governance'?T.purple:T.green}>{e.type}</Badge>
            </div>))}</div>
          </Card>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="📈 Stock Activity Summary — Last 5 Trading Days">
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Date','Close','Δ','Volume','vs Avg','VWAP','Premium','Notable'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
              <tbody>{[
                {date:'Feb 12',close:'$24.38',chg:'+2.1%',vol:'312K',vsAvg:'+25.8%',vwap:'$24.22',prem:'+148%',note:'RenTech 13F filing'},
                {date:'Feb 11',close:'$23.88',chg:'-0.4%',vol:'198K',vsAvg:'-20.2%',vwap:'$23.95',prem:'+143%',note:'Low vol consolidation'},
                {date:'Feb 10',close:'$23.98',chg:'+1.2%',vol:'245K',vsAvg:'-1.2%',vwap:'$23.82',prem:'+144%',note:'Broad market rally'},
                {date:'Feb 7',close:'$23.70',chg:'+0.8%',vol:'280K',vsAvg:'+12.9%',vwap:'$23.55',prem:'+141%',note:'ATM: 22K shares sold'},
                {date:'Feb 6',close:'$23.52',chg:'-1.5%',vol:'410K',vsAvg:'+65.3%',vwap:'$23.80',prem:'+139%',note:'Block trade: 180K shares'},
              ].map((r,i)=>(<TR key={i}>
                <TD bold>{r.date}</TD>
                <TD mono bold>{r.close}</TD>
                <TD mono bold color={r.chg.startsWith('+')?T.green:T.red}>{r.chg}</TD>
                <TD mono>{r.vol}</TD>
                <TD mono color={r.vsAvg.startsWith('+')?T.green:T.red}>{r.vsAvg}</TD>
                <TD mono>{r.vwap}</TD>
                <TD mono color={T.accent}>{r.prem}</TD>
                <TD color={T.textMuted}>{r.note}</TD>
              </TR>))}</tbody>
            </table></div>
          </Card>
          <Card title="⚡ Pending Decisions — Requires Your Input">
            <div style={{padding:0}}>{[
              {decision:'Approve $8M commitment to Thrive Capital IX',deadline:'Feb 14',owner:'IC Vote Required',priority:'URGENT',context:'Ken recommends APPROVE. Bayesian score 84. Strong co-invest rights in Anthropic competitors.'},
              {decision:'Execute Founders Fund VI secondary at 82¢',deadline:'Feb 12 (TODAY)',owner:'Ken + Jason',priority:'CRITICAL',context:'Bid expires 5 PM EST. SpaceX tender rumor makes this 15-20% undervalued. Wire by Feb 14.'},
              {decision:'Increase ATM daily limit from 25K to 40K shares',deadline:'Feb 15',owner:'Jason + Board',priority:'MEDIUM',context:'Premium environment supports accelerated issuance. Each $1M raised at +148% = $0.05 NAV accretion.'},
              {decision:'Pre-clear Q1 insider purchases (post-blackout)',deadline:'Mar 30',owner:'Compliance',priority:'LOW',context:'Trading window reopens Mar 30. Jason and Ken have pre-clearance requests pending.'},
            ].map((d,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<3?`1px solid ${T.border}`:'none',borderLeft:`3px solid ${d.priority==='CRITICAL'?T.red:d.priority==='URGENT'?T.amber:d.priority==='MEDIUM'?T.blue:T.textDim}`}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{d.decision}</span>
                <Badge color={d.priority==='CRITICAL'?T.red:d.priority==='URGENT'?T.amber:T.blue}>{d.priority}</Badge>
              </div>
              <div style={{fontSize:10,color:T.textMuted,lineHeight:1.4,marginBottom:3}}>{d.context}</div>
              <div style={{display:'flex',gap:8,fontSize:9,color:T.textDim}}><span>Deadline: <span style={{color:d.priority==='CRITICAL'?T.red:T.text,fontWeight:600}}>{d.deadline}</span></span><span>Owner: {d.owner}</span></div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='warroom'&&(<div>
        <div style={{padding:'12px 18px',background:T.red+'08',borderRadius:8,border:`1px solid ${T.red}30`,marginBottom:14}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div style={{display:'flex',alignItems:'center',gap:10}}>
              <div style={{width:10,height:10,borderRadius:5,background:T.red,animation:'pulse 1.5s infinite'}}/>
              <div><div style={{fontSize:14,fontWeight:900,color:T.red}}>LIVE SITUATION: Founders Fund VI Secondary — Bid Expires Today</div>
              <div style={{fontSize:10,color:T.textMuted}}>82¢ on NAV · SpaceX tender rumor makes this 15-20% undervalued · Wire deadline Feb 14</div></div>
            </div>
            <div style={{textAlign:'right'}}><div style={{fontSize:24,fontWeight:900,fontFamily:mono,color:T.red}}>4h 32m</div><div style={{fontSize:9,color:T.textDim}}>until bid expiry</div></div>
          </div>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8,marginBottom:14}}>
          {[
            {l:'Deal Value',v:'$6.8M',c:T.accent},
            {l:'Entry Price',v:'82¢/$1',c:T.green},
            {l:'Fair Value Est',v:'96¢-$1.08',c:T.blue},
            {l:'IRR (Base)',v:'38.2%',c:T.accent},
            {l:'IC Vote',v:'3-0-1',c:T.green},
            {l:'Wire Status',v:'PENDING',c:T.amber},
          ].map((s,i)=>(<div key={i} style={{padding:10,background:T.bgCard,borderRadius:6,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`,textAlign:'center'}}>
            <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{s.l}</div>
            <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
          </div>))}
        </div>
        <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:12,marginBottom:14}}>
          <Card title="Deal Execution Checklist — Click to Toggle Status">
            <div style={{padding:0}}>{[
              {step:'1. Seller identification & NDA execution',status:'Complete',time:'Feb 8',owner:'Ken',detail:'Institutional seller via Lazard. NDA mutual, 24-month standstill.'},
              {step:'2. Fund documentation & portfolio review',status:'Complete',time:'Feb 9',owner:'Ken + Brett',detail:'Reviewed LP statements, fund financials, portfolio schedule of investments.'},
              {step:'3. Valuation analysis & pricing model',status:'Complete',time:'Feb 10',owner:'Ken',detail:'DCF on SpaceX/Anduril exposure. Secondary market comps. Fair value range: 96¢-$1.08.'},
              {step:'4. IC presentation & vote',status:'Complete',time:'Feb 11',owner:'All',detail:'Unanimous approval. Ken, Jason, Bob voted FOR. Brett ABSTAIN (conflict on seller side).'},
              {step:'5. Legal review & transfer docs',status:'Complete',time:'Feb 11',owner:'Counsel',detail:'Latham reviewed transfer docs. No consent issues. GP pre-approved.'},
              {step:'6. Counterparty confirmation & bid submission',status:'Complete',time:'Feb 11',owner:'Ken',detail:'Bid submitted at 82¢. Seller responding by 5 PM EST today.'},
              {step:'7. Wire preparation & compliance pre-clearance',status:'In Progress',time:'Feb 12',owner:'Matthew',detail:'Wire instruction drafted for BNY Mellon. Awaiting seller bank details.'},
              {step:'8. Settlement & GP notification',status:'Pending',time:'Feb 14',owner:'Matthew + Counsel',detail:'T+2 settlement. GP requires 5 business days notice of transfer.'},
            ].map((s,i)=>{
              const stateKey=`wr_step_${i}`;
              const overrideStatus=expanded[stateKey];
              const displayStatus=overrideStatus||s.status;
              const statusCycle={'Complete':'In Progress','In Progress':'Pending','Pending':'Complete'};
              return(<div key={i} style={{padding:'10px 16px',borderBottom:i<7?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10,cursor:'pointer',transition:'background .1s'}} onClick={()=>toggleExpand(stateKey)} onMouseEnter={e=>e.currentTarget.style.background=T.bgAccent+'80'} onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
                <div onClick={e=>{e.stopPropagation();setExpanded(p=>({...p,[stateKey]:statusCycle[displayStatus]}));}} style={{width:24,height:24,borderRadius:12,background:displayStatus==='Complete'?T.green+'15':displayStatus==='In Progress'?T.amber+'15':T.bgAccent,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,cursor:'pointer',border:`2px solid ${displayStatus==='Complete'?T.green:displayStatus==='In Progress'?T.amber:T.textDim}40`,transition:'all .15s'}}>
                  <span style={{fontSize:10}}>{displayStatus==='Complete'?'✓':displayStatus==='In Progress'?'◐':'○'}</span>
                </div>
                <div style={{flex:1}}>
                  <div style={{fontSize:11,fontWeight:600,color:T.text,textDecoration:displayStatus==='Complete'?'none':'none'}}>{s.step}</div>
                  <div style={{fontSize:9,color:T.textMuted}}>{s.detail}</div>
                </div>
                <span style={{fontSize:8,fontFamily:mono,color:T.textDim}}>{s.time}</span>
                <Badge color={displayStatus==='Complete'?T.green:displayStatus==='In Progress'?T.amber:T.textDim}>{displayStatus}</Badge>
              </div>);
            })}</div>
            <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`,background:T.bgAccent}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div style={{fontSize:10,color:T.textDim}}>
                  {(()=>{const complete=[0,1,2,3,4,5,6,7].filter(i=>((expanded[`wr_step_${i}`])||['Complete','Complete','Complete','Complete','Complete','Complete','In Progress','Pending'][i])==='Complete').length;return `${complete}/8 steps complete · ${Math.round(complete/8*100)}%`;})()}
                </div>
                <Bar value={(()=>{const complete=[0,1,2,3,4,5,6,7].filter(i=>((expanded[`wr_step_${i}`])||['Complete','Complete','Complete','Complete','Complete','Complete','In Progress','Pending'][i])==='Complete').length;return complete;})() } max={8} color={T.green} h={6}/>
              </div>
            </div>
          </Card>
          <Card title="Counterparty Intelligence">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:11,fontWeight:700,color:T.text,marginBottom:8}}>Seller Profile</div>
              {[
                {l:'Institution',v:'Major Endowment (NDA)',c:T.text},
                {l:'Reason for Sale',v:'Liquidity need — rebalancing alts',c:T.blue},
                {l:'Urgency',v:'HIGH — fiscal year deadline',c:T.red},
                {l:'Broker',v:'Lazard Private Capital',c:T.textMuted},
                {l:'Other Bidders',v:'2 confirmed (est. bids 78¢-84¢)',c:T.amber},
                {l:'Prior Relationship',v:'None — cold introduction',c:T.textDim},
              ].map((p,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',padding:'5px 0',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
                <span style={{fontSize:10,color:T.textDim}}>{p.l}</span>
                <span style={{fontSize:10,fontWeight:600,color:p.c}}>{p.v}</span>
              </div>))}
              <div style={{marginTop:12,padding:8,background:T.green+'10',borderRadius:6,border:`1px solid ${T.green}30`}}>
                <div style={{fontSize:10,fontWeight:700,color:T.green}}>🎯 TACTICAL NOTE</div>
                <div style={{fontSize:9,color:T.text,lineHeight:1.4,marginTop:3}}>Seller has fiscal year deadline (Jun 30). Our 82¢ bid is competitive but not aggressive. SpaceX tender rumor (unconfirmed) could make this 15-20% undervalued. If confirmed before close, consider raising bid to 88¢ to ensure execution.</div>
              </div>
            </div>
          </Card>
        </div>
        <Card title="All Active Situations — Pipeline Dashboard">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Situation','Type','Status','Value','Deadline','Lead','Priority','Next Action'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {sit:'FF VI Secondary',type:'Secondary',status:'LIVE — Bid Submitted',val:'$6.8M',deadline:'TODAY 5PM',lead:'Ken',priority:'CRITICAL',next:'Await seller response. Prepare wire.'},
              {sit:'Anthropic Co-Invest',type:'Co-Invest',status:'IC Approved — Docs',val:'$4.2M',deadline:'Mar 15',lead:'Jason',priority:'HIGH',next:'Finalize subscription. Wire by Mar 12.'},
              {sit:'Thrive Capital IX',type:'New Commitment',status:'IC Vote Pending',val:'$8M',deadline:'Feb 14',lead:'Ken',priority:'HIGH',next:'IC vote tomorrow. Ken presenting.'},
              {sit:'Anduril Co-Invest II',type:'Co-Invest Vehicle',status:'Formation',val:'$5M',deadline:'TBD on S-1',lead:'Brett',priority:'MEDIUM',next:'Latham drafting LPA. 2 LP commits.'},
              {sit:'Databricks Secondary',type:'Secondary',status:'Sourcing',val:'$3-5M',deadline:'No urgency',lead:'Ken',priority:'LOW',next:'Monitoring bid-ask. Waiting for seller.'},
            ].map((s,i)=>(<TR key={i}>
              <TD bold>{s.sit}</TD>
              <TD><Badge color={s.type==='Secondary'?T.blue:s.type==='Co-Invest'?T.accent:s.type==='New Commitment'?T.green:T.purple}>{s.type}</Badge></TD>
              <TD color={T.textMuted}>{s.status}</TD>
              <TD mono bold>{s.val}</TD>
              <TD mono color={s.deadline==='TODAY 5PM'?T.red:T.text} bold={s.deadline==='TODAY 5PM'}>{s.deadline}</TD>
              <TD><Badge color={T.blue}>{s.lead}</Badge></TD>
              <TD><Badge color={s.priority==='CRITICAL'?T.red:s.priority==='HIGH'?T.amber:s.priority==='MEDIUM'?T.blue:T.textDim}>{s.priority}</Badge></TD>
              <TD color={T.textMuted}>{s.next}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
      </div>)}

      {aView==='peerintel'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Peer Vehicles Tracked',v:'6',d:'public pre-IPO/VC vehicles',c:T.accent},
            {l:'Our Premium Rank',v:'#2',d:'2nd highest among peers',c:T.blue},
            {l:'AUM Rank',v:'#1',d:'largest by market cap',c:T.green},
            {l:'Holdings Overlap',v:'42%',d:'avg overlap with top peers',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Peer Vehicle Comparison Matrix — Public Pre-IPO / VC Access Vehicles" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Vehicle','Ticker','AUM','NAV/Sh','Price','Prem/Disc','Expense','Holdings','Top Position','Strategy','Our Edge'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {name:'NEWCO',ticker:'NEWCO',aum:'$582M',nav:'$9.84',price:'$24.38',pd:'+148%',expense:'1.75%',holdings:'130+ (FoF)',top:'Anthropic 24.9%',strat:'AI Safety FoF',edge:'—',ours:true},
              {name:'Destiny Tech100',ticker:'DXYZ',aum:'$42M',nav:'$4.84',price:'$30.12',pd:'+522%',expense:'2.50%',holdings:'28 direct',top:'SpaceX 38%',strat:'Pre-IPO Direct',edge:'More diversified, lower fees, institutional governance'},
              {name:'SV Tech Investors',ticker:'SVVC',aum:'$38M',nav:'$6.12',price:'$3.85',pd:'-37%',expense:'1.50%',holdings:'18 direct',top:'Palantir 42%',strat:'VC Direct',edge:'Premium vs discount, better holdings quality'},
              {name:'Horizon Tech',ticker:'HRZN',aum:'$720M',nav:'$9.68',price:'$10.42',pd:'+8%',expense:'2.00%',holdings:'45 debt',top:'Various tech debt',strat:'Tech Lending',edge:'Equity upside vs fixed income, AI thesis purity'},
              {name:'BlackRock S&T',ticker:'BST',aum:'$1.2B',nav:'$38.95',price:'$36.20',pd:'-7%',expense:'0.88%',holdings:'80+ public',top:'NVIDIA 8%',strat:'Public Tech',edge:'Private access vs public-only, higher alpha potential'},
              {name:'ARK Innovation',ticker:'ARKK',aum:'$6.8B',nav:'N/A',price:'$55.20',pd:'N/A (ETF)',expense:'0.75%',holdings:'32 public',top:'Tesla 12%',strat:'Disruptive Tech',edge:'Pre-IPO access, institutional governance, lower correlation'},
            ].map((v,i)=>(<TR key={i} highlight={v.ours}>
              <TD bold color={v.ours?T.accent:T.text}>{v.name}</TD>
              <TD mono>{v.ticker}</TD>
              <TD mono>{v.aum}</TD>
              <TD mono>{v.nav}</TD>
              <TD mono bold>{v.price}</TD>
              <TD mono bold color={v.pd.startsWith('+')?T.green:v.pd.startsWith('-')?T.red:T.textDim}>{v.pd}</TD>
              <TD mono>{v.expense}</TD>
              <TD color={T.textDim}>{v.holdings}</TD>
              <TD color={T.textMuted}>{v.top}</TD>
              <TD><Badge color={T.purple}>{v.strat}</Badge></TD>
              <TD color={T.green}>{v.edge}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Holdings Overlap Analysis — Where Do We Compete?">
            <div style={{padding:0}}>{[
              {co:'SpaceX',us:'18.6%',dxyz:'38%',svvc:'0%',overlap:'DXYZ',note:'Both via Founders Fund. DXYZ direct, we FoF look-through.'},
              {co:'Anthropic',us:'24.9%',dxyz:'12%',svvc:'0%',overlap:'DXYZ',note:'Our largest position. DXYZ smaller but direct. Our co-invest gives us edge.'},
              {co:'Stripe',us:'9.4%',dxyz:'8%',svvc:'15%',overlap:'Both',note:'We have via Sequoia + a16z. DXYZ direct. SVVC from early rounds.'},
              {co:'Palantir',us:'12.2%',dxyz:'0%',svvc:'42%',overlap:'SVVC',note:'SVVC massively concentrated. We have public + fund look-through.'},
              {co:'Anduril',us:'7.3%',dxyz:'5%',svvc:'0%',overlap:'DXYZ',note:'Both via Founders Fund. Our potential co-invest vehicle differentiates.'},
              {co:'Databricks',us:'5.8%',dxyz:'4%',svvc:'0%',overlap:'DXYZ',note:'We have via a16z Infra. IPO catalyst benefits both vehicles.'},
            ].map((c,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{c.co}</span>
                <div style={{display:'flex',gap:12}}>
                  <span style={{fontSize:10,fontFamily:mono}}><span style={{color:T.accent,fontWeight:700}}>Us: {c.us}</span></span>
                  <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>DXYZ: {c.dxyz}</span>
                  <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>SVVC: {c.svvc}</span>
                </div>
              </div>
              <div style={{fontSize:9,color:T.textMuted}}>{c.note}</div>
            </div>))}</div>
          </Card>
          <Card title="Competitive Positioning — Why Investors Choose Us">
            <div style={{padding:0}}>{[
              {advantage:'Institutional Governance',detail:'Independent directors, KPMG audit, Fair Value Committee, SEC reporting. DXYZ has minimal governance.',score:95},
              {advantage:'Diversification',detail:'130+ companies via 8 funds vs DXYZ direct 28 companies. Lower single-name risk.',score:92},
              {advantage:'Fee Transparency',detail:'Full AFFE disclosure. 1.75% management fee vs DXYZ 2.50%. No incentive fee.',score:88},
              {advantage:'AI Safety Thesis',detail:'Only pure-play AI Safety vehicle in public markets. ESG/impact alignment.',score:85},
              {advantage:'Co-Invest Capability',detail:'Direct co-invest via NEWCO GP LLC. DXYZ is purely passive.',score:82},
              {advantage:'Distribution Infrastructure',detail:'Platform approvals, RIA relationships, Bob Burlinson distribution engine.',score:78},
            ].map((a,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:11,fontWeight:600,color:T.text}}>{a.advantage}</span>
                <span style={{fontSize:12,fontFamily:mono,fontWeight:800,color:T.accent}}>{a.score}</span>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:3}}>{a.detail}</div>
              <Bar value={a.score} max={100} color={a.score>=90?T.green:a.score>=80?T.accent:T.blue} h={4}/>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='sentiment'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Social Volume (7d)',v:'2,845',d:'mentions across platforms',c:T.accent},
            {l:'Sentiment Score',v:'72/100',d:'net positive',c:T.green},
            {l:'Reddit Mentions',v:'186',d:'r/wallstreetbets, r/stocks',c:T.amber},
            {l:'StockTwits Bull%',v:'68%',d:'vs 32% bearish',c:T.green},
            {l:'Meme Stock Risk',v:'MODERATE',d:'elevated retail interest',c:T.amber},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Social Media Monitoring — Top Threads & Discussions (24hr)" style={{marginBottom:14}}>
          <div style={{padding:0}}>{[
            {platform:'Reddit',sub:'r/wallstreetbets',title:'"NEWCO is the DXYZ killer — better governance, lower fees, same SpaceX exposure"',upvotes:842,comments:214,sentiment:'Bullish',impact:'HIGH',detail:'Top post comparing NEWCO to DXYZ favorably. Users highlighting our institutional governance advantage.'},
            {platform:'Reddit',sub:'r/stocks',title:'"Why is NEWCO trading at 148% premium when NAV is only $9.84?"',upvotes:326,comments:89,sentiment:'Skeptical',impact:'MEDIUM',detail:'Educational thread. Top reply accurately explains pre-IPO access premium. Some concern about eventual premium compression.'},
            {platform:'Twitter/X',sub:'@FinTwit',title:'"Anduril S-1 filing imminent — $NEWCO and $DXYZ both have exposure"',upvotes:1245,comments:182,sentiment:'Bullish',impact:'HIGH',detail:'IPO catalyst discussion driving both vehicle interest. NEWCO mentioned alongside DXYZ in every thread.'},
            {platform:'StockTwits',sub:'$NEWCO',title:'"Short squeeze incoming — 18.4% SI with 38% borrow cost is unsustainable"',upvotes:156,comments:67,sentiment:'Very Bullish',impact:'MEDIUM',detail:'Short squeeze narrative building. Technical traders noting days-to-cover. Risk: could attract WSB attention.'},
            {platform:'Reddit',sub:'r/investing',title:'"Closed-end fund premiums: NEWCO at 148% vs DXYZ at 522% — which is more reasonable?"',upvotes:198,comments:43,sentiment:'Neutral',impact:'LOW',detail:'Analytical comparison. Most users favor NEWCO as "more fairly priced" premium vehicle.'},
            {platform:'Twitter/X',sub:'VC Twitter',title:'"The best way to get public exposure to Anthropic without being an LP"',upvotes:892,comments:124,sentiment:'Bullish',impact:'HIGH',detail:'VC community discussing democratization of VC access. NEWCO mentioned as institutional-grade option.'},
          ].map((p,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <Badge color={p.platform==='Reddit'?T.amber:p.platform==='Twitter/X'?T.blue:T.green}>{p.platform}</Badge>
                <span style={{fontSize:9,color:T.textDim}}>{p.sub}</span>
              </div>
              <div style={{display:'flex',gap:6}}>
                <Badge color={p.sentiment==='Bullish'||p.sentiment==='Very Bullish'?T.green:p.sentiment==='Skeptical'?T.amber:T.textDim}>{p.sentiment}</Badge>
                <Badge color={p.impact==='HIGH'?T.red:p.impact==='MEDIUM'?T.amber:T.textDim}>{p.impact}</Badge>
              </div>
            </div>
            <div style={{fontSize:11,fontWeight:600,color:T.text,marginBottom:3}}>{p.title}</div>
            <div style={{fontSize:10,color:T.textMuted,marginBottom:2}}>{p.detail}</div>
            <div style={{display:'flex',gap:12,fontSize:9,color:T.textDim}}>
              <span>▲ {p.upvotes}</span><span>💬 {p.comments}</span>
            </div>
          </div>))}</div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Retail Ownership Estimate & Broker Distribution">
            <div style={{padding:'14px 18px'}}>
              {[
                {broker:'Fidelity',est:'3.2M shares',pct:'13.4%',type:'Mixed retail/institutional',trend:'+8% MoM'},
                {broker:'Charles Schwab',est:'2.1M shares',pct:'8.8%',type:'Primarily retail',trend:'+12% MoM'},
                {broker:'Interactive Brokers',est:'1.8M shares',pct:'7.5%',type:'Active traders',trend:'+22% MoM'},
                {broker:'Robinhood',est:'1.4M shares',pct:'5.9%',type:'Retail/meme risk',trend:'+45% MoM'},
                {broker:'TD Ameritrade',est:'1.1M shares',pct:'4.6%',type:'Self-directed',trend:'+5% MoM'},
                {broker:'Other/DTC',est:'2.8M shares',pct:'11.7%',type:'Various',trend:'Stable'},
              ].map((b,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:i<5?`1px solid ${T.border}`:'none',alignItems:'center'}}>
                <div><div style={{fontSize:11,fontWeight:600,color:T.text}}>{b.broker}</div><div style={{fontSize:9,color:T.textDim}}>{b.type}</div></div>
                <div style={{display:'flex',gap:12,alignItems:'center'}}>
                  <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>{b.est}</span>
                  <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.accent}}>{b.pct}</span>
                  <span style={{fontSize:9,fontFamily:mono,color:b.trend.includes('+')?T.green:T.textDim}}>{b.trend}</span>
                </div>
              </div>))}
              <div style={{marginTop:10,padding:8,background:T.amber+'10',borderRadius:6,border:`1px solid ${T.amber}30`}}>
                <div style={{fontSize:10,fontWeight:700,color:T.amber}}>⚠ MEME STOCK RISK: Robinhood ownership up 45% MoM</div>
                <div style={{fontSize:9,color:T.text,marginTop:2}}>Elevated Robinhood growth + WSB threads could create volatility. Monitor daily. Consider proactive IR messaging if social volume exceeds 5,000/week.</div>
              </div>
            </div>
          </Card>
          <Card title="Narrative Tracking — Key Themes in Social Discussion">
            <div style={{padding:'14px 18px'}}>{[
              {narrative:'Pre-IPO Access Vehicle',volume:42,sentiment:85,trending:'Stable',detail:'Core bull thesis. Retail investors understand the value prop.'},
              {narrative:'Short Squeeze Potential',volume:28,sentiment:78,trending:'↑ Growing',detail:'18.4% SI + high borrow cost driving squeeze narrative. Could attract WSB.'},
              {narrative:'Premium vs NAV Concern',volume:18,sentiment:45,trending:'Stable',detail:'Bears argue premium is unsustainable. Valid risk to monitor.'},
              {narrative:'Anthropic Proxy Play',volume:22,sentiment:92,trending:'↑ Growing',detail:'Investors buying NEWCO specifically for Anthropic exposure. IPO catalyst.'},
              {narrative:'DXYZ Comparison',volume:15,sentiment:72,trending:'↑ New',detail:'Increasing head-to-head comparisons. NEWCO winning on governance/fees.'},
            ].map((n,i)=>(<div key={i} style={{marginBottom:10}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:11,fontWeight:600,color:T.text}}>{n.narrative}</span>
                <div style={{display:'flex',gap:6}}>
                  <span style={{fontSize:9,fontFamily:mono,color:n.trending.includes('↑')?T.green:T.textDim}}>{n.trending}</span>
                  <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{n.volume}% of disc.</span>
                </div>
              </div>
              <Bar value={n.sentiment} max={100} color={n.sentiment>=70?T.green:n.sentiment>=50?T.amber:T.red} h={6}/>
              <div style={{fontSize:9,color:T.textMuted,marginTop:2}}>{n.detail}</div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='feecalc'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Management Fee',v:'1.75%',d:'$2.1M annually on $120M avg AUM',c:T.accent},
            {l:'Look-Through AFFE',v:'3.67%',d:'incl underlying GP fees',c:T.amber},
            {l:'Total Expense Ratio',v:'4.82%',d:'all-in cost to shareholders',c:T.red},
            {l:'Peer Avg Expense',v:'2.12%',d:'across 6 peer vehicles',c:T.blue},
            {l:'Fee Alpha',v:'+14.5%',d:'gross return minus all fees',c:T.green},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Complete Fee Waterfall — From Gross Returns to Net Shareholder Value" style={{marginBottom:14}}>
          <div style={{padding:'18px'}}>
            {[
              {label:'Gross Portfolio Return',value:'+22.4%',amount:'$43.3M',color:T.green,type:'return'},
              {label:'Less: Management Fee (1.75%)',value:'-1.75%',amount:'-$2.1M',color:T.red,type:'fee'},
              {label:'Less: Underlying GP Management Fees (~1.92%)',value:'-1.92%',amount:'-$2.3M',color:T.red,type:'fee'},
              {label:'Less: Underlying GP Carried Interest (~2.8% est)',value:'-2.80%',amount:'-$3.4M',color:T.red,type:'fee'},
              {label:'Less: Fund Admin & Custody (0.15%)',value:'-0.15%',amount:'-$183K',color:T.amber,type:'fee'},
              {label:'Less: Audit & Legal (0.12%)',value:'-0.12%',amount:'-$146K',color:T.amber,type:'fee'},
              {label:'Less: Board & Governance (0.08%)',value:'-0.08%',amount:'-$97K',color:T.amber,type:'fee'},
              {label:'Less: Other Operating (0.10%)',value:'-0.10%',amount:'-$122K',color:T.amber,type:'fee'},
              {label:'Net Return to Shareholders',value:'+15.48%',amount:'$34.8M',color:T.accent,type:'net'},
            ].map((f,i)=>(<div key={i} style={{display:'flex',alignItems:'center',padding:'8px 0',borderBottom:i<8?`1px solid ${i===0||i===8?T.accent:T.border}${i===0?'40':''}`:undefined}}>
              <div style={{flex:1,fontSize:f.type==='return'||f.type==='net'?13:11,fontWeight:f.type==='return'||f.type==='net'?700:400,color:f.type==='fee'?T.textMuted:T.text,paddingLeft:f.type==='fee'?16:0}}>{f.label}</div>
              <span style={{fontSize:f.type==='return'||f.type==='net'?14:11,fontFamily:mono,fontWeight:700,color:f.color,width:60,textAlign:'right'}}>{f.value}</span>
              <span style={{fontSize:11,fontFamily:mono,fontWeight:600,color:f.color,width:80,textAlign:'right'}}>{f.amount}</span>
            </div>))}
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Incentive Fee Scenario Modeling — Proposed Performance Fee Structure">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:10}}>Board Resolution: Reduce base from 1.75% to 1.50%, add 15% incentive over 8% hurdle</div>
              {[
                {scenario:'Bear Case (5% return)',grossReturn:'5.0%',base:'1.50%',incentive:'0.0%',total:'1.50%',saving:'vs current 1.75% = $300K saved',color:T.green},
                {scenario:'At Hurdle (8% return)',grossReturn:'8.0%',base:'1.50%',incentive:'0.0%',total:'1.50%',saving:'Hurdle not exceeded = no incentive',color:T.green},
                {scenario:'Base Case (15% return)',grossReturn:'15.0%',base:'1.50%',incentive:'1.05%',total:'2.55%',saving:'15% × (15%-8%) = 1.05%. Net cost +$960K vs current',color:T.amber},
                {scenario:'Bull Case (25% return)',grossReturn:'25.0%',base:'1.50%',incentive:'2.55%',total:'4.05%',saving:'15% × (25%-8%) = 2.55%. Net cost +$2.76M vs current',color:T.red},
                {scenario:'Exceptional (40% return)',grossReturn:'40.0%',base:'1.50%',incentive:'4.80%',total:'6.30%',saving:'15% × (40%-8%) = 4.80%. Expensive but aligned.',color:T.red},
              ].map((s,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<4?`1px solid ${T.border}`:'none'}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{s.scenario}</span>
                  <span style={{fontSize:12,fontFamily:mono,fontWeight:800,color:s.color}}>{s.total} total</span>
                </div>
                <div style={{display:'flex',gap:12,fontSize:9,color:T.textDim}}>
                  <span>Gross: {s.grossReturn}</span><span>Base: {s.base}</span><span>Incentive: {s.incentive}</span>
                </div>
                <div style={{fontSize:9,color:s.color,marginTop:2}}>{s.saving}</div>
              </div>))}
            </div>
          </Card>
          <Card title="Fee Benchmarking vs Peer Vehicles">
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Vehicle','Mgmt Fee','Incentive','AFFE','Total','Structure'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
              <tbody>{[
                {name:'NEWCO',mgmt:'1.75%',inc:'None',affe:'1.92%',total:'4.82%',structure:'FoF + Direct',ours:true},
                {name:'DXYZ',mgmt:'2.50%',inc:'None',affe:'N/A',total:'2.50%',structure:'Direct only'},
                {name:'SVVC',mgmt:'1.50%',inc:'None',affe:'N/A',total:'1.50%',structure:'Direct only'},
                {name:'BST',mgmt:'0.88%',inc:'None',affe:'N/A',total:'0.88%',structure:'Public equities'},
                {name:'ARKK',mgmt:'0.75%',inc:'None',affe:'N/A',total:'0.75%',structure:'Public ETF'},
                {name:'Typical PE FoF',mgmt:'0.50-1.0%',inc:'5-10%',affe:'2.0%',total:'3.0-4.5%',structure:'FoF benchmark'},
              ].map((v,i)=>(<TR key={i} highlight={v.ours}>
                <TD bold color={v.ours?T.accent:T.text}>{v.name}</TD>
                <TD mono>{v.mgmt}</TD>
                <TD mono>{v.inc}</TD>
                <TD mono>{v.affe}</TD>
                <TD mono bold color={v.ours?T.accent:T.text}>{v.total}</TD>
                <TD color={T.textDim}>{v.structure}</TD>
              </TR>))}</tbody>
            </table></div>
            <div style={{padding:'10px 16px',borderTop:`1px solid ${T.border}`}}>
              <div style={{fontSize:10,color:T.textMuted,lineHeight:1.4}}>
                Note: AFFE (Acquired Fund Fees and Expenses) only applies to FoF structures. Direct vehicles appear cheaper but investors bear illiquidity, concentration, and governance risks. Net of alpha, NEWCO's fee burden is justified by +14.5% net return vs 8.2% average peer return.
              </div>
            </div>
          </Card>
        </div>
      </div>)}

      {aView==='lettergen'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Quarterly Letter',v:'Q4 2025',d:'draft status: 60% complete',c:T.accent},
            {l:'Factsheet',v:'JAN 2026',d:'auto-generated monthly',c:T.green},
            {l:'Investor Deck',v:'v3.2',d:'last updated Feb 8',c:T.blue},
            {l:'Distribution List',v:'1,842',d:'shareholders + prospects',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Quarterly Shareholder Letter Builder — Q4 2025" style={{marginBottom:14}}>
          <div style={{padding:0}}>{[
            {section:'Opening — Market Context & Fund Philosophy',status:'Complete',wordCount:420,tone:'Confident, forward-looking',auto:'65%',preview:'The fourth quarter of 2025 underscored the thesis we have held since inception: artificial intelligence safety is not merely a philosophical concern — it is the defining investment opportunity of this decade...'},
            {section:'Performance Summary',status:'Auto-Generated',wordCount:380,tone:'Data-driven, transparent',auto:'95%',preview:'Fund NAV increased 14.2% in Q4 2025, bringing the full-year return to 38.6% (gross). On a net basis, shareholders benefited from $9.42 to $9.84 NAV per share appreciation. TVPI reached 1.42x...'},
            {section:'Portfolio Highlights — Top Movers',status:'Draft',wordCount:650,tone:'Analytical, thesis-reinforcing',auto:'80%',preview:'Anthropic, our largest position at 24.9% of NAV, saw its valuation increase to $75B following a $3.5B revenue run rate. Constitutional AI continues to differentiate in enterprise sales...'},
            {section:'New Investments & Pipeline',status:'Not Started',wordCount:0,tone:'Selective, conviction-driven',auto:'40%',preview:'[Requires input: 2 new commitments, 1 secondary acquisition to discuss]'},
            {section:'IPO & Exit Outlook',status:'Draft',wordCount:320,tone:'Measured optimism',auto:'70%',preview:'The IPO pipeline has strengthened materially. Anduril Industries is expected to file its S-1 in the near term, and Stripe has reportedly filed confidentially...'},
            {section:'Closing — Outlook & Gratitude',status:'Not Started',wordCount:0,tone:'Personal, mission-driven',auto:'30%',preview:'[Requires Jason personal input on mission, Berkeley connection, long-term vision]'},
          ].map((s,i)=>(<div key={i} style={{padding:'14px 18px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{s.section}</span>
                <Badge color={s.status==='Complete'?T.green:s.status==='Auto-Generated'?T.accent:s.status==='Draft'?T.amber:T.red}>{s.status}</Badge>
              </div>
              <div style={{display:'flex',gap:8}}>
                <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{s.wordCount} words</span>
                <span style={{fontSize:9,color:T.purple}}>AI: {s.auto}</span>
              </div>
            </div>
            <div style={{fontSize:10,color:T.textMuted,fontStyle:'italic',lineHeight:1.4,padding:'4px 0 4px 12px',borderLeft:`2px solid ${T.accent}25`,maxHeight:40,overflow:'hidden'}}>{s.preview}</div>
            <div style={{fontSize:9,color:T.textDim,marginTop:3}}>Tone: {s.tone}</div>
          </div>))}</div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Monthly Factsheet — Auto-Generated Template">
            <div style={{padding:'14px 18px'}}>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,marginBottom:12}}>
                {[
                  {l:'NAV/Share',v:'$9.84'},{l:'Stock Price',v:'$24.38'},{l:'Premium',v:'+148%'},{l:'Mkt Cap',v:'$582M'},
                  {l:'YTD Return',v:'+38.6%'},{l:'TVPI',v:'1.42x'},{l:'IRR (Gross)',v:'28.3%'},{l:'Holdings',v:'130+ cos'},
                ].map((d,i)=>(<div key={i} style={{padding:6,background:T.bgAccent,borderRadius:4}}>
                  <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{d.l}</div>
                  <div style={{fontSize:12,fontWeight:800,fontFamily:mono,color:T.accent}}>{d.v}</div>
                </div>))}
              </div>
              <div style={{fontSize:10,color:T.textMuted,lineHeight:1.4}}>
                Factsheet auto-generated from live portfolio data on the 1st of each month. Distributed to 1,842 subscribers.
                Includes: performance summary, top 10 holdings, sector allocation, vintage breakdown, fee disclosure, and risk metrics.
              </div>
              <div style={{marginTop:8,display:'flex',gap:6}}>
                <Badge color={T.green}>PDF</Badge><Badge color={T.blue}>Email</Badge><Badge color={T.purple}>Website</Badge>
              </div>
            </div>
          </Card>
          <Card title="Investor Presentation Deck — Version Control">
            <div style={{padding:'14px 18px'}}>{[
              {version:'v3.2',date:'Feb 8, 2026',changes:'Added Q4 performance, updated Anduril S-1 slide, refreshed comps',author:'Ken + Jason',status:'Current'},
              {version:'v3.1',date:'Jan 15, 2026',changes:'New "Why NEWCO" positioning slide, updated fee comparison',author:'Bob + Jason',status:'Archive'},
              {version:'v3.0',date:'Dec 1, 2025',changes:'Major redesign. New brand guidelines, 32-slide master deck',author:'Jason',status:'Archive'},
              {version:'v2.5',date:'Sep 15, 2025',changes:'Added secondary market data, IPO pipeline slide',author:'Ken',status:'Archive'},
            ].map((v,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<3?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                <div style={{display:'flex',alignItems:'center',gap:6}}>
                  <span style={{fontSize:12,fontWeight:700,fontFamily:mono,color:v.status==='Current'?T.accent:T.textDim}}>{v.version}</span>
                  <Badge color={v.status==='Current'?T.green:T.textDim}>{v.status}</Badge>
                </div>
                <span style={{fontSize:9,color:T.textDim}}>{v.date} · {v.author}</span>
              </div>
              <div style={{fontSize:10,color:T.textMuted}}>{v.changes}</div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='portopt'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Portfolio Sharpe',v:'1.84',d:'risk-adjusted return',c:T.accent},
            {l:'Optimal Allocation',v:'87%',d:'current vs optimal overlap',c:T.green},
            {l:'Diversification Ratio',v:'1.32',d:'weighted avg corr benefit',c:T.blue},
            {l:'Kelly Utilization',v:'62%',d:'fraction Kelly sizing',c:T.purple},
            {l:'Tracking Error',v:'8.2%',d:'vs Cambridge FoF Index',c:T.amber},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Current vs Optimal Allocation — Mean-Variance Efficient Frontier" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Fund/Strategy','Current %','Optimal %','Δ Action','E[Return]','Vol','Kelly Full','Kelly ½','Conviction','Rationale'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {fund:'Founders Fund VII',cur:22,opt:20,delta:'-2%',ret:'32.1%',vol:'28.5%',kelly:'26%',halfK:'13%',conv:95,rat:'Slightly overweight. Trim via secondary if bid > 95¢.'},
              {fund:'a16z Infra III',cur:18,opt:17,delta:'-1%',ret:'24.5%',vol:'22.0%',kelly:'18%',halfK:'9%',conv:82,rat:'Near optimal. AI Infra thesis intact.'},
              {fund:'NEA 19',cur:14,opt:12,delta:'-2%',ret:'18.2%',vol:'18.5%',kelly:'14%',halfK:'7%',conv:74,rat:'Above optimal. Consider partial secondary.'},
              {fund:'Sequoia XVI',cur:12,opt:14,delta:'+2%',ret:'26.8%',vol:'20.2%',kelly:'20%',halfK:'10%',conv:88,rat:'Underweight. Increase via secondary acquisition.'},
              {fund:'General Catalyst V',cur:10,opt:8,delta:'-2%',ret:'15.4%',vol:'16.8%',kelly:'10%',halfK:'5%',conv:68,rat:'Reduce. Lower alpha than peers.'},
              {fund:'Direct Co-Invests',cur:8,opt:12,delta:'+4%',ret:'42.5%',vol:'35.2%',kelly:'22%',halfK:'11%',conv:96,rat:'Significantly underweight. Highest risk-adj return.'},
              {fund:'Thrive Capital IX (Proposed)',cur:0,opt:6,delta:'+6%',ret:'28.0%',vol:'24.0%',kelly:'16%',halfK:'8%',conv:84,rat:'New commitment. Diversifies GP base into consumer/health.'},
              {fund:'Cash Reserve',cur:16,opt:11,delta:'-5%',ret:'4.8%',vol:'0.0%',kelly:'—',halfK:'—',conv:'—',rat:'Over-cashed. Deploy $6-8M into co-invests and Thrive.'},
            ].map((f,i)=>(<TR key={i}>
              <TD bold>{f.fund}</TD>
              <TD align="right" mono>{f.cur}%</TD>
              <TD align="right" mono bold color={T.accent}>{f.opt}%</TD>
              <TD align="right" mono bold color={f.delta.startsWith('+')?T.green:f.delta.startsWith('-')?T.red:T.textDim}>{f.delta}</TD>
              <TD align="right" mono>{f.ret}</TD>
              <TD align="right" mono>{f.vol}</TD>
              <TD align="right" mono>{f.kelly}</TD>
              <TD align="right" mono>{f.halfK}</TD>
              <TD align="right">{typeof f.conv==='number'?<span style={{fontFamily:mono,fontWeight:700,color:f.conv>=85?T.green:f.conv>=70?T.blue:T.amber}}>{f.conv}</span>:<span style={{color:T.textDim}}>—</span>}</TD>
              <TD color={T.textMuted}>{f.rat}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Commitment Pacing Simulator — Next 12 Months">
            <div style={{padding:'14px 18px'}}>{[
              {quarter:'Q1 2026',committed:'$8M',fund:'Thrive Capital IX',cumulative:'$128M',pctTarget:'78%',note:'New GP relationship. Board approval pending.'},
              {quarter:'Q2 2026',committed:'$5M',fund:'Anduril Co-Invest II',cumulative:'$133M',pctTarget:'81%',note:'Contingent on S-1 filing. LP formation underway.'},
              {quarter:'Q2 2026',committed:'$4M',fund:'Stripe Secondary',cumulative:'$137M',pctTarget:'84%',note:'Dependent on pricing. Target 75-85¢ entry.'},
              {quarter:'Q3 2026',committed:'$6M',fund:'TBD — Emerging Manager',cumulative:'$143M',pctTarget:'87%',note:'Screen emerging GPs in cybersecurity / trust vertical.'},
              {quarter:'Q4 2026',committed:'$10M',fund:'FF VIII (Expected)',cumulative:'$153M',pctTarget:'93%',note:'Re-up with Founders Fund. Largest single commitment.'},
              {quarter:'Q1 2027',committed:'$12M',fund:'Fund II Launch',cumulative:'$165M',pctTarget:'100%',note:'Begin fundraising for NEWCO Fund II vehicle.'},
            ].map((q,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <div style={{display:'flex',alignItems:'center',gap:8}}>
                  <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.accent}}>{q.quarter}</span>
                  <span style={{fontSize:11,fontWeight:600,color:T.text}}>{q.fund}</span>
                </div>
                <div style={{display:'flex',gap:8}}>
                  <span style={{fontSize:11,fontFamily:mono,fontWeight:800,color:T.green}}>{q.committed}</span>
                  <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>cum: {q.cumulative}</span>
                </div>
              </div>
              <Bar value={parseInt(q.pctTarget)} max={100} color={T.accent} h={4}/>
              <div style={{fontSize:9,color:T.textMuted,marginTop:2}}>{q.note}</div>
            </div>))}</div>
          </Card>
          <Card title="Factor Exposure Analysis">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:10}}>Portfolio factor loadings vs benchmark</div>
              {[
                {factor:'AI / ML Technology',loading:0.82,benchmark:0.45,delta:'+0.37',c:T.accent},
                {factor:'US Large Cap Growth',loading:0.65,benchmark:0.52,delta:'+0.13',c:T.blue},
                {factor:'Government/Defense',loading:0.38,benchmark:0.12,delta:'+0.26',c:T.green},
                {factor:'Interest Rate Sensitivity',loading:-0.22,benchmark:-0.15,delta:'-0.07',c:T.amber},
                {factor:'Liquidity Premium',loading:0.78,benchmark:0.35,delta:'+0.43',c:T.purple},
                {factor:'Momentum',loading:0.55,benchmark:0.42,delta:'+0.13',c:T.cyan},
                {factor:'Size (Small Cap)',loading:0.42,benchmark:0.55,delta:'-0.13',c:T.textDim},
                {factor:'Value',loading:-0.45,benchmark:0.18,delta:'-0.63',c:T.red},
              ].map((f,i)=>(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'5px 0',borderBottom:i<7?`1px solid ${T.border}`:'none'}}>
                <span style={{fontSize:10,color:T.text,width:140}}>{f.factor}</span>
                <div style={{flex:1,display:'flex',alignItems:'center',gap:4}}>
                  <div style={{flex:1,height:8,background:T.bgAccent,borderRadius:4,position:'relative',overflow:'hidden'}}>
                    <div style={{position:'absolute',left:f.loading>0?'50%':'auto',right:f.loading<0?'50%':'auto',width:`${Math.abs(f.loading)*50}%`,height:'100%',background:f.c,borderRadius:4}}/>
                    <div style={{position:'absolute',left:'50%',top:0,bottom:0,width:1,background:T.border}}/>
                  </div>
                </div>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:f.c,width:35,textAlign:'right'}}>{f.loading>0?'+':''}{f.loading.toFixed(2)}</span>
                <span style={{fontSize:8,fontFamily:mono,color:f.delta.startsWith('+')?T.green:T.red,width:35,textAlign:'right'}}>{f.delta}</span>
              </div>))}
            </div>
          </Card>
        </div>
      </div>)}

      {aView==='regrisk'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Active Regulations',v:'14',d:'tracked across jurisdictions',c:T.accent},
            {l:'Portfolio Impact',v:'MEDIUM',d:'3 high-impact items',c:T.amber},
            {l:'Compliance Actions',v:'4',d:'required within 90 days',c:T.red},
            {l:'Opportunity Signals',v:'6',d:'regulations creating moats',c:T.green},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Regulatory Impact Matrix — Active Legislation & Rulemaking" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Regulation','Jurisdiction','Status','Timeline','Portfolio Impact','Affected Cos','Opportunity / Risk','Our Action'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {reg:'EU AI Act — GPAI Rules',jur:'EU',status:'Enforcing',time:'Aug 2026',impact:'HIGH — Positive',cos:'Anthropic, Scale AI',opp:'Constitutional AI moat expands. Anthropic best-positioned for compliance.',action:'Monitor enforcement. Update thesis docs.'},
              {reg:'SEC Reg Best Interest',jur:'US Federal',status:'Active',time:'Ongoing',impact:'MEDIUM — Distribution',cos:'All (fund distribution)',opp:'Creates barrier to entry for less-compliant vehicles. Helps platform approvals.',action:'Ensure all advisor materials compliant.'},
              {reg:'CFIUS — AI Export Controls',jur:'US Federal',status:'Expanding',time:'H1 2026',impact:'HIGH — Mixed',cos:'Anthropic, Scale AI, Databricks',opp:'Limits Chinese competition but could restrict customer base.',action:'Track CFIUS reviews on portfolio M&A.'},
              {reg:'California SB-1047 (AI Safety)',jur:'California',status:'Signed',time:'Jan 2027',impact:'MEDIUM — Positive',cos:'Anthropic, Scale AI',opp:'State-level AI safety mandate. Anthropic compliance advantage.',action:'Update investment thesis for CA companies.'},
              {reg:'DOD JADC2 Mandate',jur:'US DoD',status:'Active',time:'Ongoing',impact:'HIGH — Positive',cos:'Anduril, Palantir, Shield AI',opp:'$30B+ in autonomous systems spending. Direct revenue catalyst.',action:'Track contract awards. Update GP scoring.'},
              {reg:'SEC Custody Rule Amendments',jur:'US Federal',status:'Proposed',time:'2027',impact:'MEDIUM — Operational',cos:'Fund operations',opp:'May require enhanced custody procedures for digital assets.',action:'Counsel reviewing. No crypto exposure currently.'},
              {reg:'ITAR / EAR Defense Exports',jur:'US Federal',status:'Tightening',time:'Ongoing',impact:'LOW — Monitor',cos:'Anduril, Shield AI',opp:'Export restrictions may limit TAM but protect domestic share.',action:'Monitor. No direct impact on fund.'},
            ].map((r,i)=>(<TR key={i}>
              <TD bold>{r.reg}</TD>
              <TD><Badge color={r.jur==='EU'?T.blue:r.jur==='US Federal'?T.accent:r.jur==='California'?T.green:T.purple}>{r.jur}</Badge></TD>
              <TD><Badge color={r.status==='Enforcing'?T.green:r.status==='Active'?T.blue:r.status==='Proposed'?T.amber:T.textDim}>{r.status}</Badge></TD>
              <TD mono>{r.time}</TD>
              <TD><Badge color={r.impact.includes('Positive')?T.green:r.impact.includes('Mixed')?T.amber:r.impact.includes('Monitor')?T.textDim:T.blue}>{r.impact}</Badge></TD>
              <TD color={T.textMuted}>{r.cos}</TD>
              <TD color={T.textMuted}>{r.opp}</TD>
              <TD color={T.textDim}>{r.action}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Regulatory Moat Scoring — Which Companies Benefit From Regulation?">
            <div style={{padding:0}}>{[
              {co:'Anthropic',moatScore:95,regs:['EU AI Act','CA SB-1047','CFIUS'],thesis:'Constitutional AI is purpose-built for regulatory compliance. Every new AI regulation widens Anthropic\'s moat vs competitors who prioritize capability over safety.',trend:'Strengthening'},
              {co:'Palantir',moatScore:88,regs:['CFIUS','FedRAMP','ITAR'],thesis:'Government certifications (FedRAMP High, IL5/6) create massive switching costs. 5+ year contract lifecycles. Regulatory moat is the primary competitive advantage.',trend:'Stable'},
              {co:'Anduril',moatScore:82,regs:['JADC2','ITAR','EAR'],thesis:'Defense primes face regulatory barriers to innovation. Anduril\'s software-first approach is uniquely positioned for autonomous systems mandates.',trend:'Strengthening'},
              {co:'Drata',moatScore:76,regs:['SOC 2','GDPR','CCPA'],thesis:'Compliance automation benefits from every new privacy/security regulation. TAM expands with each mandate.',trend:'Strengthening'},
              {co:'Scale AI',moatScore:58,regs:['EU AI Act','CFIUS'],thesis:'Data labeling faces regulatory scrutiny (workforce, bias). CFIUS may limit government data work. Mixed regulatory outlook.',trend:'Uncertain'},
            ].map((c,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<4?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <div style={{display:'flex',alignItems:'center',gap:8}}>
                  <span style={{fontSize:12,fontWeight:700,color:T.text}}>{c.co}</span>
                  <Badge color={c.trend==='Strengthening'?T.green:c.trend==='Stable'?T.blue:T.amber}>{c.trend}</Badge>
                </div>
                <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:c.moatScore>=80?T.green:c.moatScore>=60?T.blue:T.amber}}>{c.moatScore}</span>
              </div>
              <div style={{fontSize:10,color:T.textMuted,lineHeight:1.4,marginBottom:3}}>{c.thesis}</div>
              <div style={{display:'flex',gap:4}}>{c.regs.map(r=><Badge key={r} color={T.bgAccent}>{r}</Badge>)}</div>
            </div>))}</div>
          </Card>
          <Card title="Upcoming Regulatory Calendar — Key Dates">
            <div style={{padding:0}}>{[
              {date:'Feb 28, 2026',event:'SEC — Comment period closes on custody rule amendments',impact:'Fund Ops',action:'Counsel submitting comment letter',urgency:'MEDIUM'},
              {date:'Mar 15, 2026',event:'CFIUS — New AI technology review procedures effective',impact:'Portfolio',action:'Review Anthropic + Scale AI foreign customer lists',urgency:'HIGH'},
              {date:'Apr 1, 2026',event:'EU — AI Office GPAI code of practice final',impact:'Thesis',action:'Update Anthropic regulatory moat scoring',urgency:'MEDIUM'},
              {date:'May 15, 2026',event:'SEC — 13F quarterly filing deadline',impact:'Disclosure',action:'File institutional holdings report',urgency:'LOW'},
              {date:'Jun 1, 2026',event:'California — SB-1047 implementation guidelines',impact:'Portfolio',action:'Assess impact on Bay Area portfolio companies',urgency:'MEDIUM'},
              {date:'Aug 2, 2026',event:'EU AI Act — GPAI transparency obligations effective',impact:'Thesis +',action:'Anthropic compliance advantage crystallizes',urgency:'HIGH'},
              {date:'Sep 1, 2026',event:'DOD — FY2027 budget submission (autonomous systems)',impact:'Revenue',action:'Track Anduril/Shield AI contract pipeline',urgency:'MEDIUM'},
            ].map((d,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<6?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:T.accent,width:80,flexShrink:0}}>{d.date}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11,fontWeight:500,color:T.text}}>{d.event}</div>
                <div style={{fontSize:9,color:T.textMuted}}>{d.action}</div>
              </div>
              <Badge color={d.urgency==='HIGH'?T.red:d.urgency==='MEDIUM'?T.amber:T.textDim}>{d.urgency}</Badge>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {/* ═══════════════════════════════════════════════════════════════ */}
      {/* ═══  WAVE 4: INSTITUTIONAL DEPTH — 8 New Views              ═══ */}
      {/* ═══════════════════════════════════════════════════════════════ */}

      {aView==='fundii'&&(<div>
        <div style={{padding:'14px 18px',background:`linear-gradient(135deg, ${T.green}08, ${T.accent}04)`,borderRadius:10,border:`1px solid ${T.green}25`,marginBottom:14}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div>
              <div style={{fontSize:16,fontWeight:900,color:T.text}}>NEWCO Fund II — Fundraising War Plan</div>
              <div style={{fontSize:10,color:T.textMuted}}>Target: $500M · Launch: Q1 2027 · Strategy: AI Safety + GovTech FoF with Co-Invest</div>
            </div>
            <div style={{display:'flex',gap:12,alignItems:'center'}}>
              <div style={{textAlign:'center'}}><div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:T.green}}>$142M</div><div style={{fontSize:9,color:T.textDim}}>soft circle</div></div>
              <div style={{textAlign:'center'}}><div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:T.accent}}>28%</div><div style={{fontSize:9,color:T.textDim}}>of target</div></div>
            </div>
          </div>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8,marginBottom:14}}>
          {[
            {l:'Target',v:'$500M',c:T.accent},{l:'Hard Circle',v:'$68M',c:T.green},{l:'Soft Circle',v:'$142M',c:T.blue},
            {l:'Pipeline',v:'$385M',c:T.purple},{l:'LPs in DD',v:'14',c:T.amber},{l:'First Close',v:'Jun 2027',c:T.accent},
          ].map((s,i)=>(<div key={i} style={{padding:10,background:T.bgCard,borderRadius:6,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`,textAlign:'center'}}>
            <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{s.l}</div>
            <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
          </div>))}
        </div>
        <Card title="LP Pipeline — Click Any Row for Detail" style={{marginBottom:14}}>
          <div style={{padding:'6px 16px 0',display:'flex',gap:4,marginBottom:6}}>
            {['All','Hard Circle','Soft Circle','DD','Meeting','Sourcing'].map(f=>(
              <FilterPill key={f} label={f} active={getFilter('fundii','stage','All')===f} onClick={()=>setFilter('fundii','stage',f)}/>
            ))}
            <div style={{marginLeft:'auto',fontSize:9,color:T.textDim,fontFamily:mono}}>
              {(()=>{const lps=[
                {inst:'CalPERS',target:50,prob:75},{inst:'UC Regents',target:25,prob:80},{inst:'Mercer (Re-Up)',target:35,prob:95},
                {inst:'Northern Trust',target:30,prob:55},{inst:'TRS Texas',target:40,prob:30},{inst:'Knight Foundation',target:15,prob:70},
                {inst:'Goldman PWM',target:25,prob:40},{inst:'Bessemer Trust',target:20,prob:35},{inst:'Fund I Re-Ups',target:68,prob:90},{inst:'Pipeline',target:192,prob:20},
              ];return `Prob-Weighted: $${lps.reduce((s,l)=>s+l.target*l.prob/100,0).toFixed(0)}M`;})()}
            </div>
          </div>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Institution','Type','AUM','Target $','Stage','Probability','Lead','Next Step','Timeline'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {inst:'CalPERS',type:'Public Pension',aum:'$498B',target:'$50M',targetN:50,stage:'Soft Circle',prob:75,lead:'Jason',next:'Board approval Q2',time:'Jun 2027'},
              {inst:'UC Regents',type:'Endowment',aum:'$178B',target:'$25M',targetN:25,stage:'Soft Circle',prob:80,lead:'Jason',next:'IC presentation Feb 28',time:'Apr 2027'},
              {inst:'Mercer Advisors (Re-Up)',type:'RIA Platform',aum:'$55B',target:'$35M',targetN:35,stage:'Hard Circle',prob:95,lead:'Bob',next:'Sub docs in review',time:'Mar 2027'},
              {inst:'Northern Trust WM',type:'Bank/Trust',aum:'$1.3T',target:'$30M',targetN:30,stage:'DD',prob:55,lead:'Bob',next:'Operational DD call Mar 5',time:'Q3 2027'},
              {inst:'Teacher Retirement System TX',type:'Public Pension',aum:'$210B',target:'$40M',targetN:40,stage:'Meeting',prob:30,lead:'Jason',next:'Initial meeting Mar 12',time:'Q4 2027'},
              {inst:'Knight Foundation',type:'Foundation',aum:'$3.2B',target:'$15M',targetN:15,stage:'Soft Circle',prob:70,lead:'Jason',next:'Impact framework review',time:'May 2027'},
              {inst:'Goldman Sachs PWM',type:'Wirehouses',aum:'$2.7T',target:'$25M',targetN:25,stage:'Platform Review',prob:40,lead:'Bob',next:'DDQ submission Feb 20',time:'Q3 2027'},
              {inst:'Bessemer Trust',type:'Family Office',aum:'$150B',target:'$20M',targetN:20,stage:'Meeting',prob:35,lead:'Jason',next:'Intro dinner Feb 18',time:'Q2 2027'},
              {inst:'Fund I LPs (Re-Up)',type:'Existing',aum:'—',target:'$68M',targetN:68,stage:'Hard Circle',prob:90,lead:'All',next:'Re-up letters sent',time:'Mar 2027'},
              {inst:'Additional Pipeline',type:'Various',aum:'—',target:'$192M',targetN:192,stage:'Sourcing',prob:20,lead:'All',next:'Conference season begins',time:'2027'},
            ].filter(l=>getFilter('fundii','stage','All')==='All'||l.stage===getFilter('fundii','stage','All')).map((l,i)=>(<TR key={i} style={{cursor:'pointer'}} onClick={()=>setDrillDown({
              title:l.inst,subtitle:`${l.type} · AUM: ${l.aum}`,
              badges:[{l:l.stage,c:l.stage==='Hard Circle'?T.green:l.stage==='Soft Circle'?T.blue:T.amber},{l:`${l.prob}%`,c:l.prob>=70?T.green:l.prob>=40?T.amber:T.red}],
              kpis:[{l:'Target',v:l.target,c:T.accent},{l:'Probability',v:`${l.prob}%`,c:l.prob>=70?T.green:T.amber},{l:'Prob-Weighted',v:`$${(l.targetN*l.prob/100).toFixed(0)}M`,c:T.green},{l:'Timeline',v:l.time,c:T.blue}],
              sections:[
                {title:'Contact Details',type:'table',rows:[
                  {l:'Institution',v:l.inst},{l:'Type',v:l.type},{l:'AUM',v:l.aum,mono:true},{l:'Lead',v:l.lead},{l:'Next Step',v:l.next,c:T.accent},
                ]},
                {title:'Fundraising Actions',type:'actions',items:[
                  {icon:'📧',label:'Draft Follow-Up Email',desc:`Compose outreach to ${l.inst}`},
                  {icon:'📊',label:'Generate DDQ',desc:'Auto-fill due diligence questionnaire'},
                  {icon:'📋',label:'Prepare Pitch Deck',view:'boarddeck',desc:'Customized presentation for this LP type'},
                  {icon:'🤝',label:'View LP Portal Preview',view:'lportal',desc:'See what this LP would see'},
                ]}
              ]
            })}>
              <TD bold>{l.inst}</TD>
              <TD><Badge color={l.type==='Public Pension'?T.accent:l.type==='Endowment'?T.purple:l.type==='RIA Platform'?T.green:l.type==='Foundation'?T.blue:T.textDim}>{l.type}</Badge></TD>
              <TD mono>{l.aum}</TD>
              <TD mono bold>{l.target}</TD>
              <TD><Badge color={l.stage==='Hard Circle'?T.green:l.stage==='Soft Circle'?T.blue:l.stage==='DD'?T.amber:l.stage==='Meeting'?T.purple:T.textDim}>{l.stage}</Badge></TD>
              <TD mono bold color={l.prob>=70?T.green:l.prob>=40?T.amber:T.textDim}>{l.prob}%</TD>
              <TD><Badge color={T.blue}>{l.lead}</Badge></TD>
              <TD color={T.textMuted}>{l.next}</TD>
              <TD mono>{l.time}</TD>
            </TR>))}</tbody>
          </table></div>
          {/* Probability-weighted funnel visualization */}
          <div style={{padding:'12px 16px',borderTop:`1px solid ${T.border}`,background:T.bgAccent}}>
            <div style={{display:'flex',alignItems:'center',gap:8}}>
              <span style={{fontSize:9,color:T.textDim,fontWeight:700}}>FUNDRAISING FUNNEL:</span>
              {[{l:'Hard Circle',v:'$68M',pct:14,c:T.green},{l:'Soft Circle',v:'$142M',pct:28,c:T.blue},{l:'In DD',v:'$55M',pct:11,c:T.amber},{l:'Meeting',v:'$60M',pct:12,c:T.purple},{l:'Sourcing',v:'$192M',pct:38,c:T.textDim}].map((f,i)=>(
                <div key={i} style={{flex:f.pct,height:20,background:f.c+'30',borderRadius:i===0?'4px 0 0 4px':i===4?'0 4px 4px 0':0,display:'flex',alignItems:'center',justifyContent:'center',border:`1px solid ${f.c}40`,fontSize:8,fontWeight:600,color:f.c,overflow:'hidden',whiteSpace:'nowrap'}}>
                  {f.pct>15?`${f.l} ${f.v}`:f.v}
                </div>
              ))}
            </div>
            <div style={{display:'flex',justifyContent:'space-between',marginTop:4,fontSize:8,color:T.textDim}}>
              <span>Hard: $68M (14%)</span>
              <span>Soft: $142M (28%)</span>
              <span>Target: $500M</span>
            </div>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Fund II Term Sheet — Key Terms Under Discussion">
            <div style={{padding:0}}>{[
              {term:'Fund Size',proposed:'$500M ($750M hard cap)',benchmark:'$350-800M for emerging FoF',status:'Final',note:'Size supports diversified deployment across 10-12 funds.'},
              {term:'Management Fee',proposed:'1.50% on committed (Yr 1-5), 1.25% on invested (Yr 6+)',benchmark:'1.0-1.75% for FoF',status:'Under Discussion',note:'Lower than Fund I (1.75%). Board reviewing incentive fee addition.'},
              {term:'Incentive Fee',proposed:'15% over 8% preferred return',benchmark:'5-10% typical for FoF',status:'Under Discussion',note:'Higher than typical but aligned with performance. GP co-invest of $5M+.'},
              {term:'GP Commitment',proposed:'$5M (1% of target)',benchmark:'1-3% typical',status:'Final',note:'GP co-invest from management team demonstrates alignment.'},
              {term:'Fund Term',proposed:'12 years + 2×1yr extensions',benchmark:'10-12 years',status:'Final',note:'Extended tail for illiquid positions.'},
              {term:'Co-Invest Rights',proposed:'Pro-rata for LPs > $25M',benchmark:'Varies',status:'Final',note:'Key differentiator. LPs access direct deals at no additional fee.'},
              {term:'LPAC',proposed:'5 seats, quarterly meetings',benchmark:'3-5 seats',status:'Final',note:'Enhanced governance. LPAC has consent rights on conflicts.'},
            ].map((t,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<6?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{t.term}</span>
                <Badge color={t.status==='Final'?T.green:T.amber}>{t.status}</Badge>
              </div>
              <div style={{fontSize:11,color:T.accent,fontWeight:500}}>{t.proposed}</div>
              <div style={{fontSize:9,color:T.textDim}}>Benchmark: {t.benchmark} · {t.note}</div>
            </div>))}</div>
          </Card>
          <Card title="Fundraising Roadshow Calendar — Upcoming Events">
            <div style={{padding:0}}>{[
              {date:'Feb 18',event:'Bessemer Trust Intro Dinner',location:'SF (Quince)',type:'1-on-1',attendees:'Jason + Partner',status:'Confirmed'},
              {date:'Feb 28',event:'UC Regents IC Presentation',location:'Oakland',type:'Formal Pitch',attendees:'Jason + Ken',status:'Confirmed'},
              {date:'Mar 5',event:'Northern Trust Operational DD',location:'Virtual',type:'DD Call',attendees:'Matthew + Counsel',status:'Scheduled'},
              {date:'Mar 12',event:'TRS Texas Initial Meeting',location:'Austin',type:'Intro',attendees:'Jason + Bob',status:'Tentative'},
              {date:'Mar 18-20',event:'ILPA Summit',location:'NYC',type:'Conference',attendees:'Jason + Bob',status:'Registered'},
              {date:'Apr 8-10',event:'Milken Institute Global Conference',location:'LA',type:'Conference',attendees:'Jason',status:'Registered'},
              {date:'May 5-7',event:'Berkeley Haas LP Conference',location:'Berkeley',type:'Hosted Event',attendees:'All',status:'Planning'},
              {date:'Jun 15',event:'TARGET: First Close',location:'—',type:'Milestone',attendees:'All',status:'Target'},
            ].map((e,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<7?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:e.type==='Milestone'?T.accent:T.text,width:55,flexShrink:0}}>{e.date}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11,fontWeight:e.type==='Milestone'?800:500,color:e.type==='Milestone'?T.accent:T.text}}>{e.event}</div>
                <div style={{fontSize:9,color:T.textDim}}>{e.location} · {e.attendees}</div>
              </div>
              <Badge color={e.status==='Confirmed'?T.green:e.status==='Scheduled'?T.blue:e.status==='Target'?T.accent:T.textDim}>{e.status}</Badge>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='lportal'&&(<div>
        <div style={{padding:'14px 18px',background:T.bgCard,borderRadius:10,border:`1px solid ${T.accent}20`,marginBottom:14}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div><div style={{fontSize:16,fontWeight:900,color:T.text}}>LP Portal Preview — What Your Investors See</div>
            <div style={{fontSize:10,color:T.textDim}}>Simulated LP experience · Mercer Advisors (Gold Tier) · $25M commitment</div></div>
            <Badge color={T.accent}>PREVIEW MODE</Badge>
          </div>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Commitment',v:'$25.0M',d:'Fund I',c:T.accent},{l:'Contributed',v:'$18.2M',d:'72.8% drawn',c:T.blue},
            {l:'NAV',v:'$25.8M',d:'as of Dec 31, 2025',c:T.green},{l:'TVPI',v:'1.42x',d:'vs 1.28x benchmark',c:T.accent},
            {l:'Distributions',v:'$4.0M',d:'DPI: 0.22x',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:14}}>
          <Card title="Capital Account Statement — Quarterly">
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Period','Called','Distributed','Net Cash Flow','NAV','TVPI','IRR'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
              <tbody>{[
                {q:'Q4 2025',called:'$2.0M',dist:'$0.8M',net:'-$1.2M',nav:'$25.8M',tvpi:'1.42x',irr:'22.4%'},
                {q:'Q3 2025',called:'$3.5M',dist:'$1.2M',net:'-$2.3M',nav:'$22.6M',tvpi:'1.35x',irr:'19.8%'},
                {q:'Q2 2025',called:'$2.8M',dist:'$0.5M',net:'-$2.3M',nav:'$19.4M',tvpi:'1.28x',irr:'16.2%'},
                {q:'Q1 2025',called:'$2.2M',dist:'$0.8M',net:'-$1.4M',nav:'$16.8M',tvpi:'1.22x',irr:'14.5%'},
                {q:'Q4 2024',called:'$3.0M',dist:'$0.4M',net:'-$2.6M',nav:'$14.2M',tvpi:'1.15x',irr:'12.1%'},
                {q:'Cumulative',called:'$18.2M',dist:'$4.0M',net:'-$14.2M',nav:'$25.8M',tvpi:'1.42x',irr:'22.4%'},
              ].map((r,i)=>(<TR key={i} highlight={i===5}>
                <TD bold={i===5}>{r.q}</TD><TD mono>{r.called}</TD><TD mono color={T.green}>{r.dist}</TD>
                <TD mono color={T.red}>{r.net}</TD><TD mono bold>{r.nav}</TD>
                <TD mono bold color={T.accent}>{r.tvpi}</TD><TD mono bold color={T.green}>{r.irr}</TD>
              </TR>))}</tbody>
            </table></div>
          </Card>
          <Card title="Document Vault — LP Access">
            <div style={{padding:0}}>{[
              {doc:'Q4 2025 Quarterly Report',type:'Report',date:'Feb 15, 2026',status:'Available',pages:28},
              {doc:'Q4 2025 Capital Account Statement',type:'Financial',date:'Feb 15, 2026',status:'Available',pages:4},
              {doc:'2024 Schedule K-1',type:'Tax',date:'Mar 15, 2025',status:'Available',pages:12},
              {doc:'2025 Schedule K-1 (Estimated)',type:'Tax',date:'Mar 15, 2026',status:'Pending',pages:0},
              {doc:'Q4 2025 NAV Letter',type:'Valuation',date:'Jan 31, 2026',status:'Available',pages:2},
              {doc:'Annual Meeting Materials — 2026',type:'Governance',date:'Apr 1, 2026',status:'Not Yet',pages:0},
              {doc:'Audited Financial Statements FY2025',type:'Audit',date:'Mar 30, 2026',status:'In Progress',pages:0},
              {doc:'Subscription Agreement (Executed)',type:'Legal',date:'Jun 15, 2024',status:'Available',pages:42},
            ].map((d,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<7?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:10}}>
              <div style={{flex:1}}>
                <div style={{fontSize:11,fontWeight:500,color:T.text}}>{d.doc}</div>
                <div style={{fontSize:9,color:T.textDim}}>{d.date}{d.pages?' · '+d.pages+' pages':''}</div>
              </div>
              <Badge color={d.type==='Report'?T.accent:d.type==='Tax'?T.purple:d.type==='Financial'?T.blue:d.type==='Valuation'?T.green:T.textDim}>{d.type}</Badge>
              <Badge color={d.status==='Available'?T.green:d.status==='Pending'||d.status==='In Progress'?T.amber:T.textDim}>{d.status}</Badge>
            </div>))}</div>
          </Card>
        </div>
        <Card title="Portfolio Summary — Top Holdings (What LPs See)">
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Company','Sector','Access Via','% of NAV','FMV','Stage','Note'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {co:'Anthropic',sector:'AI Safety',via:'Founders Fund, NEA, Co-Invest I',pct:'24.9%',fmv:'$48.2M',stage:'Late / Pre-IPO',note:'Constitutional AI leader. $75B valuation.'},
              {co:'SpaceX',sector:'Space / Defense',via:'Founders Fund VII',pct:'18.6%',fmv:'$36.0M',stage:'Late / Pre-IPO',note:'$350B valuation. Tender offer activity.'},
              {co:'Palantir Technologies',sector:'GovTech / AI',via:'NEA 19',pct:'12.2%',fmv:'$23.6M',stage:'Public',note:'NYSE: PLTR. AIP platform driving growth.'},
              {co:'Anduril Industries',sector:'Defense Tech',via:'Lux Capital, Founders Fund',pct:'7.3%',fmv:'$14.1M',stage:'Late / Pre-IPO',note:'S-1 expected. $14B valuation.'},
              {co:'Stripe',sector:'Fintech',via:'Sequoia, a16z',pct:'9.4%',fmv:'$18.2M',stage:'Late / Pre-IPO',note:'Confidential S-1 filed.'},
              {co:'Other (120+ companies)',sector:'Various',via:'8 underlying funds',pct:'27.6%',fmv:'$53.4M',stage:'Mixed',note:'Diversified across AI, Defense, Trust.'},
            ].map((c,i)=>(<TR key={i}>
              <TD bold>{c.co}</TD><TD><Badge color={T.purple}>{c.sector}</Badge></TD>
              <TD color={T.textDim}>{c.via}</TD><TD mono bold color={T.accent}>{c.pct}</TD>
              <TD mono>{c.fmv}</TD><TD><Badge color={c.stage==='Public'?T.green:T.blue}>{c.stage}</Badge></TD>
              <TD color={T.textMuted}>{c.note}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
      </div>)}

      {aView==='montecarlo'&&(<div>
        {/* ── MODE TOGGLE ── */}
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <div style={{display:'flex',gap:4}}>
            {['distribution','scenarios','sensitivity','stress'].map(m=>(
              <FilterPill key={m} label={m==='distribution'?'📊 Distribution':m==='scenarios'?'🎭 Scenarios':m==='sensitivity'?'🎚️ Sensitivity':'💥 Stress Test'} active={getMode('mc','distribution')===m} onClick={()=>setMode('mc',m)}/>
            ))}
          </div>
          <div style={{display:'flex',gap:6,alignItems:'center'}}>
            <span style={{fontSize:9,color:T.textDim}}>Sims:</span>
            {[1000,5000,10000,50000].map(n=>(
              <FilterPill key={n} label={n>=1000?`${n/1000}K`:n} active={(sc.mcSimCount||10000)===n} onClick={()=>setSlider('mcSimCount',n)}/>
            ))}
          </div>
        </div>

        {/* ── DISTRIBUTION MODE (default) ── */}
        {getMode('mc','distribution')==='distribution'&&(<>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {(()=>{
            const vol=sc.mcVolatility||28;
            const sims=sc.mcSimCount||10000;
            const medianTvpi=1.82*(1+(vol-28)/100*0.3);
            const p95=2.94*(1+(vol-28)/100*0.5);
            const p5=0.91*(1-(vol-28)/100*0.4);
            const prob2x=Math.max(5,Math.min(65,38.4+(vol-28)*0.8));
            return [
              {l:'Simulations',v:sims>=1000?`${(sims/1000).toFixed(0)}K`:sims,d:'Monte Carlo paths',c:T.accent},
              {l:'Median TVPI',v:`${medianTvpi.toFixed(2)}x`,d:'50th percentile outcome',c:T.green},
              {l:'95th % TVPI',v:`${p95.toFixed(2)}x`,d:'upside scenario',c:T.blue},
              {l:'5th % TVPI',v:`${p5.toFixed(2)}x`,d:'downside stress',c:T.red},
              {l:'Prob > 2.0x',v:`${prob2x.toFixed(1)}%`,d:'exceeding target',c:T.purple},
            ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
              <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
              <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
              <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
            </div>));
          })()}
        </div>

        {/* Interactive volatility slider */}
        <Card title="Simulation Parameters — Adjust Assumptions" style={{marginBottom:14}}>
          <div style={{padding:'12px 18px'}}>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:16}}>
              <div>
                <SliderInput label="Portfolio Volatility (σ)" k="mcVolatility" min={10} max={50} step={1} unit="%" fmt={v=>`${v}%`}/>
                <div style={{fontSize:9,color:T.textMuted}}>Higher volatility widens the distribution. VC portfolios typically 25-35%.</div>
              </div>
              <div>
                <SliderInput label="Correlation Factor" k="mcCorrelation" min={0} max={100} step={5} unit="%" fmt={v=>`${v}%`}/>
                <div style={{fontSize:9,color:T.textMuted}}>Inter-position correlation. Higher = more concentrated risk.</div>
              </div>
              <div>
                <SliderInput label="Exit Timing Uncertainty" k="mcExitUncertainty" min={6} max={36} step={3} unit="mo" fmt={v=>`±${v} months`}/>
                <div style={{fontSize:9,color:T.textMuted}}>How much IPO/exit timing can deviate from expectations.</div>
              </div>
            </div>
          </div>
        </Card>

        <Card title="Monte Carlo Distribution — Simulated Portfolio Outcomes" style={{marginBottom:14}}>
          <div style={{padding:'18px'}}>
            <div style={{display:'flex',gap:2,alignItems:'flex-end',height:180,marginBottom:12}}>
              {(()=>{
                const vol=sc.mcVolatility||28;
                const spread=vol/28;
                return [
                  {range:'<0.5x',count:Math.round(42*spread),pct:+(0.4*spread).toFixed(1)},{range:'0.5-0.75x',count:Math.round(185*spread),pct:+(1.9*spread).toFixed(1)},{range:'0.75-1.0x',count:Math.round(612*spread),pct:+(6.1*spread).toFixed(1)},
                  {range:'1.0-1.25x',count:Math.round(1248/spread),pct:+(12.5/spread).toFixed(1)},{range:'1.25-1.5x',count:Math.round(2105/spread),pct:+(21.1/spread).toFixed(1)},{range:'1.5-1.75x',count:2340,pct:23.4},
                  {range:'1.75-2.0x',count:Math.round(1645/spread),pct:+(16.5/spread).toFixed(1)},{range:'2.0-2.5x',count:Math.round(1120*spread),pct:+(11.2*spread).toFixed(1)},{range:'2.5-3.0x',count:Math.round(448*spread),pct:+(4.5*spread).toFixed(1)},
                  {range:'3.0-4.0x',count:Math.round(195*spread),pct:+(2.0*spread).toFixed(1)},{range:'4.0-5.0x',count:Math.round(48*spread),pct:+(0.5*spread).toFixed(1)},{range:'>5.0x',count:Math.round(12*spread),pct:+(0.1*spread).toFixed(1)},
                ].map((b,i)=>{
                  const maxPct=Math.max(...[23.4,21.1/spread,12.5/spread,16.5/spread].map(Math.abs));
                  const maxH=160;const h=Math.max(4,(b.pct/maxPct)*maxH);
                  const isMedian=i===5;const isCurrent=i===4;
                  return(<div key={i} style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',gap:2}}>
                    <span style={{fontSize:7,fontFamily:mono,color:isMedian?T.accent:isCurrent?T.green:T.textDim}}>{b.pct}%</span>
                    <div style={{width:'100%',height:h,background:b.pct<2?T.red+'60':isMedian?T.accent:isCurrent?T.green+'80':T.blue+'60',borderRadius:2,transition:'height .3s'}}/>
                    <span style={{fontSize:7,color:T.textDim,writingMode:'vertical-lr',height:40,overflow:'hidden'}}>{b.range}</span>
                  </div>);
                });
              })()}
            </div>
            <div style={{display:'flex',justifyContent:'space-between',fontSize:9,color:T.textDim}}>
              <span>← Loss scenarios</span>
              <span style={{color:T.green,fontWeight:700}}>Current: 1.42x</span>
              <span style={{color:T.accent,fontWeight:700}}>Median: 1.82x</span>
              <span>Exceptional outcomes →</span>
            </div>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Regime-Conditional Scenarios">
            <div style={{padding:0}}>{[
              {regime:'AI Bull (40% prob)',desc:'Multiple IPOs execute, AI spending accelerates',median:'2.35x',p5:'1.45x',p95:'4.12x',navImpact:'+62%',color:T.green},
              {regime:'Base Case (35% prob)',desc:'2-3 IPOs, steady growth, moderate premium compression',median:'1.72x',p5:'1.15x',p95:'2.48x',navImpact:'+28%',color:T.blue},
              {regime:'AI Winter (15% prob)',desc:'Funding freeze, down rounds, extended hold periods',median:'1.08x',p5:'0.65x',p95:'1.55x',navImpact:'-18%',color:T.amber},
              {regime:'Systemic Crisis (10% prob)',desc:'Recession + regulation + defense cuts',median:'0.78x',p5:'0.42x',p95:'1.12x',navImpact:'-42%',color:T.red},
            ].map((r,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<3?`1px solid ${T.border}`:'none',borderLeft:`3px solid ${r.color}`,cursor:'pointer'}} onClick={()=>setDrillDown({
              title:r.regime,subtitle:r.desc,
              badges:[{l:r.navImpact,c:r.color}],
              kpis:[{l:'Median TVPI',v:r.median,c:r.color},{l:'5th %',v:r.p5,c:T.red},{l:'95th %',v:r.p95,c:T.green},{l:'NAV Impact',v:r.navImpact,c:r.color}],
              sections:[
                {title:'Scenario Description',type:'text',content:r.desc},
                {title:'Portfolio Impact By Position',type:'bars',items:positions.slice(0,6).map(p=>({l:p.fund.split(' ').slice(0,2).join(' '),v:`$${(p.nav*(1+parseFloat(r.navImpact)/100)).toFixed(1)}M`,pct:Math.max(0,50+parseFloat(r.navImpact)/2),c:r.color}))},
                {title:'Actions',type:'actions',items:[
                  {icon:'🎚️',label:'Run Scenario Sliders',view:'premdisc',desc:'Model impact on premium/discount'},
                  {icon:'⚡',label:'Check Risk Limits',view:'concentration',desc:'Verify constraint compliance under stress'},
                ]}
              ]
            })}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{r.regime}</span>
                <span style={{fontSize:14,fontFamily:mono,fontWeight:800,color:r.color}}>{r.median}</span>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:4}}>{r.desc}</div>
              <div style={{display:'flex',gap:16,fontSize:9,fontFamily:mono}}>
                <span style={{color:T.red}}>5th: {r.p5}</span><span style={{color:T.textDim}}>Med: {r.median}</span><span style={{color:T.green}}>95th: {r.p95}</span>
                <span style={{color:r.color,fontWeight:700}}>NAV: {r.navImpact}</span>
              </div>
            </div>))}</div>
          </Card>
          <Card title="Key Sensitivity Drivers">
            <div style={{padding:'14px 18px'}}>{[
              {driver:'Anthropic Valuation',sensitivity:'±$0.82/share per ±$10B',weight:28,color:T.accent},
              {driver:'SpaceX Tender/IPO',sensitivity:'±$0.62/share per ±$50B',weight:22,color:T.blue},
              {driver:'IPO Cycle Timing',sensitivity:'±18% per 12-month shift',weight:18,color:T.green},
              {driver:'AI Sector Multiple',sensitivity:'±$0.45/share per ±2x multiple',weight:15,color:T.purple},
              {driver:'Premium/Discount',sensitivity:'Stock price only, no NAV impact',weight:10,color:T.amber},
              {driver:'Interest Rates',sensitivity:'±$0.18/share per ±100bps',weight:7,color:T.red},
            ].map((d,i)=>(<div key={i} style={{marginBottom:10}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:11,fontWeight:600,color:T.text}}>{d.driver}</span>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:d.color}}>{d.weight}%</span>
              </div>
              <div style={{fontSize:10,color:T.accent,fontFamily:mono,marginBottom:2}}>{d.sensitivity}</div>
              <Bar value={d.weight} max={30} color={d.color} h={6}/>
            </div>))}</div>
          </Card>
        </div>
        </>)}

        {/* ── SENSITIVITY MODE — Interactive slider-driven what-if ── */}
        {getMode('mc','distribution')==='sensitivity'&&(
        <div style={{display:'grid',gridTemplateColumns:'1fr 2fr',gap:14}}>
          <Card title="🎚️ Sensitivity Controls" style={{position:'sticky',top:0}}>
            <div style={{padding:'14px 18px'}}>
              <SliderInput label="Anthropic Valuation" k="anthropicVal" min={20} max={200} step={5} unit="B" fmt={v=>`$${v}B`}/>
              <SliderInput label="SpaceX Valuation" k="spaceXVal" min={100} max={800} step={25} unit="B" fmt={v=>`$${v}B`}/>
              <SliderInput label="IPO Timing" k="ipoTiming" min={3} max={36} step={3} unit="mo" fmt={v=>`${v} months`}/>
              <SliderInput label="AI Revenue Multiple" k="aiMultiple" min={5} max={40} step={1} unit="x" fmt={v=>`${v}x revenue`}/>
              <SliderInput label="Rate Change" k="rateChange" min={-200} max={200} step={25} unit="bps" fmt={v=>`${v>0?'+':''}${v}bps`}/>
              <SliderInput label="Volatility (σ)" k="mcVolatility" min={10} max={50} step={1} unit="%" fmt={v=>`${v}%`}/>
              <div style={{marginTop:12,padding:10,background:T.bgAccent,borderRadius:6}}>
                <div style={{fontSize:9,color:T.textDim,marginBottom:6}}>COMPOSITE SCENARIO OUTPUT</div>
                {(()=>{
                  const baseNav=9.84;
                  const anthroImpact=(sc.anthropicVal-75)/75*0.249*baseNav;
                  const spxImpact=(sc.spaceXVal-350)/350*0.186*baseNav;
                  const multImpact=(sc.aiMultiple-18)/18*0.6*baseNav;
                  const rateImpact=sc.rateChange/100*-0.042*baseNav;
                  const scenNav=baseNav+anthroImpact+spxImpact+multImpact+rateImpact;
                  return(<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6}}>
                    {[
                      {l:'Scenario NAV',v:`$${scenNav.toFixed(2)}`,c:scenNav>baseNav?T.green:T.red},
                      {l:'NAV Change',v:`${scenNav>baseNav?'+':''}${((scenNav/baseNav-1)*100).toFixed(1)}%`,c:scenNav>baseNav?T.green:T.red},
                      {l:'Implied TVPI',v:`${(1.42*scenNav/baseNav).toFixed(2)}x`,c:T.accent},
                      {l:'Prob > 2.0x',v:`${Math.max(5,Math.min(70,38.4+((scenNav-baseNav)/baseNav)*50)).toFixed(0)}%`,c:T.purple},
                    ].map((m,i)=>(<div key={i} style={{background:T.bg,borderRadius:4,padding:'6px 8px',textAlign:'center'}}>
                      <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
                      <div style={{fontSize:14,fontWeight:800,fontFamily:mono,color:m.c}}>{m.v}</div>
                    </div>))}
                  </div>);
                })()}
              </div>
            </div>
          </Card>
          <div>
            <Card title="NAV Waterfall — Impact Decomposition" style={{marginBottom:14}}>
              <div style={{padding:'18px'}}>
                {(()=>{
                  const baseNav=9.84;
                  const items=[
                    {l:'Current NAV',v:baseNav,type:'base',c:T.accent},
                    {l:`Anthropic → $${sc.anthropicVal}B`,v:(sc.anthropicVal-75)/75*0.249*baseNav,type:'delta'},
                    {l:`SpaceX → $${sc.spaceXVal}B`,v:(sc.spaceXVal-350)/350*0.186*baseNav,type:'delta'},
                    {l:`AI Multiple → ${sc.aiMultiple}x`,v:(sc.aiMultiple-18)/18*0.6*baseNav,type:'delta'},
                    {l:`Rates ${sc.rateChange>0?'+':''}${sc.rateChange}bps`,v:sc.rateChange/100*-0.042*baseNav,type:'delta'},
                  ];
                  let running=baseNav;items.forEach((it,i)=>{if(i>0){running+=it.v;it.cum=running;}});
                  items.push({l:'Scenario NAV',v:running,type:'total',c:running>baseNav?T.green:T.red});
                  return items.map((it,i)=>(<div key={i} style={{display:'flex',alignItems:'center',padding:'8px 0',borderBottom:i<items.length-1?`1px solid ${T.border}`:'none'}}>
                    <span style={{fontSize:11,fontWeight:it.type!=='delta'?700:400,color:T.text,width:160}}>{it.l}</span>
                    <div style={{flex:1,height:24,position:'relative'}}>
                      {it.type==='delta'&&<div style={{position:'absolute',left:it.v>=0?'50%':'auto',right:it.v<0?'50%':'auto',width:`${Math.min(45,Math.abs(it.v)/baseNav*200)}%`,height:'100%',background:it.v>=0?T.green+'40':T.red+'40',borderRadius:3}}/>}
                      {it.type==='base'&&<div style={{position:'absolute',left:0,width:'50%',height:'100%',background:T.accent+'30',borderRadius:3}}/>}
                      {it.type==='total'&&<div style={{position:'absolute',left:0,width:`${Math.min(90,(it.v/baseNav)*50)}%`,height:'100%',background:it.v>=baseNav?T.green+'40':T.red+'40',borderRadius:3}}/>}
                    </div>
                    <span style={{fontSize:13,fontFamily:mono,fontWeight:700,width:70,textAlign:'right',color:it.type==='delta'?(it.v>=0?T.green:T.red):(it.c||T.accent)}}>{it.type==='delta'?(it.v>=0?'+':'')+it.v.toFixed(2):'$'+it.v.toFixed(2)}</span>
                  </div>));
                })()}
              </div>
            </Card>
            <Card title="Position-Level Sensitivity — How Each Holding Reacts">
              <div style={{padding:'14px 18px'}}>
                {positions.slice(0,8).map((p,i)=>{
                  const navDelta=(sc.anthropicVal-75)/75*0.05+(sc.aiMultiple-18)/18*0.03;
                  const newNav=p.nav*(1+navDelta*(0.8+Math.random()*0.4));
                  const pctChange=((newNav/p.nav-1)*100);
                  return(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'6px 0',borderBottom:i<7?`1px solid ${T.border}`:'none'}}>
                    <span style={{fontSize:10,fontWeight:600,color:T.text,width:140}}>{p.fund.split(' ').slice(0,2).join(' ')}</span>
                    <Bar value={Math.abs(pctChange)} max={30} color={pctChange>=0?T.green:T.red} h={5}/>
                    <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:pctChange>=0?T.green:T.red,width:60,textAlign:'right'}}>{pctChange>=0?'+':''}{pctChange.toFixed(1)}%</span>
                    <span style={{fontSize:9,fontFamily:mono,color:T.textDim,width:60,textAlign:'right'}}>${newNav.toFixed(1)}M</span>
                  </div>);
                })}
              </div>
            </Card>
          </div>
        </div>
        )}

        {/* ── STRESS TEST MODE — Pre-defined shocks ── */}
        {getMode('mc','distribution')==='stress'&&(
        <div>
          <Card title="💥 Pre-Defined Stress Scenarios — Click to Model Impact" style={{marginBottom:14}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,padding:'14px 18px'}}>
              {[
                {name:'2008 Replay',desc:'Credit freeze, 40% drawdown, 3yr recovery',navHit:'-38%',premHit:'-60%',prob:'5%',color:T.red,positions:'FF VII -45%, Anthropic -25%, Defense flat'},
                {name:'AI Regulation',desc:'EU + US restrict AI deployment, training caps',navHit:'-22%',premHit:'-35%',prob:'12%',color:T.amber,positions:'Anthropic -35%, Scale -40%, Palantir +5%'},
                {name:'China Conflict',desc:'Taiwan tensions, tech sanctions, supply disruption',navHit:'-15%',premHit:'-25%',prob:'8%',color:T.red,positions:'Defense +30%, Tech -25%, Crypto -40%'},
                {name:'Rate Spike (+300bp)',desc:'Inflation return, discount rates surge',navHit:'-12%',premHit:'-20%',prob:'10%',color:T.amber,positions:'All private valuations down, IPOs frozen'},
                {name:'Anthropic Failure',desc:'Constitutional AI flaw, safety incident, talent exodus',navHit:'-25%',premHit:'-40%',prob:'3%',color:T.red,positions:'Anthropic -60%, broader AI sentiment -15%'},
                {name:'IPO Bonanza',desc:'5+ IPOs in 6 months, all above last private round',navHit:'+48%',premHit:'-15%',prob:'15%',color:T.green,positions:'Premium compresses as NAV crystallizes'},
              ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.color}`,cursor:'pointer'}} onClick={()=>setDrillDown({
                title:`💥 ${s.name}`,subtitle:s.desc,
                badges:[{l:s.navHit,c:s.color},{l:`${s.prob} probability`,c:T.textDim}],
                kpis:[{l:'NAV Impact',v:s.navHit,c:s.color},{l:'Premium Impact',v:s.premHit,c:T.amber},{l:'Probability',v:s.prob,c:T.textDim}],
                sections:[
                  {title:'Scenario Description',type:'text',content:s.desc},
                  {title:'Position Impacts',type:'text',content:s.positions},
                  {title:'Recommended Actions',type:'actions',items:[
                    {icon:'🛡️',label:'Review Risk Limits',view:'concentration',desc:'Check constraint compliance under stress'},
                    {icon:'🔄',label:'Model Rebalancing',view:'sizing',desc:'Evaluate position changes'},
                    {icon:'📊',label:'Premium Impact',view:'premdisc',desc:'Model premium/discount scenarios'},
                  ]}
                ]
              })}>
                <div style={{fontSize:12,fontWeight:700,color:T.text,marginBottom:4}}>{s.name}</div>
                <div style={{fontSize:10,color:T.textMuted,marginBottom:8}}>{s.desc}</div>
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:6}}>
                  {[{l:'NAV',v:s.navHit},{l:'Premium',v:s.premHit},{l:'Prob',v:s.prob}].map((m,mi)=>(
                    <div key={mi} style={{textAlign:'center',padding:'4px 0',background:T.bgAccent,borderRadius:4}}>
                      <div style={{fontSize:7,color:T.textDim}}>{m.l}</div>
                      <div style={{fontSize:13,fontWeight:800,fontFamily:mono,color:m.v.startsWith('+')?T.green:m.v.startsWith('-')?T.red:T.textDim}}>{m.v}</div>
                    </div>
                  ))}
                </div>
                <div style={{fontSize:9,color:T.textDim,marginTop:6}}>{s.positions}</div>
              </div>))}
            </div>
          </Card>
          <Card title="Stress Test Summary — Portfolio Resilience Score">
            <div style={{padding:'14px 18px'}}>
              <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:14}}>
                {[
                  {l:'Overall Resilience',v:'72/100',d:'Good — diversification helps',c:T.green},
                  {l:'Max Drawdown (95%)',v:'-38%',d:'2008-type scenario',c:T.red},
                  {l:'Recovery Time',v:'2.8 years',d:'historical pattern match',c:T.amber},
                  {l:'Tail Risk (VaR 99%)',v:'-52%',d:'extreme but survivable',c:T.red},
                ].map((m,i)=>(<div key={i} style={{padding:12,background:T.bgAccent,borderRadius:8,borderTop:`3px solid ${m.c}`,textAlign:'center'}}>
                  <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{m.l}</div>
                  <div style={{fontSize:20,fontWeight:900,fontFamily:mono,color:m.c}}>{m.v}</div>
                  <div style={{fontSize:9,color:T.textMuted}}>{m.d}</div>
                </div>))}
              </div>
              <div style={{fontSize:10,fontWeight:700,color:T.textDim,marginBottom:8}}>NATURAL HEDGES IN PORTFOLIO</div>
              {[
                {hedge:'Defense exposure (Anduril, Palantir)',pct:19.5,benefit:'Rises in geopolitical stress',effectiveness:85},
                {hedge:'SBIC leverage (non-callable)',pct:100,benefit:'No margin calls in downturn',effectiveness:95},
                {hedge:'Vintage diversification',pct:100,benefit:'Reduces J-curve synchronization',effectiveness:70},
                {hedge:'Premium = buying opportunity signal',pct:100,benefit:'Premium compression = ATM stops, buyback starts',effectiveness:60},
              ].map((h,i)=>(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'6px 0',borderBottom:i<3?`1px solid ${T.border}`:'none'}}>
                <span style={{fontSize:10,color:T.text,width:200}}>{h.hedge}</span>
                <Bar value={h.effectiveness} max={100} color={h.effectiveness>=80?T.green:h.effectiveness>=60?T.blue:T.amber} h={5}/>
                <span style={{fontSize:9,fontFamily:mono,fontWeight:700,color:T.green,width:30}}>{h.effectiveness}%</span>
                <span style={{fontSize:9,color:T.textMuted,flex:1}}>{h.benefit}</span>
              </div>))}
            </div>
          </Card>
        </div>
        )}

        {/* ── SCENARIOS MODE — Detailed regime analysis ── */}
        {getMode('mc','distribution')==='scenarios'&&(
        <div>
          {[
            {regime:'AI Bull',prob:40,color:T.green,median:'2.35x',range:'1.45x – 4.12x',nav:'+62%',
              triggers:['Anthropic IPO at $100B+','SpaceX tender at $400B+','3+ AI company IPOs in H1 2026','Enterprise AI adoption inflection'],
              portfolio:[{pos:'Anthropic',impact:'+85%'},{pos:'Founders Fund VII',impact:'+45%'},{pos:'Anduril',impact:'+60%'},{pos:'Scale AI',impact:'+40%'}],
              actions:['Increase ATM issuance to capture premium','Evaluate secondary sells at peak valuations','Lock in Fund II commitment letters']},
            {regime:'Base Case',prob:35,color:T.blue,median:'1.72x',range:'1.15x – 2.48x',nav:'+28%',
              triggers:['2-3 IPOs execute on schedule','AI spending continues growing 30%+ YoY','Premium stabilizes at 100-150%','Fund II launched successfully'],
              portfolio:[{pos:'Anthropic',impact:'+25%'},{pos:'Founders Fund VII',impact:'+15%'},{pos:'Anduril',impact:'+30%'},{pos:'Palantir',impact:'+10%'}],
              actions:['Continue current deployment pace','Maintain ATM program','Execute Fund II roadshow']},
            {regime:'AI Winter',prob:15,color:T.amber,median:'1.08x',range:'0.65x – 1.55x',nav:'-18%',
              triggers:['AI spending cuts 20%+','Multiple AI down rounds','IPO window closes for 12+ months','Regulatory headwinds intensify'],
              portfolio:[{pos:'Anthropic',impact:'-30%'},{pos:'Scale AI',impact:'-45%'},{pos:'Anduril',impact:'+10%'},{pos:'Palantir',impact:'-15%'}],
              actions:['Halt ATM. Consider buyback.','Delay Fund II launch 6-12 months','Emphasize defense portfolio as hedge','Secondary buying opportunity — deploy cash']},
          ].map((r,i)=>(<Card key={i} title={`${r.regime} — ${r.prob}% Probability`} style={{marginBottom:14,borderLeft:`4px solid ${r.color}`}}>
            <div style={{padding:'14px 18px'}}>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:12,marginBottom:14}}>
                {[{l:'Median TVPI',v:r.median},{l:'Range',v:r.range},{l:'NAV Impact',v:r.nav},{l:'Probability',v:`${r.prob}%`}].map((m,mi)=>(
                  <div key={mi} style={{padding:10,background:T.bgAccent,borderRadius:6,textAlign:'center'}}>
                    <div style={{fontSize:8,color:T.textDim}}>{m.l}</div>
                    <div style={{fontSize:16,fontWeight:800,fontFamily:mono,color:r.color}}>{m.v}</div>
                  </div>
                ))}
              </div>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:16}}>
                <div>
                  <div style={{fontSize:10,fontWeight:700,color:T.textDim,marginBottom:6}}>TRIGGERS</div>
                  {r.triggers.map((t,ti)=><div key={ti} style={{fontSize:10,color:T.text,padding:'3px 0 3px 8px',borderLeft:`2px solid ${r.color}40`,marginBottom:2}}>{t}</div>)}
                </div>
                <div>
                  <div style={{fontSize:10,fontWeight:700,color:T.textDim,marginBottom:6}}>PORTFOLIO IMPACT</div>
                  {r.portfolio.map((p,pi)=><div key={pi} style={{display:'flex',justifyContent:'space-between',padding:'3px 0',borderBottom:`1px solid ${T.border}`}}>
                    <span style={{fontSize:10,color:T.text}}>{p.pos}</span>
                    <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:p.impact.startsWith('+')?T.green:T.red}}>{p.impact}</span>
                  </div>)}
                </div>
                <div>
                  <div style={{fontSize:10,fontWeight:700,color:T.textDim,marginBottom:6}}>RECOMMENDED ACTIONS</div>
                  {r.actions.map((a,ai)=><div key={ai} style={{fontSize:10,color:T.accent,padding:'3px 0 3px 8px',borderLeft:`2px solid ${T.accent}40`,marginBottom:2}}>{a}</div>)}
                </div>
              </div>
            </div>
          </Card>))}
        </div>
        )}
      </div>)}

      {aView==='earningsprep'&&(<div>
        <div style={{padding:'12px 18px',background:`linear-gradient(135deg, ${T.amber}08, ${T.red}04)`,borderRadius:8,border:`1px solid ${T.amber}25`,marginBottom:14}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div>
              <div style={{fontSize:14,fontWeight:900,color:T.text}}>📞 Q4 2025 Earnings Call Preparation</div>
              <div style={{fontSize:10,color:T.textMuted}}>Scheduled: March 15, 2026 · 4:30 PM EST · Webcast + Dial-In</div>
            </div>
            <div style={{display:'flex',gap:8}}>
              <Badge color={T.amber}>22 Days Out</Badge>
              <Badge color={T.red}>Script: 45% Complete</Badge>
            </div>
          </div>
        </div>
        <Card title="Call Script — Section-by-Section Preparation Status" style={{marginBottom:14}}>
          <div style={{padding:0}}>{[
            {section:'Opening Remarks (Jason)',duration:'5 min',status:'Draft',content:'Market environment, fund philosophy, headline results',key:'NAV +14.2% QoQ, stock +28.5% QoQ, 3 new commitments',tone:'Confident but measured. Acknowledge premium.'},
            {section:'Financial Review (CFO/Matthew)',duration:'8 min',status:'Not Started',content:'NAV bridge, expense analysis, capital structure, ATM update',key:'NAV/share $9.84, AFFE 3.67%, ATM raised $14.15M',tone:'Precise, data-driven. Emphasize NAV accretive issuance.'},
            {section:'Investment Update (Ken)',duration:'10 min',status:'Draft',content:'Portfolio performance, new commitments, secondary activity, thesis update',key:'TVPI 1.42x, 2 new fund commitments, IPO pipeline strengthening',tone:'Analytical. Conviction without hype.'},
            {section:'Distribution Update (Bob)',duration:'3 min',status:'Not Started',content:'Platform approvals, RIA pipeline, investor day plans',key:'3 new platforms, $48M pipeline, 5,000+ advisor reach',tone:'Growth-oriented. Emphasize institutional channels.'},
            {section:'Outlook & Strategy (Jason)',duration:'5 min',status:'Not Started',content:'2026 priorities, Fund II plans, IPO catalysts, premium management',key:'Fund II preparation, Anduril/Stripe IPO catalysts, ATM expansion',tone:'Forward-looking. Strategic without over-promising.'},
            {section:'Q&A Session',duration:'20 min',status:'Q&A Bank Ready',content:'Open questions from analysts and shareholders',key:'85 pre-seeded Q&As across 6 categories',tone:'Direct answers. Never speculate on timing or price targets.'},
          ].map((s,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <span style={{fontSize:12,fontWeight:700,color:T.text}}>{s.section}</span>
                <Badge color={s.status==='Draft'?T.amber:s.status==='Q&A Bank Ready'?T.green:T.red}>{s.status}</Badge>
              </div>
              <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>{s.duration}</span>
            </div>
            <div style={{fontSize:10,color:T.accent,fontWeight:500,marginBottom:2}}>Key: {s.key}</div>
            <div style={{fontSize:9,color:T.textDim}}>Content: {s.content} · Tone: {s.tone}</div>
          </div>))}</div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Analyst Expectations — What the Street Is Modeling">
            <div style={{padding:0}}>{[
              {analyst:'Ladenburg Thalmann',name:'J. Morrison',rating:'Buy',pt:'$32.00',navEst:'$10.20',premEst:'+155%',key:'Bullish on IPO pipeline. Thinks Anduril S-1 is material catalyst.',risk:'Premium contraction if IPO cycle stalls.'},
              {analyst:'B. Riley Securities',name:'S. Park',rating:'Initiate — Neutral',pt:'$22.00',navEst:'$9.50',premEst:'+120%',key:'Likes governance but concerned about AFFE. Recommends on NAV discount.', risk:'Fee drag makes outperformance difficult long-term.'},
              {analyst:'Maxim Group',name:'D. Chen',rating:'Initiate — Buy',pt:'$28.00',navEst:'$10.00',premEst:'+140%',key:'Best-in-class AI Safety exposure. Co-invest rights undervalued.',risk:'Single-name concentration (Anthropic 25%).'},
            ].map((a,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<2?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <div><span style={{fontSize:12,fontWeight:700,color:T.text}}>{a.analyst}</span><span style={{fontSize:10,color:T.textDim}}> · {a.name}</span></div>
                <div style={{display:'flex',gap:6}}>
                  <Badge color={a.rating.includes('Buy')?T.green:T.textDim}>{a.rating}</Badge>
                  <span style={{fontSize:12,fontFamily:mono,fontWeight:800,color:T.accent}}>PT: {a.pt}</span>
                </div>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:2}}>NAV Est: {a.navEst} · Premium Est: {a.premEst}</div>
              <div style={{fontSize:9,color:T.green,marginBottom:1}}>Bull: {a.key}</div>
              <div style={{fontSize:9,color:T.red}}>Bear: {a.risk}</div>
            </div>))}</div>
          </Card>
          <Card title="Top 10 Likely Questions — Preparation Priority">
            <div style={{padding:0}}>{[
              {q:'Can you explain why the stock trades at a 148% premium to NAV?',freq:'Every call',cat:'Premium',status:'Answer Ready'},
              {q:'What is your ATM strategy and how does it impact NAV per share?',freq:'Every call',cat:'Capital Markets',status:'Answer Ready'},
              {q:'When do you expect the Anduril IPO and what is the NAV impact?',freq:'New this Q',cat:'IPO Catalyst',status:'Answer Ready'},
              {q:'Why should investors pay 3.67% AFFE when ETFs charge 0.75%?',freq:'Every call',cat:'Fees',status:'Answer Ready'},
              {q:'What are your plans for Fund II and when will you begin fundraising?',freq:'New this Q',cat:'Strategy',status:'Draft — Needs Jason'},
              {q:'How do you value Level 3 assets and who are your valuation agents?',freq:'Occasional',cat:'NAV',status:'Answer Ready'},
              {q:'What is your view on the short interest and borrow cost dynamics?',freq:'New this Q',cat:'Trading',status:'Draft'},
              {q:'Can you discuss the Anthropic concentration risk at 24.9% of NAV?',freq:'Every call',cat:'Risk',status:'Answer Ready'},
              {q:'Are you considering a managed distribution policy?',freq:'Occasional',cat:'Distribution',status:'Answer Ready'},
              {q:'How does NEWCO compare to DXYZ as a pre-IPO access vehicle?',freq:'New this Q',cat:'Competition',status:'Draft — Needs Bob'},
            ].map((q,i)=>(<div key={i} style={{padding:'8px 16px',borderBottom:i<9?`1px solid ${T.border}`:'none',display:'flex',alignItems:'center',gap:8}}>
              <span style={{fontSize:10,fontFamily:mono,color:T.textDim,width:16,flexShrink:0}}>{i+1}.</span>
              <div style={{flex:1}}>
                <div style={{fontSize:10,fontWeight:500,color:T.text}}>{q.q}</div>
                <div style={{fontSize:8,color:T.textDim}}>{q.freq} · {q.cat}</div>
              </div>
              <Badge color={q.status==='Answer Ready'?T.green:T.amber}>{q.status}</Badge>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='liquidbook'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8,marginBottom:14}}>
          {[
            {l:'Bid',v:'$24.35',c:T.green},{l:'Ask',v:'$24.42',c:T.red},{l:'Spread',v:'$0.07',c:T.amber},
            {l:'Day Volume',v:'312K',c:T.accent},{l:'VWAP',v:'$24.22',c:T.blue},{l:'Depth (L2)',v:'45K×52K',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:10,background:T.bgCard,borderRadius:6,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`,textAlign:'center'}}>
            <div style={{fontSize:8,color:T.textDim,textTransform:'uppercase'}}>{s.l}</div>
            <div style={{fontSize:16,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
          </div>))}
        </div>
        <Card title="Order Book Depth — Level 2 Market Data" style={{marginBottom:14}}>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:1,padding:'14px 18px'}}>
            <div>
              <div style={{fontSize:10,fontWeight:700,color:T.green,textAlign:'center',marginBottom:8}}>BID (Buy Orders)</div>
              {[
                {price:'$24.38',size:'8,200',cum:'8,200'},{price:'$24.35',size:'12,400',cum:'20,600'},
                {price:'$24.30',size:'6,800',cum:'27,400'},{price:'$24.25',size:'4,200',cum:'31,600'},
                {price:'$24.20',size:'9,100',cum:'40,700'},{price:'$24.15',size:'3,800',cum:'44,500'},
              ].map((b,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',padding:'3px 8px',background:`${T.green}${Math.round(8+i*3).toString(16).padStart(2,'0')}`,borderRadius:2,marginBottom:1}}>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:600,color:T.green}}>{b.price}</span>
                <span style={{fontSize:10,fontFamily:mono,color:T.text}}>{b.size}</span>
                <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{b.cum}</span>
              </div>))}
            </div>
            <div>
              <div style={{fontSize:10,fontWeight:700,color:T.red,textAlign:'center',marginBottom:8}}>ASK (Sell Orders)</div>
              {[
                {price:'$24.42',size:'5,600',cum:'5,600'},{price:'$24.45',size:'10,200',cum:'15,800'},
                {price:'$24.50',size:'14,800',cum:'30,600'},{price:'$24.55',size:'8,400',cum:'39,000'},
                {price:'$24.60',size:'6,200',cum:'45,200'},{price:'$24.65',size:'6,800',cum:'52,000'},
              ].map((a,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',padding:'3px 8px',background:`${T.red}${Math.round(8+i*3).toString(16).padStart(2,'0')}`,borderRadius:2,marginBottom:1}}>
                <span style={{fontSize:10,fontFamily:mono,fontWeight:600,color:T.red}}>{a.price}</span>
                <span style={{fontSize:10,fontFamily:mono,color:T.text}}>{a.size}</span>
                <span style={{fontSize:9,fontFamily:mono,color:T.textDim}}>{a.cum}</span>
              </div>))}
            </div>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Block Trade History — Last 30 Days">
            <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
              <thead><tr>{['Date','Size','Price','Premium','Venue','Direction','Market Impact'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
              <tbody>{[
                {date:'Feb 6',size:'180K',price:'$23.80',prem:'+142%',venue:'Block Cross',dir:'SELL',impact:'-1.5% intraday'},
                {date:'Feb 3',size:'95K',price:'$23.45',prem:'+138%',venue:'NYSE Floor',dir:'BUY',impact:'+0.8% intraday'},
                {date:'Jan 28',size:'220K',price:'$22.90',prem:'+133%',venue:'Dark Pool',dir:'SELL',impact:'-0.4% (minimal)'},
                {date:'Jan 22',size:'150K',price:'$23.10',prem:'+135%',venue:'Block Cross',dir:'BUY',impact:'+1.2% intraday'},
                {date:'Jan 15',size:'310K',price:'$22.50',prem:'+129%',venue:'Dark Pool',dir:'SELL',impact:'-2.1% over 2 days'},
                {date:'Jan 8',size:'125K',price:'$22.80',prem:'+132%',venue:'NYSE Floor',dir:'BUY',impact:'+0.5% intraday'},
              ].map((t,i)=>(<TR key={i}>
                <TD mono>{t.date}</TD><TD mono bold>{t.size}</TD><TD mono>{t.price}</TD>
                <TD mono color={T.accent}>{t.prem}</TD><TD color={T.textDim}>{t.venue}</TD>
                <TD><Badge color={t.dir==='BUY'?T.green:T.red}>{t.dir}</Badge></TD>
                <TD mono color={t.impact.startsWith('-')?T.red:T.green}>{t.impact}</TD>
              </TR>))}</tbody>
            </table></div>
          </Card>
          <Card title="Market Maker Activity & Spread Analysis">
            <div style={{padding:'14px 18px'}}>
              {[
                {mm:'Virtu Financial',avgSpread:'$0.06',mktShare:'32%',avgSize:'2,400',quality:'Excellent',note:'Primary liquidity provider. Tightest spreads.'},
                {mm:'Citadel Securities',avgSpread:'$0.08',mktShare:'28%',avgSize:'1,800',quality:'Good',note:'Strong during volatility. Wider spreads off-hours.'},
                {mm:'Jane Street',avgSpread:'$0.07',mktShare:'18%',avgSize:'3,200',quality:'Excellent',note:'Large size. Algorithmic flow. Consistent.'},
                {mm:'GTS',avgSpread:'$0.09',mktShare:'12%',avgSize:'1,200',quality:'Fair',note:'Smaller size. Widens during blocks.'},
                {mm:'Other / Retail',avgSpread:'$0.12',mktShare:'10%',avgSize:'450',quality:'Variable',note:'Retail internalization. Robinhood/Schwab flow.'},
              ].map((m,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:i<4?`1px solid ${T.border}`:'none',alignItems:'center'}}>
                <div style={{width:120}}><div style={{fontSize:11,fontWeight:600,color:T.text}}>{m.mm}</div></div>
                <span style={{fontSize:10,fontFamily:mono,color:T.accent}}>{m.avgSpread}</span>
                <span style={{fontSize:10,fontFamily:mono,color:T.blue}}>{m.mktShare}</span>
                <span style={{fontSize:10,fontFamily:mono,color:T.textDim}}>{m.avgSize} avg</span>
                <Badge color={m.quality==='Excellent'?T.green:m.quality==='Good'?T.blue:T.amber}>{m.quality}</Badge>
              </div>))}
            </div>
          </Card>
        </div>
      </div>)}

      {aView==='impact'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Impact Score',v:'84/100',d:'portfolio-weighted',c:T.green},
            {l:'SDG Alignment',v:'4 Goals',d:'SDG 9, 11, 16, 17',c:T.blue},
            {l:'AI Safety Score',v:'92/100',d:'thesis purity metric',c:T.accent},
            {l:'ESG Rating',v:'A-',d:'composite institutional rating',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Portfolio Impact Assessment — Company-Level Scoring" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Company','% NAV','AI Safety','SDGs','Impact Category','Score','Evidence','Controversy'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {co:'Anthropic',nav:'24.9%',safety:98,sdgs:'9, 16',cat:'AI Safety Pioneer',score:96,evidence:'Constitutional AI, responsible scaling policy, safety research leadership',controversy:'None'},
              {co:'Anduril',nav:'7.3%',safety:72,sdgs:'16',cat:'National Security',score:78,evidence:'Autonomous defense reduces human casualties, border security tech',controversy:'Defense tech ethics debate. Some ESG funds exclude.'},
              {co:'Palantir',nav:'12.2%',safety:65,sdgs:'16, 11',cat:'Government Efficiency',score:68,evidence:'Counter-terrorism, pandemic response, fraud detection',controversy:'ICE contract history. Surveillance concerns.'},
              {co:'Scale AI',nav:'5.2%',safety:55,sdgs:'9',cat:'AI Infrastructure',score:62,evidence:'Enables responsible AI development through quality data',controversy:'Data labeling labor practices. Kenya workforce concerns.'},
              {co:'Drata',nav:'3.8%',safety:80,sdgs:'9, 16',cat:'Trust & Compliance',score:85,evidence:'Automates security compliance, reduces breach risk',controversy:'None'},
              {co:'Verkada',nav:'2.4%',safety:42,sdgs:'11',cat:'Physical Security',score:48,evidence:'Building safety, access control, AI-powered monitoring',controversy:'2021 breach incident. Privacy advocacy opposition.'},
            ].map((c,i)=>(<TR key={i}>
              <TD bold>{c.co}</TD><TD mono>{c.nav}</TD>
              <TD mono bold color={c.safety>=80?T.green:c.safety>=60?T.blue:T.amber}>{c.safety}</TD>
              <TD color={T.textDim}>{c.sdgs}</TD>
              <TD><Badge color={T.purple}>{c.cat}</Badge></TD>
              <TD mono bold color={c.score>=80?T.green:c.score>=60?T.blue:T.amber}>{c.score}</TD>
              <TD color={T.textMuted}>{c.evidence}</TD>
              <TD color={c.controversy==='None'?T.green:T.amber}>{c.controversy}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="UN SDG Alignment — Portfolio Contribution">
            <div style={{padding:'14px 18px'}}>{[
              {sdg:'SDG 9: Industry, Innovation & Infrastructure',pctNav:78,companies:'Anthropic, Scale AI, Databricks, Crusoe Energy',score:88,note:'Core thesis alignment. AI infrastructure is the defining innovation of the decade.'},
              {sdg:'SDG 16: Peace, Justice & Strong Institutions',pctNav:44,companies:'Anduril, Palantir, Drata, Shield AI',score:72,note:'Defense tech + compliance tech strengthen institutions. Controversial but material.'},
              {sdg:'SDG 11: Sustainable Cities & Communities',pctNav:15,companies:'Verkada, Crusoe Energy',score:55,note:'Smart infrastructure and clean compute. Smaller portfolio allocation.'},
              {sdg:'SDG 17: Partnerships for the Goals',pctNav:100,companies:'All (fund structure)',score:82,note:'Public CEF structure democratizes VC access. FoF builds cross-portfolio bridges.'},
            ].map((s,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<3?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:11,fontWeight:600,color:T.text}}>{s.sdg}</span>
                <span style={{fontSize:12,fontFamily:mono,fontWeight:800,color:T.green}}>{s.score}</span>
              </div>
              <Bar value={s.score} max={100} color={T.green} h={5}/>
              <div style={{fontSize:9,color:T.textMuted,marginTop:2}}>{s.pctNav}% NAV · {s.companies}</div>
              <div style={{fontSize:9,color:T.textDim}}>{s.note}</div>
            </div>))}</div>
          </Card>
          <Card title="AI Safety Thesis Integrity — Core Mission Scoring">
            <div style={{padding:'14px 18px'}}>
              <div style={{fontSize:10,color:T.textDim,marginBottom:10}}>Does our portfolio actually advance AI safety? Rigorous self-assessment.</div>
              {[
                {dimension:'Constitutional AI Investment',score:98,detail:'Anthropic (24.9% of NAV) is the global leader in safe AI alignment.',trend:'Strong'},
                {dimension:'Autonomous Systems Safety',score:82,detail:'Anduril + Shield AI build autonomous systems with human-in-the-loop.',trend:'Growing'},
                {dimension:'Trust & Verification',score:76,detail:'Drata, Verkada provide digital trust infrastructure.',trend:'Stable'},
                {dimension:'Data Quality & Integrity',score:68,detail:'Scale AI contributes to responsible AI training data.',trend:'Questioned'},
                {dimension:'Government AI Governance',score:85,detail:'Palantir\'s AIP + defense companies support responsible government AI use.',trend:'Strong'},
                {dimension:'Negative Screen Compliance',score:72,detail:'No autonomous weapons without human control. No surveillance-only companies.',trend:'Stable'},
              ].map((d,i)=>(<div key={i} style={{marginBottom:8}}>
                <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                  <span style={{fontSize:11,fontWeight:500,color:T.text}}>{d.dimension}</span>
                  <div style={{display:'flex',gap:6,alignItems:'center'}}>
                    <Badge color={d.trend==='Strong'?T.green:d.trend==='Growing'?T.blue:d.trend==='Stable'?T.textDim:T.amber}>{d.trend}</Badge>
                    <span style={{fontSize:12,fontFamily:mono,fontWeight:700,color:d.score>=80?T.green:d.score>=60?T.blue:T.amber}}>{d.score}</span>
                  </div>
                </div>
                <Bar value={d.score} max={100} color={d.score>=80?T.green:d.score>=60?T.blue:T.amber} h={4}/>
                <div style={{fontSize:9,color:T.textMuted,marginTop:1}}>{d.detail}</div>
              </div>))}</div>
          </Card>
        </div>
      </div>)}

      {aView==='teamops'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Team Size',v:'9',d:'+ 4 advisors',c:T.accent},
            {l:'Key Person Risk',v:'MEDIUM',d:'2 KP dependencies',c:T.amber},
            {l:'Open Roles',v:'3',d:'hiring pipeline active',c:T.blue},
            {l:'Comp Competitiveness',v:'P65',d:'65th percentile vs peers',c:T.green},
            {l:'Team NPS',v:'82',d:'quarterly pulse survey',c:T.purple},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Organizational Chart & Capacity Assessment" style={{marginBottom:14}}>
          <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
            <thead><tr>{['Name','Role','Department','Capacity','Key Person','Focus Areas','Risk If Departs'].map(h=><TH key={h}>{h}</TH>)}</tr></thead>
            <tbody>{[
              {name:'Jason Goldman',role:'Chair & Operating Partner',dept:'Executive',cap:'115%',kp:'YES',focus:'Strategy, IR, fundraising, Berkeley network, board',risk:'CRITICAL — LP relationships, brand, Fund II'},
              {name:'Ken Wallace',role:'CIO / Managing Partner',dept:'Investment',cap:'120%',kp:'YES',focus:'Portfolio construction, secondaries, quant, IC chair',risk:'CRITICAL — Investment process, alpha generation'},
              {name:'Bob Burlinson',role:'Head of Distribution',dept:'Distribution',cap:'90%',kp:'Medium',focus:'Platform approvals, RIA pipeline, advisor relations',risk:'HIGH — Distribution relationships, pipeline $48M'},
              {name:'Brett Nguyen',role:'Senior Analyst',dept:'Investment',cap:'95%',kp:'No',focus:'Due diligence, fund analysis, co-invest evaluation',risk:'MEDIUM — Analytical capacity'},
              {name:'Matthew Chen',role:'CFO / COO',dept:'Operations',cap:'105%',kp:'Medium',focus:'Fund admin, compliance, audit, SEC filings, treasury',risk:'HIGH — Operational continuity, KPMG relationship'},
              {name:'Sarah Kim',role:'IR Associate',dept:'Public Markets',cap:'85%',kp:'No',focus:'Investor comms, 13F analysis, earnings prep, website',risk:'LOW — Replaceable within 60 days'},
              {name:'David Park',role:'Analyst',dept:'Investment',cap:'80%',kp:'No',focus:'Company research, data pipeline, portfolio monitoring',risk:'LOW — Junior role. Succession from intern pipeline.'},
              {name:'Lisa Torres',role:'Compliance Officer',dept:'Operations',cap:'75%',kp:'No',focus:'Trading compliance, personal trading, regulatory filings',risk:'MEDIUM — Regulatory expertise. 90-day replacement.'},
              {name:'Alex Rivera',role:'Technology',dept:'Operations',cap:'110%',kp:'No',focus:'Platform development, data infrastructure, AI agents',risk:'MEDIUM — Technical debt if departs mid-build.'},
            ].map((p,i)=>(<TR key={i}>
              <TD bold>{p.name}</TD><TD>{p.role}</TD>
              <TD><Badge color={p.dept==='Executive'?T.accent:p.dept==='Investment'?T.blue:p.dept==='Distribution'?T.green:p.dept==='Public Markets'?T.amber:T.purple}>{p.dept}</Badge></TD>
              <TD mono bold color={parseInt(p.cap)>100?T.red:parseInt(p.cap)>85?T.amber:T.green}>{p.cap}</TD>
              <TD><Badge color={p.kp==='YES'?T.red:p.kp==='Medium'?T.amber:T.green}>{p.kp}</Badge></TD>
              <TD color={T.textMuted}>{p.focus}</TD>
              <TD color={p.risk.startsWith('CRITICAL')?T.red:p.risk.startsWith('HIGH')?T.amber:T.textDim}>{p.risk}</TD>
            </TR>))}</tbody>
          </table></div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Hiring Pipeline — Open Positions">
            <div style={{padding:0}}>{[
              {role:'VP, Investor Relations',dept:'Public Markets',priority:'HIGH',status:'Interviewing',candidates:4,timeline:'Mar 2026',comp:'$180-220K + equity',reason:'IR function under-resourced. Sarah needs senior support for earnings, roadshows, analyst relations.'},
              {role:'Associate, Portfolio Analytics',dept:'Investment',priority:'MEDIUM',status:'Job Posted',candidates:12,timeline:'Apr 2026',comp:'$120-150K',reason:'Ken needs quantitative support for Monte Carlo, factor models, and secondary pricing.'},
              {role:'Counsel (Part-Time)',dept:'Legal',priority:'MEDIUM',status:'Evaluating Firms',candidates:3,timeline:'Mar 2026',comp:'$350-500/hr',reason:'Reduce outside counsel spend. In-house for routine SEC filings, trading window management.'},
            ].map((h,i)=>(<div key={i} style={{padding:'12px 16px',borderBottom:i<2?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
                <div style={{display:'flex',alignItems:'center',gap:8}}>
                  <span style={{fontSize:12,fontWeight:700,color:T.text}}>{h.role}</span>
                  <Badge color={h.priority==='HIGH'?T.red:T.amber}>{h.priority}</Badge>
                </div>
                <Badge color={h.status==='Interviewing'?T.green:h.status==='Job Posted'?T.blue:T.amber}>{h.status}</Badge>
              </div>
              <div style={{fontSize:10,color:T.textMuted,marginBottom:2}}>{h.reason}</div>
              <div style={{display:'flex',gap:12,fontSize:9,color:T.textDim}}>
                <span>{h.dept}</span><span>{h.candidates} candidates</span><span>{h.comp}</span><span>Target: {h.timeline}</span>
              </div>
            </div>))}</div>
          </Card>
          <Card title="Key Person & Succession Planning">
            <div style={{padding:'14px 18px'}}>
              <div style={{padding:10,background:T.red+'08',borderRadius:6,border:`1px solid ${T.red}20`,marginBottom:12}}>
                <div style={{fontSize:10,fontWeight:700,color:T.red}}>⚠ KEY PERSON CLAUSE: Jason Goldman + Ken Wallace</div>
                <div style={{fontSize:9,color:T.text,lineHeight:1.4,marginTop:3}}>If both Jason and Ken depart within 12 months, LPs in Co-Invest I LP have redemption rights. Fund I advisory agreement includes 180-day notice period and orderly transition provisions. Board must approve any successor CIO appointment.</div>
              </div>
              {[
                {person:'Jason Goldman',successor:'Board-led search. Bob Burlinson interim for distribution. External hire for strategy/IR.',timeline:'6-9 months to replace',mitigation:'Expand advisory board. Document LP relationships. Train Bob on institutional LPs.'},
                {person:'Ken Wallace',successor:'Brett Nguyen interim for DD/monitoring. External CIO search required.',timeline:'9-12 months to replace',mitigation:'Systematize investment process. Document quantitative models. Cross-train Brett.'},
                {person:'Matthew Chen',successor:'Outsource to fund admin (Alter Domus / Citco) + external CFO consultant.',timeline:'60-90 days',mitigation:'Document all operational procedures. Maintain admin vendor relationships.'},
              ].map((s,i)=>(<div key={i} style={{padding:'8px 0',borderBottom:i<2?`1px solid ${T.border}`:'none'}}>
                <div style={{fontSize:12,fontWeight:700,color:T.text,marginBottom:2}}>{s.person}</div>
                <div style={{fontSize:10,color:T.accent,marginBottom:2}}>Successor: {s.successor}</div>
                <div style={{fontSize:9,color:T.textDim}}>Timeline: {s.timeline} · Mitigation: {s.mitigation}</div>
              </div>))}
            </div>
          </Card>
        </div>
      </div>)}

      {aView==='macro'&&(<div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
          {[
            {l:'Current Regime',v:'RISK-ON',d:'expansionary, AI-driven',c:T.green},
            {l:'Fed Funds',v:'4.25%',d:'last cut Dec 2025',c:T.blue},
            {l:'VIX',v:'14.2',d:'low volatility regime',c:T.green},
            {l:'AI Spend Cycle',v:'PEAK',d:'hyperscaler capex record',c:T.accent},
            {l:'IPO Window',v:'OPEN',d:'strongest since 2021',c:T.green},
          ].map((s,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${T.border}`,borderTop:`3px solid ${s.c}`}}>
            <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',marginBottom:4}}>{s.l}</div>
            <div style={{fontSize:22,fontWeight:900,fontFamily:mono,color:s.c}}>{s.v}</div>
            <div style={{fontSize:10,color:T.textMuted}}>{s.d}</div>
          </div>))}
        </div>
        <Card title="Regime Detection Dashboard — Current Market Environment" style={{marginBottom:14}}>
          <div style={{padding:'18px'}}>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
              {[
                {regime:'Liquidity',status:'Abundant',signal:'Fed cut 3x in 2025. M2 expanding. VC fundraising recovering.',score:78,implication:'Supports premium maintenance and new fund commitments.',color:T.green},
                {regime:'Risk Appetite',status:'Elevated',signal:'VIX 14.2, high-yield spreads tight, meme stocks active.',score:82,implication:'Good for our premium. Monitor for excess. ATM program favorable.',color:T.green},
                {regime:'AI Cycle',status:'Peak Growth',signal:'Hyperscaler capex $200B+, enterprise AI adoption inflecting.',score:92,implication:'Core thesis validated. Portfolio companies in sweet spot.',color:T.accent},
                {regime:'IPO Window',status:'Wide Open',signal:'5 VC-backed IPOs in Jan alone. Investor appetite strong.',score:88,implication:'Anduril, Stripe, Databricks all have green light. Execute.',color:T.green},
              ].map((r,i)=>(<div key={i} style={{padding:14,background:T.bgCard,borderRadius:8,border:`1px solid ${r.color}30`}}>
                <div style={{fontSize:9,color:T.textDim,textTransform:'uppercase',fontWeight:700,marginBottom:4}}>{r.regime}</div>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
                  <Badge color={r.color}>{r.status}</Badge>
                  <span style={{fontSize:16,fontFamily:mono,fontWeight:900,color:r.color}}>{r.score}</span>
                </div>
                <div style={{fontSize:10,color:T.text,marginBottom:4}}>{r.signal}</div>
                <Bar value={r.score} max={100} color={r.color} h={4}/>
                <div style={{fontSize:9,color:T.textMuted,marginTop:4}}>{r.implication}</div>
              </div>))}
            </div>
          </div>
        </Card>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <Card title="Portfolio Sensitivity to Macro Factors">
            <div style={{padding:0}}>{[
              {factor:'Interest Rates (+100bps)',navImpact:'-4.2%',premImpact:'-8-12%',mechanism:'Higher discount rates → lower private valuations. Slower IPOs. Premium compresses on risk-off.',action:'No hedge. Tolerate. Rate cycle near peak.'},
              {factor:'AI Spending Slowdown (-20%)',navImpact:'-12.5%',premImpact:'-15-25%',mechanism:'Revenue growth slows for Anthropic, Scale AI, Databricks. Multiple compression across portfolio.',action:'BIGGEST RISK. Diversify into defense/GovTech (less correlated).'},
              {factor:'Recession (GDP -2%)',navImpact:'-8.4%',premImpact:'-20-40%',mechanism:'Enterprise budgets cut. VC funding freezes. IPO window closes. Premium collapses.',action:'Activate buyback. Preserve cash. Defensive positioning.'},
              {factor:'Geopolitical Escalation',navImpact:'+2.8%',premImpact:'Volatile',mechanism:'Defense portfolio (Anduril, Shield AI, Palantir) benefits. AI companies neutral to positive.',action:'Antifragile position. Defense tech is portfolio insurance.'},
              {factor:'China AI Competition',navImpact:'-3.5%',premImpact:'-5-10%',mechanism:'DeepSeek, Qwen erode Anthropic competitive position. Open-source threatens Scale AI.',action:'Monitor closely. Constitutional AI moat holds vs capability race.'},
              {factor:'Election Cycle (Nov 2026)',navImpact:'±2%',premImpact:'±5%',mechanism:'Defense spending stable bipartisan. AI regulation depends on party. Premium sensitive to sentiment.',action:'Position for either outcome. Both parties pro-defense, pro-AI.'},
            ].map((f,i)=>(<div key={i} style={{padding:'10px 16px',borderBottom:i<5?`1px solid ${T.border}`:'none'}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}>
                <span style={{fontSize:11,fontWeight:700,color:T.text}}>{f.factor}</span>
                <div style={{display:'flex',gap:8}}>
                  <span style={{fontSize:10,fontFamily:mono,fontWeight:700,color:f.navImpact.startsWith('-')?T.red:T.green}}>NAV: {f.navImpact}</span>
                  <span style={{fontSize:10,fontFamily:mono,color:T.amber}}>Prem: {f.premImpact}</span>
                </div>
              </div>
              <div style={{fontSize:9,color:T.textMuted,marginBottom:2}}>{f.mechanism}</div>
              <div style={{fontSize:9,fontWeight:600,color:T.accent}}>Action: {f.action}</div>
            </div>))}</div>
          </Card>
          <Card title="Leading Indicators — What to Watch This Month">
            <div style={{padding:'14px 18px'}}>{[
              {indicator:'Hyperscaler Capex Guides (MSFT, GOOG, AMZN)',signal:'All guiding +15-25% YoY for 2026',reading:'Bullish',impact:'Validates AI spend thesis. Anthropic + Databricks revenue accelerates.',color:T.green},
              {indicator:'VC Fundraising (Pitchbook Quarterly)',signal:'$78B raised in Q4 — up 34% YoY',reading:'Bullish',impact:'GP fundraising health = more opportunities for us. Validates FoF model.',color:T.green},
              {indicator:'IPO Pipeline (Renaissance Capital)',signal:'22 VC-backed IPOs expected H1 2026',reading:'Bullish',impact:'Strong window for Anduril, Stripe. Distribution catalysts for our portfolio.',color:T.green},
              {indicator:'Credit Spreads (HY OAS)',signal:'320bps — tightest since 2021',reading:'Watch',impact:'Risk-on environment but historically precedes correction. Monitor weekly.',color:T.amber},
              {indicator:'CBOE Skew Index',signal:'132 — elevated',reading:'Caution',impact:'Tail risk pricing rising despite low VIX. Smart money buying puts.',color:T.amber},
              {indicator:'SEC Filing Cadence',signal:'3 confidential S-1s in last 30 days',reading:'Bullish',impact:'IPO advisors actively engaged. Our portfolio companies in queue.',color:T.green},
            ].map((ind,i)=>(<div key={i} style={{marginBottom:10}}>
              <div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}>
                <span style={{fontSize:10,fontWeight:600,color:T.text}}>{ind.indicator}</span>
                <Badge color={ind.reading==='Bullish'?T.green:ind.reading==='Watch'||ind.reading==='Caution'?T.amber:T.red}>{ind.reading}</Badge>
              </div>
              <div style={{fontSize:10,color:ind.color,fontWeight:500,marginBottom:1}}>{ind.signal}</div>
              <div style={{fontSize:9,color:T.textMuted}}>{ind.impact}</div>
            </div>))}</div>
          </Card>
        </div>
      </div>)}

      {/* ═══ "WHAT'S NEXT?" — Contextual workflow suggestions ═══ */}
      <ViewNextSteps view={aView}/>

      {/* ═══ RELATED VIEWS FOOTER — Cross-tab contextual navigation ═══ */}
      {activeViewObj?.related && activeViewObj.related.length > 0 && (
        <div style={{marginTop:18,padding:'10px 14px',background:T.bgAccent,borderRadius:8,border:`1px solid ${T.border}`}}>
          <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:8}}>
            <Link size={12} color={T.textDim}/>
            <span style={{fontSize:9,fontWeight:700,color:T.textDim,textTransform:'uppercase',letterSpacing:1}}>Related Views</span>
            <span style={{fontSize:8,color:T.textDim}}>— jump to connected analysis</span>
          </div>
          <div style={{display:'flex',gap:6,flexWrap:'wrap'}}>
            {activeViewObj.related.map(rid => {
              const rv = aViews.find(v=>v.id===rid);
              const rg = tabGroups.find(g=>g.tabs.includes(rid));
              if(!rv||!rg) return null;
              return(<button key={rid} onClick={()=>setAView(rid)} style={{display:'flex',alignItems:'center',gap:8,padding:'7px 14px',background:T.bgCard,border:`1px solid ${T.border}`,borderRadius:6,cursor:'pointer',fontFamily:sans,transition:'all .12s',flex:'0 0 auto'}} onMouseEnter={e=>{e.currentTarget.style.borderColor=rg.color+'60';e.currentTarget.style.background=`${rg.color}08`;}} onMouseLeave={e=>{e.currentTarget.style.borderColor=T.border;e.currentTarget.style.background=T.bgCard;}}>
                <span style={{width:6,height:6,borderRadius:3,background:rg.color,flexShrink:0}}/>
                <div style={{textAlign:'left'}}>
                  <div style={{fontSize:11,fontWeight:600,color:T.text,lineHeight:1}}>{rv.label.replace('⚡ ','')}</div>
                  {rv.desc && <div style={{fontSize:8,color:T.textMuted,lineHeight:1.2,marginTop:2,maxWidth:200}}>{rv.desc.length>55?rv.desc.slice(0,55)+'…':rv.desc}</div>}
                </div>
                <ChevronRight size={11} color={T.textDim} style={{flexShrink:0,opacity:0.5}}/>
              </button>);
            })}
          </div>
        </div>
      )}
    </div>
  );
};

// ════════════════════════════════════════════════════
// MAIN APP
// ════════════════════════════════════════════════════
const NAV_ITEMS = [
  { id: 'overview', label: 'Overview', icon: Activity, group: 'core' },
  { id: 'analytics', label: 'Analytics', icon: PieChart, group: 'core' },
  { id: 'funds', label: 'Portfolio', icon: Layers, group: 'portfolio' },
  { id: 'pipeline', label: 'Pipeline', icon: GitBranch, group: 'portfolio' },
  { id: 'secondaries', label: 'Secondaries', icon: Target, group: 'portfolio' },
  { id: 'investor', label: 'Investor View', icon: TrendingUp, group: 'stakeholder' },
  { id: 'lps', label: 'LPs', icon: Users, group: 'stakeholder' },
  { id: 'network', label: 'Network', icon: Globe, group: 'stakeholder' },
  { id: 'decision', label: 'Decision Science', icon: Zap, group: 'intelligence' },
  { id: 'signals', label: 'Signals', icon: Bell, group: 'intelligence' },
  { id: 'ingest', label: 'Data Ingest', icon: Upload, group: 'intelligence' },
  { id: 'alphaengine', label: '⚡ Alpha Engine', icon: Award, group: 'intelligence' },
];
const NAV_GROUPS = [
  { id: 'core', label: null },
  { id: 'portfolio', label: 'Portfolio' },
  { id: 'stakeholder', label: 'Stakeholders' },
  { id: 'intelligence', label: 'Intelligence' },
];

export default function App() {
  const [tab, setTab] = useState('overview');
  const [time, setTime] = useState(new Date());
  useEffect(() => { const i = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(i); }, []);

  return (
    <div style={{ fontFamily: sans, background: T.bg, color: T.text, minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
      <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
      <style>{`
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%; background: #fff; border: 2px solid ${T.accent}; cursor: pointer; box-shadow: 0 1px 4px #0003; }
        input[type="range"]::-moz-range-thumb { width: 14px; height: 14px; border-radius: 50%; background: #fff; border: 2px solid ${T.accent}; cursor: pointer; }
      `}</style>

      {/* Top Bar */}
      <div style={{ height: 48, borderBottom: `1px solid ${T.border}`, display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 18px', background: T.bgCard, flexShrink: 0 }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
          <div style={{ width: 28, height: 28, borderRadius: 6, background: `linear-gradient(135deg, ${T.accent}, ${T.blue})`, display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: `0 2px 8px ${T.accent}30`, cursor:'pointer' }} onClick={()=>setTab('alphaengine')} title="Go to Platform">
            <span style={{ fontSize: 14, fontWeight: 900, color: T.bg }}>N</span>
          </div>
          <span style={{ fontSize: 15, fontWeight: 800, letterSpacing: '-0.3px', cursor:'pointer' }} onClick={()=>setTab('alphaengine')}>NEWCO</span>
          <span style={{ fontSize: 9, color: T.textDim, fontFamily: mono, background: T.bgAccent, padding: '2px 6px', borderRadius: 3, letterSpacing: '0.5px' }}>V10</span>
          {/* Live status ticker — static urgent indicator */}
          <div style={{display:'flex',alignItems:'center',gap:6,marginLeft:6,padding:'3px 10px',background:`${T.red}08`,border:`1px solid ${T.red}25`,borderRadius:6,cursor:'pointer',animation:'pulse 2s infinite'}} onClick={()=>setTab('alphaengine')}>
            <span style={{width:6,height:6,borderRadius:3,background:T.red}}/>
            <span style={{fontSize:9,fontWeight:600,color:T.red}}>FF VI Secondary Bid</span>
            <span style={{fontSize:8,color:T.textDim}}>— Deadline TODAY 5PM</span>
          </div>
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
          <div style={{display:'flex',alignItems:'center',gap:3}}>
            <span style={{ fontSize: 10, color: T.textDim, fontFamily: mono }}>NYSE: NEWCO</span>
            <span style={{ fontSize: 11, color: T.accent, fontFamily: mono, fontWeight: 700 }}>$24.38</span>
            <span style={{ fontSize: 10, color: T.green, fontWeight: 600 }}>↑2.4%</span>
          </div>
          <div style={{display:'flex',alignItems:'center',gap:3}}>
            <span style={{fontSize:10,color:T.textDim,fontFamily:mono}}>NAV</span>
            <span style={{fontSize:11,color:T.blue,fontFamily:mono,fontWeight:700}}>$9.84</span>
          </div>
          <div style={{display:'flex',alignItems:'center',gap:3}}>
            <span style={{fontSize:10,color:T.textDim,fontFamily:mono}}>Prem</span>
            <span style={{fontSize:11,color:T.accent,fontFamily:mono,fontWeight:700}}>+148%</span>
          </div>
          <div style={{width:1,height:20,background:T.border}}/>
          <span style={{ fontSize: 10, color: T.textDim, fontFamily: mono }}>{time.toLocaleTimeString('en-US', { hour12: false })}</span>
          <div style={{ width: 30, height: 30, borderRadius: '50%', background: T.bgAccent, display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', position: 'relative', border: `1px solid ${T.border}`, transition: 'border-color .15s' }} onClick={()=>setTab('alphaengine')} onMouseEnter={e=>e.currentTarget.style.borderColor=T.accent+'60'} onMouseLeave={e=>e.currentTarget.style.borderColor=T.border} title="Open Action Center">
            <Bell size={14} color={T.textMuted} />
            <span style={{position:'absolute',top:-2,right:-2,width:14,height:14,borderRadius:7,background:T.red,display:'flex',alignItems:'center',justifyContent:'center',fontSize:8,fontWeight:800,color:T.bg,border:`2px solid ${T.bgCard}`}}>6</span>
          </div>
        </div>
      </div>

      <div style={{ display: 'flex', flex: 1, overflow: 'hidden' }}>
        {/* Sidebar */}
        <div style={{ width: 190, borderRight: `1px solid ${T.border}`, background: T.bgCard, padding: '10px 6px', display: 'flex', flexDirection: 'column', flexShrink: 0, overflowY: 'auto' }}>
          {NAV_GROUPS.map(g => (
            <div key={g.id}>
              {g.label && <div style={{ fontSize: 8, color: T.textDim, padding: '10px 10px 4px', textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, borderTop: g.id!=='core'?`1px solid ${T.border}`:'none', marginTop: g.id!=='core'?6:0 }}>{g.label}</div>}
              {NAV_ITEMS.filter(i=>i.group===g.id).map(item => {
                const isAlpha = item.id==='alphaengine';
                const isActive = tab === item.id;
                return(<React.Fragment key={item.id}>
                <button onClick={() => setTab(item.id)} style={{
                  display: 'flex', alignItems: 'center', gap: 9, padding: '8px 10px', borderRadius: 5, border: isAlpha&&!isActive?`1px solid ${T.accent}30`:'1px solid transparent', cursor: 'pointer', width: '100%', textAlign: 'left',
                  background: isActive ? (isAlpha?`linear-gradient(135deg, ${T.accent}18, ${T.purple}12)`:T.bgAccent) : (isAlpha?`${T.accent}06`:'transparent'),
                  color: isActive ? T.accent : (isAlpha?T.accent:T.textMuted),
                  transition: 'all 0.12s', fontSize: 12, fontWeight: isActive ? 700 : (isAlpha?600:400), fontFamily: sans,
                }}>
                  <item.icon size={14} />{item.label}
                  {isAlpha&&<span style={{marginLeft:'auto',fontSize:7,padding:'1px 4px',background:isActive?T.accent:T.bgAccent,color:isActive?T.bg:T.accent,borderRadius:3,fontWeight:800}}>26</span>}
                </button>
                {isAlpha && isActive && (
                  <div style={{padding:'1px 10px 3px 32px',fontSize:8,color:T.accent,fontWeight:500,opacity:0.7,display:'flex',gap:4,alignItems:'center'}}>
                    <Activity size={8}/> <span>4 groups · ⌘K to search</span>
                  </div>
                )}
                </React.Fragment>);
              })}
            </div>
          ))}
          <div style={{ flex: 1 }} />
          <div style={{ borderTop: `1px solid ${T.border}`, paddingTop: 10, marginTop: 6 }}>
            <div style={{ fontSize: 9, color: T.textDim, padding: '0 10px 6px', textTransform: 'uppercase', letterSpacing: '0.5px', fontWeight: 700 }}>Team</div>
            {TEAM.map(t => (
              <div key={t.id} style={{ display: 'flex', alignItems: 'center', gap: 6, padding: '4px 10px', fontSize: 10 }}>
                <div style={{ width: 5, height: 5, borderRadius: '50%', background: T.accent }} />
                <span style={{ color: T.textMuted }}>{t.name.split(' ')[0]}</span>
                <span style={{ marginLeft: 'auto', color: T.textDim, fontFamily: mono, fontSize: 9 }}>{t.role}</span>
              </div>
            ))}
          </div>
        </div>

        {/* Content */}
        <div style={{ flex: 1, overflow: 'auto', padding: 18, paddingBottom: tab === 'alphaengine' ? 90 : 18 }}>
          <div style={{ marginBottom: 16, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <h1 style={{ fontSize: 20, fontWeight: 800, margin: 0, letterSpacing: '-0.5px' }}>{NAV_ITEMS.find(n => n.id === tab)?.label}</h1>
                {tab==='alphaengine'&&<span style={{fontSize:9,padding:'2px 8px',background:`linear-gradient(135deg, ${T.accent}20, ${T.purple}15)`,color:T.accent,borderRadius:4,fontWeight:700,fontFamily:mono,border:`1px solid ${T.accent}30`}}>26 VIEWS · 4 DOMAINS</span>}
              </div>
              <p style={{ fontSize: 11, color: T.textDim, margin: '3px 0 0' }}>
                {tab==='alphaengine' ? 'Investment intelligence · Institutional operations · Distribution · Omniscient AI' : 'New Co Public Fund — AI Safety & Trust VC Fund-of-Funds'}
              </p>
            </div>
            <div style={{ display: 'flex', gap: 6 }}>
              <button style={{ display: 'flex', alignItems: 'center', gap: 5, padding: '7px 12px', borderRadius: 5, border: `1px solid ${T.border}`, background: T.bgCard, color: T.textMuted, fontSize: 11, cursor: 'pointer', fontFamily: sans, transition: 'border-color .15s' }} onMouseEnter={e=>e.currentTarget.style.borderColor=T.accent+'40'} onMouseLeave={e=>e.currentTarget.style.borderColor=T.border}><Filter size={13} /> Filter</button>
              <button style={{ display: 'flex', alignItems: 'center', gap: 5, padding: '7px 12px', borderRadius: 5, border: 'none', background: T.accent, color: T.bg, fontSize: 11, fontWeight: 700, cursor: 'pointer', fontFamily: sans, transition: 'opacity .15s' }} onMouseEnter={e=>e.currentTarget.style.opacity='0.85'} onMouseLeave={e=>e.currentTarget.style.opacity='1'}><Plus size={13} /> Add New</button>
            </div>
          </div>

          {tab === 'overview' && (
            <div>
              {/* KPI Strip — 5 headline stats */}
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 10, marginBottom: 14 }}>
                <Stat label="Fund NAV" value="$193.7M" icon={DollarSign} trend={8.3} sub="as of today" color={T.accent} />
                <Stat label="Active Funds" value="8" icon={Layers} sub="across 6 GPs" color={T.blue} />
                <Stat label="Look-Through Cos" value="130+" icon={Building2} sub="12 tracked" color={T.purple} />
                <Stat label="Secondary Pipeline" value="$22.5B" icon={Target} trend={15} sub="8 opportunities" color={T.green} />
                <Stat label="Network Score" value="974" icon={Zap} trend={3} sub="top 1% density" color={T.cyan} />
              </div>

              {/* Trend Sparklines — at-a-glance momentum */}
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 10, marginBottom: 14 }}>
                {[
                  { label: 'NAV Trend (12mo)', data: [142, 148, 155, 160, 168, 172, 178, 182, 185, 188, 191, 194], color: T.accent, current: '$193.7M', delta:'+$52M', deltaC:T.green },
                  { label: 'Portfolio TVPI', data: [1.05, 1.1, 1.15, 1.22, 1.28, 1.32, 1.35, 1.38, 1.40, 1.41, 1.42, 1.42], color: T.green, current: '1.42x', delta:'+0.37x', deltaC:T.green },
                  { label: 'Weighted IRR', data: [8, 10, 12, 14, 16, 18, 19, 20, 21, 22, 22, 22.4], color: T.blue, current: '22.4%', delta:'+14.4pp', deltaC:T.green },
                  { label: 'DPI (Cash Returned)', data: [0, 0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.12, 0.15, 0.18, 0.2, 0.22], color: T.amber, current: '0.22x', delta:'J-curve', deltaC:T.amber },
                ].map((s, i) => (
                  <Card key={i}>
                    <div style={{ padding: '10px 14px' }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 6 }}>
                        <span style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', fontWeight: 700 }}>{s.label}</span>
                        <div style={{textAlign:'right'}}><span style={{ fontSize: 14, fontWeight: 800, fontFamily: mono, color: s.color }}>{s.current}</span><div style={{fontSize:8,color:s.deltaC,fontWeight:600}}>{s.delta}</div></div>
                      </div>
                      <SparkLine data={s.data} width={160} height={32} color={s.color} showDots fill />
                    </div>
                  </Card>
                ))}
              </div>

              {/* ── PUBLIC MARKETS TICKER — Live stock + NAV metrics ── */}
              <div style={{display:'flex',gap:8,marginBottom:14,padding:'8px 14px',background:`linear-gradient(90deg, ${T.accent}06, ${T.purple}04, ${T.green}06)`,borderRadius:8,border:`1px solid ${T.accent}20`,alignItems:'center',cursor:'pointer',transition:'border-color .15s'}} onClick={()=>setTab('alphaengine')} onMouseEnter={e=>e.currentTarget.style.borderColor=T.accent+'50'} onMouseLeave={e=>e.currentTarget.style.borderColor=T.accent+'20'}>
                <div style={{display:'flex',alignItems:'center',gap:6,marginRight:8}}>
                  <span style={{fontSize:11}}>📈</span>
                  <div style={{fontSize:9,fontWeight:800,color:T.accent,textTransform:'uppercase',letterSpacing:1}}>NYSE</div>
                </div>
                {[
                  {l:'NEWCO',v:'$24.38',d:'+2.1%',c:T.green},
                  {l:'NAV/Share',v:'$9.84',d:'Q4 mark',c:T.blue},
                  {l:'Premium',v:'+148%',d:'to NAV',c:T.accent},
                  {l:'Mkt Cap',v:'$582M',d:'23.9M shs',c:T.purple},
                  {l:'Volume',v:'312K',d:'vs 248K avg',c:T.green},
                  {l:'SI %',v:'18.4%',d:'4.4M short',c:T.red},
                  {l:'ATM Left',v:'$28.5M',d:'of $50M',c:T.amber},
                ].map((t,i)=>(<div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'4px 10px',borderRight:i<6?`1px solid ${T.border}`:'none'}}>
                  <div>
                    <div style={{fontSize:8,color:T.textDim,fontWeight:600,textTransform:'uppercase'}}>{t.l}</div>
                    <div style={{display:'flex',alignItems:'baseline',gap:4}}>
                      <span style={{fontSize:13,fontWeight:800,fontFamily:mono,color:t.c}}>{t.v}</span>
                      <span style={{fontSize:8,color:T.textMuted}}>{t.d}</span>
                    </div>
                  </div>
                </div>))}
                <div style={{marginLeft:'auto',fontSize:9,color:T.textDim,display:'flex',alignItems:'center',gap:4}}>View Public Markets <ChevronRight size={10}/></div>
              </div>

              {/* ROW 1: Treemap + Risk/Return Scatter + NAV Waterfall */}
              <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: 12, marginBottom: 14 }}>
                <PortfolioTreemap width={720} height={320} />
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 14 }}>
                <RiskReturnScatter width={350} height={280} />
                <NAVWaterfall width={350} height={280} />
              </div>

              {/* ROW 2: Fund Health Heatmap — full width alert matrix */}
              <FundHeatGrid width={720} />

              {/* ROW 3: Concentration + Performance Attribution + Activity Feed */}
              <div style={{ display: 'grid', gridTemplateColumns: '350px 1fr', gap: 12, marginTop: 14 }}>
                <ConcentrationRing width={350} height={240} />
                <Card title="Recent Activity & Signals">
                  <div style={{ padding: '8px 14px' }}>
                    {[
                      { action: 'NEWCO stock +2.1% on volume spike', detail: '312K shares vs 248K avg — Renaissance Tech buying', time: '12m', color: T.green, icon: '📈' },
                      { action: 'Anthropic Safety → Screening', detail: 'Score: 95 — highest pipeline entry', time: '2m', color: T.accent, icon: '🔬' },
                      { action: 'Sequoia Growth III secondary listed', detail: '82¢ — 18% discount to NAV', time: '1h', color: T.green, icon: '💰' },
                      { action: 'Short interest down -0.8% this week', detail: 'Borrow cost up 400bps — shorts under pressure', time: '2h', color: T.red, icon: '📉' },
                      { action: 'Mercer Advisors committed $25M', detail: 'Gold tier LP — Don Calcagni signed', time: '3h', color: T.gold, icon: '🏦' },
                      { action: 'NEA 19 NAV → $62.1M', detail: 'Robust Intelligence markup +22%', time: '6h', color: T.blue, icon: '📊' },
                      { action: 'Anduril S-1 filing imminent', detail: 'IPO catalyst — 4.8% NAV uplift potential', time: '1d', color: T.purple, icon: '🚀' },
                      { action: 'ATM sold 18K shares at $24.52', detail: '+149% premium captured → $441K NAV accretive', time: '1d', color: T.accent, icon: '💎' },
                    ].map((a, i) => (
                      <div key={i} style={{ display: 'flex', gap: 8, padding: '6px 0', borderBottom: i < 6 ? `1px solid ${T.border}06` : 'none' }}>
                        <span style={{fontSize:14,flexShrink:0,width:20,textAlign:'center'}}>{a.icon}</span>
                        <div style={{ flex: 1 }}>
                          <div style={{ fontSize: 11, color: T.text, fontWeight: 500 }}>{a.action}</div>
                          <div style={{ fontSize: 9, color: T.textDim }}>{a.detail}</div>
                        </div>
                        <span style={{ fontSize: 9, color: T.textDim, fontFamily: mono, flexShrink:0 }}>{a.time}</span>
                      </div>
                    ))}
                  </div>
                </Card>
              </div>

              {/* ROW 4: Performance Attribution + Thesis Radar */}
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 350px', gap: 12, marginTop: 14 }}>
                <PerfAttribution width={350} />
                <Card title="Thesis Radar">
                  <div style={{ padding: 10, display: 'flex', justifyContent: 'center' }}>
                    <RadarChart data={[94, 88, 72, 92, 85, 78]} labels={['AI Safety', 'GovTech', 'Trust', 'Growth', 'Moat', 'Risk/Rew']} size={170} color={T.accent} />
                  </div>
                </Card>
              </div>

              {/* ROW 5: Capital Flow Sankey + Pipeline Funnel */}
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 340px', gap: 12, marginTop: 14 }}>
                <SankeyFlow
                  width={420} height={300}
                  title="Capital Flow — LP → Fund → Sector → Company"
                  data={[
                    // LPs → Funds
                    {from:'Mercer',to:'Founders VII',value:12,fromCol:0,toCol:1,color:T.accent},
                    {from:'Mercer',to:'Lux VI',value:8,fromCol:0,toCol:1,color:T.accent},
                    {from:'NorthernTrust',to:'a16z Infra',value:25,fromCol:0,toCol:1,color:T.blue},
                    {from:'NorthernTrust',to:'NEA 19',value:15,fromCol:0,toCol:1,color:T.blue},
                    {from:'CalPERS',to:'Sequoia VIII',value:20,fromCol:0,toCol:1,color:T.green},
                    {from:'CalPERS',to:'Benchmark X',value:10,fromCol:0,toCol:1,color:T.green},
                    {from:'Endowments',to:'Greylock XVII',value:15,fromCol:0,toCol:1,color:T.purple},
                    {from:'Endowments',to:'Khosla IX',value:10,fromCol:0,toCol:1,color:T.purple},
                    // Funds → Sectors
                    {from:'Founders VII',to:'AI Safety',value:12,fromCol:1,toCol:2,color:T.accent},
                    {from:'Lux VI',to:'GovTech',value:8,fromCol:1,toCol:2,color:T.blue},
                    {from:'a16z Infra',to:'AI Infra',value:25,fromCol:1,toCol:2,color:T.blue},
                    {from:'NEA 19',to:'AI Safety',value:10,fromCol:1,toCol:2,color:T.accent},
                    {from:'NEA 19',to:'Trust',value:5,fromCol:1,toCol:2,color:T.purple},
                    {from:'Sequoia VIII',to:'AI Infra',value:15,fromCol:1,toCol:2,color:T.blue},
                    {from:'Sequoia VIII',to:'AI Safety',value:5,fromCol:1,toCol:2,color:T.accent},
                    {from:'Benchmark X',to:'Trust',value:10,fromCol:1,toCol:2,color:T.purple},
                    {from:'Greylock XVII',to:'GovTech',value:15,fromCol:1,toCol:2,color:T.green},
                    {from:'Khosla IX',to:'AI Infra',value:10,fromCol:1,toCol:2,color:T.blue},
                    // Sectors → Companies
                    {from:'AI Safety',to:'Anthropic',value:14,fromCol:2,toCol:3,color:T.accent},
                    {from:'AI Safety',to:'Shield AI',value:8,fromCol:2,toCol:3,color:T.accent},
                    {from:'AI Safety',to:'Contextual',value:5,fromCol:2,toCol:3,color:T.accent},
                    {from:'AI Infra',to:'Databricks',value:22,fromCol:2,toCol:3,color:T.blue},
                    {from:'AI Infra',to:'Scale AI',value:14,fromCol:2,toCol:3,color:T.blue},
                    {from:'AI Infra',to:'Crusoe',value:14,fromCol:2,toCol:3,color:T.blue},
                    {from:'GovTech',to:'Anduril',value:15,fromCol:2,toCol:3,color:T.green},
                    {from:'GovTech',to:'Armada',value:8,fromCol:2,toCol:3,color:T.green},
                    {from:'Trust',to:'Verkada',value:8,fromCol:2,toCol:3,color:T.purple},
                    {from:'Trust',to:'Drata',value:7,fromCol:2,toCol:3,color:T.purple},
                  ]}
                />
                <FunnelChart
                  width={340} height={300}
                  title="Deal Pipeline Funnel"
                  stages={[
                    {label:'Sourced',value:127,color:T.textMuted},
                    {label:'Screening',value:48,color:T.blue},
                    {label:'Due Diligence',value:18,color:T.amber},
                    {label:'IC Review',value:8,color:T.purple},
                    {label:'Term Sheet',value:4,color:T.green},
                    {label:'Committed',value:3,color:T.accent},
                  ]}
                />
              </div>

              {/* ROW 6: Alpha Engine Intelligence Summary — Quick access to crown jewel */}
              <div style={{ marginTop: 14, background: `linear-gradient(135deg, ${T.accent}06, ${T.purple}04)`, border: `1px solid ${T.accent}25`, borderRadius: 8, padding: '12px 16px', cursor: 'pointer', transition: 'border-color .15s' }} onClick={()=>setTab('alphaengine')} onMouseEnter={e=>e.currentTarget.style.borderColor=T.accent+'60'} onMouseLeave={e=>e.currentTarget.style.borderColor=T.accent+'25'}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
                  <div style={{display:'flex',alignItems:'center',gap:8}}>
                    <span style={{fontSize:16}}>⚡</span>
                    <div>
                      <div style={{fontSize:12,fontWeight:800,color:T.accent}}>Alpha Engine Intelligence</div>
                      <div style={{fontSize:9,color:T.textMuted}}>52 analytical views across 5 domains + 8 workflows — click to explore</div>
                    </div>
                  </div>
                  <div style={{display:'flex',gap:12,alignItems:'center'}}>
                    {[
                      {l:'📊 Investment',v:'10 views',c:T.accent},
                      {l:'⚙️ Operations',v:'6 views',c:T.blue},
                      {l:'🏦 Distribution',v:'6 views',c:T.green},
                      {l:'⚡ Omniscient AI',v:'4 views',c:T.purple},
                    ].map((g,i)=>(<div key={i} style={{textAlign:'center',padding:'0 8px',borderRight:i<3?`1px solid ${T.border}`:'none'}}>
                      <div style={{fontSize:10,fontWeight:700,fontFamily:mono,color:g.c}}>{g.v}</div>
                      <div style={{fontSize:7,color:T.textDim}}>{g.l}</div>
                    </div>))}
                    <ChevronRight size={16} color={T.accent}/>
                  </div>
                </div>
                <div style={{display:'flex',gap:8}}>
                  {[
                    {label:'Strong Buy Opps',value:'3',c:T.accent},
                    {label:'Agent Value/Mo',value:'$22.3K',c:T.green},
                    {label:'Hours Saved/Yr',value:'680+',c:T.blue},
                    {label:'Network Nodes',value:'50K+',c:T.purple},
                    {label:'Fund MOIC Impact',value:'+40%',c:T.accent},
                    {label:'Build Progress',value:'42%',c:T.amber},
                  ].map((m,i)=>(<div key={i} style={{flex:1,textAlign:'center',padding:'4px 6px',background:`${m.c}06`,borderRadius:4,border:`1px solid ${m.c}15`}}>
                    <div style={{fontSize:13,fontWeight:800,fontFamily:mono,color:m.c}}>{m.value}</div>
                    <div style={{fontSize:7,color:T.textDim,fontWeight:600}}>{m.label}</div>
                  </div>))}
                </div>
              </div>

              {/* Signal Ticker Strip */}
              <div style={{ marginTop: 14, background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '8px 16px', display: 'flex', gap: 16, alignItems: 'center', overflow: 'hidden' }}>
                <span style={{ fontSize: 9, color: T.accent, fontWeight: 700, textTransform: 'uppercase', flexShrink: 0 }}>⚡ Live Signals</span>
                {[
                  { text: 'Anthropic $3.5B Series E at $75B', color: T.green },
                  { text: 'EU AI Act GPAI enforcement guidelines published', color: T.blue },
                  { text: 'SpaceX secondary — $10M block available 48hr window', color: T.amber },
                  { text: 'Taiwan Strait exercises — defense tech +4.2%', color: T.red },
                  { text: 'Databricks S-1 filed confidentially', color: T.purple },
                ].map((s, i) => (
                  <span key={i} style={{ fontSize: 10, color: s.color, whiteSpace: 'nowrap', fontFamily: mono, fontWeight: 500 }}>● {s.text}</span>
                ))}
              </div>
            </div>
          )}

          {tab === 'analytics' && <PortfolioAnalytics />}
          {tab === 'secondaries' && <SecondariesMarket />}
          {tab === 'investor' && <PublicMarketView />}
          {tab === 'funds' && <FoFDashboard />}
          {tab === 'pipeline' && <DealPipeline />}
          {tab === 'lps' && <LPManagement />}
          {tab === 'decision' && <DecisionScienceEngine />}
          {tab === 'signals' && <SignalsIntelligence />}
          {tab === 'ingest' && <DataIngestion />}
          {tab === 'alphaengine' && <AlphaEngine />}
          {tab === 'network' && (() => {
            const [netView, setNetView] = React.useState('graph');
            // Deal flow attribution
            const dealFlowAttrib = [
              { source: 'GP Relationships (direct)', deals: 14, closed: 5, capital: '$145M', conversion: '36%', topDeal: 'Founders Fund VII', color: T.accent },
              { source: 'UC Berkeley Network', deals: 8, closed: 3, capital: '$62M', conversion: '38%', topDeal: 'Contextual AI', color: T.blue },
              { source: 'LP Referrals', deals: 6, closed: 2, capital: '$48M', conversion: '33%', topDeal: 'Anduril Growth', color: T.amber },
              { source: 'Conference / Events', deals: 4, closed: 1, capital: '$25M', conversion: '25%', topDeal: 'Shield AI II', color: T.purple },
              { source: 'Cold Outbound', deals: 12, closed: 1, capital: '$15M', conversion: '8%', topDeal: 'Rebellion Defense', color: T.textMuted },
              { source: 'Inbound (website/PR)', deals: 6, closed: 0, capital: '$0M', conversion: '0%', topDeal: '—', color: T.textDim },
            ];
            // Warm intro pathfinding
            const targetAccess = [
              { target: 'OpenAI Fund', bestPath: 'Jason → Reid Hoffman → Sam Altman', hops: 2, strength: 78, alternates: ['Bob → Dario Amodei → Sam (ex-colleague)', 'Ken → Microsoft LP → OpenAI board'], status: 'Active — intro requested', value: '$1B fund' },
              { target: 'Palantir AIP Fund', bestPath: 'Ken → Palantir IR → Alex Karp', hops: 2, strength: 82, alternates: ['Jason → Peter Thiel → Karp (FF connection)'], status: 'In progress', value: '$300M co-invest' },
              { target: 'xAI Ventures', bestPath: 'Jason → Founders Fund → Elon network', hops: 3, strength: 42, alternates: ['No strong alternate path'], status: 'Cold — need bridge', value: '$500M fund' },
              { target: 'Apple AI Fund', bestPath: 'Brett → Berkeley alumni → Apple ML team', hops: 3, strength: 35, alternates: ['Ken → JP Morgan → Apple treasury'], status: 'Speculative', value: 'TBD' },
              { target: 'NVIDIA Inception VC', bestPath: 'Ken → a16z → Jensen Huang', hops: 2, strength: 68, alternates: ['Bob → Crusoe Energy → NVIDIA partnership'], status: 'Warm — meeting scheduled', value: '$200M co-invest' },
            ];
            // Relationship decay alerts
            const decayAlerts = [
              { contact: 'Peter Thiel', via: 'Jason (Founders Fund)', lastTouch: '3 months', risk: 'HIGH', action: 'Schedule dinner. Critical for FF VII allocation and SpaceX secondary intel.', value: '$50M+ deal flow' },
              { contact: 'Vinod Khosla', via: 'Ken (Khosla IX)', lastTouch: '6 weeks', risk: 'MEDIUM', action: 'Attend Khosla annual meeting in March. Need face time for Crusoe follow-on.', value: '$30M co-invest' },
              { contact: 'Stacy Singer', via: 'Matthew (Northern Trust)', lastTouch: '4 weeks', risk: 'HIGH', action: 'Matthew overdue on follow-up. $40M LP prospect going cold. Immediate re-engage.', value: '$40M LP commitment' },
              { contact: 'Reid Hoffman', via: 'Jason (Greylock)', lastTouch: '5 months', risk: 'HIGH', action: 'Critical bridge to OpenAI. Propose advisory board seat or AI Safety co-investment.', value: 'Strategic — OpenAI access' },
              { contact: 'Brad Gerstner', via: 'Bob (Altimeter)', lastTouch: '2 weeks', risk: 'LOW', action: 'Active. Continue monthly check-ins. Potential secondary market intelligence source.', value: 'Intel' },
            ];
            // Network gap analysis
            const networkGaps = [
              { sector: 'Sovereign Wealth', current: 0, target: 3, gap: 'CRITICAL', opportunity: 'Abu Dhabi Investment Authority, Temasek, GIC all investing in AI Safety. Zero current access.', action: 'Hire LP placement agent with sovereign wealth Rolodex. Or approach via Goldman Sachs PWM connection.' },
              { sector: 'Endowments', current: 1, target: 4, gap: 'HIGH', opportunity: 'Stanford, MIT, Harvard endowments allocating to VC FoF. UC Berkeley (Jason heritage) should be warm intro.', action: 'Jason to approach UC Berkeley endowment directly. Use Goldman School board seat for intro.' },
              { sector: 'Family Offices (>$1B)', current: 2, target: 6, gap: 'MEDIUM', opportunity: 'Ultra-HNW family offices are fastest-growing LP segment. Direct decision-making, faster close cycles.', action: 'Attend SALT Conference and Tiger 21 events. Leverage Neff exit story for founder-family-office rapport.' },
              { sector: 'Insurance / Pension', current: 0, target: 2, gap: 'HIGH', opportunity: 'CalPERS, CalSTRS, LACERA beginning VC FoF allocations. Government pension aligns with GovTech thesis.', action: 'Need institutional consultant endorsement. Approach Cambridge Associates for inclusion in their platform.' },
            ];
            const netViews = [{ id: 'graph', label: 'Network Graph' }, { id: 'flow', label: 'Deal Flow Attribution' }, { id: 'paths', label: 'Warm Intros' }, { id: 'decay', label: 'Relationship Decay' }, { id: 'gaps', label: 'Network Gaps' }, { id: 'roi', label: 'Network ROI' }, { id: 'influence', label: 'Influence Map' }, { id: 'events', label: 'Event ROI' }, { id: 'ecosystem', label: 'Partnership Ecosystem' }];
            return (
              <div>
                <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:14}}>
                  <Stat label="Total Connections" value={TEAM.reduce((s,t)=>s+t.connections,0)} icon={Globe} sub="across 5 partners" color={T.accent}/>
                  <Stat label="Deal Flow Sources" value={dealFlowAttrib.length} icon={GitBranch} sub={`${dealFlowAttrib.reduce((s,d)=>s+d.deals,0)} deals sourced`} color={T.blue}/>
                  <Stat label="Warm Intro Queue" value={targetAccess.filter(t=>t.strength>=50).length} icon={Users} sub="actionable paths" color={T.green}/>
                  <Stat label="Decay Alerts" value={decayAlerts.filter(d=>d.risk==='HIGH').length} icon={AlertTriangle} sub="relationships at risk" color={T.red}/>
                  <Stat label="Network Gaps" value={networkGaps.filter(g=>g.gap==='CRITICAL'||g.gap==='HIGH').length} icon={Target} sub="strategic blind spots" color={T.amber}/>
                </div>
                <div style={{ display: 'flex', gap: 2, marginBottom: 14, background: T.bgCard, borderRadius: 6, padding: 3, border: `1px solid ${T.border}`, overflowX: 'auto' }}>
                  {netViews.map(v => <button key={v.id} onClick={() => setNetView(v.id)} style={{ padding: '6px 12px', borderRadius: 4, border: 'none', cursor: 'pointer', fontSize: 11, fontWeight: 600, background: netView === v.id ? T.accent : 'transparent', color: netView === v.id ? T.bg : T.textMuted, fontFamily: sans, whiteSpace: 'nowrap' }}>{v.label}</button>)}
                </div>

                {netView === 'graph' && (
                  <div>
                    <NetworkGraph width={720} height={480} />
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 10, marginTop: 14 }}>
                      <Card title="Network Density"><div style={{padding:14}}>{TEAM.map(t=><div key={t.id} style={{marginBottom:8}}><div style={{display:'flex',justifyContent:'space-between',marginBottom:3}}><span style={{fontSize:11,color:T.text}}>{t.name}</span><span style={{fontSize:10,color:T.accent,fontFamily:mono}}>{t.connections}</span></div><Bar value={t.connections} max={350} color={T.accent} h={3}/></div>)}</div></Card>
                      <Card title="Connection Types"><div style={{padding:14}}>{[{type:'Fund GPs',count:142,color:T.blue},{type:'LPs & Allocators',count:89,color:T.amber},{type:'Founders',count:324,color:T.accent},{type:'Co-Investors',count:67,color:T.purple},{type:'Advisors',count:43,color:T.cyan}].map(c=><div key={c.type} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'5px 0',borderBottom:`1px solid ${T.border}06`}}><div style={{display:'flex',alignItems:'center',gap:6}}><div style={{width:6,height:6,borderRadius:'50%',background:c.color}}/><span style={{fontSize:11,color:T.text}}>{c.type}</span></div><span style={{fontSize:11,fontWeight:600,color:c.color,fontFamily:mono}}>{c.count}</span></div>)}</div></Card>
                      <Card title="Intro Path Analysis"><div style={{padding:14}}>{[{from:'Jason',to:'Shield AI',hops:1,via:'Ken → Direct',strength:95},{from:'Bob',to:'OpenAI',hops:2,via:'Jason → Sam A.',strength:78},{from:'Ken',to:'Databricks',hops:1,via:'Direct LP',strength:92},{from:'Brett',to:'Anduril',hops:2,via:'Jason → Palmer',strength:85}].map((p,i)=><div key={i} style={{padding:'6px 0',borderBottom:i<3?`1px solid ${T.border}06`:'none'}}><div style={{display:'flex',justifyContent:'space-between',marginBottom:2}}><span style={{fontSize:11,color:T.text,fontWeight:500}}>{p.from} → {p.to}</span><Badge color={p.strength>=90?T.accent:p.strength>=80?T.blue:T.amber}>{p.strength}%</Badge></div><div style={{fontSize:9,color:T.textDim}}>{p.hops} hop{p.hops>1?'s':''} · via {p.via}</div></div>)}</div></Card>
                    </div>
                  </div>
                )}

                {netView === 'flow' && (
                  <Card title="Deal Flow Attribution — Where Do Our Best Deals Come From?">
                    <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                      <thead><tr>{['Source Channel', 'Deals Sourced', 'Closed', 'Capital Deployed', 'Conversion', 'Top Deal'].map(h => <TH key={h} align={['Source Channel','Top Deal'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
                      <tbody>{dealFlowAttrib.sort((a,b)=>parseInt(b.capital)-parseInt(a.capital)).map((d,i) => (
                        <TR key={i}>
                          <TD bold color={d.color}>{d.source}</TD>
                          <TD align="right" mono>{d.deals}</TD>
                          <TD align="right" mono bold color={d.closed>0?T.accent:T.textDim}>{d.closed}</TD>
                          <TD align="right" mono bold color={T.accent}>{d.capital}</TD>
                          <TD align="right"><div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'flex-end'}}>
                            <div style={{width:32,height:4,background:T.bgAccent,borderRadius:2,overflow:'hidden'}}><div style={{width:`${parseInt(d.conversion)}%`,height:'100%',background:parseInt(d.conversion)>=30?T.accent:parseInt(d.conversion)>=15?T.blue:T.red,borderRadius:2}}/></div>
                            <span style={{fontSize:11,fontFamily:mono,fontWeight:700,color:parseInt(d.conversion)>=30?T.accent:parseInt(d.conversion)>=15?T.blue:T.red}}>{d.conversion}</span>
                          </div></TD>
                          <TD color={T.textMuted}>{d.topDeal}</TD>
                        </TR>
                      ))}</tbody>
                    </table></div>
                    <div style={{ padding: 14, marginTop: 8, background: T.accentBg, borderRadius: 6, border: `1px solid ${T.accent}25` }}>
                      <div style={{ fontSize: 10, color: T.accent, fontWeight: 700, marginBottom: 4 }}>INSIGHT</div>
                      <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6 }}>GP relationships and UC Berkeley network produce 76% of closed capital at 36-38% conversion rates. Cold outbound produces volume but only 8% conversion. Recommend shifting 40% of outbound time to network-warm sourcing for 4x higher ROI.</div>
                    </div>
                  </Card>
                )}

                {netView === 'paths' && (
                  <div>
                    <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Warm Introduction Pathfinding — Shortest Path to Target</div>
                    {targetAccess.map((t, i) => (
                      <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 8, borderLeft: `3px solid ${t.strength >= 70 ? T.accent : t.strength >= 50 ? T.blue : T.amber}` }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                          <div>
                            <div style={{ fontSize: 15, fontWeight: 700, color: T.text }}>{t.target}</div>
                            <div style={{ fontSize: 10, color: T.textMuted }}>{t.value}</div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 6, justifyContent: 'flex-end' }}>
                              <div style={{width:40,height:6,background:T.bgAccent,borderRadius:3,overflow:'hidden'}}><div style={{width:`${t.strength}%`,height:'100%',background:t.strength>=70?T.accent:t.strength>=50?T.blue:T.amber,borderRadius:3}}/></div>
                              <span style={{ fontSize: 16, fontWeight: 900, fontFamily: mono, color: t.strength >= 70 ? T.accent : t.strength >= 50 ? T.blue : T.amber }}>{t.strength}%</span>
                            </div>
                            <Badge color={t.status.includes('Active') ? T.accent : t.status.includes('Warm') ? T.blue : t.status.includes('Cold') ? T.red : T.textMuted}>{t.status}</Badge>
                          </div>
                        </div>
                        <div style={{ padding: 10, background: T.bgAccent, borderRadius: 6, marginBottom: 6 }}>
                          <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Best Path ({t.hops} hops)</div>
                          <div style={{ fontSize: 13, color: T.accent, fontWeight: 700, fontFamily: mono }}>{t.bestPath}</div>
                        </div>
                        {t.alternates.map((a, j) => (
                          <div key={j} style={{ fontSize: 10, color: T.textMuted, padding: '3px 0' }}>Alt: {a}</div>
                        ))}
                      </div>
                    ))}
                  </div>
                )}

                {netView === 'decay' && (
                  <div>
                    <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Relationship Decay Alerts — Re-Engage Before You Lose Access</div>
                    {decayAlerts.sort((a,b) => (a.risk==='HIGH'?0:a.risk==='MEDIUM'?1:2) - (b.risk==='HIGH'?0:b.risk==='MEDIUM'?1:2)).map((d, i) => (
                      <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '14px 16px', marginBottom: 6, borderLeft: `3px solid ${d.risk === 'HIGH' ? T.red : d.risk === 'MEDIUM' ? T.amber : T.green}`, display: 'flex', gap: 14 }}>
                        <div style={{ minWidth: 60, textAlign: 'center' }}>
                          <Badge color={d.risk === 'HIGH' ? T.red : d.risk === 'MEDIUM' ? T.amber : T.green}>{d.risk}</Badge>
                          <div style={{ fontSize: 9, color: T.textDim, marginTop: 4 }}>{d.lastTouch}</div>
                        </div>
                        <div style={{ flex: 1 }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                            <span style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{d.contact}</span>
                            <span style={{ fontSize: 10, fontFamily: mono, color: T.gold, fontWeight: 700 }}>{d.value}</span>
                          </div>
                          <div style={{ fontSize: 10, color: T.textDim, marginBottom: 4 }}>via {d.via}</div>
                          <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6 }}>{d.action}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {netView === 'gaps' && (
                  <div>
                    <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Network Gap Analysis — Strategic Blind Spots</div>
                    {networkGaps.map((g, i) => (
                      <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 8 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                            <span style={{ fontSize: 15, fontWeight: 700, color: T.text }}>{g.sector}</span>
                            <Badge color={g.gap==='CRITICAL'?T.red:g.gap==='HIGH'?T.amber:T.blue}>{g.gap}</Badge>
                          </div>
                          <div style={{ display: 'flex', gap: 10, alignItems: 'center' }}>
                            <span style={{ fontSize: 11, fontFamily: mono }}><span style={{ color: T.textDim }}>Current:</span> <span style={{ color: g.current === 0 ? T.red : T.amber, fontWeight: 700 }}>{g.current}</span></span>
                            <span style={{ fontSize: 11, fontFamily: mono }}><span style={{ color: T.textDim }}>Target:</span> <span style={{ color: T.accent, fontWeight: 700 }}>{g.target}</span></span>
                          </div>
                        </div>
                        <div style={{ padding: 10, background: T.bgAccent, borderRadius: 6, marginBottom: 6 }}>
                          <div style={{ fontSize: 11, color: T.textMuted, lineHeight: 1.6 }}>{g.opportunity}</div>
                        </div>
                        <div style={{ fontSize: 11, color: T.accent, fontWeight: 600 }}>→ {g.action}</div>
                      </div>
                    ))}
                  </div>
                )}

                {netView === 'roi' && (
                  <div>
                    <Card title="Network ROI — Connections to Capital" style={{ marginBottom: 14 }}>
                      <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                        <thead><tr>{['Partner', 'Connections', 'Deals Sourced', 'LP Capital', 'Fund NAV Managed', '$/Connection', 'Network Score'].map(h => <TH key={h} align={h==='Partner'?'left':'right'}>{h}</TH>)}</tr></thead>
                        <tbody>{TEAM.map(t => {
                          const firstName = t.name.split(' ')[0];
                          const lpCap = LPS.filter(l=>l.relationship===firstName).reduce((s,l)=>s+parseInt(l.potential),0);
                          const ownerMap = { Ken: [1,2,6], Jason: [3,7], Bob: [4,8], Brett: [5], Matthew: [] };
                          const fundNAV = FUNDS.filter(f=>(ownerMap[firstName]||[]).includes(f.id)).reduce((s,f)=>s+f.nav,0);
                          const totalVal = lpCap + fundNAV;
                          const perConn = t.connections > 0 ? (totalVal / t.connections * 1000).toFixed(0) : 0;
                          const networkScore = Math.min(99, Math.round(t.connections * 0.08 + t.deals * 1.2 + lpCap * 0.3 + fundNAV * 0.05));
                          return (
                            <TR key={t.id}>
                              <TD bold>{t.name}</TD>
                              <TD align="right" mono color={T.purple}>{t.connections}</TD>
                              <TD align="right" mono bold>{t.deals}</TD>
                              <TD align="right" mono bold color={T.gold}>${lpCap}M</TD>
                              <TD align="right" mono bold color={T.accent}>${fundNAV.toFixed(1)}M</TD>
                              <TD align="right" mono color={parseInt(perConn)>=200?T.accent:T.text}>${perConn}K</TD>
                              <TD align="right"><div style={{display:'flex',alignItems:'center',gap:4,justifyContent:'flex-end'}}>
                                <div style={{width:40,height:6,background:T.bgAccent,borderRadius:3,overflow:'hidden'}}><div style={{width:`${networkScore}%`,height:'100%',background:networkScore>=80?T.accent:networkScore>=60?T.blue:T.amber,borderRadius:3}}/></div>
                                <span style={{fontSize:13,fontFamily:mono,fontWeight:800,color:networkScore>=80?T.accent:networkScore>=60?T.blue:T.amber}}>{networkScore}</span>
                              </div></TD>
                            </TR>
                          );
                        })}</tbody>
                      </table></div>
                    </Card>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>
                      <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${T.accent}`, textAlign: 'center' }}>
                        <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Network-Sourced Capital</div>
                        <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.accent }}>$207M</div>
                        <div style={{ fontSize: 10, color: T.textMuted }}>86% of all capital raised</div>
                      </div>
                      <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${T.blue}`, textAlign: 'center' }}>
                        <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Avg Relationship Age</div>
                        <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.blue }}>7.2 yrs</div>
                        <div style={{ fontSize: 10, color: T.textMuted }}>deep trust-based network</div>
                      </div>
                      <div style={{ padding: 16, background: T.bgCard, borderRadius: 8, border: `1px solid ${T.border}`, borderTop: `3px solid ${T.green}`, textAlign: 'center' }}>
                        <div style={{ fontSize: 9, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Network Velocity</div>
                        <div style={{ fontSize: 28, fontWeight: 900, fontFamily: mono, color: T.green }}>3.2 days</div>
                        <div style={{ fontSize: 10, color: T.textMuted }}>avg time from intro to meeting</div>
                      </div>
                    </div>
                  </div>
                )}

                {netView === 'influence' && (
                  <div>
                    <Card title="Strategic Influence Map — Power Brokers in NEWCO's Ecosystem" style={{ marginBottom: 14 }}>
                      <div style={{ padding: 0 }}>{[
                        { name: 'Peter Thiel', role: 'Founders Fund / Palantir', influence: 98, connections: ['SpaceX', 'Anduril', 'Palantir', 'Valar Ventures', 'Mithril'], reach: 'Defense-AI nexus. Controls $12B+ fund family. LP anchor + deal flow kingmaker.', owner: 'Jason', relationship: 'Strong via FF VII commitment', actionable: 'Leverage for xAI access and Anduril IPO intel' },
                        { name: 'Jensen Huang', role: 'NVIDIA CEO', influence: 96, connections: ['NVIDIA Inception', 'CoreWeave', 'Crusoe Energy', 'Lambda Labs', 'Together AI'], reach: 'GPU supply chain. Every AI company depends on NVIDIA. Ecosystem intelligence goldmine.', owner: 'Ken (via a16z)', relationship: 'Warm — 2 hops', actionable: 'NVIDIA Inception co-invest program access ($200M potential)' },
                        { name: 'Dario Amodei', role: 'Anthropic CEO', influence: 95, connections: ['Anthropic', 'AI Safety Inst.', 'Constitutional AI', 'Google DeepMind'], reach: 'AI Safety thought leader. NEWCO\'s thesis perfectly aligned. Direct portfolio exposure.', owner: 'Bob', relationship: 'Direct — Anthropic investor', actionable: 'Co-invest access on future rounds + AI Safety network referrals' },
                        { name: 'Marc Andreessen', role: 'a16z GP', influence: 94, connections: ['a16z portfolio', 'Databricks', 'Scale AI', 'OpenAI', 'Mistral'], reach: '$42B AUM. Defines AI narrative. Fund-to-fund relationship critical for deal flow.', owner: 'Ken', relationship: 'Active — a16z Infra LP', actionable: 'Early access to a16z AI Safety deals + secondary pricing intel' },
                        { name: 'Alex Karp', role: 'Palantir CEO', influence: 88, connections: ['Palantir AIP', 'US DoD', 'CIA', 'Five Eyes', 'NATO AI'], reach: 'GovTech kingpin. Government AI spending flows through Palantir ecosystem.', owner: 'Ken (via NEA 19)', relationship: 'Moderate — NEA LP + Palantir investor', actionable: 'Palantir AIP Fund co-invest + government AI contract intelligence' },
                        { name: 'Palmer Luckey', role: 'Anduril CEO', influence: 87, connections: ['Anduril', 'Shield AI', 'Rebellion', 'US DoD', 'Lattice'], reach: 'Defense tech founder. Direct portfolio co. IPO on horizon = catalyst for NEWCO NAV.', owner: 'Jason', relationship: 'Direct — Anduril growth investor', actionable: 'IPO timing intel + defense tech deal referrals' },
                        { name: 'Reid Hoffman', role: 'Greylock / LinkedIn', influence: 85, connections: ['Greylock', 'Inflection AI', 'OpenAI board', 'Microsoft'], reach: 'OpenAI bridge. Silicon Valley super-connector. Critical for OpenAI Ecosystem access.', owner: 'Jason', relationship: 'Decaying — 5 months cold', actionable: 'URGENT re-engage for OpenAI Fund intro' },
                      ].map((p, i) => (
                        <div key={i} style={{ padding: '14px 18px', borderBottom: i < 6 ? `1px solid ${T.border}` : 'none' }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>
                            <div>
                              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                <span style={{ fontSize: 14, fontWeight: 700, color: T.text }}>{p.name}</span>
                                <span style={{ fontSize: 10, color: T.textDim }}>{p.role}</span>
                              </div>
                              <div style={{ fontSize: 10, color: T.textMuted }}>Owner: {p.owner} · {p.relationship}</div>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                              <div style={{width:50,height:6,background:T.bgAccent,borderRadius:3,overflow:'hidden'}}><div style={{width:`${p.influence}%`,height:'100%',background:p.influence>=95?T.accent:p.influence>=85?T.blue:T.purple,borderRadius:3}}/></div>
                              <span style={{ fontSize: 16, fontWeight: 900, fontFamily: mono, color: p.influence >= 95 ? T.accent : p.influence >= 85 ? T.blue : T.purple }}>{p.influence}</span>
                            </div>
                          </div>
                          <div style={{ display: 'flex', gap: 4, marginBottom: 4, flexWrap: 'wrap' }}>{p.connections.map(c => <Badge key={c} color={T.bgAccent}>{c}</Badge>)}</div>
                          <div style={{ fontSize: 11, color: T.textMuted, marginBottom: 3 }}>{p.reach}</div>
                          <div style={{ fontSize: 11, color: T.accent, fontWeight: 500 }}>Action: {p.actionable}</div>
                        </div>
                      ))}</div>
                    </Card>
                  </div>
                )}

                {netView === 'events' && (
                  <div>
                    <Card title="Event & Conference ROI Analysis" style={{ marginBottom: 14 }}>
                      <div style={{overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}>
                        <thead><tr>{['Event', 'Date', 'Cost', 'New Contacts', 'Deals', 'LP Intros', 'Capital Linked', 'ROI'].map(h => <TH key={h} align={['Event','Date'].includes(h)?'left':'right'}>{h}</TH>)}</tr></thead>
                        <tbody>{[
                          { event: 'Milken Institute Conference', date: 'May 2025', cost: '$15K', connections: 28, deals: 3, lpIntros: 2, capital: '$48M', roi: '320x' },
                          { event: 'SuperReturn (Berlin)', date: 'Jun 2025', cost: '$22K', connections: 42, deals: 2, lpIntros: 4, capital: '$35M', roi: '159x' },
                          { event: 'LP-GP Summit (NYC)', date: 'Sep 2025', cost: '$8K', connections: 16, deals: 0, lpIntros: 5, capital: '$25M', roi: '312x' },
                          { event: 'RSA Conference', date: 'Apr 2025', cost: '$12K', connections: 22, deals: 4, lpIntros: 0, capital: '$22M', roi: '183x' },
                          { event: 'Berkeley AI Summit', date: 'Nov 2025', cost: '$3K', connections: 35, deals: 2, lpIntros: 1, capital: '$15M', roi: '500x' },
                          { event: 'SALT Conference', date: 'Sep 2025', cost: '$18K', connections: 19, deals: 0, lpIntros: 3, capital: '$12M', roi: '67x' },
                          { event: 'Stern Grove Festival', date: 'Jul 2025', cost: '$5K', connections: 12, deals: 0, lpIntros: 2, capital: '$8M', roi: '160x' },
                        ].map((e, i) => (
                          <TR key={i}>
                            <TD bold>{e.event}</TD>
                            <TD color={T.textDim}>{e.date}</TD>
                            <TD align="right" mono color={T.red}>{e.cost}</TD>
                            <TD align="right" mono>{e.connections}</TD>
                            <TD align="right" mono bold color={e.deals > 0 ? T.accent : T.textDim}>{e.deals}</TD>
                            <TD align="right" mono bold color={e.lpIntros > 0 ? T.gold : T.textDim}>{e.lpIntros}</TD>
                            <TD align="right" mono bold color={T.accent}>{e.capital}</TD>
                            <TD align="right" mono bold color={parseInt(e.roi) >= 200 ? T.accent : parseInt(e.roi) >= 100 ? T.blue : T.text}>{e.roi}</TD>
                          </TR>
                        ))}</tbody>
                      </table></div>
                    </Card>
                    <Card title="2026 Event Calendar — Strategic Attendance Plan">
                      <div style={{ padding: 0 }}>{[
                        { event: 'CES (Las Vegas)', date: 'Jan 2026', attendee: 'Brett', objective: 'AI hardware / defense tech scouting', budget: '$10K', expectedROI: 'Deal sourcing — 2-3 new pipeline entries' },
                        { event: 'RSA Conference', date: 'Apr 2026', attendee: 'Bob', objective: 'Trust & Safety GP relationships', budget: '$12K', expectedROI: 'CrowdStrike M&A intel + Drata secondary pricing' },
                        { event: 'Hightower Conference', date: 'Apr 2026', attendee: 'Brett', objective: 'RIA LP channel development', budget: '$15K', expectedROI: '$20M LP pipeline from Hightower platform' },
                        { event: 'Milken Institute', date: 'May 2026', attendee: 'Jason + Ken', objective: 'Sovereign wealth intros + LP upsells', budget: '$18K', expectedROI: '$50M+ LP pipeline from ADIA/Mubadala' },
                        { event: 'SuperReturn', date: 'Jun 2026', attendee: 'Ken + Matthew', objective: 'European LP expansion + GP relationships', budget: '$25K', expectedROI: '$30M international LP pipeline' },
                        { event: 'Berkeley AI Summit', date: 'Nov 2026', attendee: 'Jason', objective: 'UC Berkeley endowment + AI Safety deal flow', budget: '$3K', expectedROI: '$10M endowment commitment + 3 deal leads' },
                      ].map((e, i) => (
                        <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 14, padding: '14px 18px', borderBottom: i < 5 ? `1px solid ${T.border}` : 'none' }}>
                          <div style={{ minWidth: 80, padding: '6px 10px', background: T.bgAccent, borderRadius: 4, textAlign: 'center' }}>
                            <div style={{ fontSize: 11, fontWeight: 700, fontFamily: mono, color: T.accent }}>{e.date.split(' ')[0]}</div>
                            <div style={{ fontSize: 9, color: T.textDim }}>{e.date.split(' ')[1]}</div>
                          </div>
                          <div style={{ flex: 1 }}>
                            <div style={{ fontSize: 13, fontWeight: 700, color: T.text }}>{e.event}</div>
                            <div style={{ fontSize: 10, color: T.textMuted }}>{e.objective}</div>
                            <div style={{ fontSize: 10, color: T.accent, fontWeight: 500, marginTop: 2 }}>Expected: {e.expectedROI}</div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <Badge color={T.purple}>{e.attendee}</Badge>
                            <div style={{ fontSize: 10, fontFamily: mono, color: T.textDim, marginTop: 4 }}>{e.budget}</div>
                          </div>
                        </div>
                      ))}</div>
                    </Card>
                  </div>
                )}

                {netView === 'ecosystem' && (
                  <div>
                    <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', letterSpacing: '1px', fontWeight: 700, marginBottom: 10 }}>Strategic Partnership Ecosystem — Force Multipliers</div>
                    {[
                      { partner: 'Cambridge Associates', type: 'Benchmark Provider', status: 'Active', value: 'Institutional credibility + LP referral pipeline', metrics: 'Included in CA VC FoF platform → 200+ institutional LP prospects', actions: ['Maintain 81st percentile performance', 'Annual data submission by Mar 31', 'Request inclusion in model portfolio recommendations'], color: T.accent },
                      { partner: 'Goldman Sachs Advisory', type: 'Placement Agent', status: 'Evaluating', value: 'Access to $2T+ PWM channel + model portfolio placement', metrics: 'Could unlock 800+ advisors at avg $62K = $49.6M in AUM', actions: ['Jason + Matthew dinner with Goldstein', 'Provide institutional tear sheet', 'Negotiate fee structure (1.5-2% on capital raised)'], color: T.gold },
                      { partner: 'Park Hill (PJT Partners)', type: 'Placement Agent', status: 'Not Engaged', value: 'Sovereign wealth + pension fund introductions', metrics: 'Top placement agent for sovereign wealth — ADIA, GIC, Temasek', actions: ['Ken to initiate intro conversation', 'Prepare sovereign-specific DDQ', 'Evaluate 2% placement fee vs. $75M+ sovereign commitment'], color: T.blue },
                      { partner: 'UC Berkeley BAIR', type: 'Research Partner', status: 'Active', value: 'AI Safety research pipeline + deal flow from spinouts', metrics: '3 deals sourced via Berkeley network (38% conversion)', actions: ['Jason to formalize advisory relationship', 'Sponsor BAIR AI Safety conference', 'First-look rights on Berkeley AI spinouts'], color: T.purple },
                      { partner: 'Evercore ISI', type: 'Secondary Market Intel', status: 'Active', value: 'Real-time secondary pricing + LP liquidity intel', metrics: 'Used for FF VI pricing (+15% premium captured)', actions: ['Monthly secondary market briefing (Ken)', 'Alert system for target company secondaries', 'Negotiate volume discount on advisory'], color: T.green },
                      { partner: 'PitchBook / CB Insights', type: 'Data & Analytics', status: 'Active', value: 'Competitive intelligence + market sizing + benchmarking', metrics: 'Powers the Omniscient deal scoring algorithm', actions: ['API integration for real-time pipeline scoring', 'Custom AI Safety sector reports', 'Quarterly market benchmark for LP letters'], color: T.cyan },
                    ].map((p, i) => (
                      <div key={i} style={{ background: T.bgCard, border: `1px solid ${T.border}`, borderRadius: 8, padding: '16px 18px', marginBottom: 10, borderLeft: `3px solid ${p.color}` }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                          <div>
                            <div style={{ fontSize: 15, fontWeight: 700, color: T.text }}>{p.partner}</div>
                            <div style={{ display: 'flex', gap: 6 }}><Badge color={p.color}>{p.type}</Badge><Badge color={p.status === 'Active' ? T.accent : p.status === 'Evaluating' ? T.amber : T.textMuted}>{p.status}</Badge></div>
                          </div>
                        </div>
                        <div style={{ fontSize: 12, color: T.text, fontWeight: 500, marginBottom: 4 }}>{p.value}</div>
                        <div style={{ fontSize: 11, color: T.accent, fontFamily: mono, marginBottom: 6 }}>{p.metrics}</div>
                        <div style={{ fontSize: 10, color: T.textDim, textTransform: 'uppercase', marginBottom: 4 }}>Action Items:</div>
                        {p.actions.map((a, j) => <div key={j} style={{ fontSize: 11, color: T.textMuted, padding: '2px 0', paddingLeft: 10, borderLeft: `2px solid ${p.color}30` }}>• {a}</div>)}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            );
          })()}
        </div>
      </div>
    </div>
  );
}
